var b_=Object.defineProperty;var w_=(n,l,c)=>l in n?b_(n,l,{enumerable:!0,configurable:!0,writable:!0,value:c}):n[l]=c;var M_=(n,l)=>()=>(l||n((l={exports:{}}).exports,l),l.exports);var In=(n,l,c)=>(w_(n,typeof l!="symbol"?l+"":l,c),c);var Dw=M_(Qi=>{(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))m(g);new MutationObserver(g=>{for(const x of g)if(x.type==="childList")for(const w of x.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&m(w)}).observe(document,{childList:!0,subtree:!0});function c(g){const x={};return g.integrity&&(x.integrity=g.integrity),g.referrerpolicy&&(x.referrerPolicy=g.referrerpolicy),g.crossorigin==="use-credentials"?x.credentials="include":g.crossorigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function m(g){if(g.ep)return;g.ep=!0;const x=c(g);fetch(g.href,x)}})();function ni(){}const Ku=n=>n;function E_(n,l){for(const c in l)n[c]=l[c];return n}function Ip(n){return n()}function Lf(){return Object.create(null)}function Ln(n){n.forEach(Ip)}function Ol(n){return typeof n=="function"}function gr(n,l){return n!=n?l==l:n!==l||n&&typeof n=="object"||typeof n=="function"}let Yh;function T_(n,l){return Yh||(Yh=document.createElement("a")),Yh.href=l,n===Yh.href}function S_(n){return Object.keys(n).length===0}function Ap(n,...l){if(n==null)return ni;const c=n.subscribe(...l);return c.unsubscribe?()=>c.unsubscribe():c}function I_(n){let l;return Ap(n,c=>l=c)(),l}function Cp(n,l,c){n.$$.on_destroy.push(Ap(l,c))}function Ju(n,l,c,m){if(n){const g=kp(n,l,c,m);return n[0](g)}}function kp(n,l,c,m){return n[1]&&m?E_(c.ctx.slice(),n[1](m(l))):c.ctx}function Yu(n,l,c,m){if(n[2]&&m){const g=n[2](m(c));if(l.dirty===void 0)return g;if(typeof g=="object"){const x=[],w=Math.max(l.dirty.length,g.length);for(let a=0;a<w;a+=1)x[a]=l.dirty[a]|g[a];return x}return l.dirty|g}return l.dirty}function Qu(n,l,c,m,g,x){if(g){const w=kp(l,c,m,x);n.p(w,g)}}function ed(n){if(n.ctx.length>32){const l=[],c=n.ctx.length/32;for(let m=0;m<c;m++)l[m]=-1;return l}return-1}function Df(n){return n??""}function Pu(n){return n&&Ol(n.destroy)?n.destroy:ni}const Pp=typeof window<"u";let zp=Pp?()=>window.performance.now():()=>Date.now(),td=Pp?n=>requestAnimationFrame(n):ni;const co=new Set;function Lp(n){co.forEach(l=>{l.c(n)||(co.delete(l),l.f())}),co.size!==0&&td(Lp)}function Dp(n){let l;return co.size===0&&td(Lp),{promise:new Promise(c=>{co.add(l={c:n,f:c})}),abort(){co.delete(l)}}}function xt(n,l){n.appendChild(l)}function Rp(n){if(!n)return document;const l=n.getRootNode?n.getRootNode():n.ownerDocument;return l&&l.host?l:n.ownerDocument}function A_(n){const l=gt("style");return C_(Rp(n),l),l.sheet}function C_(n,l){return xt(n.head||n,l),l.sheet}function ut(n,l,c){n.insertBefore(l,c||null)}function ht(n){n.parentNode&&n.parentNode.removeChild(n)}function zl(n,l){for(let c=0;c<n.length;c+=1)n[c]&&n[c].d(l)}function gt(n){return document.createElement(n)}function Rf(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function Di(n){return document.createTextNode(n)}function jt(){return Di(" ")}function wc(){return Di("")}function ki(n,l,c,m){return n.addEventListener(l,c,m),()=>n.removeEventListener(l,c,m)}function We(n,l,c){c==null?n.removeAttribute(l):n.getAttribute(l)!==c&&n.setAttribute(l,c)}function k_(n){return Array.from(n.childNodes)}function Vs(n,l){l=""+l,n.wholeText!==l&&(n.data=l)}function Oi(n,l,c,m){c===null?n.style.removeProperty(l):n.style.setProperty(l,c,m?"important":"")}function uc(n,l){for(let c=0;c<n.options.length;c+=1){const m=n.options[c];if(m.__value===l){m.selected=!0;return}}n.selectedIndex=-1}function Bp(n){const l=n.querySelector(":checked")||n.options[0];return l&&l.__value}function Bf(n,l,c){n.classList[c?"add":"remove"](l)}function Op(n,l,{bubbles:c=!1,cancelable:m=!1}={}){const g=document.createEvent("CustomEvent");return g.initCustomEvent(n,c,m,l),g}const dc=new Map;let fc=0;function P_(n){let l=5381,c=n.length;for(;c--;)l=(l<<5)-l^n.charCodeAt(c);return l>>>0}function z_(n,l){const c={stylesheet:A_(l),rules:{}};return dc.set(n,c),c}function Fp(n,l,c,m,g,x,w,a=0){const S=16.666/m;let P=`{
`;for(let fe=0;fe<=1;fe+=S){const De=l+(c-l)*x(fe);P+=fe*100+`%{${w(De,1-De)}}
`}const q=P+`100% {${w(c,1-c)}}
}`,R=`__svelte_${P_(q)}_${a}`,F=Rp(n),{stylesheet:Q,rules:le}=dc.get(F)||z_(F,n);le[R]||(le[R]=!0,Q.insertRule(`@keyframes ${R} ${q}`,Q.cssRules.length));const de=n.style.animation||"";return n.style.animation=`${de?`${de}, `:""}${R} ${m}ms linear ${g}ms 1 both`,fc+=1,R}function Nu(n,l){const c=(n.style.animation||"").split(", "),m=c.filter(l?x=>x.indexOf(l)<0:x=>x.indexOf("__svelte")===-1),g=c.length-m.length;g&&(n.style.animation=m.join(", "),fc-=g,fc||L_())}function L_(){td(()=>{fc||(dc.forEach(n=>{const{ownerNode:l}=n.stylesheet;l&&ht(l)}),dc.clear())})}let Ll;function Il(n){Ll=n}function Fl(){if(!Ll)throw new Error("Function called outside component initialization");return Ll}function id(n){Fl().$$.on_mount.push(n)}function Np(n){Fl().$$.on_destroy.push(n)}function D_(){const n=Fl();return(l,c,{cancelable:m=!1}={})=>{const g=n.$$.callbacks[l];if(g){const x=Op(l,c,{cancelable:m});return g.slice().forEach(w=>{w.call(n,x)}),!x.defaultPrevented}return!0}}function Mc(n,l){return Fl().$$.context.set(n,l),l}function mo(n){return Fl().$$.context.get(n)}const Ml=[],pn=[],ac=[],Uu=[],Up=Promise.resolve();let Vu=!1;function Vp(){Vu||(Vu=!0,Up.then($p))}function R_(){return Vp(),Up}function _s(n){ac.push(n)}function Al(n){Uu.push(n)}const zu=new Set;let Qh=0;function $p(){const n=Ll;do{for(;Qh<Ml.length;){const l=Ml[Qh];Qh++,Il(l),B_(l.$$)}for(Il(null),Ml.length=0,Qh=0;pn.length;)pn.pop()();for(let l=0;l<ac.length;l+=1){const c=ac[l];zu.has(c)||(zu.add(c),c())}ac.length=0}while(Ml.length);for(;Uu.length;)Uu.pop()();Vu=!1,zu.clear(),Il(n)}function B_(n){if(n.fragment!==null){n.update(),Ln(n.before_update);const l=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,l),n.after_update.forEach(_s)}}let yl;function qp(){return yl||(yl=Promise.resolve(),yl.then(()=>{yl=null})),yl}function pc(n,l,c){n.dispatchEvent(Op(`${l?"intro":"outro"}${c}`))}const oc=new Set;let $s;function go(){$s={r:0,c:[],p:$s}}function _o(){$s.r||Ln($s.c),$s=$s.p}function ti(n,l){n&&n.i&&(oc.delete(n),n.i(l))}function gi(n,l,c,m){if(n&&n.o){if(oc.has(n))return;oc.add(n),$s.c.push(()=>{oc.delete(n),m&&(c&&n.d(1),m())}),n.o(l)}else m&&m()}const Gp={duration:0};function O_(n,l,c){const m={direction:"in"};let g=l(n,c,m),x=!1,w,a,S=0;function P(){w&&Nu(n,w)}function q(){const{delay:F=0,duration:Q=300,easing:le=Ku,tick:de=ni,css:fe}=g||Gp;fe&&(w=Fp(n,0,1,Q,F,le,fe,S++)),de(0,1);const De=zp()+F,Ee=De+Q;a&&a.abort(),x=!0,_s(()=>pc(n,!0,"start")),a=Dp(xe=>{if(x){if(xe>=Ee)return de(1,0),pc(n,!0,"end"),P(),x=!1;if(xe>=De){const Te=le((xe-De)/Q);de(Te,1-Te)}}return x})}let R=!1;return{start(){R||(R=!0,Nu(n),Ol(g)?(g=g(m),qp().then(q)):q())},invalidate(){R=!1},end(){x&&(P(),x=!1)}}}function F_(n,l,c){const m={direction:"out"};let g=l(n,c,m),x=!0,w;const a=$s;a.r+=1;function S(){const{delay:P=0,duration:q=300,easing:R=Ku,tick:F=ni,css:Q}=g||Gp;Q&&(w=Fp(n,1,0,q,P,R,Q));const le=zp()+P,de=le+q;_s(()=>pc(n,!1,"start")),Dp(fe=>{if(x){if(fe>=de)return F(0,1),pc(n,!1,"end"),--a.r||Ln(a.c),!1;if(fe>=le){const De=R((fe-le)/q);F(1-De,De)}}return x})}return Ol(g)?qp().then(()=>{g=g(m),S()}):S(),{end(P){P&&g.tick&&g.tick(1,0),x&&(w&&Nu(n,w),x=!1)}}}const N_=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Cl(n,l,c,m){const g=n.$$.props[l];g!==void 0&&(n.$$.bound[g]=c,m===void 0&&c(n.$$.ctx[g]))}function Er(n){n&&n.c()}function pr(n,l,c,m){const{fragment:g,after_update:x}=n.$$;g&&g.m(l,c),m||_s(()=>{const w=n.$$.on_mount.map(Ip).filter(Ol);n.$$.on_destroy?n.$$.on_destroy.push(...w):Ln(w),n.$$.on_mount=[]}),x.forEach(_s)}function mr(n,l){const c=n.$$;c.fragment!==null&&(Ln(c.on_destroy),c.fragment&&c.fragment.d(l),c.on_destroy=c.fragment=null,c.ctx=[])}function U_(n,l){n.$$.dirty[0]===-1&&(Ml.push(n),Vp(),n.$$.dirty.fill(0)),n.$$.dirty[l/31|0]|=1<<l%31}function Sr(n,l,c,m,g,x,w,a=[-1]){const S=Ll;Il(n);const P=n.$$={fragment:null,ctx:[],props:x,update:ni,not_equal:g,bound:Lf(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(S?S.$$.context:[])),callbacks:Lf(),dirty:a,skip_bound:!1,root:l.target||S.$$.root};w&&w(P.root);let q=!1;if(P.ctx=c?c(n,l.props||{},(R,F,...Q)=>{const le=Q.length?Q[0]:F;return P.ctx&&g(P.ctx[R],P.ctx[R]=le)&&(!P.skip_bound&&P.bound[R]&&P.bound[R](le),q&&U_(n,R)),F}):[],P.update(),q=!0,Ln(P.before_update),P.fragment=m?m(P.ctx):!1,l.target){if(l.hydrate){const R=k_(l.target);P.fragment&&P.fragment.l(R),R.forEach(ht)}else P.fragment&&P.fragment.c();l.intro&&ti(n.$$.fragment),pr(n,l.target,l.anchor,l.customElement),$p()}Il(S)}class Ir{$destroy(){mr(this,1),this.$destroy=ni}$on(l,c){if(!Ol(c))return ni;const m=this.$$.callbacks[l]||(this.$$.callbacks[l]=[]);return m.push(c),()=>{const g=m.indexOf(c);g!==-1&&m.splice(g,1)}}$set(l){this.$$set&&!S_(l)&&(this.$$.skip_bound=!0,this.$$set(l),this.$$.skip_bound=!1)}}const V_=n=>({value:n&16}),Of=n=>({value:n[4]});function Ff(n){let l,c,m=(n[7]||n[3])&&n[4]&&Nf(n);return{c(){m&&m.c(),l=wc()},m(g,x){m&&m.m(g,x),ut(g,l,x),c=!0},p(g,x){(g[7]||g[3])&&g[4]?m?(m.p(g,x),x&152&&ti(m,1)):(m=Nf(g),m.c(),ti(m,1),m.m(l.parentNode,l)):m&&(go(),gi(m,1,1,()=>{m=null}),_o())},i(g){c||(ti(m),c=!0)},o(g){gi(m),c=!1},d(g){m&&m.d(g),g&&ht(l)}}}function Nf(n){let l,c,m;const g=n[16].default,x=Ju(g,n,n[15],Of);return{c(){l=gt("div"),x&&x.c(),We(l,"id",n[1]),We(l,"class",c="svelte-use-form-hint "+n[0])},m(w,a){ut(w,l,a),x&&x.m(l,null),m=!0},p(w,a){x&&x.p&&(!m||a&32784)&&Qu(x,g,w,w[15],m?Yu(g,w[15],a,V_):ed(w[15]),Of),(!m||a&2)&&We(l,"id",w[1]),(!m||a&1&&c!==(c="svelte-use-form-hint "+w[0]))&&We(l,"class",c)},i(w){m||(ti(x,w),m=!0)},o(w){gi(x,w),m=!1},d(w){w&&ht(l),x&&x.d(w)}}}function $_(n){let l,c,m=!(n[2]&&n[5])&&!n[6]&&Ff(n);return{c(){m&&m.c(),l=wc()},m(g,x){m&&m.m(g,x),ut(g,l,x),c=!0},p(g,[x]){!(g[2]&&g[5])&&!g[6]?m?(m.p(g,x),x&100&&ti(m,1)):(m=Ff(g),m.c(),ti(m,1),m.m(l.parentNode,l)):m&&(go(),gi(m,1,1,()=>{m=null}),_o())},i(g){c||(ti(m),c=!0)},o(g){gi(m),c=!1},d(g){m&&m.d(g),g&&ht(l)}}}function q_(n,l,c){let m,g,x,w,a,S,{$$slots:P={},$$scope:q}=l,{for:R=""}=l,{form:F="svelte-use-form"}=l,{class:Q=""}=l,{id:le=void 0}=l,{on:de=""}=l,{hideWhen:fe=""}=l,{hideWhenRequired:De=!1}=l,{showWhenUntouched:Ee=!1}=l;R||(R=mo(`${F}_hint-group-name`));const xe=mo(F);return Cp(n,xe,Te=>c(14,S=Te)),n.$$set=Te=>{"for"in Te&&c(9,R=Te.for),"form"in Te&&c(10,F=Te.form),"class"in Te&&c(0,Q=Te.class),"id"in Te&&c(1,le=Te.id),"on"in Te&&c(11,de=Te.on),"hideWhen"in Te&&c(12,fe=Te.hideWhen),"hideWhenRequired"in Te&&c(2,De=Te.hideWhenRequired),"showWhenUntouched"in Te&&c(3,Ee=Te.showWhenUntouched),"$$scope"in Te&&c(15,q=Te.$$scope)},n.$$.update=()=>{var Te,qe;n.$$.dirty&16896&&c(7,m=((Te=S[R])==null?void 0:Te.touched)??{}),n.$$.dirty&16896&&c(13,g=((qe=S[R])==null?void 0:qe.errors)??{}),n.$$.dirty&12288&&c(6,x=fe?g[fe]:""),n.$$.dirty&8192&&c(5,w=g.required),n.$$.dirty&10240&&c(4,a=g[de])},[Q,le,De,Ee,a,w,x,m,xe,R,F,de,fe,g,S,q,P]}class jp extends Ir{constructor(l){super(),Sr(this,l,q_,$_,gr,{for:9,form:10,class:0,id:1,on:11,hideWhen:12,hideWhenRequired:2,showWhenUntouched:3})}}const G_=n=>({form:n&1}),Uf=n=>({form:n[0]});function j_(n){let l;const c=n[3].default,m=Ju(c,n,n[2],Uf);return{c(){m&&m.c()},m(g,x){m&&m.m(g,x),l=!0},p(g,[x]){m&&m.p&&(!l||x&5)&&Qu(m,c,g,g[2],l?Yu(c,g[2],x,G_):ed(g[2]),Uf)},i(g){l||(ti(m,g),l=!0)},o(g){gi(m,g),l=!1},d(g){m&&m.d(g)}}}function Z_(n,l,c){let{$$slots:m={},$$scope:g}=l,{form:x="svelte-use-form"}=l,{for:w=""}=l;return Mc(`${x}_hint-group-name`,w),n.$$set=a=>{"form"in a&&c(0,x=a.form),"for"in a&&c(1,w=a.for),"$$scope"in a&&c(2,g=a.$$scope)},[x,w,g,m]}class H_ extends Ir{constructor(l){super(),Sr(this,l,Z_,j_,gr,{form:0,for:1})}}const W_=()=>/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),Zp="svelte-use-form-webkit-autofill",X_=`
@keyframes ${Zp} {
    from {}
}

input:-webkit-autofill {
    animation-name: svelte-use-form-webkit-autofill;
}
`;function K_(){if(document.getElementById("svelte-use-form-chrome-autofill-styles")===null){const n=document.createElement("style");n.setAttribute("id","svelte-use-form-chrome-autofill-styles"),n.setAttribute("type","text/css"),n.appendChild(document.createTextNode(X_)),document.head.appendChild(n)}}function J_(n,l,c){if(!W_())return;function m(g){g.animationName.includes(Zp)&&(n.value||(l.valid=!0,c()))}n.addEventListener("animationstart",m),K_()}class $u{constructor(l){In(this,"validators");In(this,"errors",{});In(this,"errorMap",{});In(this,"elements",[]);In(this,"valid",!0);In(this,"_touched",!1);In(this,"initial");In(this,"formRef");In(this,"_value","");this.formRef=l.formRef,this.validators=l.validators,this.errorMap=l.errorMap,this.initial=l.value,this.elements=l.elements,this.value=l.value}get value(){return this._value}get touched(){return this._touched}set value(l){this._value=l,this.validate()}set touched(l){this._touched=l,this.elements.forEach(c=>{l?c.classList.add("touched"):c.classList.remove("touched")})}error(l){this.errors={...l,...this.errors},this.valid=!1,this.formRef()._notifyListeners()}change(l){this.value=l,this.elements.forEach(c=>c.value=l)}validate(){let l=!0;this.errors={};for(const c of this.validators){const m=c(this.value,this.formRef());if(m){l=!1;for(const g of Object.entries(m)){let[x,w]=g;const a=this.errorMap[x];a&&(w=typeof a=="function"?a(w):a),this.errors[x]=w}}}return this.valid=l,this.elements.forEach(c=>c.setCustomValidity(l?"":"Field is invalid")),l}reset({value:l}={}){const c=l??this.initial;this.elements.forEach(m=>m.value=c),this.value=c,this.touched=!1,this.formRef()._notifyListeners()}}class rd{constructor(l,c){In(this,"_notifyListeners");for(const[m,g]of Object.entries(l))this._addControl(m,g.initial,g.validators,[],g.errorMap);this._notifyListeners=c}static create(l,c){return new rd(l,c)}get valid(){let l=!0;return this.forEachControl(c=>{c.valid||(l=!1)}),l}get touched(){let l=!0;return this.forEachControl(c=>{c.touched||(l=!1)}),l}get values(){let l={};return this.forEachControl((c,m)=>{l[m]=c.value}),l}set touched(l){this.forEachControl(c=>{c.touched=l}),this._notifyListeners()}reset(){this.forEachControl(l=>l.reset())}_addControl(l,c="",m=[],g=[],x={}){this[l]=new $u({value:c,validators:m,elements:g,errorMap:x,formRef:()=>this})}forEachControl(l){for(const[c,m]of Object.entries(this))m instanceof $u&&l(m,c)}}class Vf extends Error{}function Y_(n){return n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement}function ec(n){return n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement||n instanceof HTMLSelectElement}function Hp(n){return n.hasAttribute("data-suf-ignore")&&n.getAttribute("data-suf-ignore")==="true"||n.getAttribute("data-suf-ignore")===!0}const to=[];function Q_(n,l=ni){let c;const m=new Set;function g(a){if(gr(n,a)&&(n=a,c)){const S=!to.length;for(const P of m)P[1](),to.push(P,n);if(S){for(let P=0;P<to.length;P+=2)to[P][0](to[P+1]);to.length=0}}}function x(a){g(a(n))}function w(a,S=ni){const P=[a,S];return m.add(P),m.size===1&&(c=l(g)||ni),a(n),()=>{m.delete(P),m.size===0&&(c(),c=null)}}return{set:g,update:x,subscribe:w}}const Wp=Q_([]);function ey(n={},l="svelte-use-form"){const c=[];let m=[],g=rd.create(n,xe),x;w.subscribe=Te,w.set=nt,Mc(l,w);function w(Fe){return a(Fe),Wp.update(Pe=>[...Pe,{node:Fe,form:g,notifyListeners:xe}]),{update:()=>{},destroy:()=>{Q(),x.disconnect()}}}function a(Fe){const Pe=[...uo(Fe,"input")],Se=[...uo(Fe,"textarea")],He=[...uo(Fe,"select")],Lt=[...Pe,...Se];S(Lt),P(He),De([...Lt,...He]),q(Fe),xe()}function S(Fe){for(const Pe of Fe){const Se=Pe.name;let He=g[Se];if(He)He.elements.push(Pe),Pe.type==="radio"&&Pe instanceof HTMLInputElement&&Pe.checked&&(He.initial=Pe.value);else{const Lt=ty(Pe);g._addControl(Se,Lt,[],[Pe],{}),He=g[Se]}switch(Pe.type){case"checkbox":case"radio":F(Pe,"click",fe);break;default:Ee(Pe,He),le(Pe,He),F(Pe,"blur",fe)}F(Pe,"input",de)}}function P(Fe){for(const Pe of Fe){const Se=Pe.name,He=g[Se];if(He)He.elements.push(Pe),Ee(Pe,He);else{const Lt=Pe.value;g._addControl(Se,Lt,[],[Pe],{})}F(Pe,"input",de),F(Pe,"input",fe),F(Pe,"blur",fe)}}function q(Fe){x=new MutationObserver(R),x.observe(Fe,{childList:!0,subtree:!0})}function R(Fe){for(const Pe of Fe)if(Pe.type==="childList"){for(const Se of Pe.addedNodes){if(!(ec(Se)&&!Hp(Se)))continue;const He=n[Se.name];!g[Se.name]&&He&&g._addControl(Se.name,He.initial,He.validators,[],He.errorMap),Y_(Se)?S([Se]):Se instanceof HTMLSelectElement&&P([Se])}for(const Se of Pe.removedNodes){if(!(Se instanceof HTMLElement))continue;(ec(Se)?[Se]:iy(Se)).forEach(Lt=>{delete g[Lt.name],m=m.filter(It=>It.node!==Lt)})}}xe()}function F(Fe,Pe,Se){Fe.addEventListener(Pe,Se),m.push({node:Fe,event:Pe,listener:Se})}function Q(){for(const{node:Fe,event:Pe,listener:Se}of m)Fe.removeEventListener(Pe,Se)}function le(Fe,Pe){J_(Fe,Pe,xe);function Se(){return Fe.value!==Pe.initial?(fe({target:Fe}),!0):!1}Se()||setTimeout(()=>Se(),100)}function de({target:Fe}){if(ec(Fe)){const Pe=Fe.name,Se=g[Pe];if(!Se)throw new Vf;let He;Fe.type==="checkbox"&&Fe instanceof HTMLInputElement?He=Fe.checked?"checked":"":He=Fe.value,Se.value=He,xe()}}function fe({target:Fe}){if(ec(Fe)){const Pe=g[Fe.name];if(!Pe)throw new Vf;Pe.touched||de({target:Fe}),Pe.touched=!0,Fe.classList.add("touched"),xe()}}function De(Fe){for(const Pe of Object.keys(n)){let Se=!1;for(const He of Fe)Pe===He.name&&(Se=!0);Se||delete g[Pe]}}function Ee(Fe,Pe){Pe.initial&&(Fe.value=Pe.initial)}function xe(){for(const Fe of c)Fe(g)}function Te(Fe){return c.push(Fe),Fe(g),{unsubscribe:()=>qe(Fe)}}function qe(Fe){const Pe=c.indexOf(Fe);c.splice(Pe,1)}function nt(Fe){g=Fe,xe()}return w}function ty(n){let l;return n.type==="radio"&&n instanceof HTMLInputElement?l=n.checked?n.value:"":n.type==="checkbox"&&n instanceof HTMLInputElement?l=n.checked?"checked":"":l=n.value,l}function uo(n,l){return Array.from(n.getElementsByTagName(l)).filter(c=>!Hp(c))}function iy(n){const l=uo(n,"input"),c=uo(n,"textarea"),m=uo(n,"select");return[...l,...c,...m]}function $f(n,l){c();async function c(){const m=n.form;if(!m)throw new Lu("HTML element doesn't have an ancestral form");await R_();const g=I_(Wp).find(w=>w.node===m);if(!g)throw new Lu("HTML form doesn't have a svelte-use-form binded. (use:form)");const x=g.form[n.name];if(!(x instanceof $u))throw new Lu(`Form Control [${n.name}] doesn't exist.`);x.validators.push(...l),x.validate(),g.notifyListeners()}}class Lu extends Error{}function qf(n){return n.trim()?null:{required:"Required"}}function ry(n){let l;return{c(){l=Di("This is a mandatory field")},m(c,m){ut(c,l,m)},d(c){c&&ht(l)}}}function ny(n){let l,c;return l=new jp({props:{on:"required",$$slots:{default:[ry]},$$scope:{ctx:n}}}),{c(){Er(l.$$.fragment)},m(m,g){pr(l,m,g),c=!0},p(m,g){const x={};g&64&&(x.$$scope={dirty:g,ctx:m}),l.$set(x)},i(m){c||(ti(l.$$.fragment,m),c=!0)},o(m){gi(l.$$.fragment,m),c=!1},d(m){mr(l,m)}}}function sy(n){let l;return{c(){l=Di("This is a mandatory field")},m(c,m){ut(c,l,m)},d(c){c&&ht(l)}}}function ay(n){let l,c,m,g,x,w,a,S,P,q,R,F,Q,le,de,fe,De,Ee,xe,Te,qe,nt,Fe,Pe,Se,He,Lt,It;return de=new H_({props:{for:"username",$$slots:{default:[ny]},$$scope:{ctx:n}}}),xe=new jp({props:{for:"password",on:"required",$$slots:{default:[sy]},$$scope:{ctx:n}}}),{c(){l=gt("br"),c=jt(),m=gt("img"),x=jt(),w=gt("br"),a=jt(),S=gt("form"),P=gt("h1"),P.textContent="Connectivity Planning Tool Login",q=jt(),R=gt("br"),F=jt(),Q=gt("input"),le=jt(),Er(de.$$.fragment),fe=jt(),De=gt("input"),Ee=jt(),Er(xe.$$.fragment),Te=jt(),qe=gt("br"),nt=jt(),Fe=gt("button"),Pe=Di("Login"),We(m,"aria-label","DfT logo"),T_(m.src,g="https://raw.githubusercontent.com/ADD-William-WaltersDavis/dft_hackathon/main/assets/images/dft-landingpage-logo.png")||We(m,"src",g),We(m,"height","177"),We(m,"width","261"),We(Q,"type","username"),We(Q,"name","username"),We(De,"type","password"),We(De,"name","password"),Fe.disabled=Se=!n[0].valid},m(Mt,D){ut(Mt,l,D),ut(Mt,c,D),ut(Mt,m,D),ut(Mt,x,D),ut(Mt,w,D),ut(Mt,a,D),ut(Mt,S,D),xt(S,P),xt(S,q),xt(S,R),xt(S,F),xt(S,Q),xt(S,le),pr(de,S,null),xt(S,fe),xt(S,De),xt(S,Ee),pr(xe,S,null),ut(Mt,Te,D),ut(Mt,qe,D),ut(Mt,nt,D),ut(Mt,Fe,D),xt(Fe,Pe),He=!0,Lt||(It=[Pu($f.call(null,Q,[qf])),ki(Q,"keydown",n[3]),Pu($f.call(null,De,[qf])),ki(De,"keydown",n[3]),Pu(n[1].call(null,S)),ki(Fe,"click",n[2])],Lt=!0)},p(Mt,[D]){const K={};D&64&&(K.$$scope={dirty:D,ctx:Mt}),de.$set(K);const H={};D&64&&(H.$$scope={dirty:D,ctx:Mt}),xe.$set(H),(!He||D&1&&Se!==(Se=!Mt[0].valid))&&(Fe.disabled=Se)},i(Mt){He||(ti(de.$$.fragment,Mt),ti(xe.$$.fragment,Mt),He=!0)},o(Mt){gi(de.$$.fragment,Mt),gi(xe.$$.fragment,Mt),He=!1},d(Mt){Mt&&ht(l),Mt&&ht(c),Mt&&ht(m),Mt&&ht(x),Mt&&ht(w),Mt&&ht(a),Mt&&ht(S),mr(de),mr(xe),Mt&&ht(Te),Mt&&ht(qe),Mt&&ht(nt),Mt&&ht(Fe),Lt=!1,Ln(It)}}}function oy(n,l,c){let m;const g=ey();Cp(n,g,P=>c(0,m=P));let{login_username:x}=l,{login_password:w}=l;function a(){let{username:P,password:q}=m.values;c(4,x=P),c(5,w=q)}function S(P){P.key==="Enter"&&m.valid&&a()}return n.$$set=P=>{"login_username"in P&&c(4,x=P.login_username),"login_password"in P&&c(5,w=P.login_password)},[m,g,a,S,x,w]}class ly extends Ir{constructor(l){super(),Sr(this,l,oy,ay,gr,{login_username:4,login_password:5})}}var di=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},no={},hy={get exports(){return no},set exports(n){no=n}};(function(n,l){(function(c,m){n.exports=m()})(di,function(){var c,m,g;function x(a,S){if(!c)c=S;else if(!m)m=S;else{var P="var sharedChunk = {}; ("+c+")(sharedChunk); ("+m+")(sharedChunk);",q={};c(q),g=S(q),typeof window<"u"&&(g.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}x(["exports"],function(a){var S=P;function P(i,e,r,o){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=o}function q(i,e,r,o){const d=new S(i,e,r,o);return function(p){return d.solve(p)}}P.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,o=0;o<8;o++){var d=this.sampleCurveX(r)-i;if(Math.abs(d)<e)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=d/p}var y=0,b=1;for(r=i,o=0;o<20&&(d=this.sampleCurveX(r),!(Math.abs(d-i)<e));o++)i>d?y=r:b=r,r=.5*(b-y)+y;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const R=q(.25,.1,.25,1);function F(i,e,r){return Math.min(r,Math.max(e,i))}function Q(i,e,r){const o=r-e,d=((i-e)%o+o)%o+e;return d===e?r:d}function le(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}let de=1;function fe(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function De(i,e,r){const o={};for(const d in i)o[d]=e.call(r||this,i[d],d,i);return o}function Ee(i,e,r){const o={};for(const d in i)e.call(r||this,i[d],d,i)&&(o[d]=i[d]);return o}function xe(i){return Array.isArray(i)?i.map(xe):typeof i=="object"&&i?De(i,xe):i}const Te={};function qe(i){Te[i]||(typeof console<"u"&&console.warn(i),Te[i]=!0)}function nt(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Fe(i){let e=0;for(let r,o,d=0,p=i.length,y=p-1;d<p;y=d++)r=i[d],o=i[y],e+=(o.x-r.x)*(r.y+o.y);return e}function Pe(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Se(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,d,p)=>{const y=d||p;return e[o]=!y||y.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let He,Lt,It=null;function Mt(i){if(It==null){const e=i.navigator?i.navigator.userAgent:null;It=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return It}function D(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const K={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const r=window.document.createElement("canvas"),o=r.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,o.drawImage(i,0,0,i.width,i.height),o.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(He||(He=document.createElement("a")),He.href=i,He.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Lt==null&&(Lt=matchMedia("(prefers-reduced-motion: reduce)")),Lt.matches)}};var H=Be;function Be(i,e){this.x=i,this.y=e}Be.prototype={clone:function(){return new Be(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),o=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=o,this},_rotateAround:function(i,e){var r=Math.cos(i),o=Math.sin(i),d=e.y+o*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-o*(this.y-e.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Be.convert=function(i){return i instanceof Be?i:Array.isArray(i)?new Be(i[0],i[1]):i};const me={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Ne="mapbox-tiles";let Re,Ce,Ge=500,Ve=50;function st(){typeof caches>"u"||Re||(Re=caches.open(Ne))}let At=1/0;const zt={supported:!1,testSupport:function(i){!ii&&Ft&&(ri?Bt(i):St=i)}};let St,Ft,ii=!1,ri=!1;function Bt(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Ft),i.isContextLost())return;zt.supported=!0}catch{}i.deleteTexture(e),ii=!0}typeof document<"u"&&(Ft=document.createElement("img"),Ft.onload=function(){St&&Bt(St),St=null,ri=!0},Ft.onerror=function(){ii=!0,St=null},Ft.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ht={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ht);class Ot extends Error{constructor(e,r,o,d){super(`AJAXError: ${r} (${e}): ${o}`),this.status=e,this.statusText=r,this.url=o,this.body=d}}const Pi=Pe()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Vr(i,e){const r=new AbortController,o=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Pi(),signal:r.signal});let d=!1,p=!1;return i.type==="json"&&o.headers.set("Accept","application/json"),((y,b,M)=>{if(p)return;const I=Date.now();fetch(o).then(k=>k.ok?((L,N,V)=>{(i.type==="arrayBuffer"?L.arrayBuffer():i.type==="json"?L.json():L.text()).then($=>{p||(N&&V&&function(te,ee,ue){if(st(),!Re)return;const ve={status:ee.status,statusText:ee.statusText,headers:new Headers};ee.headers.forEach((_e,Le)=>ve.headers.set(Le,_e));const ce=Se(ee.headers.get("Cache-Control")||"");ce["no-store"]||(ce["max-age"]&&ve.headers.set("Expires",new Date(ue+1e3*ce["max-age"]).toUTCString()),new Date(ve.headers.get("Expires")).getTime()-ue<42e4||function(_e,Le){if(Ce===void 0)try{new Response(new ReadableStream),Ce=!0}catch{Ce=!1}Ce?Le(_e.body):_e.blob().then(Le)}(ee,_e=>{const Le=new Response(_e,ve);st(),Re&&Re.then(ze=>ze.put(function(lt){const pt=lt.indexOf("?");return pt<0?lt:lt.slice(0,pt)}(te.url),Le)).catch(ze=>qe(ze.message))}))}(o,N,V),d=!0,e(null,$,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch($=>{p||e(new Error($.message))})})(k,null,I):k.blob().then(L=>e(new Ot(k.status,k.statusText,i.url,L)))).catch(k=>{k.code!==20&&e(new Error(k.message))})})(),{cancel:()=>{p=!0,d||r.abort()}}}const Xr=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Pe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Pe()){const o=i.url.substring(0,i.url.indexOf("://"));return(me.REGISTERED_PROTOCOLS[o]||Vr)(i,e)}}if(!(/^file:/.test(r=i.url)||/^file:/.test(Pi())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Vr(i,e);if(Pe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(o,d){const p=new XMLHttpRequest;p.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const y in o.headers)p.setRequestHeader(y,o.headers[y]);return o.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=o.credentials==="include",p.onerror=()=>{d(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let y=p.response;if(o.type==="json")try{y=JSON.parse(p.response)}catch(b){return d(b)}d(null,y,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else{const y=new Blob([p.response],{type:p.getResponseHeader("Content-Type")});d(new Ot(p.status,p.statusText,o.url,y))}},p.send(o.body),{cancel:()=>p.abort()}}(i,e)},Dn=function(i,e){return Xr(le(i,{type:"arrayBuffer"}),e)};function Kn(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const Wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let _r,lr;_r=[],lr=0;const yr=function(i,e){if(zt.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),lr>=me.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return _r.push(p),p}lr++;let r=!1;const o=()=>{if(!r)for(r=!0,lr--;_r.length&&lr<me.MAX_PARALLEL_IMAGE_REQUESTS;){const p=_r.shift(),{requestParameters:y,callback:b,cancelled:M}=p;M||(p.cancel=yr(y,b).cancel)}},d=Dn(i,(p,y,b,M)=>{o(),p?e(p):y&&function(I,k){typeof createImageBitmap=="function"?function(L,N){const V=new Blob([new Uint8Array(L)],{type:"image/png"});createImageBitmap(V).then($=>{N(null,$)}).catch($=>{N(new Error(`Could not load image because of ${$.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(I,k):function(L,N){const V=new Image;V.onload=()=>{N(null,V),URL.revokeObjectURL(V.src),V.onload=null,window.requestAnimationFrame(()=>{V.src=Wt})},V.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const $=new Blob([new Uint8Array(L)],{type:"image/png"});V.src=L.byteLength?URL.createObjectURL($):Wt}(I,k)}(y,(I,k)=>{I!=null?e(I):k!=null&&e(null,k,{cacheControl:b,expires:M})})});return{cancel:()=>{d.cancel(),o()}}};function mn(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function gn(i,e,r){if(r&&r[i]){const o=r[i].indexOf(e);o!==-1&&r[i].splice(o,1)}}class _n{constructor(e,r={}){le(this,r),this.type=e}}class vs extends _n{constructor(e,r={}){super("error",le({error:e},r))}}class yn{on(e,r){return this._listeners=this._listeners||{},mn(e,r,this._listeners),this}off(e,r){return gn(e,r,this._listeners),gn(e,r,this._oneTimeListeners),this}once(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},mn(e,r,this._oneTimeListeners),this}fire(e,r){typeof e=="string"&&(e=new _n(e,r||{}));const o=e.type;if(this.listens(o)){e.target=this;const d=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const b of d)b.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const b of p)gn(o,b,this._oneTimeListeners),b.call(this,e);const y=this._eventedParent;y&&(le(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof vs&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ke={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Ye{constructor(e,r,o,d){this.message=(e?`${e}: `:"")+o,d&&(this.identifier=d),r!=null&&r.__line__&&(this.line=r.__line__)}}function Jn(i){const e=i.value;return e?[new Ye(i.key,e,"constants have been deprecated as of v8")]:[]}function Kr(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}function Jt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function $r(i){if(Array.isArray(i))return i.map($r);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=$r(i[r]);return e}return Jt(i)}class Ar extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Cr{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[o,d]of r)this.bindings[o]=d}concat(e){return new Cr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Rn={kind:"null"},Xe={kind:"number"},Nt={kind:"string"},Dt={kind:"boolean"},er={kind:"color"},Bn={kind:"object"},Pt={kind:"value"},vn={kind:"collator"},Zi={kind:"formatted"},xs={kind:"padding"},Fi={kind:"resolvedImage"};function hr(i,e){return{kind:"array",itemType:i,N:e}}function ci(i){if(i.kind==="array"){const e=ci(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const bs=[Rn,Xe,Nt,Dt,er,Zi,Bn,hr(Pt),xs,Fi];function an(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!an(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of bs)if(!an(r,e))return null}}return`Expected ${ci(i)} but found ${ci(e)} instead.`}function Yn(i,e){return e.some(r=>r.kind===i.kind)}function Qn(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var ws,es={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Z(i){return(i=Math.round(i))<0?0:i>255?255:i}function C(i){return Z(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function B(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function G(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{ws={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in es)return es[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=r.indexOf("("),d=r.indexOf(")");if(o!==-1&&d+1===r.length){var p=r.substr(0,o),y=r.substr(o+1,d-(o+1)).split(","),b=1;switch(p){case"rgba":if(y.length!==4)return null;b=B(y.pop());case"rgb":return y.length!==3?null:[C(y[0]),C(y[1]),C(y[2]),b];case"hsla":if(y.length!==4)return null;b=B(y.pop());case"hsl":if(y.length!==3)return null;var M=(parseFloat(y[0])%360+360)%360/360,I=B(y[1]),k=B(y[2]),L=k<=.5?k*(I+1):k+I-k*I,N=2*k-L;return[Z(255*G(N,L,M+1/3)),Z(255*G(N,L,M)),Z(255*G(N,L,M-1/3)),b];default:return null}}return null}}catch{}class j{constructor(e,r,o,d=1){this.r=e,this.g=r,this.b=o,this.a=d}static parse(e){if(!e)return;if(e instanceof j)return e;if(typeof e!="string")return;const r=ws(e);return r?new j(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,o,d]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(o)},${d})`}toArray(){const{r:e,g:r,b:o,a:d}=this;return d===0?[0,0,0,0]:[255*e/d,255*r/d,255*o/d,d]}}j.black=new j(0,0,0,1),j.white=new j(1,1,1,1),j.transparent=new j(0,0,0,0),j.red=new j(1,0,0,1);class ie{constructor(e,r,o){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ae{constructor(e,r,o,d,p){this.text=e,this.image=r,this.scale=o,this.fontStack=d,this.textColor=p}}class ne{constructor(e){this.sections=e}static fromString(e){return new ne([new ae(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ne?e:ne.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class re{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof re)return e;if(typeof e=="number")return new re([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new re(e)}}toString(){return JSON.stringify(this.values)}}class oe{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new oe({name:e,available:!1}):null}}function we(i,e,r,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,r,o]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Oe(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof j||i instanceof ie||i instanceof ne||i instanceof re||i instanceof oe)return!0;if(Array.isArray(i)){for(const e of i)if(!Oe(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Oe(i[e]))return!1;return!0}return!1}function be(i){if(i===null)return Rn;if(typeof i=="string")return Nt;if(typeof i=="boolean")return Dt;if(typeof i=="number")return Xe;if(i instanceof j)return er;if(i instanceof ie)return vn;if(i instanceof ne)return Zi;if(i instanceof re)return xs;if(i instanceof oe)return Fi;if(Array.isArray(i)){const e=i.length;let r;for(const o of i){const d=be(o);if(r){if(r===d)continue;r=Pt;break}r=d}return hr(r||Pt,e)}return Bn}function ft(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof j||i instanceof ne||i instanceof re||i instanceof oe?i.toString():JSON.stringify(i)}class mt{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Oe(e[1]))return r.error("invalid value");const o=e[1];let d=be(o);const p=r.expectedType;return d.kind!=="array"||d.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(d=p),new mt(d,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class rt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Et={string:Nt,number:Xe,boolean:Dt,object:Bn};class Ct{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o,d=1;const p=e[0];if(p==="array"){let b,M;if(e.length>2){const I=e[1];if(typeof I!="string"||!(I in Et)||I==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);b=Et[I],d++}else b=Pt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);M=e[2],d++}o=hr(b,M)}else{if(!Et[p])throw new Error(`Types doesn't contain name = ${p}`);o=Et[p]}const y=[];for(;d<e.length;d++){const b=r.parse(e[d],d,Pt);if(!b)return null;y.push(b)}return new Ct(o,y)}evaluate(e){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(e);if(!an(this.type,be(o)))return o;if(r===this.args.length-1)throw new rt(`Expected value to be of type ${ci(this.type)}, but found ${ci(be(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Yt={"to-boolean":Dt,"to-color":er,"to-number":Xe,"to-string":Nt};class kt{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[0];if(!Yt[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return r.error("Expected one argument.");const d=Yt[o],p=[];for(let y=1;y<e.length;y++){const b=r.parse(e[y],y,Pt);if(!b)return null;p.push(b)}return new kt(d,p)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,o;for(const d of this.args){if(r=d.evaluate(e),o=null,r instanceof j)return r;if(typeof r=="string"){const p=e.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:we(r[0],r[1],r[2],r[3]),!o))return new j(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new rt(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="padding"){let r;for(const o of this.args){r=o.evaluate(e);const d=re.parse(r);if(d)return d}throw new rt(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="number"){let r=null;for(const o of this.args){if(r=o.evaluate(e),r===null)return 0;const d=Number(r);if(!isNaN(d))return d}throw new rt(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?ne.fromString(ft(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?oe.fromString(ft(this.args[0].evaluate(e))):ft(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ut=["Unknown","Point","LineString","Polygon"];class Qt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ut[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=j.parse(e)),r}}class fi{constructor(e,r,o,d){this.name=e,this.type=r,this._evaluate=o,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const o=e[0],d=fi.definitions[o];if(!d)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=y.filter(([I])=>!Array.isArray(I)||I.length===e.length-1);let M=null;for(const[I,k]of b){M=new Ts(r.registry,r.path,null,r.scope);const L=[];let N=!1;for(let V=1;V<e.length;V++){const $=e[V],te=Array.isArray(I)?I[V-1]:I.type,ee=M.parse($,1+L.length,te);if(!ee){N=!0;break}L.push(ee)}if(!N)if(Array.isArray(I)&&I.length!==L.length)M.error(`Expected ${I.length} arguments, but found ${L.length} instead.`);else{for(let V=0;V<L.length;V++){const $=Array.isArray(I)?I[V]:I.type,te=L[V];M.concat(V+1).checkSubtype($,te.type)}if(M.errors.length===0)return new fi(o,p,k,L)}}if(b.length===1)r.errors.push(...M.errors);else{const I=(b.length?b:y).map(([L])=>{return N=L,Array.isArray(N)?`(${N.map(ci).join(", ")})`:`(${ci(N.type)}...)`;var N}).join(" | "),k=[];for(let L=1;L<e.length;L++){const N=r.parse(e[L],1+k.length);if(!N)return null;k.push(ci(N.type))}r.error(`Expected arguments of type ${I}, but found (${k.join(", ")}) instead.`)}return null}static register(e,r){fi.definitions=r;for(const o in r)e[o]=fi}}class Hi{constructor(e,r,o){this.type=vn,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const d=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Dt);if(!d)return null;const p=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Dt);if(!p)return null;let y=null;return o.locale&&(y=r.parse(o.locale,1,Nt),!y)?null:new Hi(d,p,y)}evaluate(e){return new ie(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Mi=8192;function rr(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ms(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Zs(i,e){const r=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(r*d*Mi),Math.round(o*d*Mi)]}function pi(i,e,r){const o=i[0]-e[0],d=i[1]-e[1],p=i[0]-r[0],y=i[1]-r[1];return o*y-p*d==0&&o*p<=0&&d*y<=0}function bo(i,e){let r=!1;for(let y=0,b=e.length;y<b;y++){const M=e[y];for(let I=0,k=M.length;I<k-1;I++){if(pi(i,M[I],M[I+1]))return!1;(d=M[I])[1]>(o=i)[1]!=(p=M[I+1])[1]>o[1]&&o[0]<(p[0]-d[0])*(o[1]-d[1])/(p[1]-d[1])+d[0]&&(r=!r)}}var o,d,p;return r}function wo(i,e){for(let r=0;r<e.length;r++)if(bo(i,e[r]))return!0;return!1}function jl(i,e,r,o){const d=o[0]-r[0],p=o[1]-r[1],y=(i[0]-r[0])*p-d*(i[1]-r[1]),b=(e[0]-r[0])*p-d*(e[1]-r[1]);return y>0&&b<0||y<0&&b>0}function Zl(i,e,r){for(const I of r)for(let k=0;k<I.length-1;++k)if((b=[(y=I[k+1])[0]-(p=I[k])[0],y[1]-p[1]])[0]*(M=[(d=e)[0]-(o=i)[0],d[1]-o[1]])[1]-b[1]*M[0]!=0&&jl(o,d,p,y)&&jl(p,y,o,d))return!0;var o,d,p,y,b,M;return!1}function Mo(i,e){for(let r=0;r<i.length;++r)if(!bo(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Zl(i[r],i[r+1],e))return!1;return!0}function Ic(i,e){for(let r=0;r<e.length;r++)if(Mo(i,e[r]))return!0;return!1}function Ta(i,e,r){const o=[];for(let d=0;d<i.length;d++){const p=[];for(let y=0;y<i[d].length;y++){const b=Zs(i[d][y],r);rr(e,b),p.push(b)}o.push(p)}return o}function Eo(i,e,r){const o=[];for(let d=0;d<i.length;d++){const p=Ta(i[d],e,r);o.push(p)}return o}function Hl(i,e,r,o){if(i[0]<r[0]||i[0]>r[2]){const d=.5*o;let p=i[0]-r[0]>d?-o:r[0]-i[0]>d?o:0;p===0&&(p=i[0]-r[2]>d?-o:r[2]-i[0]>d?o:0),i[0]+=p}rr(e,i)}function Wl(i,e,r,o){const d=Math.pow(2,o.z)*Mi,p=[o.x*Mi,o.y*Mi],y=[];for(const b of i)for(const M of b){const I=[M.x+p[0],M.y+p[1]];Hl(I,e,r,d),y.push(I)}return y}function Xl(i,e,r,o){const d=Math.pow(2,o.z)*Mi,p=[o.x*Mi,o.y*Mi],y=[];for(const M of i){const I=[];for(const k of M){const L=[k.x+p[0],k.y+p[1]];rr(e,L),I.push(L)}y.push(I)}if(e[2]-e[0]<=d/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const M of y)for(const I of M)Hl(I,e,r,d)}var b;return y}class ts{constructor(e,r){this.type=Dt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Oe(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let d=0;d<o.features.length;++d){const p=o.features[d].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new ts(o,o.features[d].geometry)}else if(o.type==="Feature"){const d=o.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new ts(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new ts(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){const d=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(o.type==="Polygon"){const b=Ta(o.coordinates,p,y),M=Wl(r.geometry(),d,p,y);if(!Ms(d,p))return!1;for(const I of M)if(!bo(I,b))return!1}if(o.type==="MultiPolygon"){const b=Eo(o.coordinates,p,y),M=Wl(r.geometry(),d,p,y);if(!Ms(d,p))return!1;for(const I of M)if(!wo(I,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){const d=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(o.type==="Polygon"){const b=Ta(o.coordinates,p,y),M=Xl(r.geometry(),d,p,y);if(!Ms(d,p))return!1;for(const I of M)if(!Mo(I,b))return!1}if(o.type==="MultiPolygon"){const b=Eo(o.coordinates,p,y),M=Xl(r.geometry(),d,p,y);if(!Ms(d,p))return!1;for(const I of M)if(!Ic(I,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Hs(i){if(i instanceof fi&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof ts)return!1;let e=!0;return i.eachChild(r=>{e&&!Hs(r)&&(e=!1)}),e}function Es(i){if(i instanceof fi&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Es(r)&&(e=!1)}),e}function Sa(i,e){if(i instanceof fi&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(o=>{r&&!Sa(o,e)&&(r=!1)}),r}class Ia{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=e[1];return r.scope.has(o)?new Ia(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Ts{constructor(e,r=[],o,d=new Cr,p=[]){this.registry=e,this.path=r,this.key=r.map(y=>`[${y}]`).join(""),this.scope=d,this.errors=p,this.expectedType=o}parse(e,r,o,d,p={}){return r?this.concat(r,o,d)._parse(e,p):this._parse(e,p)}_parse(e,r){function o(d,p,y){return y==="assert"?new Ct(p,[d]):y==="coerce"?new kt(p,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[d];if(p){let y=p.parse(e,this);if(!y)return null;if(this.expectedType){const b=this.expectedType,M=y.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||M.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string")if(b.kind!=="padding"||M.kind!=="value"&&M.kind!=="number"&&M.kind!=="array"){if(this.checkSubtype(b,M))return null}else y=o(y,b,r.typeAnnotation||"coerce");else y=o(y,b,r.typeAnnotation||"coerce");else y=o(y,b,r.typeAnnotation||"assert")}if(!(y instanceof mt)&&y.type.kind!=="resolvedImage"&&To(y)){const b=new Qt;try{y=new mt(y.type,y.evaluate(b))}catch(M){return this.error(M.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,o){const d=typeof e=="number"?this.path.concat(e):this.path,p=o?this.scope.concat(o):this.scope;return new Ts(this.registry,d,r||null,p,this.errors)}error(e,...r){const o=`${this.key}${r.map(d=>`[${d}]`).join("")}`;this.errors.push(new Ar(o,e))}checkSubtype(e,r){const o=an(e,r);return o&&this.error(o),o}}function To(i){if(i instanceof Ia)return To(i.boundExpression);if(i instanceof fi&&i.name==="error"||i instanceof Hi||i instanceof ts)return!1;const e=i instanceof kt||i instanceof Ct;let r=!0;return i.eachChild(o=>{r=e?r&&To(o):r&&o instanceof mt}),!!r&&Hs(i)&&Sa(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Aa(i,e){const r=i.length-1;let o,d,p=0,y=r,b=0;for(;p<=y;)if(b=Math.floor((p+y)/2),o=i[b],d=i[b+1],o<=e){if(b===r||e<d)return b;p=b+1}else{if(!(o>e))throw new rt("Input is not a number.");y=b-1}return 0}class Ws{constructor(e,r,o){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[d,p]of o)this.labels.push(d),this.outputs.push(p)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(e[1],1,Xe);if(!o)return null;const d=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let y=1;y<e.length;y+=2){const b=y===1?-1/0:e[y],M=e[y+1],I=y,k=y+1;if(typeof b!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(d.length&&d[d.length-1][0]>=b)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const L=r.parse(M,k,p);if(!L)return null;p=p||L.type,d.push([b,L])}return new Ws(p,o,d)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const d=this.input.evaluate(e);if(d<=r[0])return o[0].evaluate(e);const p=r.length;return d>=r[p-1]?o[p-1].evaluate(e):o[Aa(r,d)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ei(i,e,r){return i*(1-r)+e*r}var Xs=Object.freeze({__proto__:null,number:Ei,color:function(i,e,r){return new j(Ei(i.r,e.r,r),Ei(i.g,e.g,r),Ei(i.b,e.b,r),Ei(i.a,e.a,r))},array:function(i,e,r){return i.map((o,d)=>Ei(o,e[d],r))},padding:function(i,e,r){const o=i.values,d=e.values;return new re([Ei(o[0],d[0],r),Ei(o[1],d[1],r),Ei(o[2],d[2],r),Ei(o[3],d[3],r)])}});const Kl=.95047,Jl=1.08883,So=4/29,Ca=6/29,Yl=3*Ca*Ca,Ac=Math.PI/180,Cc=180/Math.PI;function Io(i){return i>.008856451679035631?Math.pow(i,1/3):i/Yl+So}function Ao(i){return i>Ca?i*i*i:Yl*(i-So)}function Co(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function ko(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function si(i){const e=ko(i.r),r=ko(i.g),o=ko(i.b),d=Io((.4124564*e+.3575761*r+.1804375*o)/Kl),p=Io((.2126729*e+.7151522*r+.072175*o)/1);return{l:116*p-16,a:500*(d-p),b:200*(p-Io((.0193339*e+.119192*r+.9503041*o)/Jl)),alpha:i.a}}function Ql(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,o=isNaN(i.b)?e:e-i.b/200;return e=1*Ao(e),r=Kl*Ao(r),o=Jl*Ao(o),new j(Co(3.2404542*r-1.5371385*e-.4985314*o),Co(-.969266*r+1.8760108*e+.041556*o),Co(.0556434*r-.2040259*e+1.0572252*o),i.alpha)}function kc(i,e,r){const o=e-i;return i+r*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ks={forward:si,reverse:Ql,interpolate:function(i,e,r){return{l:Ei(i.l,e.l,r),a:Ei(i.a,e.a,r),b:Ei(i.b,e.b,r),alpha:Ei(i.alpha,e.alpha,r)}}},Js={forward:function(i){const{l:e,a:r,b:o}=si(i),d=Math.atan2(o,r)*Cc;return{h:d<0?d+360:d,c:Math.sqrt(r*r+o*o),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Ac,r=i.c;return Ql({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:kc(i.h,e.h,r),c:Ei(i.c,e.c,r),l:Ei(i.l,e.l,r),alpha:Ei(i.alpha,e.alpha,r)}}};var eh=Object.freeze({__proto__:null,lab:Ks,hcl:Js});class kr{constructor(e,r,o,d,p){this.type=e,this.operator=r,this.interpolation=o,this.input=d,this.labels=[],this.outputs=[];for(const[y,b]of p)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(e,r,o,d){let p=0;if(e.name==="exponential")p=Po(r,e.base,o,d);else if(e.name==="linear")p=Po(r,1,o,d);else if(e.name==="cubic-bezier"){const y=e.controlPoints;p=new S(y[0],y[1],y[2],y[3]).solve(Po(r,1,o,d))}return p}static parse(e,r){let[o,d,p,...y]=e;if(!Array.isArray(d)||d.length===0)return r.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const I=d[1];if(typeof I!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:I}}else{if(d[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const I=d.slice(1);if(I.length!==4||I.some(k=>typeof k!="number"||k<0||k>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:I}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,Xe),!p)return null;const b=[];let M=null;o==="interpolate-hcl"||o==="interpolate-lab"?M=er:r.expectedType&&r.expectedType.kind!=="value"&&(M=r.expectedType);for(let I=0;I<y.length;I+=2){const k=y[I],L=y[I+1],N=I+3,V=I+4;if(typeof k!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(b.length&&b[b.length-1][0]>=k)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const $=r.parse(L,V,M);if(!$)return null;M=M||$.type,b.push([k,$])}return M.kind==="number"||M.kind==="color"||M.kind==="padding"||M.kind==="array"&&M.itemType.kind==="number"&&typeof M.N=="number"?new kr(M,o,d,p,b):r.error(`Type ${ci(M)} is not interpolatable.`)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const d=this.input.evaluate(e);if(d<=r[0])return o[0].evaluate(e);const p=r.length;if(d>=r[p-1])return o[p-1].evaluate(e);const y=Aa(r,d),b=kr.interpolationFactor(this.interpolation,d,r[y],r[y+1]),M=o[y].evaluate(e),I=o[y+1].evaluate(e);return this.operator==="interpolate"?Xs[this.type.kind.toLowerCase()](M,I,b):this.operator==="interpolate-hcl"?Js.reverse(Js.interpolate(Js.forward(M),Js.forward(I),b)):Ks.reverse(Ks.interpolate(Ks.forward(M),Ks.forward(I),b))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Po(i,e,r,o){const d=o-r,p=i-r;return d===0?0:e===1?p/d:(Math.pow(e,p)-1)/(Math.pow(e,d)-1)}class ka{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let o=null;const d=r.expectedType;d&&d.kind!=="value"&&(o=d);const p=[];for(const b of e.slice(1)){const M=r.parse(b,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!M)return null;o=o||M.type,p.push(M)}if(!o)throw new Error("No output type");const y=d&&p.some(b=>an(d,b.type));return new ka(y?Pt:o,p)}evaluate(e){let r,o=null,d=0;for(const p of this.args)if(d++,o=p.evaluate(e),o&&o instanceof oe&&!o.available&&(r||(r=o.name),o=null,d===this.args.length&&(o=r)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Pa{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let p=1;p<e.length-1;p+=2){const y=e[p];if(typeof y!="string")return r.error(`Expected string, but found ${typeof y} instead.`,p);if(/[^a-zA-Z0-9_]/.test(y))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const b=r.parse(e[p+1],p+1);if(!b)return null;o.push([y,b])}const d=r.parse(e[e.length-1],e.length-1,r.expectedType,o);return d?new Pa(o,d):null}outputDefined(){return this.result.outputDefined()}}class zo{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Xe),d=r.parse(e[2],2,hr(r.expectedType||Pt));return o&&d?new zo(d.type.itemType,o,d):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new rt(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new rt(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new rt(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Lo{constructor(e,r){this.type=Dt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Pt),d=r.parse(e[2],2,Pt);return o&&d?Yn(o.type,[Dt,Nt,Xe,Rn,Pt])?new Lo(o,d):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(o.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Qn(r,["boolean","string","number","null"]))throw new rt(`Expected first argument to be of type boolean, string, number or null, but found ${ci(be(r))} instead.`);if(!Qn(o,["string","array"]))throw new rt(`Expected second argument to be of type array or string, but found ${ci(be(o))} instead.`);return o.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class za{constructor(e,r,o){this.type=Xe,this.needle=e,this.haystack=r,this.fromIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Pt),d=r.parse(e[2],2,Pt);if(!o||!d)return null;if(!Yn(o.type,[Dt,Nt,Xe,Rn,Pt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(o.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,Xe);return p?new za(o,d,p):null}return new za(o,d)}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Qn(r,["boolean","string","number","null"]))throw new rt(`Expected first argument to be of type boolean, string, number or null, but found ${ci(be(r))} instead.`);if(!Qn(o,["string","array"]))throw new rt(`Expected second argument to be of type array or string, but found ${ci(be(o))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return o.indexOf(r,d)}return o.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Do{constructor(e,r,o,d,p,y){this.inputType=e,this.type=r,this.input=o,this.cases=d,this.outputs=p,this.otherwise=y}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let o,d;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);const p={},y=[];for(let I=2;I<e.length-1;I+=2){let k=e[I];const L=e[I+1];Array.isArray(k)||(k=[k]);const N=r.concat(I);if(k.length===0)return N.error("Expected at least one branch label.");for(const $ of k){if(typeof $!="number"&&typeof $!="string")return N.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return N.error("Numeric branch labels must be integer values.");if(o){if(N.checkSubtype(o,be($)))return null}else o=be($);if(p[String($)]!==void 0)return N.error("Branch labels must be unique.");p[String($)]=y.length}const V=r.parse(L,I,d);if(!V)return null;d=d||V.type,y.push(V)}const b=r.parse(e[1],1,Pt);if(!b)return null;const M=r.parse(e[e.length-1],e.length-1,d);return M?b.type.kind!=="value"&&r.concat(1).checkSubtype(o,b.type)?null:new Do(o,d,b,p,y,M):null}evaluate(e){const r=this.input.evaluate(e);return(be(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Ro{constructor(e,r,o){this.type=e,this.branches=r,this.otherwise=o}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const d=[];for(let y=1;y<e.length-1;y+=2){const b=r.parse(e[y],y,Dt);if(!b)return null;const M=r.parse(e[y+1],y+1,o);if(!M)return null;d.push([b,M]),o=o||M.type}const p=r.parse(e[e.length-1],e.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new Ro(o,d,p)}evaluate(e){for(const[r,o]of this.branches)if(r.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,o]of this.branches)e(r),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class La{constructor(e,r,o,d){this.type=e,this.input=r,this.beginIndex=o,this.endIndex=d}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Pt),d=r.parse(e[2],2,Xe);if(!o||!d)return null;if(!Yn(o.type,[hr(Pt),Nt,Pt]))return r.error(`Expected first argument to be of type array or string, but found ${ci(o.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,Xe);return p?new La(o.type,o,d,p):null}return new La(o.type,o,d)}evaluate(e){const r=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Qn(r,["string","array"]))throw new rt(`Expected first argument to be of type array or string, but found ${ci(be(r))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return r.slice(o,d)}return r.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function th(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ih(i,e,r,o){return o.compare(e,r)===0}function Ss(i,e,r){const o=i!=="=="&&i!=="!=";return class Xp{constructor(p,y,b){this.type=Dt,this.lhs=p,this.rhs=y,this.collator=b,this.hasUntypedArgument=p.type.kind==="value"||y.type.kind==="value"}static parse(p,y){if(p.length!==3&&p.length!==4)return y.error("Expected two or three arguments.");const b=p[0];let M=y.parse(p[1],1,Pt);if(!M)return null;if(!th(b,M.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${ci(M.type)}'.`);let I=y.parse(p[2],2,Pt);if(!I)return null;if(!th(b,I.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${ci(I.type)}'.`);if(M.type.kind!==I.type.kind&&M.type.kind!=="value"&&I.type.kind!=="value")return y.error(`Cannot compare types '${ci(M.type)}' and '${ci(I.type)}'.`);o&&(M.type.kind==="value"&&I.type.kind!=="value"?M=new Ct(I.type,[M]):M.type.kind!=="value"&&I.type.kind==="value"&&(I=new Ct(M.type,[I])));let k=null;if(p.length===4){if(M.type.kind!=="string"&&I.type.kind!=="string"&&M.type.kind!=="value"&&I.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(k=y.parse(p[3],3,vn),!k)return null}return new Xp(M,I,k)}evaluate(p){const y=this.lhs.evaluate(p),b=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const M=be(y),I=be(b);if(M.kind!==I.kind||M.kind!=="string"&&M.kind!=="number")throw new rt(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${M.kind}, ${I.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const M=be(y),I=be(b);if(M.kind!=="string"||I.kind!=="string")return e(p,y,b)}return this.collator?r(p,y,b,this.collator.evaluate(p)):e(p,y,b)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const Pc=Ss("==",function(i,e,r){return e===r},ih),zc=Ss("!=",function(i,e,r){return e!==r},function(i,e,r,o){return!ih(0,e,r,o)}),Lc=Ss("<",function(i,e,r){return e<r},function(i,e,r,o){return o.compare(e,r)<0}),Dc=Ss(">",function(i,e,r){return e>r},function(i,e,r,o){return o.compare(e,r)>0}),Rc=Ss("<=",function(i,e,r){return e<=r},function(i,e,r,o){return o.compare(e,r)<=0}),Bc=Ss(">=",function(i,e,r){return e>=r},function(i,e,r,o){return o.compare(e,r)>=0});class Bo{constructor(e,r,o,d,p){this.type=Nt,this.number=e,this.locale=r,this.currency=o,this.minFractionDigits=d,this.maxFractionDigits=p}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const o=r.parse(e[1],1,Xe);if(!o)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return r.error("NumberFormat options argument must be an object.");let p=null;if(d.locale&&(p=r.parse(d.locale,1,Nt),!p))return null;let y=null;if(d.currency&&(y=r.parse(d.currency,1,Nt),!y))return null;let b=null;if(d["min-fraction-digits"]&&(b=r.parse(d["min-fraction-digits"],1,Xe),!b))return null;let M=null;return d["max-fraction-digits"]&&(M=r.parse(d["max-fraction-digits"],1,Xe),!M)?null:new Bo(o,p,y,b,M)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Da{constructor(e){this.type=Zi,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const d=[];let p=!1;for(let y=1;y<=e.length-1;++y){const b=e[y];if(p&&typeof b=="object"&&!Array.isArray(b)){p=!1;let M=null;if(b["font-scale"]&&(M=r.parse(b["font-scale"],1,Xe),!M))return null;let I=null;if(b["text-font"]&&(I=r.parse(b["text-font"],1,hr(Nt)),!I))return null;let k=null;if(b["text-color"]&&(k=r.parse(b["text-color"],1,er),!k))return null;const L=d[d.length-1];L.scale=M,L.font=I,L.textColor=k}else{const M=r.parse(e[y],1,Pt);if(!M)return null;const I=M.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,d.push({content:M,scale:null,font:null,textColor:null})}}return new Da(d)}evaluate(e){return new ne(this.sections.map(r=>{const o=r.content.evaluate(e);return be(o)===Fi?new ae("",o,null,null,null):new ae(ft(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class Oo{constructor(e){this.type=Fi,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const o=r.parse(e[1],1,Nt);return o?new Oo(o):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),o=oe.fromString(r);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(r)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Fo{constructor(e){this.type=Xe,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=r.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${ci(o.type)} instead.`):new Fo(o):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new rt(`Expected value to be of type string or array, but found ${ci(be(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Is={"==":Pc,"!=":zc,">":Dc,"<":Lc,">=":Bc,"<=":Rc,array:Ct,at:zo,boolean:Ct,case:Ro,coalesce:ka,collator:Hi,format:Da,image:Oo,in:Lo,"index-of":za,interpolate:kr,"interpolate-hcl":kr,"interpolate-lab":kr,length:Fo,let:Pa,literal:mt,match:Do,number:Ct,"number-format":Bo,object:Ct,slice:La,step:Ws,string:Ct,"to-boolean":kt,"to-color":kt,"to-number":kt,"to-string":kt,var:Ia,within:ts};function rh(i,[e,r,o,d]){e=e.evaluate(i),r=r.evaluate(i),o=o.evaluate(i);const p=d?d.evaluate(i):1,y=we(e,r,o,p);if(y)throw new rt(y);return new j(e/255*p,r/255*p,o/255*p,p)}function nh(i,e){return i in e}function Ra(i,e){const r=e[i];return r===void 0?null:r}function is(i){return{type:i}}function sh(i){return{result:"success",value:i}}function As(i){return{result:"error",value:i}}function bi(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ah(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Xt(i){return!!i.expression&&i.expression.interpolated}function ai(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function xi(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Ti(i){return i}function Ys(i,e){const r=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",d=o||!(o||i.property!==void 0),p=i.type||(Xt(e)?"exponential":"interval");if(r||e.type==="padding"){const I=r?j.parse:re.parse;(i=Kr({},i)).stops&&(i.stops=i.stops.map(k=>[k[0],I(k[1])])),i.default=I(i.default?i.default:e.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!eh[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let y,b,M;if(p==="exponential")y=oh;else if(p==="interval")y=Fc;else if(p==="categorical"){y=Oc,b=Object.create(null);for(const I of i.stops)b[I[0]]=I[1];M=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);y=Nc}if(o){const I={},k=[];for(let V=0;V<i.stops.length;V++){const $=i.stops[V],te=$[0].zoom;I[te]===void 0&&(I[te]={zoom:te,type:i.type,property:i.property,default:i.default,stops:[]},k.push(te)),I[te].stops.push([$[0].value,$[1]])}const L=[];for(const V of k)L.push([I[V].zoom,Ys(I[V],e)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:kr.interpolationFactor.bind(void 0,N),zoomStops:L.map(V=>V[0]),evaluate:({zoom:V},$)=>oh({stops:L,base:i.base},e,V).evaluate(V,$)}}if(d){const I=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:kr.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map(k=>k[0]),evaluate:({zoom:k})=>y(i,e,k,b,M)}}return{kind:"source",evaluate(I,k){const L=k&&k.properties?k.properties[i.property]:void 0;return L===void 0?Cs(i.default,e.default):y(i,e,L,b,M)}}}function Cs(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Oc(i,e,r,o,d){return Cs(typeof r===d?o[r]:void 0,i.default,e.default)}function Fc(i,e,r){if(ai(r)!=="number")return Cs(i.default,e.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const d=Aa(i.stops.map(p=>p[0]),r);return i.stops[d][1]}function oh(i,e,r){const o=i.base!==void 0?i.base:1;if(ai(r)!=="number")return Cs(i.default,e.default);const d=i.stops.length;if(d===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[d-1][0])return i.stops[d-1][1];const p=Aa(i.stops.map(k=>k[0]),r),y=function(k,L,N,V){const $=V-N,te=k-N;return $===0?0:L===1?te/$:(Math.pow(L,te)-1)/(Math.pow(L,$)-1)}(r,o,i.stops[p][0],i.stops[p+1][0]),b=i.stops[p][1],M=i.stops[p+1][1];let I=Xs[e.type]||Ti;if(i.colorSpace&&i.colorSpace!=="rgb"){const k=eh[i.colorSpace];I=(L,N)=>k.reverse(k.interpolate(k.forward(L),k.forward(N),y))}return typeof b.evaluate=="function"?{evaluate(...k){const L=b.evaluate.apply(void 0,k),N=M.evaluate.apply(void 0,k);if(L!==void 0&&N!==void 0)return I(L,N,y)}}:I(b,M,y)}function Nc(i,e,r){switch(e.type){case"color":r=j.parse(r);break;case"formatted":r=ne.fromString(r.toString());break;case"resolvedImage":r=oe.fromString(r.toString());break;case"padding":r=re.parse(r);break;default:ai(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Cs(r,i.default,e.default)}fi.register(Is,{error:[{kind:"error"},[Nt],(i,[e])=>{throw new rt(e.evaluate(i))}],typeof:[Nt,[Pt],(i,[e])=>ci(be(e.evaluate(i)))],"to-rgba":[hr(Xe,4),[er],(i,[e])=>e.evaluate(i).toArray()],rgb:[er,[Xe,Xe,Xe],rh],rgba:[er,[Xe,Xe,Xe,Xe],rh],has:{type:Dt,overloads:[[[Nt],(i,[e])=>nh(e.evaluate(i),i.properties())],[[Nt,Bn],(i,[e,r])=>nh(e.evaluate(i),r.evaluate(i))]]},get:{type:Pt,overloads:[[[Nt],(i,[e])=>Ra(e.evaluate(i),i.properties())],[[Nt,Bn],(i,[e,r])=>Ra(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Pt,[Nt],(i,[e])=>Ra(e.evaluate(i),i.featureState||{})],properties:[Bn,[],i=>i.properties()],"geometry-type":[Nt,[],i=>i.geometryType()],id:[Pt,[],i=>i.id()],zoom:[Xe,[],i=>i.globals.zoom],"heatmap-density":[Xe,[],i=>i.globals.heatmapDensity||0],"line-progress":[Xe,[],i=>i.globals.lineProgress||0],accumulated:[Pt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Xe,is(Xe),(i,e)=>{let r=0;for(const o of e)r+=o.evaluate(i);return r}],"*":[Xe,is(Xe),(i,e)=>{let r=1;for(const o of e)r*=o.evaluate(i);return r}],"-":{type:Xe,overloads:[[[Xe,Xe],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Xe],(i,[e])=>-e.evaluate(i)]]},"/":[Xe,[Xe,Xe],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Xe,[Xe,Xe],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Xe,[],()=>Math.LN2],pi:[Xe,[],()=>Math.PI],e:[Xe,[],()=>Math.E],"^":[Xe,[Xe,Xe],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Xe,[Xe],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Xe,[Xe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Xe,[Xe],(i,[e])=>Math.log(e.evaluate(i))],log2:[Xe,[Xe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Xe,[Xe],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Xe,[Xe],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Xe,[Xe],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Xe,[Xe],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Xe,[Xe],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Xe,[Xe],(i,[e])=>Math.atan(e.evaluate(i))],min:[Xe,is(Xe),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Xe,is(Xe),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Xe,[Xe],(i,[e])=>Math.abs(e.evaluate(i))],round:[Xe,[Xe],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Xe,[Xe],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Xe,[Xe],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Dt,[Nt,Pt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Dt,[Pt],(i,[e])=>i.id()===e.value],"filter-type-==":[Dt,[Nt],(i,[e])=>i.geometryType()===e.value],"filter-<":[Dt,[Nt,Pt],(i,[e,r])=>{const o=i.properties()[e.value],d=r.value;return typeof o==typeof d&&o<d}],"filter-id-<":[Dt,[Pt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<o}],"filter->":[Dt,[Nt,Pt],(i,[e,r])=>{const o=i.properties()[e.value],d=r.value;return typeof o==typeof d&&o>d}],"filter-id->":[Dt,[Pt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>o}],"filter-<=":[Dt,[Nt,Pt],(i,[e,r])=>{const o=i.properties()[e.value],d=r.value;return typeof o==typeof d&&o<=d}],"filter-id-<=":[Dt,[Pt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<=o}],"filter->=":[Dt,[Nt,Pt],(i,[e,r])=>{const o=i.properties()[e.value],d=r.value;return typeof o==typeof d&&o>=d}],"filter-id->=":[Dt,[Pt],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>=o}],"filter-has":[Dt,[Pt],(i,[e])=>e.value in i.properties()],"filter-has-id":[Dt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Dt,[hr(Nt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Dt,[hr(Pt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Dt,[Nt,hr(Pt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Dt,[Nt,hr(Pt)],(i,[e,r])=>function(o,d,p,y){for(;p<=y;){const b=p+y>>1;if(d[b]===o)return!0;d[b]>o?y=b-1:p=b+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Dt,overloads:[[[Dt,Dt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[is(Dt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Dt,overloads:[[[Dt,Dt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[is(Dt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Dt,[Dt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Dt,[Nt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Nt,[Nt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Nt,[Nt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Nt,is(Pt),(i,e)=>e.map(r=>ft(r.evaluate(i))).join("")],"resolved-locale":[Nt,[vn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Ba{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Qt,this._defaultValue=r?function(o){return o.type==="color"&&xi(o.default)?new j(0,0,0,0):o.type==="color"?j.parse(o.default)||null:o.type==="padding"?re.parse(o.default)||null:o.default===void 0?null:o.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,o,d,p,y){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=d,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,r,o,d,p,y){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=d,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=y||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new rt(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Qs(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Is}function ea(i,e){const r=new Ts(Is,[],e?function(d){const p={color:er,string:Nt,number:Xe,enum:Nt,boolean:Dt,formatted:Zi,padding:xs,resolvedImage:Fi};return d.type==="array"?hr(p[d.value]||Pt,d.length):p[d.type]}(e):void 0),o=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?sh(new Ba(o,e)):As(r.errors)}class ta{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Es(r.expression)}evaluateWithoutErrorHandling(e,r,o,d,p,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,d,p,y)}evaluate(e,r,o,d,p,y){return this._styleExpression.evaluate(e,r,o,d,p,y)}}class No{constructor(e,r,o,d){this.kind=e,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Es(r.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,r,o,d,p,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,d,p,y)}evaluate(e,r,o,d,p,y){return this._styleExpression.evaluate(e,r,o,d,p,y)}interpolationFactor(e,r,o){return this.interpolationType?kr.interpolationFactor(this.interpolationType,e,r,o):0}}function lh(i,e){const r=ea(i,e);if(r.result==="error")return r;const o=r.value.expression,d=Hs(o);if(!d&&!bi(e))return As([new Ar("","data expressions not supported")]);const p=Sa(o,["zoom"]);if(!p&&!ah(e))return As([new Ar("","zoom expressions not supported")]);const y=Fa(o);return y||p?y instanceof Ar?As([y]):y instanceof kr&&!Xt(e)?As([new Ar("",'"interpolate" expressions cannot be used with this property')]):sh(y?new No(d?"camera":"composite",r.value,y.labels,y instanceof kr?y.interpolation:void 0):new ta(d?"constant":"source",r.value)):As([new Ar("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Oa{constructor(e,r){this._parameters=e,this._specification=r,Kr(this,Ys(this._parameters,this._specification))}static deserialize(e){return new Oa(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Fa(i){let e=null;if(i instanceof Pa)e=Fa(i.result);else if(i instanceof ka){for(const r of i.args)if(e=Fa(r),e)break}else(i instanceof Ws||i instanceof kr)&&i.input instanceof fi&&i.input.name==="zoom"&&(e=i);return e instanceof Ar||i.eachChild(r=>{const o=Fa(r);o instanceof Ar?e=o:!e&&o?e=new Ar("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Ar("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Jr(i){const e=i.key,r=i.value,o=i.valueSpec||{},d=i.objectElementValidators||{},p=i.style,y=i.styleSpec;let b=[];const M=ai(r);if(M!=="object")return[new Ye(e,r,`object expected, ${M} found`)];for(const I in r){const k=I.split(".")[0],L=o[k]||o["*"];let N;if(d[k])N=d[k];else if(o[k])N=zr;else if(d["*"])N=d["*"];else{if(!o["*"]){b.push(new Ye(e,r[I],`unknown property "${I}"`));continue}N=zr}b=b.concat(N({key:(e&&`${e}.`)+I,value:r[I],valueSpec:L,style:p,styleSpec:y,object:r,objectKey:I},r))}for(const I in o)d[I]||o[I].required&&o[I].default===void 0&&r[I]===void 0&&b.push(new Ye(e,r,`missing required property "${I}"`));return b}function hh(i){const e=i.value,r=i.valueSpec,o=i.style,d=i.styleSpec,p=i.key,y=i.arrayElementValidator||zr;if(ai(e)!=="array")return[new Ye(p,e,`array expected, ${ai(e)} found`)];if(r.length&&e.length!==r.length)return[new Ye(p,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Ye(p,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let b={type:r.value,values:r.values};d.$version<7&&(b.function=r.function),ai(r.value)==="object"&&(b=r.value);let M=[];for(let I=0;I<e.length;I++)M=M.concat(y({array:e,arrayIndex:I,value:e[I],valueSpec:b,style:o,styleSpec:d,key:`${p}[${I}]`}));return M}function Uo(i){const e=i.key,r=i.value,o=i.valueSpec;let d=ai(r);return d==="number"&&r!=r&&(d="NaN"),d!=="number"?[new Ye(e,r,`number expected, ${d} found`)]:"minimum"in o&&r<o.minimum?[new Ye(e,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new Ye(e,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function ch(i){const e=i.valueSpec,r=Jt(i.value.type);let o,d,p,y={};const b=r!=="categorical"&&i.value.property===void 0,M=!b,I=ai(i.value.stops)==="array"&&ai(i.value.stops[0])==="array"&&ai(i.value.stops[0][0])==="object",k=Jr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(V){if(r==="identity")return[new Ye(V.key,V.value,'identity function may not have a "stops" property')];let $=[];const te=V.value;return $=$.concat(hh({key:V.key,value:te,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:L})),ai(te)==="array"&&te.length===0&&$.push(new Ye(V.key,te,"array must have at least one stop")),$},default:function(V){return zr({key:V.key,value:V.value,valueSpec:e,style:V.style,styleSpec:V.styleSpec})}}});return r==="identity"&&b&&k.push(new Ye(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||k.push(new Ye(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Xt(i.valueSpec)&&k.push(new Ye(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(M&&!bi(i.valueSpec)?k.push(new Ye(i.key,i.value,"property functions not supported")):b&&!ah(i.valueSpec)&&k.push(new Ye(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!I||i.value.property!==void 0||k.push(new Ye(i.key,i.value,'"property" property is required')),k;function L(V){let $=[];const te=V.value,ee=V.key;if(ai(te)!=="array")return[new Ye(ee,te,`array expected, ${ai(te)} found`)];if(te.length!==2)return[new Ye(ee,te,`array length 2 expected, length ${te.length} found`)];if(I){if(ai(te[0])!=="object")return[new Ye(ee,te,`object expected, ${ai(te[0])} found`)];if(te[0].zoom===void 0)return[new Ye(ee,te,"object stop key must have zoom")];if(te[0].value===void 0)return[new Ye(ee,te,"object stop key must have value")];if(p&&p>Jt(te[0].zoom))return[new Ye(ee,te[0].zoom,"stop zoom values must appear in ascending order")];Jt(te[0].zoom)!==p&&(p=Jt(te[0].zoom),d=void 0,y={}),$=$.concat(Jr({key:`${ee}[0]`,value:te[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Uo,value:N}}))}else $=$.concat(N({key:`${ee}[0]`,value:te[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},te));return Qs($r(te[1]))?$.concat([new Ye(`${ee}[1]`,te[1],"expressions are not allowed in function stops.")]):$.concat(zr({key:`${ee}[1]`,value:te[1],valueSpec:e,style:V.style,styleSpec:V.styleSpec}))}function N(V,$){const te=ai(V.value),ee=Jt(V.value),ue=V.value!==null?V.value:$;if(o){if(te!==o)return[new Ye(V.key,ue,`${te} stop domain type must match previous stop domain type ${o}`)]}else o=te;if(te!=="number"&&te!=="string"&&te!=="boolean")return[new Ye(V.key,ue,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&r!=="categorical"){let ve=`number expected, ${te} found`;return bi(e)&&r===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(V.key,ue,ve)]}return r!=="categorical"||te!=="number"||isFinite(ee)&&Math.floor(ee)===ee?r!=="categorical"&&te==="number"&&d!==void 0&&ee<d?[new Ye(V.key,ue,"stop domain values must appear in ascending order")]:(d=ee,r==="categorical"&&ee in y?[new Ye(V.key,ue,"stop domain values must be unique")]:(y[ee]=!0,[])):[new Ye(V.key,ue,`integer expected, found ${ee}`)]}}function rs(i){const e=(i.expressionContext==="property"?lh:ea)($r(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new Ye(`${i.key}${o.key}`,i.value,o.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Ye(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Es(r))return[new Ye(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Es(r))return[new Ye(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Sa(r,["zoom","feature-state"]))return[new Ye(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Hs(r))return[new Ye(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ia(i){const e=i.key,r=i.value,o=i.valueSpec,d=[];return Array.isArray(o.values)?o.values.indexOf(Jt(r))===-1&&d.push(new Ye(e,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(Jt(r))===-1&&d.push(new Ye(e,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),d}function ks(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ks(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Uc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Na(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ks(i)||(i=ra(i));const e=ea(i,Uc);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,d)=>e.value.evaluate(r,o,{},d),needGeometry:dh(i)}}function uh(i,e){return i<e?-1:i>e?1:0}function dh(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(dh(i[e]))return!0;return!1}function ra(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Vo(i[1],i[2],"=="):e==="!="?Ps(Vo(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Vo(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(ra))):e==="all"?["all"].concat(i.slice(1).map(ra)):e==="none"?["all"].concat(i.slice(1).map(ra).map(Ps)):e==="in"?Ua(i[1],i.slice(2)):e==="!in"?Ps(Ua(i[1],i.slice(2))):e==="has"?na(i[1]):e==="!has"?Ps(na(i[1])):e!=="within"||i;var r}function Vo(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Ua(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(uh)]]:["filter-in-small",i,["literal",e]]}}function na(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ps(i){return["!",i]}function sa(i){return ks($r(i.value))?rs(Kr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):fh(i)}function fh(i){const e=i.value,r=i.key;if(ai(e)!=="array")return[new Ye(r,e,`array expected, ${ai(e)} found`)];const o=i.styleSpec;let d,p=[];if(e.length<1)return[new Ye(r,e,"filter array must have at least 1 element")];switch(p=p.concat(ia({key:`${r}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Jt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Jt(e[1])==="$type"&&p.push(new Ye(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new Ye(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=ai(e[1]),d!=="string"&&p.push(new Ye(`${r}[1]`,e[1],`string expected, ${d} found`)));for(let y=2;y<e.length;y++)d=ai(e[y]),Jt(e[1])==="$type"?p=p.concat(ia({key:`${r}[${y}]`,value:e[y],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&p.push(new Ye(`${r}[${y}]`,e[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)p=p.concat(fh({key:`${r}[${y}]`,value:e[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=ai(e[1]),e.length!==2?p.push(new Ye(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&p.push(new Ye(`${r}[1]`,e[1],`string expected, ${d} found`));break;case"within":d=ai(e[1]),e.length!==2?p.push(new Ye(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="object"&&p.push(new Ye(`${r}[1]`,e[1],`object expected, ${d} found`))}return p}function aa(i,e){const r=i.key,o=i.style,d=i.styleSpec,p=i.value,y=i.objectKey,b=d[`${e}_${i.layerType}`];if(!b)return[];const M=y.match(/^(.*)-transition$/);if(e==="paint"&&M&&b[M[1]]&&b[M[1]].transition)return zr({key:r,value:p,valueSpec:d.transition,style:o,styleSpec:d});const I=i.valueSpec||b[y];if(!I)return[new Ye(r,p,`unknown property "${y}"`)];let k;if(ai(p)==="string"&&bi(I)&&!I.tokens&&(k=/^{([^}]+)}$/.exec(p)))return[new Ye(r,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const L=[];return i.layerType==="symbol"&&(y==="text-field"&&o&&!o.glyphs&&L.push(new Ye(r,p,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&xi($r(p))&&Jt(p.type)==="identity"&&L.push(new Ye(r,p,'"text-font" does not support identity functions'))),L.concat(zr({key:i.key,value:p,valueSpec:I,style:o,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function ph(i){return aa(i,"paint")}function mh(i){return aa(i,"layout")}function gh(i){let e=[];const r=i.value,o=i.key,d=i.style,p=i.styleSpec;r.type||r.ref||e.push(new Ye(o,r,'either "type" or "ref" is required'));let y=Jt(r.type);const b=Jt(r.ref);if(r.id){const M=Jt(r.id);for(let I=0;I<i.arrayIndex;I++){const k=d.layers[I];Jt(k.id)===M&&e.push(new Ye(o,r.id,`duplicate layer id "${r.id}", previously used at line ${k.id.__line__}`))}}if("ref"in r){let M;["type","source","source-layer","filter","layout"].forEach(I=>{I in r&&e.push(new Ye(o,r[I],`"${I}" is prohibited for ref layers`))}),d.layers.forEach(I=>{Jt(I.id)===b&&(M=I)}),M?M.ref?e.push(new Ye(o,r.ref,"ref cannot reference another ref layer")):y=Jt(M.type):e.push(new Ye(o,r.ref,`ref layer "${b}" not found`))}else if(y!=="background")if(r.source){const M=d.sources&&d.sources[r.source],I=M&&Jt(M.type);M?I==="vector"&&y==="raster"?e.push(new Ye(o,r.source,`layer "${r.id}" requires a raster source`)):I==="raster"&&y!=="raster"?e.push(new Ye(o,r.source,`layer "${r.id}" requires a vector source`)):I!=="vector"||r["source-layer"]?I==="raster-dem"&&y!=="hillshade"?e.push(new Ye(o,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!r.paint||!r.paint["line-gradient"]||I==="geojson"&&M.lineMetrics||e.push(new Ye(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ye(o,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Ye(o,r.source,`source "${r.source}" not found`))}else e.push(new Ye(o,r,'missing required property "source"'));return e=e.concat(Jr({key:o,value:r,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zr({key:`${o}.type`,value:r.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:sa,layout:M=>Jr({layer:r,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":I=>mh(Kr({layerType:y},I))}}),paint:M=>Jr({layer:r,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":I=>ph(Kr({layerType:y},I))}})}})),e}function zs(i){const e=i.value,r=i.key,o=ai(e);return o!=="string"?[new Ye(r,e,`string expected, ${o} found`)]:[]}const _h={promoteId:function({key:i,value:e}){if(ai(e)==="string")return zs({key:i,value:e});{const r=[];for(const o in e)r.push(...zs({key:`${i}.${o}`,value:e[o]}));return r}}};function oa(i){const e=i.value,r=i.key,o=i.styleSpec,d=i.style;if(!e.type)return[new Ye(r,e,'"type" is required')];const p=Jt(e.type);let y;switch(p){case"vector":case"raster":case"raster-dem":return y=Jr({key:r,value:e,valueSpec:o[`source_${p.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:_h}),y;case"geojson":if(y=Jr({key:r,value:e,valueSpec:o.source_geojson,style:d,styleSpec:o,objectElementValidators:_h}),e.cluster)for(const b in e.clusterProperties){const[M,I]=e.clusterProperties[b],k=typeof M=="string"?[M,["accumulated"],["get",b]]:M;y.push(...rs({key:`${r}.${b}.map`,value:I,expressionContext:"cluster-map"})),y.push(...rs({key:`${r}.${b}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return y;case"video":return Jr({key:r,value:e,valueSpec:o.source_video,style:d,styleSpec:o});case"image":return Jr({key:r,value:e,valueSpec:o.source_image,style:d,styleSpec:o});case"canvas":return[new Ye(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ia({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:o})}}function la(i){const e=i.value,r=i.styleSpec,o=r.light,d=i.style;let p=[];const y=ai(e);if(e===void 0)return p;if(y!=="object")return p=p.concat([new Ye("light",e,`object expected, ${y} found`)]),p;for(const b in e){const M=b.match(/^(.*)-transition$/);p=p.concat(M&&o[M[1]]&&o[M[1]].transition?zr({key:b,value:e[b],valueSpec:r.transition,style:d,styleSpec:r}):o[b]?zr({key:b,value:e[b],valueSpec:o[b],style:d,styleSpec:r}):[new Ye(b,e[b],`unknown property "${b}"`)])}return p}function Pr(i){const e=i.value,r=i.styleSpec,o=r.terrain,d=i.style;let p=[];const y=ai(e);if(e===void 0)return p;if(y!=="object")return p=p.concat([new Ye("terrain",e,`object expected, ${y} found`)]),p;for(const b in e)p=p.concat(o[b]?zr({key:b,value:e[b],valueSpec:o[b],style:d,styleSpec:r}):[new Ye(b,e[b],`unknown property "${b}"`)]);return p}const ha={"*":()=>[],array:hh,boolean:function(i){const e=i.value,r=i.key,o=ai(e);return o!=="boolean"?[new Ye(r,e,`boolean expected, ${o} found`)]:[]},number:Uo,color:function(i){const e=i.key,r=i.value,o=ai(r);return o!=="string"?[new Ye(e,r,`color expected, ${o} found`)]:ws(r)===null?[new Ye(e,r,`color expected, "${r}" found`)]:[]},constants:Jn,enum:ia,filter:sa,function:ch,layer:gh,object:Jr,source:oa,light:la,terrain:Pr,string:zs,formatted:function(i){return zs(i).length===0?[]:rs(i)},resolvedImage:function(i){return zs(i).length===0?[]:rs(i)},padding:function(i){const e=i.key,r=i.value;if(ai(r)==="array"){if(r.length<1||r.length>4)return[new Ye(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let d=[];for(let p=0;p<r.length;p++)d=d.concat(zr({key:`${e}[${p}]`,value:r[p],valueSpec:o}));return d}return Uo({key:e,value:r,valueSpec:{}})}};function zr(i){const e=i.value,r=i.valueSpec,o=i.styleSpec;return r.expression&&xi(Jt(e))?ch(i):r.expression&&Qs($r(e))?rs(i):r.type&&ha[r.type]?ha[r.type](i):Jr(Kr({},i,{valueSpec:r.type?o[r.type]:r}))}function Vc(i){const e=i.value,r=i.key,o=zs(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Ye(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Ye(r,e,'"glyphs" url must include a "{range}" token'))),o}function On(i,e=ke){let r=[];return r=r.concat(zr({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Vc,"*":()=>[]}})),i.constants&&(r=r.concat(Jn({key:"constants",value:i.constants,style:i,styleSpec:e}))),yh(r)}function yh(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function xn(i){return function(...e){return yh(i.apply(this,e))}}On.source=xn(oa),On.light=xn(la),On.terrain=xn(Pr),On.layer=xn(gh),On.filter=xn(sa),On.paintProperty=xn(ph),On.layoutProperty=xn(mh);const ca=On,$o=ca.light,$c=ca.paintProperty,qc=ca.layoutProperty;function Va(i,e){let r=!1;if(e&&e.length)for(const o of e)i.fire(new vs(new Error(o.message))),r=!0;return r}class ua{constructor(e,r,o){const d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(r=y[1])+2*(o=y[2]);for(let M=0;M<this.d*this.d;M++){const I=y[3+M],k=y[3+M+1];d.push(I===k?null:y.subarray(I,k))}const b=y[3+d.length+1];this.keys=y.subarray(y[3+d.length],b),this.bboxes=y.subarray(b),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let y=0;y<this.d*this.d;y++)d.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=o,this.scale=r/e,this.uid=0;const p=o/r*e;this.min=-p,this.max=e+p}insert(e,r,o,d,p){this._forEachCell(r,o,d,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(d),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,o,d,p,y){this.cells[p].push(y)}query(e,r,o,d,p){const y=this.min,b=this.max;if(e<=y&&r<=y&&b<=o&&b<=d&&!p)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(e,r,o,d,this._queryCell,M,{},p),M}}_queryCell(e,r,o,d,p,y,b,M){const I=this.cells[p];if(I!==null){const k=this.keys,L=this.bboxes;for(let N=0;N<I.length;N++){const V=I[N];if(b[V]===void 0){const $=4*V;(M?M(L[$+0],L[$+1],L[$+2],L[$+3]):e<=L[$+2]&&r<=L[$+3]&&o>=L[$+0]&&d>=L[$+1])?(b[V]=!0,y.push(k[V])):b[V]=!1}}}}_forEachCell(e,r,o,d,p,y,b,M){const I=this._convertToCellCoord(e),k=this._convertToCellCoord(r),L=this._convertToCellCoord(o),N=this._convertToCellCoord(d);for(let V=I;V<=L;V++)for(let $=k;$<=N;$++){const te=this.d*$+V;if((!M||M(this._convertFromCellCoord(V),this._convertFromCellCoord($),this._convertFromCellCoord(V+1),this._convertFromCellCoord($+1)))&&p.call(this,e,r,o,d,te,y,b,M))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let o=0;for(let y=0;y<this.cells.length;y++)o+=this.cells[y].length;const d=new Int32Array(r+o+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let p=r;for(let y=0;y<e.length;y++){const b=e[y];d[3+y]=p,d.set(b,p),p+=b.length}return d[3+e.length]=p,d.set(this.keys,p),p+=this.keys.length,d[3+e.length+1]=p,d.set(this.bboxes,p),p+=this.bboxes.length,d.buffer}static serialize(e,r){const o=e.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(e){return new ua(e.buffer)}}const bn={};function ct(i,e,r={}){if(bn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),bn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}ct("Object",Object),ct("TransferableGridIndex",ua),ct("Color",j),ct("Error",Error),ct("AJAXError",Ot),ct("ResolvedImage",oe),ct("StylePropertyFunction",Oa),ct("StyleExpression",Ba,{omit:["_evaluator"]}),ct("ZoomDependentExpression",No),ct("ZoomConstantExpression",ta),ct("CompoundExpression",fi,{omit:["_evaluate"]});for(const i in Is)Is[i]._classRegistryKey||ct(`Expression_${i}`,Is[i]);function vh(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ns(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(vh(i)||D(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const o of i)r.push(ns(o,e));return r}if(typeof i=="object"){const r=i.constructor,o=r._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");if(!bn[o])throw new Error(`${o} is not registered.`);const d=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&d===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||bn[o].omit.indexOf(p)>=0)continue;const y=i[p];d[p]=bn[o].shallow.indexOf(p)>=0?y:ns(y,e)}i instanceof Error&&(d.message=i.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(d.$name=o),d}throw new Error("can't serialize object of type "+typeof i)}function Fn(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||vh(i)||D(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Fn);if(typeof i=="object"){const e=i.$name||"Object";if(!bn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=bn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const o=Object.create(r.prototype);for(const d of Object.keys(i)){if(d==="$name")continue;const p=i[d];o[d]=bn[e].shallow.indexOf(d)>=0?p:Fn(p)}return o}throw new Error("can't deserialize object of type "+typeof i)}class qo{constructor(){this.first=!0}update(e,r){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const et={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function $a(i){for(const e of i)if(jo(e.charCodeAt(0)))return!0;return!1}function Gc(i){for(const e of i)if(!Go(e.charCodeAt(0)))return!1;return!0}function Go(i){return!(et.Arabic(i)||et["Arabic Supplement"](i)||et["Arabic Extended-A"](i)||et["Arabic Presentation Forms-A"](i)||et["Arabic Presentation Forms-B"](i))}function jo(i){return!(i!==746&&i!==747&&(i<4352||!(et["Bopomofo Extended"](i)||et.Bopomofo(i)||et["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||et["CJK Compatibility Ideographs"](i)||et["CJK Compatibility"](i)||et["CJK Radicals Supplement"](i)||et["CJK Strokes"](i)||!(!et["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||et["CJK Unified Ideographs Extension A"](i)||et["CJK Unified Ideographs"](i)||et["Enclosed CJK Letters and Months"](i)||et["Hangul Compatibility Jamo"](i)||et["Hangul Jamo Extended-A"](i)||et["Hangul Jamo Extended-B"](i)||et["Hangul Jamo"](i)||et["Hangul Syllables"](i)||et.Hiragana(i)||et["Ideographic Description Characters"](i)||et.Kanbun(i)||et["Kangxi Radicals"](i)||et["Katakana Phonetic Extensions"](i)||et.Katakana(i)&&i!==12540||!(!et["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!et["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||et["Unified Canadian Aboriginal Syllabics"](i)||et["Unified Canadian Aboriginal Syllabics Extended"](i)||et["Vertical Forms"](i)||et["Yijing Hexagram Symbols"](i)||et["Yi Syllables"](i)||et["Yi Radicals"](i))))}function xh(i){return!(jo(i)||function(e){return!!(et["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||et["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||et["Letterlike Symbols"](e)||et["Number Forms"](e)||et["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||et["Control Pictures"](e)&&e!==9251||et["Optical Character Recognition"](e)||et["Enclosed Alphanumerics"](e)||et["Geometric Shapes"](e)||et["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||et["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||et["CJK Symbols and Punctuation"](e)||et.Katakana(e)||et["Private Use Area"](e)||et["CJK Compatibility Forms"](e)||et["Small Form Variants"](e)||et["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function bh(i){return i>=1424&&i<=2303||et["Arabic Presentation Forms-A"](i)||et["Arabic Presentation Forms-B"](i)}function jc(i,e){return!(!e&&bh(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||et.Khmer(i))}function wh(i){for(const e of i)if(bh(e.charCodeAt(0)))return!0;return!1}const Zo="deferred",Ho="loading",Wo="loaded";let Xo=null,vr="unavailable",Nn=null;const Mh=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(vr="error"),Xo&&Xo(i)};function Ls(){Ko.fire(new _n("pluginStateChange",{pluginStatus:vr,pluginURL:Nn}))}const Ko=new yn,da=function(){return vr},Eh=function(){if(vr!==Zo||!Nn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");vr=Ho,Ls(),Nn&&Dn({url:Nn},i=>{i?Mh(i):(vr=Wo,Ls())})},qr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>vr===Wo||qr.applyArabicShaping!=null,isLoading:()=>vr===Ho,setState(i){if(!Pe())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");vr=i.pluginStatus,Nn=i.pluginURL},isParsed(){if(!Pe())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return qr.applyArabicShaping!=null&&qr.processBidirectionalText!=null&&qr.processStyledBidirectionalText!=null},getPluginURL(){if(!Pe())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Nn}};class Si{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qo,this.transition={})}isSupportedScript(e){return function(r,o){for(const d of r)if(!jc(d.charCodeAt(0),o))return!1;return!0}(e,qr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class fa{constructor(e,r){this.property=e,this.value=r,this.expression=function(o,d){if(xi(o))return new Oa(o,d);if(Qs(o)){const p=lh(o,d);if(p.result==="error")throw new Error(p.value.map(y=>`${y.key}: ${y.message}`).join(", "));return p.value}{let p=o;return d.type==="color"&&typeof o=="string"?p=j.parse(o):d.type!=="padding"||typeof o!="number"&&!Array.isArray(o)||(p=re.parse(o)),{kind:"constant",evaluate:()=>p}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,o){return this.property.possiblyEvaluate(this,e,r,o)}}class qa{constructor(e){this.property=e,this.value=new fa(e,void 0)}transitioned(e,r){return new Sh(this.property,this.value,r,le({},e.transition,this.transition),e.now)}untransitioned(){return new Sh(this.property,this.value,null,{},0)}}class Th{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return xe(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new qa(this._values[e].property)),this._values[e].value=new fa(this._values[e].property,r===null?void 0:xe(r))}getTransition(e){return xe(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new qa(this._values[e].property)),this._values[e].transition=xe(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o);const d=this.getTransition(r);d!==void 0&&(e[`${r}-transition`]=d)}return e}transitioned(e,r){const o=new Ih(this._properties);for(const d of Object.keys(this._values))o._values[d]=this._values[d].transitioned(e,r._values[d]);return o}untransitioned(){const e=new Ih(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Sh{constructor(e,r,o,d,p){this.property=e,this.value=r,this.begin=p+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=o)}possiblyEvaluate(e,r,o){const d=e.now||0,p=this.value.possiblyEvaluate(e,r,o),y=this.prior;if(y){if(d>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(d<this.begin)return y.possiblyEvaluate(e,r,o);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,r,o),p,function(M){if(M<=0)return 0;if(M>=1)return 1;const I=M*M,k=I*M;return 4*(M<.5?k:3*(M-I)+k-.75)}(b))}}return p}}class Ih{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,o){const d=new pa(this._properties);for(const p of Object.keys(this._values))d._values[p]=this._values[p].possiblyEvaluate(e,r,o);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Zc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return xe(this._values[e].value)}setValue(e,r){this._values[e]=new fa(this._values[e].property,r===null?void 0:xe(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o)}return e}possiblyEvaluate(e,r,o){const d=new pa(this._properties);for(const p of Object.keys(this._values))d._values[p]=this._values[p].possiblyEvaluate(e,r,o);return d}}class on{constructor(e,r,o){this.property=e,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,o,d){return this.property.evaluate(this.value,this.parameters,e,r,o,d)}}class pa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class _t{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,o){const d=Xs[this.specification.type];return d?d(e,r,o):e}}class Tt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,o,d){return new on(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},o,d)}:e.expression,r)}interpolate(e,r,o){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new on(this,{kind:"constant",value:void 0},e.parameters);const d=Xs[this.specification.type];return d?new on(this,{kind:"constant",value:d(e.value.value,r.value.value,o)},e.parameters):e}evaluate(e,r,o,d,p,y){return e.kind==="constant"?e.value:e.evaluate(r,o,d,p,y)}}class Ds extends Tt{possiblyEvaluate(e,r,o,d){if(e.value===void 0)return new on(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const p=e.expression.evaluate(r,null,{},o,d),y=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,b=this._calculate(y,y,y,r);return new on(this,{kind:"constant",value:b},r)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new on(this,{kind:"constant",value:p},r)}return new on(this,e.expression,r)}evaluate(e,r,o,d,p,y){if(e.kind==="source"){const b=e.evaluate(r,o,d,p,y);return this._calculate(b,b,b,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},o,d),e.evaluate({zoom:Math.floor(r.zoom)},o,d),e.evaluate({zoom:Math.floor(r.zoom)+1},o,d),r):e.value}_calculate(e,r,o,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class Jo{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,d){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(r,null,{},o,d);return this._calculate(p,p,p,r)}return this._calculate(e.expression.evaluate(new Si(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Si(Math.floor(r.zoom),r)),e.expression.evaluate(new Si(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,o,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class Un{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,d){return!!e.expression.evaluate(r,null,{},o,d)}interpolate(){return!1}}class tr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const o=e[r];o.specification.overridable&&this.overridableProperties.push(r);const d=this.defaultPropertyValues[r]=new fa(o,void 0),p=this.defaultTransitionablePropertyValues[r]=new qa(o);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=d.possiblyEvaluate({})}}}ct("DataDrivenProperty",Tt),ct("DataConstantProperty",_t),ct("CrossFadedDataDrivenProperty",Ds),ct("CrossFadedProperty",Jo),ct("ColorRampProperty",Un);const Vn="-transition";class ln extends yn{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Zc(r.layout)),r.paint)){this._transitionablePaint=new Th(r.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pa(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,o={}){r!=null&&this._validate(qc,`layers.${this.id}.layout.${e}`,e,r,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Vn)?this._transitionablePaint.getTransition(e.slice(0,-Vn.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,o={}){if(r!=null&&this._validate($c,`layers.${this.id}.paint.${e}`,e,r,o))return!1;if(e.endsWith(Vn))return this._transitionablePaint.setTransition(e.slice(0,-Vn.length),r||void 0),!1;{const d=this._transitionablePaint._values[e],p=d.property.specification["property-type"]==="cross-faded-data-driven",y=d.value.isDataDriven(),b=d.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const M=this._transitionablePaint._values[e].value;return M.isDataDriven()||y||p||this._handleOverridablePaintPropertyUpdate(e,b,M)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ee(e,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(e,r,o,d,p={}){return(!p||p.validate!==!1)&&Va(this,e.call(ca,{key:r,layerType:this.type,objectKey:o,value:d,styleSpec:ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof on&&bi(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Ah={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $n{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ni(i,e=1){let r=0,o=0;return{members:i.map(d=>{const p=Ah[d.type].BYTES_PER_ELEMENT,y=r=Yo(r,Math.max(e,p)),b=d.components||1;return o=Math.max(o,p),r+=p*b,{name:d.name,type:d.type,components:b,offset:y}}),size:Yo(r,Math.max(o,e)),alignment:e}}function Yo(i,e){return Math.ceil(i/e)*e}class ss extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const d=2*e;return this.int16[d+0]=r,this.int16[d+1]=o,e}}ss.prototype.bytesPerElement=4,ct("StructArrayLayout2i4",ss);class u extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o,d)}emplace(e,r,o,d,p){const y=4*e;return this.int16[y+0]=r,this.int16[y+1]=o,this.int16[y+2]=d,this.int16[y+3]=p,e}}u.prototype.bytesPerElement=8,ct("StructArrayLayout4i8",u);class t extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,o,d,p,y)}emplace(e,r,o,d,p,y,b){const M=6*e;return this.int16[M+0]=r,this.int16[M+1]=o,this.int16[M+2]=d,this.int16[M+3]=p,this.int16[M+4]=y,this.int16[M+5]=b,e}}t.prototype.bytesPerElement=12,ct("StructArrayLayout2i4i12",t);class s extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,o,d,p,y)}emplace(e,r,o,d,p,y,b){const M=4*e,I=8*e;return this.int16[M+0]=r,this.int16[M+1]=o,this.uint8[I+4]=d,this.uint8[I+5]=p,this.uint8[I+6]=y,this.uint8[I+7]=b,e}}s.prototype.bytesPerElement=8,ct("StructArrayLayout2i4ub8",s);class h extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const d=2*e;return this.float32[d+0]=r,this.float32[d+1]=o,e}}h.prototype.bytesPerElement=8,ct("StructArrayLayout2f8",h);class f extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,d,p,y,b,M,I,k){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,o,d,p,y,b,M,I,k)}emplace(e,r,o,d,p,y,b,M,I,k,L){const N=10*e;return this.uint16[N+0]=r,this.uint16[N+1]=o,this.uint16[N+2]=d,this.uint16[N+3]=p,this.uint16[N+4]=y,this.uint16[N+5]=b,this.uint16[N+6]=M,this.uint16[N+7]=I,this.uint16[N+8]=k,this.uint16[N+9]=L,e}}f.prototype.bytesPerElement=20,ct("StructArrayLayout10ui20",f);class _ extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,d,p,y,b,M,I,k,L,N){const V=this.length;return this.resize(V+1),this.emplace(V,e,r,o,d,p,y,b,M,I,k,L,N)}emplace(e,r,o,d,p,y,b,M,I,k,L,N,V){const $=12*e;return this.int16[$+0]=r,this.int16[$+1]=o,this.int16[$+2]=d,this.int16[$+3]=p,this.uint16[$+4]=y,this.uint16[$+5]=b,this.uint16[$+6]=M,this.uint16[$+7]=I,this.int16[$+8]=k,this.int16[$+9]=L,this.int16[$+10]=N,this.int16[$+11]=V,e}}_.prototype.bytesPerElement=24,ct("StructArrayLayout4i4ui4i24",_);class v extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,o)}emplace(e,r,o,d){const p=3*e;return this.float32[p+0]=r,this.float32[p+1]=o,this.float32[p+2]=d,e}}v.prototype.bytesPerElement=12,ct("StructArrayLayout3f12",v);class E extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}E.prototype.bytesPerElement=4,ct("StructArrayLayout1ul4",E);class T extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,d,p,y,b,M,I){const k=this.length;return this.resize(k+1),this.emplace(k,e,r,o,d,p,y,b,M,I)}emplace(e,r,o,d,p,y,b,M,I,k){const L=10*e,N=5*e;return this.int16[L+0]=r,this.int16[L+1]=o,this.int16[L+2]=d,this.int16[L+3]=p,this.int16[L+4]=y,this.int16[L+5]=b,this.uint32[N+3]=M,this.uint16[L+8]=I,this.uint16[L+9]=k,e}}T.prototype.bytesPerElement=20,ct("StructArrayLayout6i1ul2ui20",T);class A extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,d,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,o,d,p,y)}emplace(e,r,o,d,p,y,b){const M=6*e;return this.int16[M+0]=r,this.int16[M+1]=o,this.int16[M+2]=d,this.int16[M+3]=p,this.int16[M+4]=y,this.int16[M+5]=b,e}}A.prototype.bytesPerElement=12,ct("StructArrayLayout2i2i2i12",A);class z extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,d,p)}emplace(e,r,o,d,p,y){const b=4*e,M=8*e;return this.float32[b+0]=r,this.float32[b+1]=o,this.float32[b+2]=d,this.int16[M+6]=p,this.int16[M+7]=y,e}}z.prototype.bytesPerElement=16,ct("StructArrayLayout2f1f2i16",z);class O extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o,d)}emplace(e,r,o,d,p){const y=12*e,b=3*e;return this.uint8[y+0]=r,this.uint8[y+1]=o,this.float32[b+1]=d,this.float32[b+2]=p,e}}O.prototype.bytesPerElement=12,ct("StructArrayLayout2ub2f12",O);class U extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,o)}emplace(e,r,o,d){const p=3*e;return this.uint16[p+0]=r,this.uint16[p+1]=o,this.uint16[p+2]=d,e}}U.prototype.bytesPerElement=6,ct("StructArrayLayout3ui6",U);class J extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,d,p,y,b,M,I,k,L,N,V,$,te,ee,ue){const ve=this.length;return this.resize(ve+1),this.emplace(ve,e,r,o,d,p,y,b,M,I,k,L,N,V,$,te,ee,ue)}emplace(e,r,o,d,p,y,b,M,I,k,L,N,V,$,te,ee,ue,ve){const ce=24*e,_e=12*e,Le=48*e;return this.int16[ce+0]=r,this.int16[ce+1]=o,this.uint16[ce+2]=d,this.uint16[ce+3]=p,this.uint32[_e+2]=y,this.uint32[_e+3]=b,this.uint32[_e+4]=M,this.uint16[ce+10]=I,this.uint16[ce+11]=k,this.uint16[ce+12]=L,this.float32[_e+7]=N,this.float32[_e+8]=V,this.uint8[Le+36]=$,this.uint8[Le+37]=te,this.uint8[Le+38]=ee,this.uint32[_e+10]=ue,this.int16[ce+22]=ve,e}}J.prototype.bytesPerElement=48,ct("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",J);class W extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,d,p,y,b,M,I,k,L,N,V,$,te,ee,ue,ve,ce,_e,Le,ze,lt,pt,tt,Je,Ze,it){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,e,r,o,d,p,y,b,M,I,k,L,N,V,$,te,ee,ue,ve,ce,_e,Le,ze,lt,pt,tt,Je,Ze,it)}emplace(e,r,o,d,p,y,b,M,I,k,L,N,V,$,te,ee,ue,ve,ce,_e,Le,ze,lt,pt,tt,Je,Ze,it,Qe){const $e=34*e,wt=17*e;return this.int16[$e+0]=r,this.int16[$e+1]=o,this.int16[$e+2]=d,this.int16[$e+3]=p,this.int16[$e+4]=y,this.int16[$e+5]=b,this.int16[$e+6]=M,this.int16[$e+7]=I,this.uint16[$e+8]=k,this.uint16[$e+9]=L,this.uint16[$e+10]=N,this.uint16[$e+11]=V,this.uint16[$e+12]=$,this.uint16[$e+13]=te,this.uint16[$e+14]=ee,this.uint16[$e+15]=ue,this.uint16[$e+16]=ve,this.uint16[$e+17]=ce,this.uint16[$e+18]=_e,this.uint16[$e+19]=Le,this.uint16[$e+20]=ze,this.uint16[$e+21]=lt,this.uint16[$e+22]=pt,this.uint32[wt+12]=tt,this.float32[wt+13]=Je,this.float32[wt+14]=Ze,this.float32[wt+15]=it,this.float32[wt+16]=Qe,e}}W.prototype.bytesPerElement=68,ct("StructArrayLayout8i15ui1ul4f68",W);class X extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}X.prototype.bytesPerElement=4,ct("StructArrayLayout1f4",X);class se extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,o)}emplace(e,r,o,d){const p=3*e;return this.int16[p+0]=r,this.int16[p+1]=o,this.int16[p+2]=d,e}}se.prototype.bytesPerElement=6,ct("StructArrayLayout3i6",se);class he extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,o)}emplace(e,r,o,d){const p=4*e;return this.uint32[2*e+0]=r,this.uint16[p+2]=o,this.uint16[p+3]=d,e}}he.prototype.bytesPerElement=8,ct("StructArrayLayout1ul2ui8",he);class pe extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const d=2*e;return this.uint16[d+0]=r,this.uint16[d+1]=o,e}}pe.prototype.bytesPerElement=4,ct("StructArrayLayout2ui4",pe);class Y extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Y.prototype.bytesPerElement=2,ct("StructArrayLayout1ui2",Y);class ye extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,o,d)}emplace(e,r,o,d,p){const y=4*e;return this.float32[y+0]=r,this.float32[y+1]=o,this.float32[y+2]=d,this.float32[y+3]=p,e}}ye.prototype.bytesPerElement=16,ct("StructArrayLayout4f16",ye);class ge extends $n{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new H(this.anchorPointX,this.anchorPointY)}}ge.prototype.size=20;class Ie extends T{get(e){return new ge(this,e)}}ct("CollisionBoxArray",Ie);class Ae extends $n{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ae.prototype.size=48;class Ue extends J{get(e){return new Ae(this,e)}}ct("PlacedSymbolArray",Ue);class Me extends $n{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Me.prototype.size=68;class at extends W{get(e){return new Me(this,e)}}ct("SymbolInstanceArray",at);class Ke extends X{getoffsetX(e){return this.float32[1*e+0]}}ct("GlyphOffsetArray",Ke);class ot extends se{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ct("SymbolLineVertexArray",ot);class Rt extends $n{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Rt.prototype.size=8;class Vt extends he{get(e){return new Rt(this,e)}}ct("FeatureIndexArray",Vt);class bt extends ss{}class li extends ss{}class hi extends ss{}class Kt extends t{}class ei extends s{}class ui extends h{}class Wi extends f{}class hn extends _{}class Yr extends v{}class cn extends E{}class qn extends A{}class Gr extends O{}class xr extends U{}class wn extends pe{}const Ga=Ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:$i}=Ga;class Gt{constructor(e=[]){this.segments=e}prepareSegment(e,r,o,d){let p=this.segments[this.segments.length-1];return e>Gt.MAX_VERTEX_ARRAY_LENGTH&&qe(`Max vertices per segment is ${Gt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Gt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==d)&&(p={vertexOffset:r.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},d!==void 0&&(p.sortKey=d),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,o,d){return new Gt([{vertexOffset:e,primitiveOffset:r,vertexLength:o,primitiveLength:d,vaos:{},sortKey:0}])}}function oi(i,e){return 256*(i=F(Math.floor(i),0,255))+F(Math.floor(e),0,255)}Gt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ct("SegmentVector",Gt);const Xi=Ni([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ki={exports:{}},Ii={exports:{}};Ii.exports=function(i,e){var r,o,d,p,y,b,M,I;for(o=i.length-(r=3&i.length),d=e,y=3432918353,b=461845907,I=0;I<o;)M=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,d=27492+(65535&(p=5*(65535&(d=(d^=M=(65535&(M=(M=(65535&M)*y+(((M>>>16)*y&65535)<<16)&4294967295)<<15|M>>>17))*b+(((M>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(M=0,r){case 3:M^=(255&i.charCodeAt(I+2))<<16;case 2:M^=(255&i.charCodeAt(I+1))<<8;case 1:d^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(I)))*y+(((M>>>16)*y&65535)<<16)&4294967295)<<15|M>>>17))*b+(((M>>>16)*b&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var jr={exports:{}};jr.exports=function(i,e){for(var r,o=i.length,d=e^o,p=0;o>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),o-=4,++p;switch(o){case 3:d^=(255&i.charCodeAt(p+2))<<16;case 2:d^=(255&i.charCodeAt(p+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(p)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var as=Ii.exports,Qo=jr.exports;Ki.exports=as,Ki.exports.murmur3=as,Ki.exports.murmur2=Qo;class Rs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,o,d){this.ids.push(Ch(e)),this.positions.push(r,o,d)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Ch(e);let o=0,d=this.ids.length-1;for(;o<d;){const y=o+d>>1;this.ids[y]>=r?d=y:o=y+1}const p=[];for(;this.ids[o]===r;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(e,r){const o=new Float64Array(e.ids),d=new Uint32Array(e.positions);return el(o,d,0,o.length-1),r&&r.push(o.buffer,d.buffer),{ids:o,positions:d}}static deserialize(e){const r=new Rs;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Ch(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Ki.exports(String(i))}function el(i,e,r,o){for(;r<o;){const d=i[r+o>>1];let p=r-1,y=o+1;for(;;){do p++;while(i[p]<d);do y--;while(i[y]>d);if(p>=y)break;Gn(i,p,y),Gn(e,3*p,3*y),Gn(e,3*p+1,3*y+1),Gn(e,3*p+2,3*y+2)}y-r<o-y?(el(i,e,r,y),r=y+1):(el(i,e,y+1,o),o=y)}}function Gn(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}ct("FeaturePositionMap",Rs);class os{constructor(e,r){this.gl=e.gl,this.location=r}}class ls extends os{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ja extends os{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class cd extends os{constructor(e,r){super(e,r),this.current=j.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Lm=new Float32Array(16);function Hc(i){return[oi(255*i.r,255*i.g),oi(255*i.b,255*i.a)]}class tl{constructor(e,r,o){this.value=e,this.uniformNames=r.map(d=>`u_${d}`),this.type=o}setUniform(e,r,o){e.set(o.constantOr(this.value))}getBinding(e,r,o){return this.type==="color"?new cd(e,r):new ls(e,r)}}class Za{constructor(e,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,o,d){const p=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&e.set(p)}getBinding(e,r,o){return o.substr(0,9)==="u_pattern"?new ja(e,r):new ls(e,r)}}class hs{constructor(e,r,o,d){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,r,o,d,p){const y=this.paintVertexArray.length,b=this.expression.evaluate(new Si(0),r,{},d,[],p);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,r,o,d){const p=this.expression.evaluate({zoom:0},o,d);this._setPaintValue(e,r,p)}_setPaintValue(e,r,o){if(this.type==="color"){const d=Hc(o);for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,d[0],d[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Mn{constructor(e,r,o,d,p,y){this.expression=e,this.uniformNames=r.map(b=>`u_${b}_t`),this.type=o,this.useIntegerZoom=d,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map(b=>({name:`a_${b}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,r,o,d,p){const y=this.expression.evaluate(new Si(this.zoom),r,{},d,[],p),b=this.expression.evaluate(new Si(this.zoom+1),r,{},d,[],p),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,y,b)}updatePaintArray(e,r,o,d){const p=this.expression.evaluate({zoom:this.zoom},o,d),y=this.expression.evaluate({zoom:this.zoom+1},o,d);this._setPaintValue(e,r,p,y)}_setPaintValue(e,r,o,d){if(this.type==="color"){const p=Hc(o),y=Hc(d);for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,p[0],p[1],y[0],y[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,o,d);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,d=F(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,r,o){return new ls(e,r)}}class Bs{constructor(e,r,o,d,p,y){this.expression=e,this.type=r,this.useIntegerZoom=o,this.zoom=d,this.layerId=y,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,r,o){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(e,r,o,d,p){this._setPaintValues(e,r,o.patterns&&o.patterns[this.layerId],p)}_setPaintValues(e,r,o,d){if(!d||!o)return;const{min:p,mid:y,max:b}=o,M=d[p],I=d[y],k=d[b];if(M&&I&&k)for(let L=e;L<r;L++)this.zoomInPaintVertexArray.emplace(L,I.tl[0],I.tl[1],I.br[0],I.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],I.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,I.tl[0],I.tl[1],I.br[0],I.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],I.pixelRatio,k.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Xi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Xi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ud{constructor(e,r,o){this.binders={},this._buffers=[];const d=[];for(const p in e.paint._values){if(!o(p))continue;const y=e.paint.get(p);if(!(y instanceof on&&bi(y.property.specification)))continue;const b=Dm(p,e.type),M=y.value,I=y.property.specification.type,k=y.property.useIntegerZoom,L=y.property.specification["property-type"],N=L==="cross-faded"||L==="cross-faded-data-driven";if(M.kind==="constant")this.binders[p]=N?new Za(M.value,b):new tl(M.value,b,I),d.push(`/u_${p}`);else if(M.kind==="source"||N){const V=dd(p,I,"source");this.binders[p]=N?new Bs(M,I,k,r,V,e.id):new hs(M,b,I,V),d.push(`/a_${p}`)}else{const V=dd(p,I,"composite");this.binders[p]=new Mn(M,b,I,k,r,V),d.push(`/z_${p}`)}}this.cacheKey=d.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof hs||r instanceof Mn?r.maxValue:0}populatePaintArrays(e,r,o,d,p){for(const y in this.binders){const b=this.binders[y];(b instanceof hs||b instanceof Mn||b instanceof Bs)&&b.populatePaintArray(e,r,o,d,p)}}setConstantPatternPositions(e,r){for(const o in this.binders){const d=this.binders[o];d instanceof Za&&d.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,o,d,p){let y=!1;for(const b in e){const M=r.getPositions(b);for(const I of M){const k=o.feature(I.index);for(const L in this.binders){const N=this.binders[L];if((N instanceof hs||N instanceof Mn||N instanceof Bs)&&N.expression.isStateDependent===!0){const V=d.paint.get(L);N.expression=V.value,N.updatePaintArray(I.start,I.end,k,e[b],p),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const o=this.binders[r];(o instanceof tl||o instanceof Za)&&e.push(...o.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof hs||o instanceof Mn)for(let d=0;d<o.paintVertexAttributes.length;d++)e.push(o.paintVertexAttributes[d].name);else if(o instanceof Bs)for(let d=0;d<Xi.members.length;d++)e.push(Xi.members[d].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof tl||o instanceof Za||o instanceof Mn)for(const d of o.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const o=[];for(const d in this.binders){const p=this.binders[d];if(p instanceof tl||p instanceof Za||p instanceof Mn){for(const y of p.uniformNames)if(r[y]){const b=p.getBinding(e,r[y],y);o.push({name:y,property:d,binding:b})}}}return o}setUniforms(e,r,o,d){for(const{name:p,property:y,binding:b}of r)this.binders[y].setUniform(b,d,o.get(y),p)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(e&&o instanceof Bs){const d=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(o instanceof hs||o instanceof Mn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const r in this.binders){const o=this.binders[r];(o instanceof hs||o instanceof Mn||o instanceof Bs)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof hs||r instanceof Mn||r instanceof Bs)&&r.destroy()}}}class ma{constructor(e,r,o=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new ud(d,r,o);this.needsUpload=!1,this._featureMap=new Rs,this._bufferOffset=0}populatePaintArrays(e,r,o,d,p,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,d,p,y);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,o,d){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,r,p,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Dm(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function dd(i,e,r){const o={color:{source:h,composite:ye},number:{source:X,composite:h}},d=function(p){return{"line-pattern":{source:Wi,composite:Wi},"fill-pattern":{source:Wi,composite:Wi},"fill-extrusion-pattern":{source:Wi,composite:Wi}}[p]}(i);return d&&d[r]||o[e][r]}ct("ConstantBinder",tl),ct("CrossFadedConstantBinder",Za),ct("SourceExpressionBinder",hs),ct("CrossFadedCompositeBinder",Bs),ct("CompositeExpressionBinder",Mn),ct("ProgramConfiguration",ud,{omit:["_buffers"]}),ct("ProgramConfigurationSet",ma);var qi=8192;const Wc=Math.pow(2,14)-1,fd=-Wc-1;function ga(i){const e=qi/i.extent,r=i.loadGeometry();for(let o=0;o<r.length;o++){const d=r[o];for(let p=0;p<d.length;p++){const y=d[p],b=Math.round(y.x*e),M=Math.round(y.y*e);y.x=F(b,fd,Wc),y.y=F(M,fd,Wc),(b<y.x||b>y.x+1||M<y.y||M>y.y+1)&&qe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function _a(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ga(i):[]}}function kh(i,e,r,o,d){i.emplaceBack(2*e+(o+1)/2,2*r+(d+1)/2)}class Xc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new li,this.indexArray=new xr,this.segments=new Gt,this.programConfigurations=new ma(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){const d=this.layers[0],p=[];let y=null,b=!1;d.type==="circle"&&(y=d.layout.get("circle-sort-key"),b=!y.isConstant());for(const{feature:M,id:I,index:k,sourceLayerIndex:L}of e){const N=this.layers[0]._featureFilter.needGeometry,V=_a(M,N);if(!this.layers[0]._featureFilter.filter(new Si(this.zoom),V,o))continue;const $=b?y.evaluate(V,{},o):void 0,te={id:I,properties:M.properties,type:M.type,sourceLayerIndex:L,index:k,geometry:N?V.geometry:ga(M),patterns:{},sortKey:$};p.push(te)}b&&p.sort((M,I)=>M.sortKey-I.sortKey);for(const M of p){const{geometry:I,index:k,sourceLayerIndex:L}=M,N=e[k].feature;this.addFeature(M,I,k,o),r.featureIndex.insert(N,I,k,L,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$i),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,d){for(const p of r)for(const y of p){const b=y.x,M=y.y;if(b<0||b>=qi||M<0||M>=qi)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),k=I.vertexLength;kh(this.layoutVertexArray,b,M,-1,-1),kh(this.layoutVertexArray,b,M,1,-1),kh(this.layoutVertexArray,b,M,1,1),kh(this.layoutVertexArray,b,M,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+3,k+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},d)}}function pd(i,e){for(let r=0;r<i.length;r++)if(Ha(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ha(i,e[r]))return!0;return!!Kc(i,e)}function Rm(i,e,r){return!!Ha(i,e)||!!Jc(e,i,r)}function md(i,e){if(i.length===1)return _d(e,i[0]);for(let r=0;r<e.length;r++){const o=e[r];for(let d=0;d<o.length;d++)if(Ha(i,o[d]))return!0}for(let r=0;r<i.length;r++)if(_d(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Kc(i,e[r]))return!0;return!1}function Bm(i,e,r){if(i.length>1){if(Kc(i,e))return!0;for(let o=0;o<e.length;o++)if(Jc(e[o],i,r))return!0}for(let o=0;o<i.length;o++)if(Jc(i[o],e,r))return!0;return!1}function Kc(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const o=i[r],d=i[r+1];for(let p=0;p<e.length-1;p++)if(Om(o,d,e[p],e[p+1]))return!0}return!1}function Om(i,e,r,o){return nt(i,r,o)!==nt(e,r,o)&&nt(i,e,r)!==nt(i,e,o)}function Jc(i,e,r){const o=r*r;if(e.length===1)return i.distSqr(e[0])<o;for(let d=1;d<e.length;d++)if(gd(i,e[d-1],e[d])<o)return!0;return!1}function gd(i,e,r){const o=e.distSqr(r);if(o===0)return i.distSqr(e);const d=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/o;return i.distSqr(d<0?e:d>1?r:r.sub(e)._mult(d)._add(e))}function _d(i,e){let r,o,d,p=!1;for(let y=0;y<i.length;y++){r=i[y];for(let b=0,M=r.length-1;b<r.length;M=b++)o=r[b],d=r[M],o.y>e.y!=d.y>e.y&&e.x<(d.x-o.x)*(e.y-o.y)/(d.y-o.y)+o.x&&(p=!p)}return p}function Ha(i,e){let r=!1;for(let o=0,d=i.length-1;o<i.length;d=o++){const p=i[o],y=i[d];p.y>e.y!=y.y>e.y&&e.x<(y.x-p.x)*(e.y-p.y)/(y.y-p.y)+p.x&&(r=!r)}return r}function Fm(i,e,r){const o=r[0],d=r[2];if(i.x<o.x&&e.x<o.x||i.x>d.x&&e.x>d.x||i.y<o.y&&e.y<o.y||i.y>d.y&&e.y>d.y)return!1;const p=nt(i,e,r[0]);return p!==nt(i,e,r[1])||p!==nt(i,e,r[2])||p!==nt(i,e,r[3])}function il(i,e,r){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Ph(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function zh(i,e,r,o,d){if(!e[0]&&!e[1])return i;const p=H.convert(e)._mult(d);r==="viewport"&&p._rotate(-o);const y=[];for(let b=0;b<i.length;b++)y.push(i[b].sub(p));return y}ct("CircleBucket",Xc,{omit:["layers"]});const Nm=new tr({"circle-sort-key":new Tt(ke.layout_circle["circle-sort-key"])});var Um={paint:new tr({"circle-radius":new Tt(ke.paint_circle["circle-radius"]),"circle-color":new Tt(ke.paint_circle["circle-color"]),"circle-blur":new Tt(ke.paint_circle["circle-blur"]),"circle-opacity":new Tt(ke.paint_circle["circle-opacity"]),"circle-translate":new _t(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new _t(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _t(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _t(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tt(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tt(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tt(ke.paint_circle["circle-stroke-opacity"])}),layout:Nm},br=1e-6,wr=typeof Float32Array<"u"?Float32Array:Array;function yd(){var i=new wr(9);return wr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Yc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function vd(i,e,r){var o=e[0],d=e[1],p=e[2],y=e[3],b=e[4],M=e[5],I=e[6],k=e[7],L=e[8],N=e[9],V=e[10],$=e[11],te=e[12],ee=e[13],ue=e[14],ve=e[15],ce=r[0],_e=r[1],Le=r[2],ze=r[3];return i[0]=ce*o+_e*b+Le*L+ze*te,i[1]=ce*d+_e*M+Le*N+ze*ee,i[2]=ce*p+_e*I+Le*V+ze*ue,i[3]=ce*y+_e*k+Le*$+ze*ve,i[4]=(ce=r[4])*o+(_e=r[5])*b+(Le=r[6])*L+(ze=r[7])*te,i[5]=ce*d+_e*M+Le*N+ze*ee,i[6]=ce*p+_e*I+Le*V+ze*ue,i[7]=ce*y+_e*k+Le*$+ze*ve,i[8]=(ce=r[8])*o+(_e=r[9])*b+(Le=r[10])*L+(ze=r[11])*te,i[9]=ce*d+_e*M+Le*N+ze*ee,i[10]=ce*p+_e*I+Le*V+ze*ue,i[11]=ce*y+_e*k+Le*$+ze*ve,i[12]=(ce=r[12])*o+(_e=r[13])*b+(Le=r[14])*L+(ze=r[15])*te,i[13]=ce*d+_e*M+Le*N+ze*ee,i[14]=ce*p+_e*I+Le*V+ze*ue,i[15]=ce*y+_e*k+Le*$+ze*ve,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var rl,Vm=vd;function xd(){var i=new wr(3);return wr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function bd(i,e,r){var o=new wr(3);return o[0]=i,o[1]=e,o[2]=r,o}function Lh(i,e,r){var o=e[0],d=e[1],p=e[2],y=e[3];return i[0]=r[0]*o+r[4]*d+r[8]*p+r[12]*y,i[1]=r[1]*o+r[5]*d+r[9]*p+r[13]*y,i[2]=r[2]*o+r[6]*d+r[10]*p+r[14]*y,i[3]=r[3]*o+r[7]*d+r[11]*p+r[15]*y,i}function wd(){var i=new wr(4);return wr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Md(i,e){const r=Lh([],[i.x,i.y,0,1],e);return new H(r[0]/r[3],r[1]/r[3])}xd(),rl=new wr(4),wr!=Float32Array&&(rl[0]=0,rl[1]=0,rl[2]=0,rl[3]=0),xd(),bd(1,0,0),bd(0,1,0),wd(),wd(),yd(),function(){var i;i=new wr(2),wr!=Float32Array&&(i[0]=0,i[1]=0)}();class Ed extends Xc{}ct("HeatmapBucket",Ed,{omit:["layers"]});var $m={paint:new tr({"heatmap-radius":new Tt(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tt(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _t(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Un(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _t(ke.paint_heatmap["heatmap-opacity"])})};function Qc(i,{width:e,height:r},o,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*r*o)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${e*r*o}`)}else d=new Uint8Array(e*r*o);return i.width=e,i.height=r,i.data=d,i}function Td(i,{width:e,height:r},o){if(e===i.width&&r===i.height)return;const d=Qc({},{width:e,height:r},o);eu(i,d,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},o),i.width=e,i.height=r,i.data=d.data}function eu(i,e,r,o,d,p){if(d.width===0||d.height===0)return e;if(d.width>i.width||d.height>i.height||r.x>i.width-d.width||r.y>i.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||o.x>e.width-d.width||o.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,b=e.data;if(y===b)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<d.height;M++){const I=((r.y+M)*i.width+r.x)*p,k=((o.y+M)*e.width+o.x)*p;for(let L=0;L<d.width*p;L++)b[k+L]=y[I+L]}return e}class nl{constructor(e,r){Qc(this,e,1,r)}resize(e){Td(this,e,1)}clone(){return new nl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,d,p){eu(e,r,o,d,p,1)}}class Qr{constructor(e,r){Qc(this,e,4,r)}resize(e){Td(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,d,p){eu(e,r,o,d,p,4)}}function Sd(i){const e={},r=i.resolution||256,o=i.clips?i.clips.length:1,d=i.image||new Qr({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const p=(y,b,M)=>{e[i.evaluationKey]=M;const I=i.expression.evaluate(e);d.data[y+b+0]=Math.floor(255*I.r/I.a),d.data[y+b+1]=Math.floor(255*I.g/I.a),d.data[y+b+2]=Math.floor(255*I.b/I.a),d.data[y+b+3]=Math.floor(255*I.a)};if(i.clips)for(let y=0,b=0;y<o;++y,b+=4*r)for(let M=0,I=0;M<r;M++,I+=4){const k=M/(r-1),{start:L,end:N}=i.clips[y];p(b,I,L*(1-k)+N*k)}else for(let y=0,b=0;y<r;y++,b+=4)p(0,b,y/(r-1));return d}ct("AlphaImage",nl),ct("RGBAImage",Qr);var qm={paint:new tr({"hillshade-illumination-direction":new _t(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _t(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _t(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _t(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _t(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _t(ke.paint_hillshade["hillshade-accent-color"])})};const Gm=Ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:jm}=Gm;var Dh={exports:{}};function Rh(i,e,r){r=r||2;var o,d,p,y,b,M,I,k=e&&e.length,L=k?e[0]*r:i.length,N=Id(i,0,L,r,!0),V=[];if(!N||N.next===N.prev)return V;if(k&&(N=function(te,ee,ue,ve){var ce,_e,Le,ze=[];for(ce=0,_e=ee.length;ce<_e;ce++)(Le=Id(te,ee[ce]*ve,ce<_e-1?ee[ce+1]*ve:te.length,ve,!1))===Le.next&&(Le.steiner=!0),ze.push(Qm(Le));for(ze.sort(Km),ce=0;ce<ze.length;ce++)ue=Jm(ze[ce],ue);return ue}(i,e,N,r)),i.length>80*r){o=p=i[0],d=y=i[1];for(var $=r;$<L;$+=r)(b=i[$])<o&&(o=b),(M=i[$+1])<d&&(d=M),b>p&&(p=b),M>y&&(y=M);I=(I=Math.max(p-o,y-d))!==0?32767/I:0}return sl(N,V,r,o,d,I,0),V}function Id(i,e,r,o,d){var p,y;if(d===ru(i,e,r,o)>0)for(p=e;p<r;p+=o)y=kd(p,i[p],i[p+1],y);else for(p=r-o;p>=e;p-=o)y=kd(p,i[p],i[p+1],y);return y&&Bh(y,y.next)&&(ol(y),y=y.next),y}function ya(i,e){if(!i)return i;e||(e=i);var r,o=i;do if(r=!1,o.steiner||!Bh(o,o.next)&&Ri(o.prev,o,o.next)!==0)o=o.next;else{if(ol(o),(o=e=o.prev)===o.next)break;r=!0}while(r||o!==e);return e}function sl(i,e,r,o,d,p,y){if(i){!y&&p&&function(k,L,N,V){var $=k;do $.z===0&&($.z=tu($.x,$.y,L,N,V)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==k);$.prevZ.nextZ=null,$.prevZ=null,function(te){var ee,ue,ve,ce,_e,Le,ze,lt,pt=1;do{for(ue=te,te=null,_e=null,Le=0;ue;){for(Le++,ve=ue,ze=0,ee=0;ee<pt&&(ze++,ve=ve.nextZ);ee++);for(lt=pt;ze>0||lt>0&&ve;)ze!==0&&(lt===0||!ve||ue.z<=ve.z)?(ce=ue,ue=ue.nextZ,ze--):(ce=ve,ve=ve.nextZ,lt--),_e?_e.nextZ=ce:te=ce,ce.prevZ=_e,_e=ce;ue=ve}_e.nextZ=null,pt*=2}while(Le>1)}($)}(i,o,d,p);for(var b,M,I=i;i.prev!==i.next;)if(b=i.prev,M=i.next,p?Hm(i,o,d,p):Zm(i))e.push(b.i/r|0),e.push(i.i/r|0),e.push(M.i/r|0),ol(i),i=M.next,I=M.next;else if((i=M)===I){y?y===1?sl(i=Wm(ya(i),e,r),e,r,o,d,p,2):y===2&&Xm(i,e,r,o,d,p):sl(ya(i),e,r,o,d,p,1);break}}}function Zm(i){var e=i.prev,r=i,o=i.next;if(Ri(e,r,o)>=0)return!1;for(var d=e.x,p=r.x,y=o.x,b=e.y,M=r.y,I=o.y,k=d<p?d<y?d:y:p<y?p:y,L=b<M?b<I?b:I:M<I?M:I,N=d>p?d>y?d:y:p>y?p:y,V=b>M?b>I?b:I:M>I?M:I,$=o.next;$!==e;){if($.x>=k&&$.x<=N&&$.y>=L&&$.y<=V&&Wa(d,b,p,M,y,I,$.x,$.y)&&Ri($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function Hm(i,e,r,o){var d=i.prev,p=i,y=i.next;if(Ri(d,p,y)>=0)return!1;for(var b=d.x,M=p.x,I=y.x,k=d.y,L=p.y,N=y.y,V=b<M?b<I?b:I:M<I?M:I,$=k<L?k<N?k:N:L<N?L:N,te=b>M?b>I?b:I:M>I?M:I,ee=k>L?k>N?k:N:L>N?L:N,ue=tu(V,$,e,r,o),ve=tu(te,ee,e,r,o),ce=i.prevZ,_e=i.nextZ;ce&&ce.z>=ue&&_e&&_e.z<=ve;){if(ce.x>=V&&ce.x<=te&&ce.y>=$&&ce.y<=ee&&ce!==d&&ce!==y&&Wa(b,k,M,L,I,N,ce.x,ce.y)&&Ri(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,_e.x>=V&&_e.x<=te&&_e.y>=$&&_e.y<=ee&&_e!==d&&_e!==y&&Wa(b,k,M,L,I,N,_e.x,_e.y)&&Ri(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;ce&&ce.z>=ue;){if(ce.x>=V&&ce.x<=te&&ce.y>=$&&ce.y<=ee&&ce!==d&&ce!==y&&Wa(b,k,M,L,I,N,ce.x,ce.y)&&Ri(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;_e&&_e.z<=ve;){if(_e.x>=V&&_e.x<=te&&_e.y>=$&&_e.y<=ee&&_e!==d&&_e!==y&&Wa(b,k,M,L,I,N,_e.x,_e.y)&&Ri(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function Wm(i,e,r){var o=i;do{var d=o.prev,p=o.next.next;!Bh(d,p)&&Ad(d,o,o.next,p)&&al(d,p)&&al(p,d)&&(e.push(d.i/r|0),e.push(o.i/r|0),e.push(p.i/r|0),ol(o),ol(o.next),o=i=p),o=o.next}while(o!==i);return ya(o)}function Xm(i,e,r,o,d,p){var y=i;do{for(var b=y.next.next;b!==y.prev;){if(y.i!==b.i&&eg(y,b)){var M=Cd(y,b);return y=ya(y,y.next),M=ya(M,M.next),sl(y,e,r,o,d,p,0),void sl(M,e,r,o,d,p,0)}b=b.next}y=y.next}while(y!==i)}function Km(i,e){return i.x-e.x}function Jm(i,e){var r=function(d,p){var y,b=p,M=d.x,I=d.y,k=-1/0;do{if(I<=b.y&&I>=b.next.y&&b.next.y!==b.y){var L=b.x+(I-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(L<=M&&L>k&&(k=L,y=b.x<b.next.x?b:b.next,L===M))return y}b=b.next}while(b!==p);if(!y)return null;var N,V=y,$=y.x,te=y.y,ee=1/0;b=y;do M>=b.x&&b.x>=$&&M!==b.x&&Wa(I<te?M:k,I,$,te,I<te?k:M,I,b.x,b.y)&&(N=Math.abs(I-b.y)/(M-b.x),al(b,d)&&(N<ee||N===ee&&(b.x>y.x||b.x===y.x&&Ym(y,b)))&&(y=b,ee=N)),b=b.next;while(b!==V);return y}(i,e);if(!r)return e;var o=Cd(r,i);return ya(o,o.next),ya(r,r.next)}function Ym(i,e){return Ri(i.prev,i,e.prev)<0&&Ri(e.next,i,i.next)<0}function tu(i,e,r,o,d){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Qm(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Wa(i,e,r,o,d,p,y,b){return(d-y)*(e-b)>=(i-y)*(p-b)&&(i-y)*(o-b)>=(r-y)*(e-b)&&(r-y)*(p-b)>=(d-y)*(o-b)}function eg(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,o){var d=r;do{if(d.i!==r.i&&d.next.i!==r.i&&d.i!==o.i&&d.next.i!==o.i&&Ad(d,d.next,r,o))return!0;d=d.next}while(d!==r);return!1}(i,e)&&(al(i,e)&&al(e,i)&&function(r,o){var d=r,p=!1,y=(r.x+o.x)/2,b=(r.y+o.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&y<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(p=!p),d=d.next;while(d!==r);return p}(i,e)&&(Ri(i.prev,i,e.prev)||Ri(i,e.prev,e))||Bh(i,e)&&Ri(i.prev,i,i.next)>0&&Ri(e.prev,e,e.next)>0)}function Ri(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Bh(i,e){return i.x===e.x&&i.y===e.y}function Ad(i,e,r,o){var d=Fh(Ri(i,e,r)),p=Fh(Ri(i,e,o)),y=Fh(Ri(r,o,i)),b=Fh(Ri(r,o,e));return d!==p&&y!==b||!(d!==0||!Oh(i,r,e))||!(p!==0||!Oh(i,o,e))||!(y!==0||!Oh(r,i,o))||!(b!==0||!Oh(r,e,o))}function Oh(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Fh(i){return i>0?1:i<0?-1:0}function al(i,e){return Ri(i.prev,i,i.next)<0?Ri(i,e,i.next)>=0&&Ri(i,i.prev,e)>=0:Ri(i,e,i.prev)<0||Ri(i,i.next,e)<0}function Cd(i,e){var r=new iu(i.i,i.x,i.y),o=new iu(e.i,e.x,e.y),d=i.next,p=e.prev;return i.next=e,e.prev=i,r.next=d,d.prev=r,o.next=r,r.prev=o,p.next=o,o.prev=p,o}function kd(i,e,r,o){var d=new iu(i,e,r);return o?(d.next=o.next,d.prev=o,o.next.prev=d,o.next=d):(d.prev=d,d.next=d),d}function ol(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function iu(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ru(i,e,r,o){for(var d=0,p=e,y=r-o;p<r;p+=o)d+=(i[y]-i[p])*(i[p+1]+i[y+1]),y=p;return d}function tg(i,e,r,o,d){Pd(i,e,r||0,o||i.length-1,d||ig)}function Pd(i,e,r,o,d){for(;o>r;){if(o-r>600){var p=o-r+1,y=e-r+1,b=Math.log(p),M=.5*Math.exp(2*b/3),I=.5*Math.sqrt(b*M*(p-M)/p)*(y-p/2<0?-1:1);Pd(i,e,Math.max(r,Math.floor(e-y*M/p+I)),Math.min(o,Math.floor(e+(p-y)*M/p+I)),d)}var k=i[e],L=r,N=o;for(ll(i,r,e),d(i[o],k)>0&&ll(i,r,o);L<N;){for(ll(i,L,N),L++,N--;d(i[L],k)<0;)L++;for(;d(i[N],k)>0;)N--}d(i[r],k)===0?ll(i,r,N):ll(i,++N,o),N<=e&&(r=N+1),e<=N&&(o=N-1)}}function ll(i,e,r){var o=i[e];i[e]=i[r],i[r]=o}function ig(i,e){return i<e?-1:i>e?1:0}function nu(i,e){const r=i.length;if(r<=1)return[i];const o=[];let d,p;for(let y=0;y<r;y++){const b=Fe(i[y]);b!==0&&(i[y].area=Math.abs(b),p===void 0&&(p=b<0),p===b<0?(d&&o.push(d),d=[i[y]]):d.push(i[y]))}if(d&&o.push(d),e>1)for(let y=0;y<o.length;y++)o[y].length<=e||(tg(o[y],e,1,o[y].length-1,rg),o[y]=o[y].slice(0,e));return o}function rg(i,e){return e.area-i.area}function su(i,e,r){const o=r.patternDependencies;let d=!1;for(const p of e){const y=p.paint.get(`${i}-pattern`);y.isConstant()||(d=!0);const b=y.constantOr(null);b&&(d=!0,o[b.to]=!0,o[b.from]=!0)}return d}function au(i,e,r,o,d){const p=d.patternDependencies;for(const y of e){const b=y.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let M=b.evaluate({zoom:o-1},r,{},d.availableImages),I=b.evaluate({zoom:o},r,{},d.availableImages),k=b.evaluate({zoom:o+1},r,{},d.availableImages);M=M&&M.name?M.name:M,I=I&&I.name?I.name:I,k=k&&k.name?k.name:k,p[M]=!0,p[I]=!0,p[k]=!0,r.patterns[y.id]={min:M,mid:I,max:k}}}return r}Dh.exports=Rh,Dh.exports.default=Rh,Rh.deviation=function(i,e,r,o){var d=e&&e.length,p=Math.abs(ru(i,0,d?e[0]*r:i.length,r));if(d)for(var y=0,b=e.length;y<b;y++)p-=Math.abs(ru(i,e[y]*r,y<b-1?e[y+1]*r:i.length,r));var M=0;for(y=0;y<o.length;y+=3){var I=o[y]*r,k=o[y+1]*r,L=o[y+2]*r;M+=Math.abs((i[I]-i[L])*(i[k+1]-i[I+1])-(i[I]-i[k])*(i[L+1]-i[I+1]))}return p===0&&M===0?0:Math.abs((M-p)/p)},Rh.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},o=0,d=0;d<i.length;d++){for(var p=0;p<i[d].length;p++)for(var y=0;y<e;y++)r.vertices.push(i[d][p][y]);d>0&&r.holes.push(o+=i[d-1].length)}return r};class ou{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new hi,this.indexArray=new xr,this.indexArray2=new wn,this.programConfigurations=new ma(e.layers,e.zoom),this.segments=new Gt,this.segments2=new Gt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=su("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),p=!d.isConstant(),y=[];for(const{feature:b,id:M,index:I,sourceLayerIndex:k}of e){const L=this.layers[0]._featureFilter.needGeometry,N=_a(b,L);if(!this.layers[0]._featureFilter.filter(new Si(this.zoom),N,o))continue;const V=p?d.evaluate(N,{},o,r.availableImages):void 0,$={id:M,properties:b.properties,type:b.type,sourceLayerIndex:k,index:I,geometry:L?N.geometry:ga(b),patterns:{},sortKey:V};y.push($)}p&&y.sort((b,M)=>b.sortKey-M.sortKey);for(const b of y){const{geometry:M,index:I,sourceLayerIndex:k}=b;if(this.hasPattern){const L=au("fill",this.layers,b,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(b,M,I,o,{});r.featureIndex.insert(e[I].feature,M,I,k,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,o,d,p){for(const y of nu(r,500)){let b=0;for(const V of y)b+=V.length;const M=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),I=M.vertexLength,k=[],L=[];for(const V of y){if(V.length===0)continue;V!==y[0]&&L.push(k.length/2);const $=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),te=$.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(te+V.length-1,te),k.push(V[0].x),k.push(V[0].y);for(let ee=1;ee<V.length;ee++)this.layoutVertexArray.emplaceBack(V[ee].x,V[ee].y),this.indexArray2.emplaceBack(te+ee-1,te+ee),k.push(V[ee].x),k.push(V[ee].y);$.vertexLength+=V.length,$.primitiveLength+=V.length}const N=Dh.exports(k,L);for(let V=0;V<N.length;V+=3)this.indexArray.emplaceBack(I+N[V],I+N[V+1],I+N[V+2]);M.vertexLength+=b,M.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,p,d)}}ct("FillBucket",ou,{omit:["layers","patternFeatures"]});const ng=new tr({"fill-sort-key":new Tt(ke.layout_fill["fill-sort-key"])});var sg={paint:new tr({"fill-antialias":new _t(ke.paint_fill["fill-antialias"]),"fill-opacity":new Tt(ke.paint_fill["fill-opacity"]),"fill-color":new Tt(ke.paint_fill["fill-color"]),"fill-outline-color":new Tt(ke.paint_fill["fill-outline-color"]),"fill-translate":new _t(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new _t(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ds(ke.paint_fill["fill-pattern"])}),layout:ng};const ag=Ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),og=Ni([{name:"a_centroid",components:2,type:"Int16"}],4),{members:lg}=ag;var Os={},hg=H,zd=Xa;function Xa(i,e,r,o,d){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=d,i.readFields(cg,this,e)}function cg(i,e,r){i==1?e.id=r.readVarint():i==2?function(o,d){for(var p=o.readVarint()+o.pos;o.pos<p;){var y=d._keys[o.readVarint()],b=d._values[o.readVarint()];d.properties[y]=b}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function ug(i){for(var e,r,o=0,d=0,p=i.length,y=p-1;d<p;y=d++)o+=((r=i[y]).x-(e=i[d]).x)*(e.y+r.y);return o}Xa.types=["Unknown","Point","LineString","Polygon"],Xa.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,o=1,d=0,p=0,y=0,b=[];i.pos<r;){if(d<=0){var M=i.readVarint();o=7&M,d=M>>3}if(d--,o===1||o===2)p+=i.readSVarint(),y+=i.readSVarint(),o===1&&(e&&b.push(e),e=[]),e.push(new hg(p,y));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&b.push(e),b},Xa.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,o=0,d=0,p=0,y=1/0,b=-1/0,M=1/0,I=-1/0;i.pos<e;){if(o<=0){var k=i.readVarint();r=7&k,o=k>>3}if(o--,r===1||r===2)(d+=i.readSVarint())<y&&(y=d),d>b&&(b=d),(p+=i.readSVarint())<M&&(M=p),p>I&&(I=p);else if(r!==7)throw new Error("unknown command "+r)}return[y,M,b,I]},Xa.prototype.toGeoJSON=function(i,e,r){var o,d,p=this.extent*Math.pow(2,r),y=this.extent*i,b=this.extent*e,M=this.loadGeometry(),I=Xa.types[this.type];function k(V){for(var $=0;$<V.length;$++){var te=V[$];V[$]=[360*(te.x+y)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(te.y+b)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(o=0;o<M.length;o++)L[o]=M[o][0];k(M=L);break;case 2:for(o=0;o<M.length;o++)k(M[o]);break;case 3:for(M=function(V){var $=V.length;if($<=1)return[V];for(var te,ee,ue=[],ve=0;ve<$;ve++){var ce=ug(V[ve]);ce!==0&&(ee===void 0&&(ee=ce<0),ee===ce<0?(te&&ue.push(te),te=[V[ve]]):te.push(V[ve]))}return te&&ue.push(te),ue}(M),o=0;o<M.length;o++)for(d=0;d<M[o].length;d++)k(M[o][d])}M.length===1?M=M[0]:I="Multi"+I;var N={type:"Feature",geometry:{type:I,coordinates:M},properties:this.properties};return"id"in this&&(N.id=this.id),N};var dg=zd,Ld=Dd;function Dd(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(fg,this,e),this.length=this._features.length}function fg(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(o){for(var d=null,p=o.readVarint()+o.pos;o.pos<p;){var y=o.readVarint()>>3;d=y===1?o.readString():y===2?o.readFloat():y===3?o.readDouble():y===4?o.readVarint64():y===5?o.readVarint():y===6?o.readSVarint():y===7?o.readBoolean():null}return d}(r))}Dd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new dg(this._pbf,e,this.extent,this._keys,this._values)};var pg=Ld;function mg(i,e,r){if(i===3){var o=new pg(r,r.readVarint()+r.pos);o.length&&(e[o.name]=o)}}Os.VectorTile=function(i,e){this.layers=i.readFields(mg,{},e)},Os.VectorTileFeature=zd,Os.VectorTileLayer=Ld;const gg=Os.VectorTileFeature.types,lu=Math.pow(2,13);function hl(i,e,r,o,d,p,y,b){i.emplaceBack(e,r,2*Math.floor(o*lu)+y,d*lu*2,p*lu*2,Math.round(b))}class hu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Kt,this.centroidVertexArray=new bt,this.indexArray=new xr,this.programConfigurations=new ma(e.layers,e.zoom),this.segments=new Gt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.features=[],this.hasPattern=su("fill-extrusion",this.layers,r);for(const{feature:d,id:p,index:y,sourceLayerIndex:b}of e){const M=this.layers[0]._featureFilter.needGeometry,I=_a(d,M);if(!this.layers[0]._featureFilter.filter(new Si(this.zoom),I,o))continue;const k={id:p,sourceLayerIndex:b,index:y,geometry:M?I.geometry:ga(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(au("fill-extrusion",this.layers,k,this.zoom,r)):this.addFeature(k,k.geometry,y,o,{}),r.featureIndex.insert(d,k.geometry,y,b,this.index,!0)}}addFeatures(e,r,o){for(const d of this.features){const{geometry:p}=d;this.addFeature(d,p,d.index,r,o)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lg),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,og.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,o,d,p){const y={x:0,y:0,vertexCount:0};for(const b of nu(r,500)){let M=0;for(const $ of b)M+=$.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const $ of b){if($.length===0||yg($))continue;let te=0;for(let ee=0;ee<$.length;ee++){const ue=$[ee];if(ee>=1){const ve=$[ee-1];if(!_g(ue,ve)){I.vertexLength+4>Gt.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ce=ue.sub(ve)._perp()._unit(),_e=ve.dist(ue);te+_e>32768&&(te=0),hl(this.layoutVertexArray,ue.x,ue.y,ce.x,ce.y,0,0,te),hl(this.layoutVertexArray,ue.x,ue.y,ce.x,ce.y,0,1,te),y.x+=2*ue.x,y.y+=2*ue.y,y.vertexCount+=2,te+=_e,hl(this.layoutVertexArray,ve.x,ve.y,ce.x,ce.y,0,0,te),hl(this.layoutVertexArray,ve.x,ve.y,ce.x,ce.y,0,1,te),y.x+=2*ve.x,y.y+=2*ve.y,y.vertexCount+=2;const Le=I.vertexLength;this.indexArray.emplaceBack(Le,Le+2,Le+1),this.indexArray.emplaceBack(Le+1,Le+2,Le+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+M>Gt.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),gg[e.type]!=="Polygon")continue;const k=[],L=[],N=I.vertexLength;for(const $ of b)if($.length!==0){$!==b[0]&&L.push(k.length/2);for(let te=0;te<$.length;te++){const ee=$[te];hl(this.layoutVertexArray,ee.x,ee.y,0,0,1,1,0),y.x+=ee.x,y.y+=ee.y,y.vertexCount+=1,k.push(ee.x),k.push(ee.y)}}const V=Dh.exports(k,L);for(let $=0;$<V.length;$+=3)this.indexArray.emplaceBack(N+V[$],N+V[$+2],N+V[$+1]);I.primitiveLength+=V.length/3,I.vertexLength+=M}for(let b=0;b<y.vertexCount;b++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,p,d)}}function _g(i,e){return i.x===e.x&&(i.x<0||i.x>qi)||i.y===e.y&&(i.y<0||i.y>qi)}function yg(i){return i.every(e=>e.x<0)||i.every(e=>e.x>qi)||i.every(e=>e.y<0)||i.every(e=>e.y>qi)}ct("FillExtrusionBucket",hu,{omit:["layers","features"]});var vg={paint:new tr({"fill-extrusion-opacity":new _t(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tt(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _t(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _t(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ds(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tt(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tt(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _t(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function cl(i,e){return i.x*e.x+i.y*e.y}function Rd(i,e){if(i.length===1){let r=0;const o=e[r++];let d;for(;!d||o.equals(d);)if(d=e[r++],!d)return 1/0;for(;r<e.length;r++){const p=e[r],y=i[0],b=d.sub(o),M=p.sub(o),I=y.sub(o),k=cl(b,b),L=cl(b,M),N=cl(M,M),V=cl(I,b),$=cl(I,M),te=k*N-L*L,ee=(N*V-L*$)/te,ue=(k*$-L*V)/te,ve=o.z*(1-ee-ue)+d.z*ee+p.z*ue;if(isFinite(ve))return ve}return 1/0}{let r=1/0;for(const o of e)r=Math.min(r,o.z);return r}}const xg=Ni([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:bg}=xg,wg=Ni([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Mg}=wg,Eg=Os.VectorTileFeature.types,Tg=Math.cos(Math.PI/180*37.5),Bd=Math.pow(2,14)/.5;class cu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ei,this.layoutVertexArray2=new ui,this.indexArray=new xr,this.programConfigurations=new ma(e.layers,e.zoom),this.segments=new Gt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=su("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key"),p=!d.isConstant(),y=[];for(const{feature:b,id:M,index:I,sourceLayerIndex:k}of e){const L=this.layers[0]._featureFilter.needGeometry,N=_a(b,L);if(!this.layers[0]._featureFilter.filter(new Si(this.zoom),N,o))continue;const V=p?d.evaluate(N,{},o):void 0,$={id:M,properties:b.properties,type:b.type,sourceLayerIndex:k,index:I,geometry:L?N.geometry:ga(b),patterns:{},sortKey:V};y.push($)}p&&y.sort((b,M)=>b.sortKey-M.sortKey);for(const b of y){const{geometry:M,index:I,sourceLayerIndex:k}=b;if(this.hasPattern){const L=au("line",this.layers,b,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(b,M,I,o,{});r.featureIndex.insert(e[I].feature,M,I,k,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Mg)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bg),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,o,d,p){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),M=y.get("line-cap"),I=y.get("line-miter-limit"),k=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of r)this.addLine(L,e,b,M,I,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,p,d)}addLine(e,r,o,d,p,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<e.length-1;ue++)this.totalDistance+=e[ue].dist(e[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=Eg[r.type]==="Polygon";let M=e.length;for(;M>=2&&e[M-1].equals(e[M-2]);)M--;let I=0;for(;I<M-1&&e[I].equals(e[I+1]);)I++;if(M<(b?3:2))return;o==="bevel"&&(p=1.05);const k=this.overscaling<=16?122880/(512*this.overscaling):0,L=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let N,V,$,te,ee;this.e1=this.e2=-1,b&&(N=e[M-2],ee=e[I].sub(N)._unit()._perp());for(let ue=I;ue<M;ue++){if($=ue===M-1?b?e[I+1]:void 0:e[ue+1],$&&e[ue].equals($))continue;ee&&(te=ee),N&&(V=N),N=e[ue],ee=$?$.sub(N)._unit()._perp():te,te=te||ee;let ve=te.add(ee);ve.x===0&&ve.y===0||ve._unit();const ce=te.x*ee.x+te.y*ee.y,_e=ve.x*ee.x+ve.y*ee.y,Le=_e!==0?1/_e:1/0,ze=2*Math.sqrt(2-2*_e),lt=_e<Tg&&V&&$,pt=te.x*ee.y-te.y*ee.x>0;if(lt&&ue>I){const Ze=N.dist(V);if(Ze>2*k){const it=N.sub(N.sub(V)._mult(k/Ze)._round());this.updateDistance(V,it),this.addCurrentVertex(it,te,0,0,L),V=it}}const tt=V&&$;let Je=tt?o:b?"butt":d;if(tt&&Je==="round"&&(Le<y?Je="miter":Le<=2&&(Je="fakeround")),Je==="miter"&&Le>p&&(Je="bevel"),Je==="bevel"&&(Le>2&&(Je="flipbevel"),Le<p&&(Je="miter")),V&&this.updateDistance(V,N),Je==="miter")ve._mult(Le),this.addCurrentVertex(N,ve,0,0,L);else if(Je==="flipbevel"){if(Le>100)ve=ee.mult(-1);else{const Ze=Le*te.add(ee).mag()/te.sub(ee).mag();ve._perp()._mult(Ze*(pt?-1:1))}this.addCurrentVertex(N,ve,0,0,L),this.addCurrentVertex(N,ve.mult(-1),0,0,L)}else if(Je==="bevel"||Je==="fakeround"){const Ze=-Math.sqrt(Le*Le-1),it=pt?Ze:0,Qe=pt?0:Ze;if(V&&this.addCurrentVertex(N,te,it,Qe,L),Je==="fakeround"){const $e=Math.round(180*ze/Math.PI/20);for(let wt=1;wt<$e;wt++){let yt=wt/$e;if(yt!==.5){const wi=yt-.5;yt+=yt*wi*(yt-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*wi*wi+(.848013+ce*(.215638*ce-1.06021)))}const $t=ee.sub(te)._mult(yt)._add(te)._unit()._mult(pt?-1:1);this.addHalfVertex(N,$t.x,$t.y,!1,pt,0,L)}}$&&this.addCurrentVertex(N,ee,-it,-Qe,L)}else if(Je==="butt")this.addCurrentVertex(N,ve,0,0,L);else if(Je==="square"){const Ze=V?1:-1;this.addCurrentVertex(N,ve,Ze,Ze,L)}else Je==="round"&&(V&&(this.addCurrentVertex(N,te,0,0,L),this.addCurrentVertex(N,te,1,1,L,!0)),$&&(this.addCurrentVertex(N,ee,-1,-1,L,!0),this.addCurrentVertex(N,ee,0,0,L)));if(lt&&ue<M-1){const Ze=N.dist($);if(Ze>2*k){const it=N.add($.sub(N)._mult(k/Ze)._round());this.updateDistance(N,it),this.addCurrentVertex(it,ee,0,0,L),N=it}}}}addCurrentVertex(e,r,o,d,p,y=!1){const b=r.y*d-r.x,M=-r.y-r.x*d;this.addHalfVertex(e,r.x+r.y*o,r.y-r.x*o,y,!1,o,p),this.addHalfVertex(e,b,M,y,!0,-d,p),this.distance>Bd/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,o,d,p,y))}addHalfVertex({x:e,y:r},o,d,p,y,b,M){const I=.5*(this.lineClips?this.scaledDistance*(Bd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(r<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const k=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),M.primitiveLength++),y?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}ct("LineBucket",cu,{omit:["layers","patternFeatures"]});const Sg=new tr({"line-cap":new _t(ke.layout_line["line-cap"]),"line-join":new Tt(ke.layout_line["line-join"]),"line-miter-limit":new _t(ke.layout_line["line-miter-limit"]),"line-round-limit":new _t(ke.layout_line["line-round-limit"]),"line-sort-key":new Tt(ke.layout_line["line-sort-key"])});var Od={paint:new tr({"line-opacity":new Tt(ke.paint_line["line-opacity"]),"line-color":new Tt(ke.paint_line["line-color"]),"line-translate":new _t(ke.paint_line["line-translate"]),"line-translate-anchor":new _t(ke.paint_line["line-translate-anchor"]),"line-width":new Tt(ke.paint_line["line-width"]),"line-gap-width":new Tt(ke.paint_line["line-gap-width"]),"line-offset":new Tt(ke.paint_line["line-offset"]),"line-blur":new Tt(ke.paint_line["line-blur"]),"line-dasharray":new Jo(ke.paint_line["line-dasharray"]),"line-pattern":new Ds(ke.paint_line["line-pattern"]),"line-gradient":new Un(ke.paint_line["line-gradient"])}),layout:Sg};const Fd=new class extends Tt{possiblyEvaluate(i,e){return e=new Si(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,o){return e=le({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,o)}}(Od.paint.properties["line-width"].specification);function Nd(i,e){return e>0?e+2*i:i}Fd.useIntegerZoom=!0;const Ig=Ni([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ag=Ni([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ni([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cg=Ni([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ni([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ud=Ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),kg=Ni([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Pg(i,e,r){return i.sections.forEach(o=>{o.text=function(d,p,y){const b=p.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),qr.applyArabicShaping&&(d=qr.applyArabicShaping(d)),d}(o.text,e,r)}),i}Ni([{name:"triangle",components:3,type:"Uint16"}]),Ni([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ni([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ni([{type:"Float32",name:"offsetX"}]),Ni([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ul={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ir=24,uu=mi,Vd=function(i,e,r,o,d){var p,y,b=8*d-o-1,M=(1<<b)-1,I=M>>1,k=-7,L=r?d-1:0,N=r?-1:1,V=i[e+L];for(L+=N,p=V&(1<<-k)-1,V>>=-k,k+=b;k>0;p=256*p+i[e+L],L+=N,k-=8);for(y=p&(1<<-k)-1,p>>=-k,k+=o;k>0;y=256*y+i[e+L],L+=N,k-=8);if(p===0)p=1-I;else{if(p===M)return y?NaN:1/0*(V?-1:1);y+=Math.pow(2,o),p-=I}return(V?-1:1)*y*Math.pow(2,p-o)},$d=function(i,e,r,o,d,p){var y,b,M,I=8*p-d-1,k=(1<<I)-1,L=k>>1,N=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=o?0:p-1,$=o?1:-1,te=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,y=k):(y=Math.floor(Math.log(e)/Math.LN2),e*(M=Math.pow(2,-y))<1&&(y--,M*=2),(e+=y+L>=1?N/M:N*Math.pow(2,1-L))*M>=2&&(y++,M/=2),y+L>=k?(b=0,y=k):y+L>=1?(b=(e*M-1)*Math.pow(2,d),y+=L):(b=e*Math.pow(2,L-1)*Math.pow(2,d),y=0));d>=8;i[r+V]=255&b,V+=$,b/=256,d-=8);for(y=y<<d|b,I+=d;I>0;i[r+V]=255&y,V+=$,y/=256,I-=8);i[r+V-$]|=128*te};function mi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}mi.Varint=0,mi.Fixed64=1,mi.Bytes=2,mi.Fixed32=5;var Fs,du=4294967296,qd=1/du,Gd=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function cs(i){return i.type===mi.Bytes?i.readVarint()+i.pos:i.pos+1}function Ka(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function jd(i,e,r){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(o);for(var d=r.pos-1;d>=i;d--)r.buf[d+o]=r.buf[d]}function zg(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Lg(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Dg(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Rg(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Bg(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Og(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Fg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Ng(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Ug(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Nh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ja(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Zd(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Vg(i,e,r){i===1&&r.readMessage($g,e)}function $g(i,e,r){if(i===3){const{id:o,bitmap:d,width:p,height:y,left:b,top:M,advance:I}=r.readMessage(qg,{});e.push({id:o,bitmap:new nl({width:p+6,height:y+6},d),metrics:{width:p,height:y,left:b,top:M,advance:I}})}}function qg(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Hd(i){let e=0,r=0;for(const y of i)e+=y.w*y.h,r=Math.max(r,y.w);i.sort((y,b)=>b.h-y.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let d=0,p=0;for(const y of i)for(let b=o.length-1;b>=0;b--){const M=o[b];if(!(y.w>M.w||y.h>M.h)){if(y.x=M.x,y.y=M.y,p=Math.max(p,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===M.w&&y.h===M.h){const I=o.pop();b<o.length&&(o[b]=I)}else y.h===M.h?(M.x+=y.w,M.w-=y.w):y.w===M.w?(M.y+=y.h,M.h-=y.h):(o.push({x:M.x+y.w,y:M.y,w:M.w-y.w,h:y.h}),M.y+=y.h,M.h-=y.h);break}}return{w:d,h:p,fill:e/(d*p)||0}}mi.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var o=this.readVarint(),d=o>>3,p=this.pos;this.type=7&o,i(d,e,this),this.pos===p&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Nh(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Zd(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Nh(this.buf,this.pos)+Nh(this.buf,this.pos+4)*du;return this.pos+=8,i},readSFixed64:function(){var i=Nh(this.buf,this.pos)+Zd(this.buf,this.pos+4)*du;return this.pos+=8,i},readFloat:function(){var i=Vd(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Vd(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,o=this.buf;return e=127&(r=o[this.pos++]),r<128?e:(e|=(127&(r=o[this.pos++]))<<7,r<128?e:(e|=(127&(r=o[this.pos++]))<<14,r<128?e:(e|=(127&(r=o[this.pos++]))<<21,r<128?e:function(d,p,y){var b,M,I=y.buf;if(b=(112&(M=I[y.pos++]))>>4,M<128||(b|=(127&(M=I[y.pos++]))<<3,M<128)||(b|=(127&(M=I[y.pos++]))<<10,M<128)||(b|=(127&(M=I[y.pos++]))<<17,M<128)||(b|=(127&(M=I[y.pos++]))<<24,M<128)||(b|=(1&(M=I[y.pos++]))<<31,M<128))return Ka(d,b,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Gd?function(r,o,d){return Gd.decode(r.subarray(o,d))}(this.buf,e,i):function(r,o,d){for(var p="",y=o;y<d;){var b,M,I,k=r[y],L=null,N=k>239?4:k>223?3:k>191?2:1;if(y+N>d)break;N===1?k<128&&(L=k):N===2?(192&(b=r[y+1]))==128&&(L=(31&k)<<6|63&b)<=127&&(L=null):N===3?(M=r[y+2],(192&(b=r[y+1]))==128&&(192&M)==128&&((L=(15&k)<<12|(63&b)<<6|63&M)<=2047||L>=55296&&L<=57343)&&(L=null)):N===4&&(M=r[y+2],I=r[y+3],(192&(b=r[y+1]))==128&&(192&M)==128&&(192&I)==128&&((L=(15&k)<<18|(63&b)<<12|(63&M)<<6|63&I)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,N=1):L>65535&&(L-=65536,p+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),p+=String.fromCharCode(L),y+=N}return p}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==mi.Bytes)return i.push(this.readVarint(e));var r=cs(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==mi.Bytes)return i.push(this.readSVarint());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==mi.Bytes)return i.push(this.readBoolean());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==mi.Bytes)return i.push(this.readFloat());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==mi.Bytes)return i.push(this.readDouble());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==mi.Bytes)return i.push(this.readFixed32());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==mi.Bytes)return i.push(this.readSFixed32());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==mi.Bytes)return i.push(this.readFixed64());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==mi.Bytes)return i.push(this.readSFixed64());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===mi.Varint)for(;this.buf[this.pos++]>127;);else if(e===mi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===mi.Fixed32)this.pos+=4;else{if(e!==mi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ja(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ja(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ja(this.buf,-1&i,this.pos),Ja(this.buf,Math.floor(i*qd),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ja(this.buf,-1&i,this.pos),Ja(this.buf,Math.floor(i*qd),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var o,d;if(e>=0?(o=e%4294967296|0,d=e/4294967296|0):(d=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(p,y,b){b.buf[b.pos++]=127&p|128,p>>>=7,b.buf[b.pos++]=127&p|128,p>>>=7,b.buf[b.pos++]=127&p|128,p>>>=7,b.buf[b.pos++]=127&p|128,b.buf[b.pos]=127&(p>>>=7)}(o,0,r),function(p,y){var b=(7&p)<<4;y.buf[y.pos++]|=b|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))}(d,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,d,p){for(var y,b,M=0;M<d.length;M++){if((y=d.charCodeAt(M))>55295&&y<57344){if(!b){y>56319||M+1===d.length?(o[p++]=239,o[p++]=191,o[p++]=189):b=y;continue}if(y<56320){o[p++]=239,o[p++]=191,o[p++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(o[p++]=239,o[p++]=191,o[p++]=189,b=null);y<128?o[p++]=y:(y<2048?o[p++]=y>>6|192:(y<65536?o[p++]=y>>12|224:(o[p++]=y>>18|240,o[p++]=y>>12&63|128),o[p++]=y>>6&63|128),o[p++]=63&y|128)}return p}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&jd(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),$d(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),$d(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var o=this.pos-r;o>=128&&jd(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,r){this.writeTag(i,mi.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,zg,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Lg,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Bg,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Dg,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Rg,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Og,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Fg,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Ng,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Ug,e)},writeBytesField:function(i,e){this.writeTag(i,mi.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,mi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,mi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,mi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,mi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,mi.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,mi.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,mi.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,mi.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,mi.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class fu{constructor(e,{pixelRatio:r,version:o,stretchX:d,stretchY:p,content:y}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=d,this.stretchY=p,this.content=y,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Wd{constructor(e,r){const o={},d={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,o,p),this.addImages(r,d,p);const{w:y,h:b}=Hd(p),M=new Qr({width:y||1,height:b||1});for(const I in e){const k=e[I],L=o[I].paddedRect;Qr.copy(k.data,M,{x:0,y:0},{x:L.x+1,y:L.y+1},k.data)}for(const I in r){const k=r[I],L=d[I].paddedRect,N=L.x+1,V=L.y+1,$=k.data.width,te=k.data.height;Qr.copy(k.data,M,{x:0,y:0},{x:N,y:V},k.data),Qr.copy(k.data,M,{x:0,y:te-1},{x:N,y:V-1},{width:$,height:1}),Qr.copy(k.data,M,{x:0,y:0},{x:N,y:V+te},{width:$,height:1}),Qr.copy(k.data,M,{x:$-1,y:0},{x:N-1,y:V},{width:1,height:te}),Qr.copy(k.data,M,{x:0,y:0},{x:N+$,y:V},{width:1,height:te})}this.image=M,this.iconPositions=o,this.patternPositions=d}addImages(e,r,o){for(const d in e){const p=e[d],y={x:0,y:0,w:p.data.width+2,h:p.data.height+2};o.push(y),r[d]=new fu(y,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),r)}patchUpdatedImage(e,r,o){if(!e||!r||e.version===r.version)return;e.version=r.version;const[d,p]=e.tl;o.update(r.data,void 0,{x:d,y:p})}}ct("ImagePosition",fu),ct("ImageAtlas",Wd),a.WritingMode=void 0,(Fs=a.WritingMode||(a.WritingMode={}))[Fs.none=0]="none",Fs[Fs.horizontal=1]="horizontal",Fs[Fs.vertical=2]="vertical",Fs[Fs.horizontalOnly=3]="horizontalOnly";const Uh=-17;class dl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const o=new dl;return o.scale=e||1,o.fontStack=r,o}static forImage(e){const r=new dl;return r.imageName=e,r}}class Ya{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const o=new Ya;for(let d=0;d<e.sections.length;d++){const p=e.sections[d];p.image?o.addImageSection(p):o.addTextSection(p,r)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let o=0;o<e.length;o++){const d=e.charCodeAt(o+1)||null,p=e.charCodeAt(o-1)||null;r+=d&&xh(d)&&!ul[e[o+1]]||p&&xh(p)&&!ul[e[o-1]]||!ul[e[o]]?e[o]:ul[e[o]]}return r}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&$h[this.text.charCodeAt(o)];o++)e++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&$h[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const o=new Ya;return o.text=this.text.substring(e,r),o.sectionIndex=this.sectionIndex.slice(e,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(dl.forText(e.scale,e.fontStack||r));const o=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(o)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void qe("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(dl.forImage(r)),this.sectionIndex.push(this.sections.length-1)):qe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Vh(i,e,r,o,d,p,y,b,M,I,k,L,N,V,$,te){const ee=Ya.fromFeature(i,d);let ue;L===a.WritingMode.vertical&&ee.verticalizePunctuation();const{processBidirectionalText:ve,processStyledBidirectionalText:ce}=qr;if(ve&&ee.sections.length===1){ue=[];const ze=ve(ee.toString(),pu(ee,I,p,e,o,V,$));for(const lt of ze){const pt=new Ya;pt.text=lt,pt.sections=ee.sections;for(let tt=0;tt<lt.length;tt++)pt.sectionIndex.push(0);ue.push(pt)}}else if(ce){ue=[];const ze=ce(ee.text,ee.sectionIndex,pu(ee,I,p,e,o,V,$));for(const lt of ze){const pt=new Ya;pt.text=lt[0],pt.sectionIndex=lt[1],pt.sections=ee.sections,ue.push(pt)}}else ue=function(ze,lt){const pt=[],tt=ze.text;let Je=0;for(const Ze of lt)pt.push(ze.substring(Je,Ze)),Je=Ze;return Je<tt.length&&pt.push(ze.substring(Je,tt.length)),pt}(ee,pu(ee,I,p,e,o,V,$));const _e=[],Le={positionedLines:_e,text:ee.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(ze,lt,pt,tt,Je,Ze,it,Qe,$e,wt,yt,$t){let wi=0,Ai=Uh,Gi=0,tn=0;const nr=Qe==="right"?1:Qe==="left"?0:.5;let Ui=0;for(const Vi of Je){Vi.trim();const ar=Vi.getMaxScale(),ur=(ar-1)*ir,Mr={positionedGlyphs:[],lineOffset:0};ze.positionedLines[Ui]=Mr;const Dr=Mr.positionedGlyphs;let Rr=0;if(!Vi.length()){Ai+=Ze,++Ui;continue}for(let Yi=0;Yi<Vi.length();Yi++){const Zt=Vi.getSection(Yi),Zr=Vi.getSectionIndex(Yi),or=Vi.getCharCode(Yi);let dr=0,un=null,En=null,Tn=null,ds=ir;const dn=!($e===a.WritingMode.horizontal||!yt&&!jo(or)||yt&&($h[or]||(Ji=or,et.Arabic(Ji)||et["Arabic Supplement"](Ji)||et["Arabic Extended-A"](Ji)||et["Arabic Presentation Forms-A"](Ji)||et["Arabic Presentation Forms-B"](Ji))));if(Zt.imageName){const rn=tt[Zt.imageName];if(!rn)continue;Tn=Zt.imageName,ze.iconsInText=ze.iconsInText||!0,En=rn.paddedRect;const Br=rn.displaySize;Zt.scale=Zt.scale*ir/$t,un={width:Br[0],height:Br[1],left:1,top:-3,advance:dn?Br[1]:Br[0]},dr=ur+(ir-Br[1]*Zt.scale),ds=un.advance;const fs=dn?Br[0]*Zt.scale-ir*ar:Br[1]*Zt.scale-ir*ar;fs>0&&fs>Rr&&(Rr=fs)}else{const rn=pt[Zt.fontStack],Br=rn&&rn[or];if(Br&&Br.rect)En=Br.rect,un=Br.metrics;else{const fs=lt[Zt.fontStack],ml=fs&&fs[or];if(!ml)continue;un=ml.metrics}dr=(ar-Zt.scale)*ir}dn?(ze.verticalizable=!0,Dr.push({glyph:or,imageName:Tn,x:wi,y:Ai+dr,vertical:dn,scale:Zt.scale,fontStack:Zt.fontStack,sectionIndex:Zr,metrics:un,rect:En}),wi+=ds*Zt.scale+wt):(Dr.push({glyph:or,imageName:Tn,x:wi,y:Ai+dr,vertical:dn,scale:Zt.scale,fontStack:Zt.fontStack,sectionIndex:Zr,metrics:un,rect:En}),wi+=un.advance*Zt.scale+wt)}Dr.length!==0&&(Gi=Math.max(wi-wt,Gi),Zg(Dr,0,Dr.length-1,nr,Rr)),wi=0;const Ci=Ze*ar+Rr;Mr.lineOffset=Math.max(Rr,ur),Ai+=Ci,tn=Math.max(Ci,tn),++Ui}var Ji;const sr=Ai-Uh,{horizontalAlign:cr,verticalAlign:Lr}=mu(it);(function(Vi,ar,ur,Mr,Dr,Rr,Ci,Yi,Zt){const Zr=(ar-ur)*Dr;let or=0;or=Rr!==Ci?-Yi*Mr-Uh:(-Mr*Zt+.5)*Ci;for(const dr of Vi)for(const un of dr.positionedGlyphs)un.x+=Zr,un.y+=or})(ze.positionedLines,nr,cr,Lr,Gi,tn,Ze,sr,Je.length),ze.top+=-Lr*sr,ze.bottom=ze.top+sr,ze.left+=-cr*Gi,ze.right=ze.left+Gi}(Le,e,r,o,ue,y,b,M,L,I,N,te),!function(ze){for(const lt of ze)if(lt.positionedGlyphs.length!==0)return!1;return!0}(_e)&&Le}const $h={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Gg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Xd(i,e,r,o,d,p){if(e.imageName){const y=o[e.imageName];return y?y.displaySize[0]*e.scale*ir/p+d:0}{const y=r[e.fontStack],b=y&&y[i];return b?b.metrics.advance*e.scale+d:0}}function Kd(i,e,r,o){const d=Math.pow(i-e,2);return o?i<e?d/2:2*d:d+Math.abs(r)*r}function jg(i,e,r){let o=0;return i===10&&(o-=1e4),r&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Jd(i,e,r,o,d,p){let y=null,b=Kd(e,r,d,p);for(const M of o){const I=Kd(e-M.x,r,d,p)+M.badness;I<=b&&(y=M,b=I)}return{index:i,x:e,priorBreak:y,badness:b}}function Yd(i){return i?Yd(i.priorBreak).concat(i.index):[]}function pu(i,e,r,o,d,p,y){if(p!=="point")return[];if(!i)return[];const b=[],M=function(N,V,$,te,ee,ue){let ve=0;for(let ce=0;ce<N.length();ce++){const _e=N.getSection(ce);ve+=Xd(N.getCharCode(ce),_e,te,ee,V,ue)}return ve/Math.max(1,Math.ceil(ve/$))}(i,e,r,o,d,y),I=i.text.indexOf("")>=0;let k=0;for(let N=0;N<i.length();N++){const V=i.getSection(N),$=i.getCharCode(N);if($h[$]||(k+=Xd($,V,o,d,e,y)),N<i.length()-1){const te=!((L=$)<11904||!(et["Bopomofo Extended"](L)||et.Bopomofo(L)||et["CJK Compatibility Forms"](L)||et["CJK Compatibility Ideographs"](L)||et["CJK Compatibility"](L)||et["CJK Radicals Supplement"](L)||et["CJK Strokes"](L)||et["CJK Symbols and Punctuation"](L)||et["CJK Unified Ideographs Extension A"](L)||et["CJK Unified Ideographs"](L)||et["Enclosed CJK Letters and Months"](L)||et["Halfwidth and Fullwidth Forms"](L)||et.Hiragana(L)||et["Ideographic Description Characters"](L)||et["Kangxi Radicals"](L)||et["Katakana Phonetic Extensions"](L)||et.Katakana(L)||et["Vertical Forms"](L)||et["Yi Radicals"](L)||et["Yi Syllables"](L)));(Gg[$]||te||V.imageName)&&b.push(Jd(N+1,k,M,b,jg($,i.getCharCode(N+1),te&&I),!1))}}var L;return Yd(Jd(i.length(),k,M,b,0,!0))}function mu(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Zg(i,e,r,o,d){if(!o&&!d)return;const p=i[r],y=(i[r].x+p.metrics.advance*p.scale)*o;for(let b=e;b<=r;b++)i[b].x-=y,i[b].y+=d}function Hg(i,e,r){const{horizontalAlign:o,verticalAlign:d}=mu(r),p=e[0]-i.displaySize[0]*o,y=e[1]-i.displaySize[1]*d;return{image:i,top:y,bottom:y+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Qd(i,e,r,o,d,p){const y=i.image;let b;if(y.content){const ee=y.content,ue=y.pixelRatio||1;b=[ee[0]/ue,ee[1]/ue,y.displaySize[0]-ee[2]/ue,y.displaySize[1]-ee[3]/ue]}const M=e.left*p,I=e.right*p;let k,L,N,V;r==="width"||r==="both"?(V=d[0]+M-o[3],L=d[0]+I+o[1]):(V=d[0]+(M+I-y.displaySize[0])/2,L=V+y.displaySize[0]);const $=e.top*p,te=e.bottom*p;return r==="height"||r==="both"?(k=d[1]+$-o[0],N=d[1]+te+o[2]):(k=d[1]+($+te-y.displaySize[1])/2,N=k+y.displaySize[1]),{image:y,top:k,right:L,bottom:N,left:V,collisionPadding:b}}const us=128;function ef(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Si(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:d}=r;let p=0;for(;p<o.length&&o[p]<=i;)p++;p=Math.max(0,p-1);let y=p;for(;y<o.length&&o[y]<i+1;)y++;y=Math.min(o.length-1,y);const b=o[p],M=o[y];return r.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:M,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:M,minSize:r.evaluate(new Si(b)),maxSize:r.evaluate(new Si(M)),interpolationType:d}}}class Ns extends H{constructor(e,r,o,d){super(e,r),this.angle=o,d!==void 0&&(this.segment=d)}clone(){return new Ns(this.x,this.y,this.angle,this.segment)}}function tf(i,e,r,o,d){if(e.segment===void 0)return!0;let p=e,y=e.segment+1,b=0;for(;b>-r/2;){if(y--,y<0)return!1;b-=i[y].dist(p),p=i[y]}b+=i[y].dist(i[y+1]),y++;const M=[];let I=0;for(;b<r/2;){const k=i[y],L=i[y+1];if(!L)return!1;let N=i[y-1].angleTo(k)-k.angleTo(L);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:b,angleDelta:N}),I+=N;b-M[0].distance>o;)I-=M.shift().angleDelta;if(I>d)return!1;y++,b+=k.dist(L)}return!0}function rf(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function nf(i,e,r){return i?.6*e*r:0}function sf(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Wg(i,e,r,o,d,p){const y=nf(r,d,p),b=sf(r,o)*p;let M=0;const I=rf(i)/2;for(let k=0;k<i.length-1;k++){const L=i[k],N=i[k+1],V=L.dist(N);if(M+V>I){const $=(I-M)/V,te=Ei(L.x,N.x,$),ee=Ei(L.y,N.y,$),ue=new Ns(te,ee,N.angleTo(L),k);return ue._round(),!y||tf(i,ue,b,y,e)?ue:void 0}M+=V}}function Xg(i,e,r,o,d,p,y,b,M){const I=nf(o,p,y),k=sf(o,d),L=k*y,N=i[0].x===0||i[0].x===M||i[0].y===0||i[0].y===M;return e-L<e/4&&(e=L+e/4),af(i,N?e/2*b%e:(k/2+2*p)*y*b%e,e,I,r,L,N,!1,M)}function af(i,e,r,o,d,p,y,b,M){const I=p/2,k=rf(i);let L=0,N=e-r,V=[];for(let $=0;$<i.length-1;$++){const te=i[$],ee=i[$+1],ue=te.dist(ee),ve=ee.angleTo(te);for(;N+r<L+ue;){N+=r;const ce=(N-L)/ue,_e=Ei(te.x,ee.x,ce),Le=Ei(te.y,ee.y,ce);if(_e>=0&&_e<M&&Le>=0&&Le<M&&N-I>=0&&N+I<=k){const ze=new Ns(_e,Le,ve,$);ze._round(),o&&!tf(i,ze,p,o,d)||V.push(ze)}}L+=ue}return b||V.length||y||(V=af(i,L/2,r,o,d,p,y,!0,M)),V}function of(i,e,r,o,d){const p=[];for(let y=0;y<i.length;y++){const b=i[y];let M;for(let I=0;I<b.length-1;I++){let k=b[I],L=b[I+1];k.x<e&&L.x<e||(k.x<e?k=new H(e,k.y+(e-k.x)/(L.x-k.x)*(L.y-k.y))._round():L.x<e&&(L=new H(e,k.y+(e-k.x)/(L.x-k.x)*(L.y-k.y))._round()),k.y<r&&L.y<r||(k.y<r?k=new H(k.x+(r-k.y)/(L.y-k.y)*(L.x-k.x),r)._round():L.y<r&&(L=new H(k.x+(r-k.y)/(L.y-k.y)*(L.x-k.x),r)._round()),k.x>=o&&L.x>=o||(k.x>=o?k=new H(o,k.y+(o-k.x)/(L.x-k.x)*(L.y-k.y))._round():L.x>=o&&(L=new H(o,k.y+(o-k.x)/(L.x-k.x)*(L.y-k.y))._round()),k.y>=d&&L.y>=d||(k.y>=d?k=new H(k.x+(d-k.y)/(L.y-k.y)*(L.x-k.x),d)._round():L.y>=d&&(L=new H(k.x+(d-k.y)/(L.y-k.y)*(L.x-k.x),d)._round()),M&&k.equals(M[M.length-1])||(M=[k],p.push(M)),M.push(L)))))}}return p}function lf(i,e,r,o){const d=[],p=i.image,y=p.pixelRatio,b=p.paddedRect.w-2,M=p.paddedRect.h-2,I=i.right-i.left,k=i.bottom-i.top,L=p.stretchX||[[0,b]],N=p.stretchY||[[0,M]],V=(Ze,it)=>Ze+it[1]-it[0],$=L.reduce(V,0),te=N.reduce(V,0),ee=b-$,ue=M-te;let ve=0,ce=$,_e=0,Le=te,ze=0,lt=ee,pt=0,tt=ue;if(p.content&&o){const Ze=p.content;ve=qh(L,0,Ze[0]),_e=qh(N,0,Ze[1]),ce=qh(L,Ze[0],Ze[2]),Le=qh(N,Ze[1],Ze[3]),ze=Ze[0]-ve,pt=Ze[1]-_e,lt=Ze[2]-Ze[0]-ce,tt=Ze[3]-Ze[1]-Le}const Je=(Ze,it,Qe,$e)=>{const wt=Gh(Ze.stretch-ve,ce,I,i.left),yt=jh(Ze.fixed-ze,lt,Ze.stretch,$),$t=Gh(it.stretch-_e,Le,k,i.top),wi=jh(it.fixed-pt,tt,it.stretch,te),Ai=Gh(Qe.stretch-ve,ce,I,i.left),Gi=jh(Qe.fixed-ze,lt,Qe.stretch,$),tn=Gh($e.stretch-_e,Le,k,i.top),nr=jh($e.fixed-pt,tt,$e.stretch,te),Ui=new H(wt,$t),Ji=new H(Ai,$t),sr=new H(Ai,tn),cr=new H(wt,tn),Lr=new H(yt/y,wi/y),Vi=new H(Gi/y,nr/y),ar=e*Math.PI/180;if(ar){const Dr=Math.sin(ar),Rr=Math.cos(ar),Ci=[Rr,-Dr,Dr,Rr];Ui._matMult(Ci),Ji._matMult(Ci),cr._matMult(Ci),sr._matMult(Ci)}const ur=Ze.stretch+Ze.fixed,Mr=it.stretch+it.fixed;return{tl:Ui,tr:Ji,bl:cr,br:sr,tex:{x:p.paddedRect.x+1+ur,y:p.paddedRect.y+1+Mr,w:Qe.stretch+Qe.fixed-ur,h:$e.stretch+$e.fixed-Mr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Lr,pixelOffsetBR:Vi,minFontScaleX:lt/y/I,minFontScaleY:tt/y/k,isSDF:r}};if(o&&(p.stretchX||p.stretchY)){const Ze=hf(L,ee,$),it=hf(N,ue,te);for(let Qe=0;Qe<Ze.length-1;Qe++){const $e=Ze[Qe],wt=Ze[Qe+1];for(let yt=0;yt<it.length-1;yt++)d.push(Je($e,it[yt],wt,it[yt+1]))}}else d.push(Je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:M+1}));return d}function qh(i,e,r){let o=0;for(const d of i)o+=Math.max(e,Math.min(r,d[1]))-Math.max(e,Math.min(r,d[0]));return o}function hf(i,e,r){const o=[{fixed:-1,stretch:0}];for(const[d,p]of i){const y=o[o.length-1];o.push({fixed:d-y.stretch,stretch:y.stretch}),o.push({fixed:d-y.stretch,stretch:y.stretch+(p-d)})}return o.push({fixed:e+1,stretch:r}),o}function Gh(i,e,r,o){return i/e*r+o}function jh(i,e,r,o){return i-e*r/o}ct("Anchor",Ns);class Zh{constructor(e,r,o,d,p,y,b,M,I,k){if(this.boxStartIndex=e.length,I){let L=y.top,N=y.bottom;const V=y.collisionPadding;V&&(L-=V[1],N+=V[3]);let $=N-L;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{let L=y.top*b-M[0],N=y.bottom*b+M[2],V=y.left*b-M[3],$=y.right*b+M[1];const te=y.collisionPadding;if(te&&(V-=te[0]*b,L-=te[1]*b,$+=te[2]*b,N+=te[3]*b),k){const ee=new H(V,L),ue=new H($,L),ve=new H(V,N),ce=new H($,N),_e=k*Math.PI/180;ee._rotate(_e),ue._rotate(_e),ve._rotate(_e),ce._rotate(_e),V=Math.min(ee.x,ue.x,ve.x,ce.x),$=Math.max(ee.x,ue.x,ve.x,ce.x),L=Math.min(ee.y,ue.y,ve.y,ce.y),N=Math.max(ee.y,ue.y,ve.y,ce.y)}e.emplaceBack(r.x,r.y,V,L,$,N,o,d,p)}this.boxEndIndex=e.length}}class Kg{constructor(e=[],r=Jg){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:o}=this,d=r[e];for(;e>0;){const p=e-1>>1,y=r[p];if(o(d,y)>=0)break;r[e]=y,e=p}r[e]=d}_down(e){const{data:r,compare:o}=this,d=this.length>>1,p=r[e];for(;e<d;){let y=1+(e<<1),b=r[y];const M=y+1;if(M<this.length&&o(r[M],b)<0&&(y=M,b=r[M]),o(b,p)>=0)break;r[e]=b,e=y}r[e]=p}}function Jg(i,e){return i<e?-1:i>e?1:0}function Yg(i,e=1,r=!1){let o=1/0,d=1/0,p=-1/0,y=-1/0;const b=i[0];for(let V=0;V<b.length;V++){const $=b[V];(!V||$.x<o)&&(o=$.x),(!V||$.y<d)&&(d=$.y),(!V||$.x>p)&&(p=$.x),(!V||$.y>y)&&(y=$.y)}const M=Math.min(p-o,y-d);let I=M/2;const k=new Kg([],Qg);if(M===0)return new H(o,d);for(let V=o;V<p;V+=M)for(let $=d;$<y;$+=M)k.push(new Qa(V+I,$+I,I,i));let L=function(V){let $=0,te=0,ee=0;const ue=V[0];for(let ve=0,ce=ue.length,_e=ce-1;ve<ce;_e=ve++){const Le=ue[ve],ze=ue[_e],lt=Le.x*ze.y-ze.x*Le.y;te+=(Le.x+ze.x)*lt,ee+=(Le.y+ze.y)*lt,$+=3*lt}return new Qa(te/$,ee/$,0,V)}(i),N=k.length;for(;k.length;){const V=k.pop();(V.d>L.d||!L.d)&&(L=V,r&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,N)),V.max-L.d<=e||(I=V.h/2,k.push(new Qa(V.p.x-I,V.p.y-I,I,i)),k.push(new Qa(V.p.x+I,V.p.y-I,I,i)),k.push(new Qa(V.p.x-I,V.p.y+I,I,i)),k.push(new Qa(V.p.x+I,V.p.y+I,I,i)),N+=4)}return r&&(console.log(`num probes: ${N}`),console.log(`best distance: ${L.d}`)),L.p}function Qg(i,e){return e.max-i.max}function Qa(i,e,r,o){this.p=new H(i,e),this.h=r,this.d=function(d,p){let y=!1,b=1/0;for(let M=0;M<p.length;M++){const I=p[M];for(let k=0,L=I.length,N=L-1;k<L;N=k++){const V=I[k],$=I[N];V.y>d.y!=$.y>d.y&&d.x<($.x-V.x)*(d.y-V.y)/($.y-V.y)+V.x&&(y=!y),b=Math.min(b,gd(d,V,$))}}return(y?1:-1)*Math.sqrt(b)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const gu=Number.POSITIVE_INFINITY;function cf(i,e){return e[1]!==gu?function(r,o,d){let p=0,y=0;switch(o=Math.abs(o),d=Math.abs(d),r){case"top-right":case"top-left":case"top":y=d-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-d}switch(r){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,y]}(i,e[0],e[1]):function(r,o){let d=0,p=0;o<0&&(o=0);const y=o/Math.sqrt(2);switch(r){case"top-right":case"top-left":p=y-7;break;case"bottom-right":case"bottom-left":p=7-y;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(r){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=o;break;case"right":d=-o}return[d,p]}(i,e[0])}function _u(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function e_(i,e,r,o,d,p,y,b,M,I,k){let L=p.textMaxSize.evaluate(e,{});L===void 0&&(L=y);const N=i.layers[0].layout,V=N.get("icon-offset").evaluate(e,{},k),$=df(r.horizontal),te=y/24,ee=i.tilePixelRatio*te,ue=i.tilePixelRatio*L/24,ve=i.tilePixelRatio*b,ce=i.tilePixelRatio*N.get("symbol-spacing"),_e=N.get("text-padding")*i.tilePixelRatio,Le=function($e,wt,yt,$t=1){const wi=$e.get("icon-padding").evaluate(wt,{},yt),Ai=wi&&wi.values;return[Ai[0]*$t,Ai[1]*$t,Ai[2]*$t,Ai[3]*$t]}(N,e,k,i.tilePixelRatio),ze=N.get("text-max-angle")/180*Math.PI,lt=N.get("text-rotation-alignment")!=="viewport"&&N.get("symbol-placement")!=="point",pt=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",tt=N.get("symbol-placement"),Je=ce/2,Ze=N.get("icon-text-fit");let it;o&&Ze!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(it=Qd(o,r.vertical,Ze,N.get("icon-text-fit-padding"),V,te)),$&&(o=Qd(o,$,Ze,N.get("icon-text-fit-padding"),V,te)));const Qe=($e,wt)=>{wt.x<0||wt.x>=qi||wt.y<0||wt.y>=qi||function(yt,$t,wi,Ai,Gi,tn,nr,Ui,Ji,sr,cr,Lr,Vi,ar,ur,Mr,Dr,Rr,Ci,Yi,Zt,Zr,or,dr,un){const En=yt.addToLineVertexArray($t,wi);let Tn,ds,dn,rn,Br=0,fs=0,ml=0,Af=0,Iu=-1,Au=-1;const ps={};let Cf=Ki.exports(""),Cu=0,ku=0;if(Ui._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Cu,ku]=Ui.layout.get("text-offset").evaluate(Zt,{},dr).map(Or=>Or*ir):(Cu=Ui.layout.get("text-radial-offset").evaluate(Zt,{},dr)*ir,ku=gu),yt.allowVerticalPlacement&&Ai.vertical){const Or=Ui.layout.get("text-rotate").evaluate(Zt,{},dr)+90;dn=new Zh(Ji,$t,sr,cr,Lr,Ai.vertical,Vi,ar,ur,Or),nr&&(rn=new Zh(Ji,$t,sr,cr,Lr,nr,Dr,Rr,ur,Or))}if(Gi){const Or=Ui.layout.get("icon-rotate").evaluate(Zt,{}),jn=Ui.layout.get("icon-text-fit")!=="none",gl=lf(Gi,Or,or,jn),_l=nr?lf(nr,Or,or,jn):void 0;ds=new Zh(Ji,$t,sr,cr,Lr,Gi,Dr,Rr,!1,Or),Br=4*gl.length;const zf=yt.iconSizeData;let xa=null;zf.kind==="source"?(xa=[us*Ui.layout.get("icon-size").evaluate(Zt,{})],xa[0]>Us&&qe(`${yt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):zf.kind==="composite"&&(xa=[us*Zr.compositeIconSizes[0].evaluate(Zt,{},dr),us*Zr.compositeIconSizes[1].evaluate(Zt,{},dr)],(xa[0]>Us||xa[1]>Us)&&qe(`${yt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),yt.addSymbols(yt.icon,gl,xa,Yi,Ci,Zt,a.WritingMode.none,$t,En.lineStartIndex,En.lineLength,-1,dr),Iu=yt.icon.placedSymbolArray.length-1,_l&&(fs=4*_l.length,yt.addSymbols(yt.icon,_l,xa,Yi,Ci,Zt,a.WritingMode.vertical,$t,En.lineStartIndex,En.lineLength,-1,dr),Au=yt.icon.placedSymbolArray.length-1)}const kf=Object.keys(Ai.horizontal);for(const Or of kf){const jn=Ai.horizontal[Or];if(!Tn){Cf=Ki.exports(jn.text);const _l=Ui.layout.get("text-rotate").evaluate(Zt,{},dr);Tn=new Zh(Ji,$t,sr,cr,Lr,jn,Vi,ar,ur,_l)}const gl=jn.positionedLines.length===1;if(ml+=uf(yt,$t,jn,tn,Ui,ur,Zt,Mr,En,Ai.vertical?a.WritingMode.horizontal:a.WritingMode.horizontalOnly,gl?kf:[Or],ps,Iu,Zr,dr),gl)break}Ai.vertical&&(Af+=uf(yt,$t,Ai.vertical,tn,Ui,ur,Zt,Mr,En,a.WritingMode.vertical,["vertical"],ps,Au,Zr,dr));const f_=Tn?Tn.boxStartIndex:yt.collisionBoxArray.length,p_=Tn?Tn.boxEndIndex:yt.collisionBoxArray.length,m_=dn?dn.boxStartIndex:yt.collisionBoxArray.length,g_=dn?dn.boxEndIndex:yt.collisionBoxArray.length,__=ds?ds.boxStartIndex:yt.collisionBoxArray.length,y_=ds?ds.boxEndIndex:yt.collisionBoxArray.length,v_=rn?rn.boxStartIndex:yt.collisionBoxArray.length,x_=rn?rn.boxEndIndex:yt.collisionBoxArray.length;let Sn=-1;const Jh=(Or,jn)=>Or&&Or.circleDiameter?Math.max(Or.circleDiameter,jn):jn;Sn=Jh(Tn,Sn),Sn=Jh(dn,Sn),Sn=Jh(ds,Sn),Sn=Jh(rn,Sn);const Pf=Sn>-1?1:0;Pf&&(Sn*=un/ir),yt.glyphOffsetArray.length>=eo.MAX_GLYPHS&&qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&yt.addToSortKeyRanges(yt.symbolInstances.length,Zt.sortKey),yt.symbolInstances.emplaceBack($t.x,$t.y,ps.right>=0?ps.right:-1,ps.center>=0?ps.center:-1,ps.left>=0?ps.left:-1,ps.vertical||-1,Iu,Au,Cf,f_,p_,m_,g_,__,y_,v_,x_,sr,ml,Af,Br,fs,Pf,0,Vi,Cu,ku,Sn)}(i,wt,$e,r,o,d,it,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ee,[_e,_e,_e,_e],lt,M,ve,Le,pt,V,e,p,I,k,y)};if(tt==="line")for(const $e of of(e.geometry,0,0,qi,qi)){const wt=Xg($e,ce,ze,r.vertical||$,o,24,ue,i.overscaling,qi);for(const yt of wt){const $t=$;$t&&t_(i,$t.text,Je,yt)||Qe($e,yt)}}else if(tt==="line-center"){for(const $e of e.geometry)if($e.length>1){const wt=Wg($e,ze,r.vertical||$,o,24,ue);wt&&Qe($e,wt)}}else if(e.type==="Polygon")for(const $e of nu(e.geometry,0)){const wt=Yg($e,16);Qe($e[0],new Ns(wt.x,wt.y,0))}else if(e.type==="LineString")for(const $e of e.geometry)Qe($e,new Ns($e[0].x,$e[0].y,0));else if(e.type==="Point")for(const $e of e.geometry)for(const wt of $e)Qe([wt],new Ns(wt.x,wt.y,0))}const Us=32640;function uf(i,e,r,o,d,p,y,b,M,I,k,L,N,V,$){const te=function(ve,ce,_e,Le,ze,lt,pt,tt){const Je=Le.layout.get("text-rotate").evaluate(lt,{})*Math.PI/180,Ze=[];for(const it of ce.positionedLines)for(const Qe of it.positionedGlyphs){if(!Qe.rect)continue;const $e=Qe.rect||{};let wt=4,yt=!0,$t=1,wi=0;const Ai=(ze||tt)&&Qe.vertical,Gi=Qe.metrics.advance*Qe.scale/2;if(tt&&ce.verticalizable){const Ci=(Qe.scale-1)*ir,Yi=(ir-Qe.metrics.width*Qe.scale)/2;wi=it.lineOffset/2-(Qe.imageName?-Yi:Ci)}if(Qe.imageName){const Ci=pt[Qe.imageName];yt=Ci.sdf,$t=Ci.pixelRatio,wt=1/$t}const tn=ze?[Qe.x+Gi,Qe.y]:[0,0];let nr=ze?[0,0]:[Qe.x+Gi+_e[0],Qe.y+_e[1]-wi],Ui=[0,0];Ai&&(Ui=nr,nr=[0,0]);const Ji=(Qe.metrics.left-wt)*Qe.scale-Gi+nr[0],sr=(-Qe.metrics.top-wt)*Qe.scale+nr[1],cr=Ji+$e.w*Qe.scale/$t,Lr=sr+$e.h*Qe.scale/$t,Vi=new H(Ji,sr),ar=new H(cr,sr),ur=new H(Ji,Lr),Mr=new H(cr,Lr);if(Ai){const Ci=new H(-Gi,Gi-Uh),Yi=-Math.PI/2,Zt=12-Gi,Zr=new H(22-Zt,-(Qe.imageName?Zt:0)),or=new H(...Ui);Vi._rotateAround(Yi,Ci)._add(Zr)._add(or),ar._rotateAround(Yi,Ci)._add(Zr)._add(or),ur._rotateAround(Yi,Ci)._add(Zr)._add(or),Mr._rotateAround(Yi,Ci)._add(Zr)._add(or)}if(Je){const Ci=Math.sin(Je),Yi=Math.cos(Je),Zt=[Yi,-Ci,Ci,Yi];Vi._matMult(Zt),ar._matMult(Zt),ur._matMult(Zt),Mr._matMult(Zt)}const Dr=new H(0,0),Rr=new H(0,0);Ze.push({tl:Vi,tr:ar,bl:ur,br:Mr,tex:$e,writingMode:ce.writingMode,glyphOffset:tn,sectionIndex:Qe.sectionIndex,isSDF:yt,pixelOffsetTL:Dr,pixelOffsetBR:Rr,minFontScaleX:0,minFontScaleY:0})}return Ze}(0,r,b,d,p,y,o,i.allowVerticalPlacement),ee=i.textSizeData;let ue=null;ee.kind==="source"?(ue=[us*d.layout.get("text-size").evaluate(y,{})],ue[0]>Us&&qe(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ee.kind==="composite"&&(ue=[us*V.compositeTextSizes[0].evaluate(y,{},$),us*V.compositeTextSizes[1].evaluate(y,{},$)],(ue[0]>Us||ue[1]>Us)&&qe(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,te,ue,b,p,y,I,e,M.lineStartIndex,M.lineLength,N,$);for(const ve of k)L[ve]=i.text.placedSymbolArray.length-1;return 4*te.length}function df(i){for(const e in i)return i[e];return null}function t_(i,e,r,o){const d=i.compareText;if(e in d){const p=d[e];for(let y=p.length-1;y>=0;y--)if(o.dist(p[y])<r)return!0}else d[e]=[];return d[e].push(o),!1}const i_=Os.VectorTileFeature.types,r_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hh(i,e,r,o,d,p,y,b,M,I,k,L,N){const V=b?Math.min(Us,Math.round(b[0])):0,$=b?Math.min(Us,Math.round(b[1])):0;i.emplaceBack(e,r,Math.round(32*o),Math.round(32*d),p,y,(V<<1)+(M?1:0),$,16*I,16*k,256*L,256*N)}function yu(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function n_(i){for(const e of i.sections)if(wh(e.text))return!0;return!1}class vu{constructor(e){this.layoutVertexArray=new hn,this.indexArray=new xr,this.programConfigurations=e,this.segments=new Gt,this.dynamicLayoutVertexArray=new Yr,this.opacityVertexArray=new cn,this.placedSymbolArray=new Ue}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,o,d){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ig.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Ag.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,r_,!0),this.opacityVertexBuffer.itemSize=1),(o||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ct("SymbolBuffers",vu);class xu{constructor(e,r,o){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new o,this.segments=new Gt,this.collisionVertexArray=new Gr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Cg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ct("CollisionBuffers",xu);class eo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Yc([]),this.placementViewportMatrix=Yc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ef(this.zoom,r["text-size"]),this.iconSizeData=ef(this.zoom,r["icon-size"]);const o=this.layers[0].layout,d=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=wu(o,"text-overlap","text-allow-overlap")!=="never"||wu(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(y=>a.WritingMode[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new vu(new ma(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new vu(new ma(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ke,this.lineVertexArray=new ot,this.symbolInstances=new at}calculateGlyphDependencies(e,r,o,d,p){for(let y=0;y<e.length;y++)if(r[e.charCodeAt(y)]=!0,(o||d)&&p){const b=ul[e.charAt(y)];b&&(r[b.charCodeAt(0)]=!0)}}populate(e,r,o){const d=this.layers[0],p=d.layout,y=p.get("text-font"),b=p.get("text-field"),M=p.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof ne&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),k=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,L=p.get("symbol-sort-key");if(this.features=[],!I&&!k)return;const N=r.iconDependencies,V=r.glyphDependencies,$=r.availableImages,te=new Si(this.zoom);for(const{feature:ee,id:ue,index:ve,sourceLayerIndex:ce}of e){const _e=d._featureFilter.needGeometry,Le=_a(ee,_e);if(!d._featureFilter.filter(te,Le,o))continue;let ze,lt;if(_e||(Le.geometry=ga(ee)),I){const tt=d.getValueAndResolveTokens("text-field",Le,o,$),Je=ne.factory(tt);n_(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||da()==="unavailable"||this.hasRTLText&&qr.isParsed())&&(ze=Pg(Je,d,Le))}if(k){const tt=d.getValueAndResolveTokens("icon-image",Le,o,$);lt=tt instanceof oe?tt:oe.fromString(tt)}if(!ze&&!lt)continue;const pt=this.sortFeaturesByKey?L.evaluate(Le,{},o):void 0;if(this.features.push({id:ue,text:ze,icon:lt,index:ve,sourceLayerIndex:ce,geometry:Le.geometry,properties:ee.properties,type:i_[ee.type],sortKey:pt}),lt&&(N[lt.name]=!0),ze){const tt=y.evaluate(Le,{},o).join(","),Je=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.WritingMode.vertical)>=0;for(const Ze of ze.sections)if(Ze.image)N[Ze.image.name]=!0;else{const it=$a(ze.toString()),Qe=Ze.fontStack||tt,$e=V[Qe]=V[Qe]||{};this.calculateGlyphDependencies(Ze.text,$e,Je,this.allowVerticalPlacement,it)}}}p.get("symbol-placement")==="line"&&(this.features=function(ee){const ue={},ve={},ce=[];let _e=0;function Le(tt){ce.push(ee[tt]),_e++}function ze(tt,Je,Ze){const it=ve[tt];return delete ve[tt],ve[Je]=it,ce[it].geometry[0].pop(),ce[it].geometry[0]=ce[it].geometry[0].concat(Ze[0]),it}function lt(tt,Je,Ze){const it=ue[Je];return delete ue[Je],ue[tt]=it,ce[it].geometry[0].shift(),ce[it].geometry[0]=Ze[0].concat(ce[it].geometry[0]),it}function pt(tt,Je,Ze){const it=Ze?Je[0][Je[0].length-1]:Je[0][0];return`${tt}:${it.x}:${it.y}`}for(let tt=0;tt<ee.length;tt++){const Je=ee[tt],Ze=Je.geometry,it=Je.text?Je.text.toString():null;if(!it){Le(tt);continue}const Qe=pt(it,Ze),$e=pt(it,Ze,!0);if(Qe in ve&&$e in ue&&ve[Qe]!==ue[$e]){const wt=lt(Qe,$e,Ze),yt=ze(Qe,$e,ce[wt].geometry);delete ue[Qe],delete ve[$e],ve[pt(it,ce[yt].geometry,!0)]=yt,ce[wt].geometry=null}else Qe in ve?ze(Qe,$e,Ze):$e in ue?lt(Qe,$e,Ze):(Le(tt),ue[Qe]=_e-1,ve[$e]=_e-1)}return ce.filter(tt=>tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,ue)=>ee.sortKey-ue.sortKey)}update(e,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const o=this.lineVertexArray.length;if(e.segment!==void 0){let d=e.dist(r[e.segment+1]),p=e.dist(r[e.segment]);const y={};for(let b=e.segment+1;b<r.length;b++)y[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:d},b<r.length-1&&(d+=r[b+1].dist(r[b]));for(let b=e.segment||0;b>=0;b--)y[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:p},b>0&&(p+=r[b-1].dist(r[b]));for(let b=0;b<r.length;b++){const M=y[b];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,r,o,d,p,y,b,M,I,k,L,N){const V=e.indexArray,$=e.layoutVertexArray,te=e.segments.prepareSegment(4*r.length,$,V,this.canOverlap?y.sortKey:void 0),ee=this.glyphOffsetArray.length,ue=te.vertexLength,ve=this.allowVerticalPlacement&&b===a.WritingMode.vertical?Math.PI/2:0,ce=y.text&&y.text.sections;for(let _e=0;_e<r.length;_e++){const{tl:Le,tr:ze,bl:lt,br:pt,tex:tt,pixelOffsetTL:Je,pixelOffsetBR:Ze,minFontScaleX:it,minFontScaleY:Qe,glyphOffset:$e,isSDF:wt,sectionIndex:yt}=r[_e],$t=te.vertexLength,wi=$e[1];Hh($,M.x,M.y,Le.x,wi+Le.y,tt.x,tt.y,o,wt,Je.x,Je.y,it,Qe),Hh($,M.x,M.y,ze.x,wi+ze.y,tt.x+tt.w,tt.y,o,wt,Ze.x,Je.y,it,Qe),Hh($,M.x,M.y,lt.x,wi+lt.y,tt.x,tt.y+tt.h,o,wt,Je.x,Ze.y,it,Qe),Hh($,M.x,M.y,pt.x,wi+pt.y,tt.x+tt.w,tt.y+tt.h,o,wt,Ze.x,Ze.y,it,Qe),yu(e.dynamicLayoutVertexArray,M,ve),V.emplaceBack($t,$t+1,$t+2),V.emplaceBack($t+1,$t+2,$t+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($e[0]),_e!==r.length-1&&yt===r[_e+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,y,y.index,{},N,ce&&ce[yt])}e.placedSymbolArray.emplaceBack(M.x,M.y,ee,this.glyphOffsetArray.length-ee,ue,I,k,M.segment,o?o[0]:0,o?o[1]:0,d[0],d[1],b,0,!1,0,L)}_addCollisionDebugVertex(e,r,o,d,p,y){return r.emplaceBack(0,0),e.emplaceBack(o.x,o.y,d,p,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,r,o,d,p,y,b){const M=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),I=M.vertexLength,k=p.layoutVertexArray,L=p.collisionVertexArray,N=b.anchorX,V=b.anchorY;this._addCollisionDebugVertex(k,L,y,N,V,new H(e,r)),this._addCollisionDebugVertex(k,L,y,N,V,new H(o,r)),this._addCollisionDebugVertex(k,L,y,N,V,new H(o,d)),this._addCollisionDebugVertex(k,L,y,N,V,new H(e,d)),M.vertexLength+=4;const $=p.indexArray;$.emplaceBack(I,I+1),$.emplaceBack(I+1,I+2),$.emplaceBack(I+2,I+3),$.emplaceBack(I+3,I),M.primitiveLength+=4}addDebugCollisionBoxes(e,r,o,d){for(let p=e;p<r;p++){const y=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,d?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new xu(qn,Ud.members,wn),this.iconCollisionBox=new xu(qn,Ud.members,wn);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,o,d,p,y,b,M,I){const k={};for(let L=r;L<o;L++){const N=e.get(L);k.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},k.textFeatureIndex=N.featureIndex;break}for(let L=d;L<p;L++){const N=e.get(L);k.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},k.verticalTextFeatureIndex=N.featureIndex;break}for(let L=y;L<b;L++){const N=e.get(L);k.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},k.iconFeatureIndex=N.featureIndex;break}for(let L=M;L<I;L++){const N=e.get(L);k.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},k.verticalIconFeatureIndex=N.featureIndex;break}return k}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const o=e.placedSymbolArray.get(r),d=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<d;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),o=Math.cos(e),d=[],p=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const M=this.symbolInstances.get(b);d.push(0|Math.round(r*M.anchorX+o*M.anchorY)),p.push(M.featureIndex)}return y.sort((b,M)=>d[b]-d[M]||p[M]-p[b]),y}addToSortKeyRanges(e,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((d,p,y)=>{d>=0&&y.indexOf(d)===p&&this.addIndicesForPlacedSymbol(this.text,d)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ct("SymbolBucket",eo,{omit:["layers","collisionBoxArray","features","compareText"]}),eo.MAX_GLYPHS=65535,eo.addDynamicAttributes=yu;const s_=new tr({"symbol-placement":new _t(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new _t(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _t(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tt(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _t(ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _t(ke.layout_symbol["icon-allow-overlap"]),"icon-overlap":new _t(ke.layout_symbol["icon-overlap"]),"icon-ignore-placement":new _t(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new _t(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _t(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tt(ke.layout_symbol["icon-size"]),"icon-text-fit":new _t(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _t(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tt(ke.layout_symbol["icon-image"]),"icon-rotate":new Tt(ke.layout_symbol["icon-rotate"]),"icon-padding":new Tt(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new _t(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new Tt(ke.layout_symbol["icon-offset"]),"icon-anchor":new Tt(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _t(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _t(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _t(ke.layout_symbol["text-rotation-alignment"]),"text-field":new Tt(ke.layout_symbol["text-field"]),"text-font":new Tt(ke.layout_symbol["text-font"]),"text-size":new Tt(ke.layout_symbol["text-size"]),"text-max-width":new Tt(ke.layout_symbol["text-max-width"]),"text-line-height":new _t(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new Tt(ke.layout_symbol["text-letter-spacing"]),"text-justify":new Tt(ke.layout_symbol["text-justify"]),"text-radial-offset":new Tt(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _t(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new Tt(ke.layout_symbol["text-anchor"]),"text-max-angle":new _t(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new _t(ke.layout_symbol["text-writing-mode"]),"text-rotate":new Tt(ke.layout_symbol["text-rotate"]),"text-padding":new _t(ke.layout_symbol["text-padding"]),"text-keep-upright":new _t(ke.layout_symbol["text-keep-upright"]),"text-transform":new Tt(ke.layout_symbol["text-transform"]),"text-offset":new Tt(ke.layout_symbol["text-offset"]),"text-allow-overlap":new _t(ke.layout_symbol["text-allow-overlap"]),"text-overlap":new _t(ke.layout_symbol["text-overlap"]),"text-ignore-placement":new _t(ke.layout_symbol["text-ignore-placement"]),"text-optional":new _t(ke.layout_symbol["text-optional"])});var bu={paint:new tr({"icon-opacity":new Tt(ke.paint_symbol["icon-opacity"]),"icon-color":new Tt(ke.paint_symbol["icon-color"]),"icon-halo-color":new Tt(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tt(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tt(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new _t(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new _t(ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new Tt(ke.paint_symbol["text-opacity"]),"text-color":new Tt(ke.paint_symbol["text-color"],{runtimeType:er,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Tt(ke.paint_symbol["text-halo-color"]),"text-halo-width":new Tt(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new Tt(ke.paint_symbol["text-halo-blur"]),"text-translate":new _t(ke.paint_symbol["text-translate"]),"text-translate-anchor":new _t(ke.paint_symbol["text-translate-anchor"])}),layout:s_};class ff{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Rn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ct("FormatSectionOverride",ff,{omit:["defaultValue"]});class Wh extends ln{constructor(e){super(e,bu)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const d=[];for(const p of o)d.indexOf(p)<0&&d.push(p);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,o,d){const p=this.layout.get(e).evaluate(r,{},o,d),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Qs(y.value)||!p?p:function(b,M){return M.replace(/{([^{}]+)}/g,(I,k)=>k in b?String(b[k]):"")}(r.properties,p)}createBucket(e){return new eo(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of bu.paint.overridableProperties){if(!Wh.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),o=new ff(r),d=new Ba(o,r.property.specification);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new ta("source",d):new No("composite",d,r.value.zoomStops),this.paint._values[e]=new on(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Wh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const o=e.get("text-field"),d=bu.paint.properties[r];let p=!1;const y=b=>{for(const M of b)if(d.overrides&&d.overrides.hasOverride(M))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof ne)y(o.value.value.sections);else if(o.value.kind==="source"){const b=I=>{p||(I instanceof mt&&be(I.value)===Zi?y(I.value.sections):I instanceof Da?y(I.sections):I.eachChild(b))},M=o.value;M._styleExpression&&b(M._styleExpression.expression)}return p}}function wu(i,e,r){let o="never";const d=i.get(e);return d?o=d:i.get(r)&&(o="always"),o}var a_={paint:new tr({"background-color":new _t(ke.paint_background["background-color"]),"background-pattern":new Jo(ke.paint_background["background-pattern"]),"background-opacity":new _t(ke.paint_background["background-opacity"])})},o_={paint:new tr({"raster-opacity":new _t(ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new _t(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _t(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _t(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new _t(ke.paint_raster["raster-saturation"]),"raster-contrast":new _t(ke.paint_raster["raster-contrast"]),"raster-resampling":new _t(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new _t(ke.paint_raster["raster-fade-duration"])})};class l_ extends ln{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const h_={circle:class extends ln{constructor(i){super(i,Um)}createBucket(i){return new Xc(i)}queryRadius(i){const e=i;return il("circle-radius",this,e)+il("circle-stroke-width",this,e)+Ph(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,o,d,p,y,b){const M=zh(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,y),I=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),k=this.paint.get("circle-pitch-alignment")==="map",L=k?M:function(V,$){return V.map(te=>Md(te,$))}(M,b),N=k?I*y:I;for(const V of o)for(const $ of V){const te=k?$:Md($,b);let ee=N;const ue=Lh([],[$.x,$.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ee*=ue[3]/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ee*=p.cameraToCenterDistance/ue[3]),Rm(L,te,ee))return!0}return!1}},heatmap:class extends ln{constructor(i){super(i,$m),this._updateColorRamp()}createBucket(i){return new Ed(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Sd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends ln{constructor(i){super(i,qm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends ln{constructor(i){super(i,sg)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new ou(i)}queryRadius(){return Ph(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,o,d,p,y){return md(zh(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,y),o)}isTileClipped(){return!0}},"fill-extrusion":class extends ln{constructor(i){super(i,vg)}createBucket(i){return new hu(i)}queryRadius(){return Ph(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,r,o,d,p,y,b){const M=zh(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,y),I=this.paint.get("fill-extrusion-height").evaluate(e,r),k=this.paint.get("fill-extrusion-base").evaluate(e,r),L=function(V,$,te,ee){const ue=[];for(const ve of V){const ce=[ve.x,ve.y,0,1];Lh(ce,ce,$),ue.push(new H(ce[0]/ce[3],ce[1]/ce[3]))}return ue}(M,b),N=function(V,$,te,ee){const ue=[],ve=[],ce=ee[8]*$,_e=ee[9]*$,Le=ee[10]*$,ze=ee[11]*$,lt=ee[8]*te,pt=ee[9]*te,tt=ee[10]*te,Je=ee[11]*te;for(const Ze of V){const it=[],Qe=[];for(const $e of Ze){const wt=$e.x,yt=$e.y,$t=ee[0]*wt+ee[4]*yt+ee[12],wi=ee[1]*wt+ee[5]*yt+ee[13],Ai=ee[2]*wt+ee[6]*yt+ee[14],Gi=ee[3]*wt+ee[7]*yt+ee[15],tn=Ai+Le,nr=Gi+ze,Ui=$t+lt,Ji=wi+pt,sr=Ai+tt,cr=Gi+Je,Lr=new H(($t+ce)/nr,(wi+_e)/nr);Lr.z=tn/nr,it.push(Lr);const Vi=new H(Ui/cr,Ji/cr);Vi.z=sr/cr,Qe.push(Vi)}ue.push(it),ve.push(Qe)}return[ue,ve]}(o,k,I,b);return function(V,$,te){let ee=1/0;md(te,$)&&(ee=Rd(te,$[0]));for(let ue=0;ue<$.length;ue++){const ve=$[ue],ce=V[ue];for(let _e=0;_e<ve.length-1;_e++){const Le=ve[_e],ze=[Le,ve[_e+1],ce[_e+1],ce[_e],Le];pd(te,ze)&&(ee=Math.min(ee,Rd(te,ze)))}}return ee!==1/0&&ee}(N[0],N[1],L)}},line:class extends ln{constructor(i){super(i,Od),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ws,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Fd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new cu(i)}queryRadius(i){const e=i,r=Nd(il("line-width",this,e),il("line-gap-width",this,e)),o=il("line-offset",this,e);return r/2+Math.abs(o)+Ph(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,o,d,p,y){const b=zh(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,y),M=y/2*Nd(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),I=this.paint.get("line-offset").evaluate(e,r);return I&&(o=function(k,L){const N=[];for(let V=0;V<k.length;V++){const $=k[V],te=[];for(let ee=0;ee<$.length;ee++){const ue=$[ee-1],ve=$[ee],ce=$[ee+1],_e=ee===0?new H(0,0):ve.sub(ue)._unit()._perp(),Le=ee===$.length-1?new H(0,0):ce.sub(ve)._unit()._perp(),ze=_e._add(Le)._unit(),lt=ze.x*Le.x+ze.y*Le.y;lt!==0&&ze._mult(1/lt),te.push(ze._mult(L)._add(ve))}N.push(te)}return N}(o,I*y)),function(k,L,N){for(let V=0;V<L.length;V++){const $=L[V];if(k.length>=3){for(let te=0;te<$.length;te++)if(Ha(k,$[te]))return!0}if(Bm(k,$,N))return!0}return!1}(b,o,M)}isTileClipped(){return!0}},symbol:Wh,background:class extends ln{constructor(i){super(i,a_)}},raster:class extends ln{constructor(i){super(i,o_)}}};class c_{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const pf=63710088e-1;class Li{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Li(Q(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,o=this.lat*r,d=e.lat*r,p=Math.sin(o)*Math.sin(d)+Math.cos(o)*Math.cos(d)*Math.cos((e.lng-this.lng)*r);return pf*Math.acos(Math.min(p,1))}toBounds(e=0){const r=360*e/40075017,o=r/Math.cos(Math.PI/180*this.lat);return new va(new Li(this.lng-o,this.lat-r),new Li(this.lng+o,this.lat+r))}static convert(e){if(e instanceof Li)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Li(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Li(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class va{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Li?new Li(e.lng,e.lat):Li.convert(e),this}setSouthWest(e){return this._sw=e instanceof Li?new Li(e.lng,e.lat):Li.convert(e),this}extend(e){const r=this._sw,o=this._ne;let d,p;if(e instanceof Li)d=e,p=e;else{if(!(e instanceof va))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(va.convert(e)):this.extend(Li.convert(e)):this;if(d=e._sw,p=e._ne,!d||!p)return this}return r||o?(r.lng=Math.min(d.lng,r.lng),r.lat=Math.min(d.lat,r.lat),o.lng=Math.max(p.lng,o.lng),o.lat=Math.max(p.lat,o.lat)):(this._sw=new Li(d.lng,d.lat),this._ne=new Li(p.lng,p.lat)),this}getCenter(){return new Li((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Li(this.getWest(),this.getNorth())}getSouthEast(){return new Li(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:o}=Li.convert(e);let d=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&d}static convert(e){return e instanceof va?e:e&&new va(e)}}const mf=2*Math.PI*pf;function gf(i){return mf*Math.cos(i*Math.PI/180)}function _f(i){return(180+i)/360}function yf(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function vf(i,e){return i/gf(e)}function Mu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Xh{constructor(e,r,o=0){this.x=+e,this.y=+r,this.z=+o}static fromLngLat(e,r=0){const o=Li.convert(e);return new Xh(_f(o.lng),yf(o.lat),vf(r,o.lat))}toLngLat(){return new Li(360*this.x-180,Mu(this.y))}toAltitude(){return this.z*gf(Mu(this.y))}meterInMercatorCoordinateUnits(){return 1/mf*(e=Mu(this.y),1/Math.cos(e*Math.PI/180));var e}}function xf(i,e,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Eu{constructor(e,r,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=o,this.key=fl(0,e,e,r,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,o){const d=(y=this.y,b=this.z,M=xf(256*(p=this.x),256*(y=Math.pow(2,b)-y-1),b),I=xf(256*(p+1),256*(y+1),b),M[0]+","+M[1]+","+I[0]+","+I[1]);var p,y,b,M,I;const k=function(L,N,V){let $,te="";for(let ee=L;ee>0;ee--)$=1<<ee-1,te+=(N&$?1:0)+(V&$?2:0);return te}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,k).replace(/{bbox-epsg-3857}/g,d)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new H((e.x*r-this.x)*qi,(e.y*r-this.y)*qi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bf{constructor(e,r){this.wrap=e,this.canonical=r,this.key=fl(e,r.z,r.z,r.x,r.y)}}class en{constructor(e,r,o,d,p){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Eu(o,+d,+p),this.key=fl(r,e,o,d,p)}clone(){return new en(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new en(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new en(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?fl(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):fl(this.wrap*+r,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new en(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,d=2*this.canonical.y;return[new en(r,this.wrap,r,o,d),new en(r,this.wrap,r,o+1,d),new en(r,this.wrap,r,o,d+1),new en(r,this.wrap,r,o+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new en(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new en(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Xh(e.x-this.wrap,e.y))}}function fl(i,e,r,o,d){(i*=2)<0&&(i=-1*i-1);const p=1<<r;return(p*p*i+p*d+o).toString(36)+r.toString(36)+e.toString(36)}ct("CanonicalTileID",Eu),ct("OverscaledTileID",en,{omit:["posMatrix"]});class wf{constructor(e,r,o){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void qe(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const d=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=o||"mapbox";for(let p=0;p<d;p++)this.data[this._idx(-1,p)]=this.data[this._idx(0,p)],this.data[this._idx(d,p)]=this.data[this._idx(d-1,p)],this.data[this._idx(p,-1)]=this.data[this._idx(p,0)],this.data[this._idx(p,d)]=this.data[this._idx(p,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let p=0;p<d;p++)for(let y=0;y<d;y++){const b=this.get(p,y);b>this.max&&(this.max=b),b<this.min&&(this.min=b)}}get(e,r){const o=new Uint8Array(this.data.buffer),d=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(o[d],o[d+1],o[d+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,o){return(256*e*256+256*r+o)/10-1e4}_unpackTerrarium(e,r,o){return 256*e+r+o/256-32768}getPixels(){return new Qr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=r*this.dim,p=r*this.dim+this.dim,y=o*this.dim,b=o*this.dim+this.dim;switch(r){case-1:d=p-1;break;case 1:p=d+1}switch(o){case-1:y=b-1;break;case 1:b=y+1}const M=-r*this.dim,I=-o*this.dim;for(let k=y;k<b;k++)for(let L=d;L<p;L++)this.data[this._idx(L,k)]=e.data[this._idx(L+M,k+I)]}}ct("DEMData",wf);class Mf{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const o=e[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Ef{constructor(e,r,o,d,p){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=o,e._y=d,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Tf{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ua(qi,16,0),this.grid3D=new ua(qi,16,0),this.featureIndexArray=new Vt,this.promoteId=r}insert(e,r,o,d,p,y){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,d,p);const M=y?this.grid3D:this.grid;for(let I=0;I<r.length;I++){const k=r[I],L=[1/0,1/0,-1/0,-1/0];for(let N=0;N<k.length;N++){const V=k[N];L[0]=Math.min(L[0],V.x),L[1]=Math.min(L[1],V.y),L[2]=Math.max(L[2],V.x),L[3]=Math.max(L[3],V.y)}L[0]<qi&&L[1]<qi&&L[2]>=0&&L[3]>=0&&M.insert(b,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Os.VectorTile(new uu(this.rawTileData)).layers,this.sourceLayerCoder=new Mf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,o,d){this.loadVTLayers();const p=e.params||{},y=qi/e.tileSize/e.scale,b=Na(p.filter),M=e.queryGeometry,I=e.queryPadding*y,k=If(M),L=this.grid.query(k.minX-I,k.minY-I,k.maxX+I,k.maxY+I),N=If(e.cameraQueryGeometry),V=this.grid3D.query(N.minX-I,N.minY-I,N.maxX+I,N.maxY+I,(ee,ue,ve,ce)=>function(_e,Le,ze,lt,pt){for(const Je of _e)if(Le<=Je.x&&ze<=Je.y&&lt>=Je.x&&pt>=Je.y)return!0;const tt=[new H(Le,ze),new H(Le,pt),new H(lt,pt),new H(lt,ze)];if(_e.length>2){for(const Je of tt)if(Ha(_e,Je))return!0}for(let Je=0;Je<_e.length-1;Je++)if(Fm(_e[Je],_e[Je+1],tt))return!0;return!1}(e.cameraQueryGeometry,ee-I,ue-I,ve+I,ce+I));for(const ee of V)L.push(ee);L.sort(u_);const $={};let te;for(let ee=0;ee<L.length;ee++){const ue=L[ee];if(ue===te)continue;te=ue;const ve=this.featureIndexArray.get(ue);let ce=null;this.loadMatchingFeature($,ve.bucketIndex,ve.sourceLayerIndex,ve.featureIndex,b,p.layers,p.availableImages,r,o,d,(_e,Le,ze)=>(ce||(ce=ga(_e)),Le.queryIntersectsFeature(M,_e,ze,ce,this.z,e.transform,y,e.pixelPosMatrix)))}return $}loadMatchingFeature(e,r,o,d,p,y,b,M,I,k,L){const N=this.bucketLayerIDs[r];if(y&&!function(ee,ue){for(let ve=0;ve<ee.length;ve++)if(ue.indexOf(ee[ve])>=0)return!0;return!1}(y,N))return;const V=this.sourceLayerCoder.decode(o),$=this.vtLayers[V].feature(d);if(p.needGeometry){const ee=_a($,!0);if(!p.filter(new Si(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!p.filter(new Si(this.tileID.overscaledZ),$))return;const te=this.getId($,V);for(let ee=0;ee<N.length;ee++){const ue=N[ee];if(y&&y.indexOf(ue)<0)continue;const ve=M[ue];if(!ve)continue;let ce={};te&&k&&(ce=k.getState(ve.sourceLayer||"_geojsonTileLayer",te));const _e=le({},I[ue]);_e.paint=Sf(_e.paint,ve.paint,$,ce,b),_e.layout=Sf(_e.layout,ve.layout,$,ce,b);const Le=!L||L($,ve,ce);if(!Le)continue;const ze=new Ef($,this.z,this.x,this.y,te);ze.layer=_e;let lt=e[ue];lt===void 0&&(lt=e[ue]=[]),lt.push({featureIndex:d,feature:ze,intersectionZ:Le})}}lookupSymbolFeatures(e,r,o,d,p,y,b,M){const I={};this.loadVTLayers();const k=Na(p);for(const L of e)this.loadMatchingFeature(I,o,d,L,k,y,b,M,r);return I}hasLayer(e){for(const r of this.bucketLayerIDs)for(const o of r)if(e===o)return!0;return!1}getId(e,r){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof o=="boolean"&&(o=Number(o))),o}}function Sf(i,e,r,o,d){return De(i,(p,y)=>{const b=e instanceof pa?e.get(y):null;return b&&b.evaluate?b.evaluate(r,o,d):b})}function If(i){let e=1/0,r=1/0,o=-1/0,d=-1/0;for(const p of i)e=Math.min(e,p.x),r=Math.min(r,p.y),o=Math.max(o,p.x),d=Math.max(d,p.y);return{minX:e,minY:r,maxX:o,maxY:d}}function u_(i,e){return e-i}var Tu;ct("FeatureIndex",Tf,{omit:["rawTileData","sourceLayerCoder"]}),a.PerformanceMarkers=void 0,(Tu=a.PerformanceMarkers||(a.PerformanceMarkers={})).create="create",Tu.load="load",Tu.fullLoad="fullLoad";let Kh=null,pl=[];const Su=1e3/30,d_={mark(i){performance.mark(i)},frame(i){const e=i;Kh!=null&&pl.push(e-Kh),Kh=e},clearMetrics(){Kh=null,pl=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in a.PerformanceMarkers)performance.clearMarks(a.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.load),performance.measure("fullLoadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,r=pl.length,o=1/(pl.reduce((p,y)=>p+y,0)/r/1e3),d=pl.filter(p=>p>Su).reduce((p,y)=>p+(y-Su)/Su,0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:d/(r+d)*100}}};a.AJAXError=Ot,a.ARRAY_TYPE=wr,a.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},fe(["receive","process"],this),this.invoker=new c_(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Pe()?i:window}send(i,e,r,o,d=!1){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[p]=r);const y=Mt(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:i,hasCallback:!!r,targetMapId:o,mustQueue:d,sourceMapId:this.mapId,data:ns(e,y)},y),{cancel:()=>{r&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];const o=this.cancelCallbacks[r];delete this.cancelCallbacks[r],o&&o()}else Pe()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Fn(e.error)):r(null,Fn(e.data)))}else{let r=!1;const o=Mt(this.globalScope)?void 0:[],d=e.hasCallback?(b,M)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:b?ns(b):null,data:ns(M,o)},o)}:b=>{r=!0};let p=null;const y=Fn(e.data);if(this.parent[e.type])p=this.parent[e.type](e.sourceMapId,y,d);else if(this.parent.getWorkerSource){const b=e.type.split(".");p=this.parent.getWorkerSource(e.sourceMapId,b[0],y.source)[b[1]](y,d)}else d(new Error(`Could not find function ${e.type}`));!r&&p&&p.cancel&&(this.cancelCallbacks[i]=p.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.AlphaImage=nl,a.CanonicalTileID=Eu,a.CollisionBoxArray=Ie,a.CollisionCircleLayoutArray=class extends z{},a.Color=j,a.DEMData=wf,a.DataConstantProperty=_t,a.DictionaryCoder=Mf,a.EXTENT=qi,a.ErrorEvent=vs,a.EvaluationParameters=Si,a.Event=_n,a.Evented=yn,a.FeatureIndex=Tf,a.FillBucket=ou,a.FillExtrusionBucket=hu,a.GeoJSONFeature=Ef,a.ImageAtlas=Wd,a.ImagePosition=fu,a.LineBucket=cu,a.LineStripIndexArray=class extends Y{},a.LngLat=Li,a.LngLatBounds=va,a.MercatorCoordinate=Xh,a.ONE_EM=ir,a.OverscaledTileID=en,a.PerformanceUtils=d_,a.PosArray=bt,a.Properties=tr,a.QuadTriangleArray=class extends U{},a.RGBAImage=Qr,a.RasterBoundsArray=class extends u{},a.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},a.ResourceType=Ht,a.SegmentVector=Gt,a.SymbolBucket=eo,a.Transitionable=Th,a.TriangleIndexArray=xr,a.Uniform1f=ls,a.Uniform1i=class extends os{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends os{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},a.Uniform3f=class extends os{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},a.Uniform4f=ja,a.UniformColor=cd,a.UniformMatrix4f=class extends os{constructor(i,e){super(i,e),this.current=Lm}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},a.UnwrappedTileID=bf,a.ValidationError=Ye,a.ZoomHistory=qo,a.add=function(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i},a.addDynamicAttributes=yu,a.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let o=i.length;const d=new Array(i.length);let p=null;i.forEach((y,b)=>{e(y,(M,I)=>{M&&(p=M),d[b]=I,--o==0&&r(p,d)})})},a.bezier=q,a.bindAll=fe,a.cacheEntryPossiblyAdded=function(i){At++,At>Ve&&(i.getActor().send("enforceCacheSizeLimit",Ge),At=0)},a.clamp=F,a.clearTileCache=function(i){const e=caches.delete(Ne);i&&e.catch(i).then(()=>i())},a.clipLine=of,a.clone=function(i){var e=new wr(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},a.clone$1=xe,a.clone$2=function(i){var e=new wr(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},a.collisionCircleLayout=kg,a.config=me,a.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.create=function(){var i=new wr(16);return wr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a.create$1=yd,a.createExpression=ea,a.createFilter=Na,a.createLayout=Ni,a.createStyleLayer=function(i){return i.type==="custom"?new l_(i):new h_[i.type](i)},a.cross=function(i,e,r){var o=e[0],d=e[1],p=e[2],y=r[0],b=r[1],M=r[2];return i[0]=d*M-p*b,i[1]=p*y-o*M,i[2]=o*b-d*y,i},a.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},a.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},a.ease=R,a.emitValidationErrors=Va,a.enforceCacheSizeLimit=function(i){st(),Re&&Re.then(e=>{e.keys().then(r=>{for(let o=0;o<r.length-i;o++)e.delete(r[o])})})},a.equals=function(i,e){var r=i[0],o=i[1],d=i[2],p=i[3],y=i[4],b=i[5],M=i[6],I=i[7],k=i[8],L=i[9],N=i[10],V=i[11],$=i[12],te=i[13],ee=i[14],ue=i[15],ve=e[0],ce=e[1],_e=e[2],Le=e[3],ze=e[4],lt=e[5],pt=e[6],tt=e[7],Je=e[8],Ze=e[9],it=e[10],Qe=e[11],$e=e[12],wt=e[13],yt=e[14],$t=e[15];return Math.abs(r-ve)<=br*Math.max(1,Math.abs(r),Math.abs(ve))&&Math.abs(o-ce)<=br*Math.max(1,Math.abs(o),Math.abs(ce))&&Math.abs(d-_e)<=br*Math.max(1,Math.abs(d),Math.abs(_e))&&Math.abs(p-Le)<=br*Math.max(1,Math.abs(p),Math.abs(Le))&&Math.abs(y-ze)<=br*Math.max(1,Math.abs(y),Math.abs(ze))&&Math.abs(b-lt)<=br*Math.max(1,Math.abs(b),Math.abs(lt))&&Math.abs(M-pt)<=br*Math.max(1,Math.abs(M),Math.abs(pt))&&Math.abs(I-tt)<=br*Math.max(1,Math.abs(I),Math.abs(tt))&&Math.abs(k-Je)<=br*Math.max(1,Math.abs(k),Math.abs(Je))&&Math.abs(L-Ze)<=br*Math.max(1,Math.abs(L),Math.abs(Ze))&&Math.abs(N-it)<=br*Math.max(1,Math.abs(N),Math.abs(it))&&Math.abs(V-Qe)<=br*Math.max(1,Math.abs(V),Math.abs(Qe))&&Math.abs($-$e)<=br*Math.max(1,Math.abs($),Math.abs($e))&&Math.abs(te-wt)<=br*Math.max(1,Math.abs(te),Math.abs(wt))&&Math.abs(ee-yt)<=br*Math.max(1,Math.abs(ee),Math.abs(yt))&&Math.abs(ue-$t)<=br*Math.max(1,Math.abs(ue),Math.abs($t))},a.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:o,upperSize:d}){return i.kind==="source"?o/us:i.kind==="composite"?Ei(o/us,d/us,r):e},a.evaluateSizeForZoom=function(i,e){let r=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:d,minZoom:p,maxZoom:y}=i,b=d?F(kr.interpolationFactor(d,e,p,y),0,1):0;i.kind==="camera"?o=Ei(i.minSize,i.maxSize,b):r=b}return{uSizeT:r,uSize:o}},a.evaluateVariableOffset=cf,a.evented=Ko,a.exported=K,a.exported$1=zt,a.extend=le,a.filterObject=Ee,a.fromRotation=function(i,e){var r=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=r,i[2]=0,i[3]=-r,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},a.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.getAnchorAlignment=mu,a.getAnchorJustification=_u,a.getArrayBuffer=Dn,a.getImage=yr,a.getJSON=function(i,e){return Xr(le(i,{type:"json"}),e)},a.getOverlapMode=wu,a.getRTLTextPluginStatus=da,a.getReferrer=Pi,a.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let o=0;o<i.length;o++){const d=window.document.createElement("source");Kn(i[o])||(r.crossOrigin="Anonymous"),d.src=i[o],r.appendChild(d)}return{cancel:()=>{}}},a.identity=Yc,a.invert=function(i,e){var r=e[0],o=e[1],d=e[2],p=e[3],y=e[4],b=e[5],M=e[6],I=e[7],k=e[8],L=e[9],N=e[10],V=e[11],$=e[12],te=e[13],ee=e[14],ue=e[15],ve=r*b-o*y,ce=r*M-d*y,_e=r*I-p*y,Le=o*M-d*b,ze=o*I-p*b,lt=d*I-p*M,pt=k*te-L*$,tt=k*ee-N*$,Je=k*ue-V*$,Ze=L*ee-N*te,it=L*ue-V*te,Qe=N*ue-V*ee,$e=ve*Qe-ce*it+_e*Ze+Le*Je-ze*tt+lt*pt;return $e?(i[0]=(b*Qe-M*it+I*Ze)*($e=1/$e),i[1]=(d*it-o*Qe-p*Ze)*$e,i[2]=(te*lt-ee*ze+ue*Le)*$e,i[3]=(N*ze-L*lt-V*Le)*$e,i[4]=(M*Je-y*Qe-I*tt)*$e,i[5]=(r*Qe-d*Je+p*tt)*$e,i[6]=(ee*_e-$*lt-ue*ce)*$e,i[7]=(k*lt-N*_e+V*ce)*$e,i[8]=(y*it-b*Je+I*pt)*$e,i[9]=(o*Je-r*it-p*pt)*$e,i[10]=($*ze-te*_e+ue*ve)*$e,i[11]=(L*_e-k*ze-V*ve)*$e,i[12]=(b*tt-y*Ze-M*pt)*$e,i[13]=(r*Ze-o*tt+d*pt)*$e,i[14]=(te*ce-$*Le-ee*ve)*$e,i[15]=(k*Le-L*ce+N*ve)*$e,i):null},a.isImageBitmap=D,a.isSafari=Mt,a.isWorker=Pe,a.keysDifference=function(i,e){const r=[];for(const o in i)o in e||r.push(o);return r},a.lazyLoadRTLTextPlugin=function(){qr.isLoading()||qr.isLoaded()||da()!=="deferred"||Eh()},a.makeRequest=Xr,a.mapObject=De,a.mercatorXfromLng=_f,a.mercatorYfromLat=yf,a.mercatorZfromAltitude=vf,a.mul=Vm,a.mul$1=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},a.multiply=vd,a.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},a.normalize=function(i,e){var r=e[0],o=e[1],d=e[2],p=r*r+o*o+d*d;return p>0&&(p=1/Math.sqrt(p)),i[0]=e[0]*p,i[1]=e[1]*p,i[2]=e[2]*p,i},a.number=Ei,a.ortho=function(i,e,r,o,d,p,y){var b=1/(e-r),M=1/(o-d),I=1/(p-y);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*M,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*I,i[11]=0,i[12]=(e+r)*b,i[13]=(d+o)*M,i[14]=(y+p)*I,i[15]=1,i},a.parseCacheControl=Se,a.parseGlyphPbf=function(i){return new uu(i).readFields(Vg,[])},a.pbf=uu,a.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=qi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0].layout,r=i.bucket.layers[0]._unevaluatedLayout._values,o={layoutIconSize:r["icon-size"].possiblyEvaluate(new Si(i.bucket.zoom+1),i.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Si(i.bucket.zoom+1),i.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Si(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:I}=i.bucket.textSizeData;o.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Si(M),i.canonical),r["text-size"].possiblyEvaluate(new Si(I),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:I}=i.bucket.iconSizeData;o.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Si(M),i.canonical),r["icon-size"].possiblyEvaluate(new Si(I),i.canonical)]}const d=e.get("text-line-height")*ir,p=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",y=e.get("text-keep-upright"),b=e.get("text-size");for(const M of i.bucket.features){const I=e.get("text-font").evaluate(M,{},i.canonical).join(","),k=b.evaluate(M,{},i.canonical),L=o.layoutTextSize.evaluate(M,{},i.canonical),N=o.layoutIconSize.evaluate(M,{},i.canonical),V={horizontal:{},vertical:void 0},$=M.text;let te,ee=[0,0];if($){const ce=$.toString(),_e=e.get("text-letter-spacing").evaluate(M,{},i.canonical)*ir,Le=Gc(ce)?_e:0,ze=e.get("text-anchor").evaluate(M,{},i.canonical),lt=e.get("text-variable-anchor");if(!lt){const it=e.get("text-radial-offset").evaluate(M,{},i.canonical);ee=it?cf(ze,[it*ir,gu]):e.get("text-offset").evaluate(M,{},i.canonical).map(Qe=>Qe*ir)}let pt=p?"center":e.get("text-justify").evaluate(M,{},i.canonical);const tt=e.get("symbol-placement"),Je=tt==="point"?e.get("text-max-width").evaluate(M,{},i.canonical)*ir:0,Ze=()=>{i.bucket.allowVerticalPlacement&&$a(ce)&&(V.vertical=Vh($,i.glyphMap,i.glyphPositions,i.imagePositions,I,Je,d,ze,"left",Le,ee,a.WritingMode.vertical,!0,tt,L,k))};if(!p&&lt){const it=pt==="auto"?lt.map($e=>_u($e)):[pt];let Qe=!1;for(let $e=0;$e<it.length;$e++){const wt=it[$e];if(!V.horizontal[wt])if(Qe)V.horizontal[wt]=V.horizontal[0];else{const yt=Vh($,i.glyphMap,i.glyphPositions,i.imagePositions,I,Je,d,"center",wt,Le,ee,a.WritingMode.horizontal,!1,tt,L,k);yt&&(V.horizontal[wt]=yt,Qe=yt.positionedLines.length===1)}}Ze()}else{pt==="auto"&&(pt=_u(ze));const it=Vh($,i.glyphMap,i.glyphPositions,i.imagePositions,I,Je,d,ze,pt,Le,ee,a.WritingMode.horizontal,!1,tt,L,k);it&&(V.horizontal[pt]=it),Ze(),$a(ce)&&p&&y&&(V.vertical=Vh($,i.glyphMap,i.glyphPositions,i.imagePositions,I,Je,d,ze,pt,Le,ee,a.WritingMode.vertical,!1,tt,L,k))}}let ue=!1;if(M.icon&&M.icon.name){const ce=i.imageMap[M.icon.name];ce&&(te=Hg(i.imagePositions[M.icon.name],e.get("icon-offset").evaluate(M,{},i.canonical),e.get("icon-anchor").evaluate(M,{},i.canonical)),ue=!!ce.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ue:i.bucket.sdfIcons!==ue&&qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ce.pixelRatio!==i.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ve=df(V.horizontal)||V.vertical;i.bucket.iconsInText=!!ve&&ve.iconsInText,(ve||te)&&e_(i.bucket,M,V,te,i.imageMap,o,L,N,ee,ue,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},a.perspective=function(i,e,r,o,d){var p,y=1/Math.tan(e/2);return i[0]=y/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,d!=null&&d!==1/0?(i[10]=(d+o)*(p=1/(o-d)),i[14]=2*d*o*p):(i[10]=-1,i[14]=-2*o),i},a.pick=function(i,e){const r={};for(let o=0;o<e.length;o++){const d=e[o];d in i&&(r[d]=i[d])}return r},a.plugin=qr,a.pointGeometry=H,a.polygonIntersectsPolygon=pd,a.potpack=Hd,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.register=ct,a.registerForPluginStateChange=function(i){return i({pluginStatus:vr,pluginURL:Nn}),Ko.on("pluginStateChange",i),i},a.renderColorRamp=Sd,a.rotateX=function(i,e,r){var o=Math.sin(r),d=Math.cos(r),p=e[4],y=e[5],b=e[6],M=e[7],I=e[8],k=e[9],L=e[10],N=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*d+I*o,i[5]=y*d+k*o,i[6]=b*d+L*o,i[7]=M*d+N*o,i[8]=I*d-p*o,i[9]=k*d-y*o,i[10]=L*d-b*o,i[11]=N*d-M*o,i},a.rotateZ=function(i,e,r){var o=Math.sin(r),d=Math.cos(r),p=e[0],y=e[1],b=e[2],M=e[3],I=e[4],k=e[5],L=e[6],N=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*d+I*o,i[1]=y*d+k*o,i[2]=b*d+L*o,i[3]=M*d+N*o,i[4]=I*d-p*o,i[5]=k*d-y*o,i[6]=L*d-b*o,i[7]=N*d-M*o,i},a.scale=function(i,e,r){var o=r[0],d=r[1],p=r[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*d,i[5]=e[5]*d,i[6]=e[6]*d,i[7]=e[7]*d,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i},a.setCacheLimits=function(i,e){Ge=i,Ve=e},a.setRTLTextPlugin=function(i,e,r=!1){if(vr===Zo||vr===Ho||vr===Wo)throw new Error("setRTLTextPlugin cannot be called multiple times.");Nn=K.resolveURL(i),vr=Zo,Xo=e,Ls(),r||Eh()},a.spec=ke,a.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},a.sqrLen=function(i){var e=i[0],r=i[1];return e*e+r*r},a.sub=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},a.toEvaluationFeature=_a,a.transformMat3=function(i,e,r){var o=e[0],d=e[1],p=e[2];return i[0]=o*r[0]+d*r[3]+p*r[6],i[1]=o*r[1]+d*r[4]+p*r[7],i[2]=o*r[2]+d*r[5]+p*r[8],i},a.transformMat4=Lh,a.transformMat4$1=function(i,e,r){var o=e[0],d=e[1];return i[0]=r[0]*o+r[4]*d+r[12],i[1]=r[1]*o+r[5]*d+r[13],i},a.translate=function(i,e,r){var o,d,p,y,b,M,I,k,L,N,V,$,te=r[0],ee=r[1],ue=r[2];return e===i?(i[12]=e[0]*te+e[4]*ee+e[8]*ue+e[12],i[13]=e[1]*te+e[5]*ee+e[9]*ue+e[13],i[14]=e[2]*te+e[6]*ee+e[10]*ue+e[14],i[15]=e[3]*te+e[7]*ee+e[11]*ue+e[15]):(d=e[1],p=e[2],y=e[3],b=e[4],M=e[5],I=e[6],k=e[7],L=e[8],N=e[9],V=e[10],$=e[11],i[0]=o=e[0],i[1]=d,i[2]=p,i[3]=y,i[4]=b,i[5]=M,i[6]=I,i[7]=k,i[8]=L,i[9]=N,i[10]=V,i[11]=$,i[12]=o*te+b*ee+L*ue+e[12],i[13]=d*te+M*ee+N*ue+e[13],i[14]=p*te+I*ee+V*ue+e[14],i[15]=y*te+k*ee+$*ue+e[15]),i},a.triggerPluginCompletionEvent=Mh,a.unicodeBlockLookup=et,a.uniqueId=function(){return de++},a.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateLight=$o,a.validateStyle=ca,a.vectorTile=Os,a.warnOnce=qe,a.wrap=Q}),x(["./shared"],function(a){function S(Z){const C=typeof Z;if(C==="number"||C==="boolean"||C==="string"||Z==null)return JSON.stringify(Z);if(Array.isArray(Z)){let j="[";for(const ie of Z)j+=`${S(ie)},`;return`${j}]`}const B=Object.keys(Z).sort();let G="{";for(let j=0;j<B.length;j++)G+=`${JSON.stringify(B[j])}:${S(Z[B[j]])},`;return`${G}}`}function P(Z){let C="";for(const B of a.refProperties)C+=`/${S(Z[B])}`;return C}class q{constructor(C){this.keyCache={},C&&this.replace(C)}replace(C){this._layerConfigs={},this._layers={},this.update(C,[])}update(C,B){for(const j of C){this._layerConfigs[j.id]=j;const ie=this._layers[j.id]=a.createStyleLayer(j);ie._featureFilter=a.createFilter(ie.filter),this.keyCache[j.id]&&delete this.keyCache[j.id]}for(const j of B)delete this.keyCache[j],delete this._layerConfigs[j],delete this._layers[j];this.familiesBySource={};const G=function(j,ie){const ae={};for(let re=0;re<j.length;re++){const oe=ie&&ie[j[re].id]||P(j[re]);ie&&(ie[j[re].id]=oe);let we=ae[oe];we||(we=ae[oe]=[]),we.push(j[re])}const ne=[];for(const re in ae)ne.push(ae[re]);return ne}(Object.values(this._layerConfigs),this.keyCache);for(const j of G){const ie=j.map(Oe=>this._layers[Oe.id]),ae=ie[0];if(ae.visibility==="none")continue;const ne=ae.source||"";let re=this.familiesBySource[ne];re||(re=this.familiesBySource[ne]={});const oe=ae.sourceLayer||"_geojsonTileLayer";let we=re[oe];we||(we=re[oe]=[]),we.push(ie)}}}class R{constructor(C){const B={},G=[];for(const ne in C){const re=C[ne],oe=B[ne]={};for(const we in re){const Oe=re[+we];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const be={x:0,y:0,w:Oe.bitmap.width+2,h:Oe.bitmap.height+2};G.push(be),oe[we]={rect:be,metrics:Oe.metrics}}}const{w:j,h:ie}=a.potpack(G),ae=new a.AlphaImage({width:j||1,height:ie||1});for(const ne in C){const re=C[ne];for(const oe in re){const we=re[+oe];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const Oe=B[ne][oe].rect;a.AlphaImage.copy(we.bitmap,ae,{x:0,y:0},{x:Oe.x+1,y:Oe.y+1},we.bitmap)}}this.image=ae,this.positions=B}}a.register("GlyphAtlas",R);class F{constructor(C){this.tileID=new a.OverscaledTileID(C.tileID.overscaledZ,C.tileID.wrap,C.tileID.canonical.z,C.tileID.canonical.x,C.tileID.canonical.y),this.uid=C.uid,this.zoom=C.zoom,this.pixelRatio=C.pixelRatio,this.tileSize=C.tileSize,this.source=C.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=C.showCollisionBoxes,this.collectResourceTiming=!!C.collectResourceTiming,this.returnDependencies=!!C.returnDependencies,this.promoteId=C.promoteId}parse(C,B,G,j,ie){this.status="parsing",this.data=C,this.collisionBoxArray=new a.CollisionBoxArray;const ae=new a.DictionaryCoder(Object.keys(C.layers).sort()),ne=new a.FeatureIndex(this.tileID,this.promoteId);ne.bucketLayerIDs=[];const re={},oe={featureIndex:ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:G},we=B.familiesBySource[this.source];for(const kt in we){const Ut=C.layers[kt];if(!Ut)continue;Ut.version===1&&a.warnOnce(`Vector tile source "${this.source}" layer "${kt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Qt=ae.encode(kt),fi=[];for(let Hi=0;Hi<Ut.length;Hi++){const Mi=Ut.feature(Hi),rr=ne.getId(Mi,kt);fi.push({feature:Mi,id:rr,index:Hi,sourceLayerIndex:Qt})}for(const Hi of we[kt]){const Mi=Hi[0];Mi.source!==this.source&&a.warnOnce(`layer.source = ${Mi.source} does not equal this.source = ${this.source}`),Mi.minzoom&&this.zoom<Math.floor(Mi.minzoom)||Mi.maxzoom&&this.zoom>=Mi.maxzoom||Mi.visibility!=="none"&&(Q(Hi,this.zoom,G),(re[Mi.id]=Mi.createBucket({index:ne.bucketLayerIDs.length,layers:Hi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qt,sourceID:this.source})).populate(fi,oe,this.tileID.canonical),ne.bucketLayerIDs.push(Hi.map(rr=>rr.id)))}}let Oe,be,ft,mt;const rt=a.mapObject(oe.glyphDependencies,kt=>Object.keys(kt).map(Number));Object.keys(rt).length?j.send("getGlyphs",{uid:this.uid,stacks:rt},(kt,Ut)=>{Oe||(Oe=kt,be=Ut,Yt.call(this))}):be={};const Et=Object.keys(oe.iconDependencies);Et.length?j.send("getImages",{icons:Et,source:this.source,tileID:this.tileID,type:"icons"},(kt,Ut)=>{Oe||(Oe=kt,ft=Ut,Yt.call(this))}):ft={};const Ct=Object.keys(oe.patternDependencies);function Yt(){if(Oe)return ie(Oe);if(be&&ft&&mt){const kt=new R(be),Ut=new a.ImageAtlas(ft,mt);for(const Qt in re){const fi=re[Qt];fi instanceof a.SymbolBucket?(Q(fi.layers,this.zoom,G),a.performSymbolLayout({bucket:fi,glyphMap:be,glyphPositions:kt.positions,imageMap:ft,imagePositions:Ut.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):fi.hasPattern&&(fi instanceof a.LineBucket||fi instanceof a.FillBucket||fi instanceof a.FillExtrusionBucket)&&(Q(fi.layers,this.zoom,G),fi.addFeatures(oe,this.tileID.canonical,Ut.patternPositions))}this.status="done",ie(null,{buckets:Object.values(re).filter(Qt=>!Qt.isEmpty()),featureIndex:ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:kt.image,imageAtlas:Ut,glyphMap:this.returnDependencies?be:null,iconMap:this.returnDependencies?ft:null,glyphPositions:this.returnDependencies?kt.positions:null})}}Ct.length?j.send("getImages",{icons:Ct,source:this.source,tileID:this.tileID,type:"patterns"},(kt,Ut)=>{Oe||(Oe=kt,mt=Ut,Yt.call(this))}):mt={},Yt.call(this)}}function Q(Z,C,B){const G=new a.EvaluationParameters(C);for(const j of Z)j.recalculate(G,B)}function le(Z,C){const B=a.getArrayBuffer(Z.request,(G,j,ie,ae)=>{G?C(G):j&&C(null,{vectorTile:new a.vectorTile.VectorTile(new a.pbf(j)),rawData:j,cacheControl:ie,expires:ae})});return()=>{B.cancel(),C()}}class de{constructor(C,B,G,j){this.actor=C,this.layerIndex=B,this.availableImages=G,this.loadVectorData=j||le,this.loading={},this.loaded={}}loadTile(C,B){const G=C.uid;this.loading||(this.loading={});const j=!!(C&&C.request&&C.request.collectResourceTiming)&&new a.RequestPerformance(C.request),ie=this.loading[G]=new F(C);ie.abort=this.loadVectorData(C,(ae,ne)=>{if(delete this.loading[G],ae||!ne)return ie.status="done",this.loaded[G]=ie,B(ae);const re=ne.rawData,oe={};ne.expires&&(oe.expires=ne.expires),ne.cacheControl&&(oe.cacheControl=ne.cacheControl);const we={};if(j){const Oe=j.finish();Oe&&(we.resourceTiming=JSON.parse(JSON.stringify(Oe)))}ie.vectorTile=ne.vectorTile,ie.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,(Oe,be)=>{if(Oe||!be)return B(Oe);B(null,a.extend({rawTileData:re.slice(0)},be,oe,we))}),this.loaded=this.loaded||{},this.loaded[G]=ie})}reloadTile(C,B){const G=this.loaded,j=C.uid,ie=this;if(G&&G[j]){const ae=G[j];ae.showCollisionBoxes=C.showCollisionBoxes;const ne=(re,oe)=>{const we=ae.reloadCallback;we&&(delete ae.reloadCallback,ae.parse(ae.vectorTile,ie.layerIndex,this.availableImages,ie.actor,we)),B(re,oe)};ae.status==="parsing"?ae.reloadCallback=ne:ae.status==="done"&&(ae.vectorTile?ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,ne):ne())}}abortTile(C,B){const G=this.loading,j=C.uid;G&&G[j]&&G[j].abort&&(G[j].abort(),delete G[j]),B()}removeTile(C,B){const G=this.loaded,j=C.uid;G&&G[j]&&delete G[j],B()}}class fe{constructor(){this.loaded={}}loadTile(C,B){const{uid:G,encoding:j,rawImageData:ie}=C,ae=a.isImageBitmap(ie)?this.getImageData(ie):ie,ne=new a.DEMData(G,ae,j);this.loaded=this.loaded||{},this.loaded[G]=ne,B(null,ne)}getImageData(C){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(C.width,C.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=C.width,this.offscreenCanvas.height=C.height,this.offscreenCanvasContext.drawImage(C,0,0,C.width,C.height);const B=this.offscreenCanvasContext.getImageData(-1,-1,C.width+2,C.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:B.width,height:B.height},B.data)}removeTile(C){const B=this.loaded,G=C.uid;B&&B[G]&&delete B[G]}}var De=function Z(C,B){var G,j=C&&C.type;if(j==="FeatureCollection")for(G=0;G<C.features.length;G++)Z(C.features[G],B);else if(j==="GeometryCollection")for(G=0;G<C.geometries.length;G++)Z(C.geometries[G],B);else if(j==="Feature")Z(C.geometry,B);else if(j==="Polygon")Ee(C.coordinates,B);else if(j==="MultiPolygon")for(G=0;G<C.coordinates.length;G++)Ee(C.coordinates[G],B);return C};function Ee(Z,C){if(Z.length!==0){xe(Z[0],C);for(var B=1;B<Z.length;B++)xe(Z[B],!C)}}function xe(Z,C){for(var B=0,G=0,j=0,ie=Z.length,ae=ie-1;j<ie;ae=j++){var ne=(Z[j][0]-Z[ae][0])*(Z[ae][1]+Z[j][1]),re=B+ne;G+=Math.abs(B)>=Math.abs(ne)?B-re+ne:ne-re+B,B=re}B+G>=0!=!!C&&Z.reverse()}const Te=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class qe{constructor(C){this._feature=C,this.extent=a.EXTENT,this.type=C.type,this.properties=C.tags,"id"in C&&!isNaN(C.id)&&(this.id=parseInt(C.id,10))}loadGeometry(){if(this._feature.type===1){const C=[];for(const B of this._feature.geometry)C.push([new a.pointGeometry(B[0],B[1])]);return C}{const C=[];for(const B of this._feature.geometry){const G=[];for(const j of B)G.push(new a.pointGeometry(j[0],j[1]));C.push(G)}return C}}toGeoJSON(C,B,G){return Te.call(this,C,B,G)}}class nt{constructor(C){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=C.length,this._features=C}feature(C){return new qe(this._features[C])}}var Fe={exports:{}},Pe=a.pointGeometry,Se=a.vectorTile.VectorTileFeature,He=Lt;function Lt(Z,C){this.options=C||{},this.features=Z,this.length=Z.length}function It(Z,C){this.id=typeof Z.id=="number"?Z.id:void 0,this.type=Z.type,this.rawGeometry=Z.type===1?[Z.geometry]:Z.geometry,this.properties=Z.tags,this.extent=C||4096}Lt.prototype.feature=function(Z){return new It(this.features[Z],this.options.extent)},It.prototype.loadGeometry=function(){var Z=this.rawGeometry;this.geometry=[];for(var C=0;C<Z.length;C++){for(var B=Z[C],G=[],j=0;j<B.length;j++)G.push(new Pe(B[j][0],B[j][1]));this.geometry.push(G)}return this.geometry},It.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Z=this.geometry,C=1/0,B=-1/0,G=1/0,j=-1/0,ie=0;ie<Z.length;ie++)for(var ae=Z[ie],ne=0;ne<ae.length;ne++){var re=ae[ne];C=Math.min(C,re.x),B=Math.max(B,re.x),G=Math.min(G,re.y),j=Math.max(j,re.y)}return[C,G,B,j]},It.prototype.toGeoJSON=Se.prototype.toGeoJSON;var Mt=a.pbf,D=He;function K(Z){var C=new Mt;return function(B,G){for(var j in B.layers)G.writeMessage(3,H,B.layers[j])}(Z,C),C.finish()}function H(Z,C){var B;C.writeVarintField(15,Z.version||1),C.writeStringField(1,Z.name||""),C.writeVarintField(5,Z.extent||4096);var G={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<Z.length;B++)G.feature=Z.feature(B),C.writeMessage(2,Be,G);var j=G.keys;for(B=0;B<j.length;B++)C.writeStringField(3,j[B]);var ie=G.values;for(B=0;B<ie.length;B++)C.writeMessage(4,Ge,ie[B])}function Be(Z,C){var B=Z.feature;B.id!==void 0&&C.writeVarintField(1,B.id),C.writeMessage(2,me,Z),C.writeVarintField(3,B.type),C.writeMessage(4,Ce,B)}function me(Z,C){var B=Z.feature,G=Z.keys,j=Z.values,ie=Z.keycache,ae=Z.valuecache;for(var ne in B.properties){var re=B.properties[ne],oe=ie[ne];if(re!==null){oe===void 0&&(G.push(ne),ie[ne]=oe=G.length-1),C.writeVarint(oe);var we=typeof re;we!=="string"&&we!=="boolean"&&we!=="number"&&(re=JSON.stringify(re));var Oe=we+":"+re,be=ae[Oe];be===void 0&&(j.push(re),ae[Oe]=be=j.length-1),C.writeVarint(be)}}}function Ne(Z,C){return(C<<3)+(7&Z)}function Re(Z){return Z<<1^Z>>31}function Ce(Z,C){for(var B=Z.loadGeometry(),G=Z.type,j=0,ie=0,ae=B.length,ne=0;ne<ae;ne++){var re=B[ne],oe=1;G===1&&(oe=re.length),C.writeVarint(Ne(1,oe));for(var we=G===3?re.length-1:re.length,Oe=0;Oe<we;Oe++){Oe===1&&G!==1&&C.writeVarint(Ne(2,we-1));var be=re[Oe].x-j,ft=re[Oe].y-ie;C.writeVarint(Re(be)),C.writeVarint(Re(ft)),j+=be,ie+=ft}G===3&&C.writeVarint(Ne(7,1))}}function Ge(Z,C){var B=typeof Z;B==="string"?C.writeStringField(1,Z):B==="boolean"?C.writeBooleanField(7,Z):B==="number"&&(Z%1!=0?C.writeDoubleField(3,Z):Z<0?C.writeSVarintField(6,Z):C.writeVarintField(5,Z))}function Ve(Z,C,B,G,j,ie){if(j-G<=B)return;const ae=G+j>>1;st(Z,C,ae,G,j,ie%2),Ve(Z,C,B,G,ae-1,ie+1),Ve(Z,C,B,ae+1,j,ie+1)}function st(Z,C,B,G,j,ie){for(;j>G;){if(j-G>600){const oe=j-G+1,we=B-G+1,Oe=Math.log(oe),be=.5*Math.exp(2*Oe/3),ft=.5*Math.sqrt(Oe*be*(oe-be)/oe)*(we-oe/2<0?-1:1);st(Z,C,B,Math.max(G,Math.floor(B-we*be/oe+ft)),Math.min(j,Math.floor(B+(oe-we)*be/oe+ft)),ie)}const ae=C[2*B+ie];let ne=G,re=j;for(At(Z,C,G,B),C[2*j+ie]>ae&&At(Z,C,G,j);ne<re;){for(At(Z,C,ne,re),ne++,re--;C[2*ne+ie]<ae;)ne++;for(;C[2*re+ie]>ae;)re--}C[2*G+ie]===ae?At(Z,C,G,re):(re++,At(Z,C,re,j)),re<=B&&(G=re+1),B<=re&&(j=re-1)}}function At(Z,C,B,G){zt(Z,B,G),zt(C,2*B,2*G),zt(C,2*B+1,2*G+1)}function zt(Z,C,B){const G=Z[C];Z[C]=Z[B],Z[B]=G}function St(Z,C,B,G){const j=Z-B,ie=C-G;return j*j+ie*ie}Fe.exports=K,Fe.exports.fromVectorTileJs=K,Fe.exports.fromGeojsonVt=function(Z,C){C=C||{};var B={};for(var G in Z)B[G]=new D(Z[G].features,C),B[G].name=G,B[G].version=C.version,B[G].extent=C.extent;return K({layers:B})},Fe.exports.GeoJSONWrapper=D;const Ft=Z=>Z[0],ii=Z=>Z[1];class ri{constructor(C,B=Ft,G=ii,j=64,ie=Float64Array){this.nodeSize=j,this.points=C;const ae=C.length<65536?Uint16Array:Uint32Array,ne=this.ids=new ae(C.length),re=this.coords=new ie(2*C.length);for(let oe=0;oe<C.length;oe++)ne[oe]=oe,re[2*oe]=B(C[oe]),re[2*oe+1]=G(C[oe]);Ve(ne,re,j,0,ne.length-1,0)}range(C,B,G,j){return function(ie,ae,ne,re,oe,we,Oe){const be=[0,ie.length-1,0],ft=[];let mt,rt;for(;be.length;){const Et=be.pop(),Ct=be.pop(),Yt=be.pop();if(Ct-Yt<=Oe){for(let Qt=Yt;Qt<=Ct;Qt++)mt=ae[2*Qt],rt=ae[2*Qt+1],mt>=ne&&mt<=oe&&rt>=re&&rt<=we&&ft.push(ie[Qt]);continue}const kt=Math.floor((Yt+Ct)/2);mt=ae[2*kt],rt=ae[2*kt+1],mt>=ne&&mt<=oe&&rt>=re&&rt<=we&&ft.push(ie[kt]);const Ut=(Et+1)%2;(Et===0?ne<=mt:re<=rt)&&(be.push(Yt),be.push(kt-1),be.push(Ut)),(Et===0?oe>=mt:we>=rt)&&(be.push(kt+1),be.push(Ct),be.push(Ut))}return ft}(this.ids,this.coords,C,B,G,j,this.nodeSize)}within(C,B,G){return function(j,ie,ae,ne,re,oe){const we=[0,j.length-1,0],Oe=[],be=re*re;for(;we.length;){const ft=we.pop(),mt=we.pop(),rt=we.pop();if(mt-rt<=oe){for(let Ut=rt;Ut<=mt;Ut++)St(ie[2*Ut],ie[2*Ut+1],ae,ne)<=be&&Oe.push(j[Ut]);continue}const Et=Math.floor((rt+mt)/2),Ct=ie[2*Et],Yt=ie[2*Et+1];St(Ct,Yt,ae,ne)<=be&&Oe.push(j[Et]);const kt=(ft+1)%2;(ft===0?ae-re<=Ct:ne-re<=Yt)&&(we.push(rt),we.push(Et-1),we.push(kt)),(ft===0?ae+re>=Ct:ne+re>=Yt)&&(we.push(Et+1),we.push(mt),we.push(kt))}return Oe}(this.ids,this.coords,C,B,G,this.nodeSize)}}const Bt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Z=>Z},Ht=Math.fround||(Ot=new Float32Array(1),Z=>(Ot[0]=+Z,Ot[0]));var Ot;class Pi{constructor(C){this.options=yr(Object.create(Bt),C),this.trees=new Array(this.options.maxZoom+1)}load(C){const{log:B,minZoom:G,maxZoom:j,nodeSize:ie}=this.options;B&&console.time("total time");const ae=`prepare ${C.length} points`;B&&console.time(ae),this.points=C;let ne=[];for(let re=0;re<C.length;re++)C[re].geometry&&ne.push(Xr(C[re],re));this.trees[j+1]=new ri(ne,mn,gn,ie,Float32Array),B&&console.timeEnd(ae);for(let re=j;re>=G;re--){const oe=+Date.now();ne=this._cluster(ne,re),this.trees[re]=new ri(ne,mn,gn,ie,Float32Array),B&&console.log("z%d: %d clusters in %dms",re,ne.length,+Date.now()-oe)}return B&&console.timeEnd("total time"),this}getClusters(C,B){let G=((C[0]+180)%360+360)%360-180;const j=Math.max(-90,Math.min(90,C[1]));let ie=C[2]===180?180:((C[2]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,C[3]));if(C[2]-C[0]>=360)G=-180,ie=180;else if(G>ie){const we=this.getClusters([G,j,180,ae],B),Oe=this.getClusters([-180,j,ie,ae],B);return we.concat(Oe)}const ne=this.trees[this._limitZoom(B)],re=ne.range(Wt(G),_r(ae),Wt(ie),_r(j)),oe=[];for(const we of re){const Oe=ne.points[we];oe.push(Oe.numPoints?Dn(Oe):this.points[Oe.index])}return oe}getChildren(C){const B=this._getOriginId(C),G=this._getOriginZoom(C),j="No cluster with the specified id.",ie=this.trees[G];if(!ie)throw new Error(j);const ae=ie.points[B];if(!ae)throw new Error(j);const ne=this.options.radius/(this.options.extent*Math.pow(2,G-1)),re=ie.within(ae.x,ae.y,ne),oe=[];for(const we of re){const Oe=ie.points[we];Oe.parentId===C&&oe.push(Oe.numPoints?Dn(Oe):this.points[Oe.index])}if(oe.length===0)throw new Error(j);return oe}getLeaves(C,B,G){const j=[];return this._appendLeaves(j,C,B=B||10,G=G||0,0),j}getTile(C,B,G){const j=this.trees[this._limitZoom(C)],ie=Math.pow(2,C),{extent:ae,radius:ne}=this.options,re=ne/ae,oe=(G-re)/ie,we=(G+1+re)/ie,Oe={features:[]};return this._addTileFeatures(j.range((B-re)/ie,oe,(B+1+re)/ie,we),j.points,B,G,ie,Oe),B===0&&this._addTileFeatures(j.range(1-re/ie,oe,1,we),j.points,ie,G,ie,Oe),B===ie-1&&this._addTileFeatures(j.range(0,oe,re/ie,we),j.points,-1,G,ie,Oe),Oe.features.length?Oe:null}getClusterExpansionZoom(C){let B=this._getOriginZoom(C)-1;for(;B<=this.options.maxZoom;){const G=this.getChildren(C);if(B++,G.length!==1)break;C=G[0].properties.cluster_id}return B}_appendLeaves(C,B,G,j,ie){const ae=this.getChildren(B);for(const ne of ae){const re=ne.properties;if(re&&re.cluster?ie+re.point_count<=j?ie+=re.point_count:ie=this._appendLeaves(C,re.cluster_id,G,j,ie):ie<j?ie++:C.push(ne),C.length===G)break}return ie}_addTileFeatures(C,B,G,j,ie,ae){for(const ne of C){const re=B[ne],oe=re.numPoints;let we,Oe,be;if(oe)we=Kn(re),Oe=re.x,be=re.y;else{const rt=this.points[re.index];we=rt.properties,Oe=Wt(rt.geometry.coordinates[0]),be=_r(rt.geometry.coordinates[1])}const ft={type:1,geometry:[[Math.round(this.options.extent*(Oe*ie-G)),Math.round(this.options.extent*(be*ie-j))]],tags:we};let mt;oe?mt=re.id:this.options.generateId?mt=re.index:this.points[re.index].id&&(mt=this.points[re.index].id),mt!==void 0&&(ft.id=mt),ae.features.push(ft)}}_limitZoom(C){return Math.max(this.options.minZoom,Math.min(Math.floor(+C),this.options.maxZoom+1))}_cluster(C,B){const G=[],{radius:j,extent:ie,reduce:ae,minPoints:ne}=this.options,re=j/(ie*Math.pow(2,B));for(let oe=0;oe<C.length;oe++){const we=C[oe];if(we.zoom<=B)continue;we.zoom=B;const Oe=this.trees[B+1],be=Oe.within(we.x,we.y,re),ft=we.numPoints||1;let mt=ft;for(const rt of be){const Et=Oe.points[rt];Et.zoom>B&&(mt+=Et.numPoints||1)}if(mt>ft&&mt>=ne){let rt=we.x*ft,Et=we.y*ft,Ct=ae&&ft>1?this._map(we,!0):null;const Yt=(oe<<5)+(B+1)+this.points.length;for(const kt of be){const Ut=Oe.points[kt];if(Ut.zoom<=B)continue;Ut.zoom=B;const Qt=Ut.numPoints||1;rt+=Ut.x*Qt,Et+=Ut.y*Qt,Ut.parentId=Yt,ae&&(Ct||(Ct=this._map(we,!0)),ae(Ct,this._map(Ut)))}we.parentId=Yt,G.push(Vr(rt/mt,Et/mt,Yt,mt,Ct))}else if(G.push(we),mt>1)for(const rt of be){const Et=Oe.points[rt];Et.zoom<=B||(Et.zoom=B,G.push(Et))}}return G}_getOriginId(C){return C-this.points.length>>5}_getOriginZoom(C){return(C-this.points.length)%32}_map(C,B){if(C.numPoints)return B?yr({},C.properties):C.properties;const G=this.points[C.index].properties,j=this.options.map(G);return B&&j===G?yr({},j):j}}function Vr(Z,C,B,G,j){return{x:Ht(Z),y:Ht(C),zoom:1/0,id:B,parentId:-1,numPoints:G,properties:j}}function Xr(Z,C){const[B,G]=Z.geometry.coordinates;return{x:Ht(Wt(B)),y:Ht(_r(G)),zoom:1/0,index:C,parentId:-1}}function Dn(Z){return{type:"Feature",id:Z.id,properties:Kn(Z),geometry:{type:"Point",coordinates:[(C=Z.x,360*(C-.5)),lr(Z.y)]}};var C}function Kn(Z){const C=Z.numPoints,B=C>=1e4?`${Math.round(C/1e3)}k`:C>=1e3?Math.round(C/100)/10+"k":C;return yr(yr({},Z.properties),{cluster:!0,cluster_id:Z.id,point_count:C,point_count_abbreviated:B})}function Wt(Z){return Z/360+.5}function _r(Z){const C=Math.sin(Z*Math.PI/180),B=.5-.25*Math.log((1+C)/(1-C))/Math.PI;return B<0?0:B>1?1:B}function lr(Z){const C=(180-360*Z)*Math.PI/180;return 360*Math.atan(Math.exp(C))/Math.PI-90}function yr(Z,C){for(const B in C)Z[B]=C[B];return Z}function mn(Z){return Z.x}function gn(Z){return Z.y}function _n(Z,C,B,G){for(var j,ie=G,ae=B-C>>1,ne=B-C,re=Z[C],oe=Z[C+1],we=Z[B],Oe=Z[B+1],be=C+3;be<B;be+=3){var ft=vs(Z[be],Z[be+1],re,oe,we,Oe);if(ft>ie)j=be,ie=ft;else if(ft===ie){var mt=Math.abs(be-ae);mt<ne&&(j=be,ne=mt)}}ie>G&&(j-C>3&&_n(Z,C,j,G),Z[j+2]=ie,B-j>3&&_n(Z,j,B,G))}function vs(Z,C,B,G,j,ie){var ae=j-B,ne=ie-G;if(ae!==0||ne!==0){var re=((Z-B)*ae+(C-G)*ne)/(ae*ae+ne*ne);re>1?(B=j,G=ie):re>0&&(B+=ae*re,G+=ne*re)}return(ae=Z-B)*ae+(ne=C-G)*ne}function yn(Z,C,B,G){var j={id:Z===void 0?null:Z,type:C,geometry:B,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ie){var ae=ie.geometry,ne=ie.type;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")ke(ie,ae);else if(ne==="Polygon"||ne==="MultiLineString")for(var re=0;re<ae.length;re++)ke(ie,ae[re]);else if(ne==="MultiPolygon")for(re=0;re<ae.length;re++)for(var oe=0;oe<ae[re].length;oe++)ke(ie,ae[re][oe])}(j),j}function ke(Z,C){for(var B=0;B<C.length;B+=3)Z.minX=Math.min(Z.minX,C[B]),Z.minY=Math.min(Z.minY,C[B+1]),Z.maxX=Math.max(Z.maxX,C[B]),Z.maxY=Math.max(Z.maxY,C[B+1])}function Ye(Z,C,B,G){if(C.geometry){var j=C.geometry.coordinates,ie=C.geometry.type,ae=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),ne=[],re=C.id;if(B.promoteId?re=C.properties[B.promoteId]:B.generateId&&(re=G||0),ie==="Point")Jn(j,ne);else if(ie==="MultiPoint")for(var oe=0;oe<j.length;oe++)Jn(j[oe],ne);else if(ie==="LineString")Kr(j,ne,ae,!1);else if(ie==="MultiLineString"){if(B.lineMetrics){for(oe=0;oe<j.length;oe++)Kr(j[oe],ne=[],ae,!1),Z.push(yn(re,"LineString",ne,C.properties));return}Jt(j,ne,ae,!1)}else if(ie==="Polygon")Jt(j,ne,ae,!0);else{if(ie!=="MultiPolygon"){if(ie==="GeometryCollection"){for(oe=0;oe<C.geometry.geometries.length;oe++)Ye(Z,{id:re,geometry:C.geometry.geometries[oe],properties:C.properties},B,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(oe=0;oe<j.length;oe++){var we=[];Jt(j[oe],we,ae,!0),ne.push(we)}}Z.push(yn(re,ie,ne,C.properties))}}function Jn(Z,C){C.push($r(Z[0])),C.push(Ar(Z[1])),C.push(0)}function Kr(Z,C,B,G){for(var j,ie,ae=0,ne=0;ne<Z.length;ne++){var re=$r(Z[ne][0]),oe=Ar(Z[ne][1]);C.push(re),C.push(oe),C.push(0),ne>0&&(ae+=G?(j*oe-re*ie)/2:Math.sqrt(Math.pow(re-j,2)+Math.pow(oe-ie,2))),j=re,ie=oe}var we=C.length-3;C[2]=1,_n(C,0,we,B),C[we+2]=1,C.size=Math.abs(ae),C.start=0,C.end=C.size}function Jt(Z,C,B,G){for(var j=0;j<Z.length;j++){var ie=[];Kr(Z[j],ie,B,G),C.push(ie)}}function $r(Z){return Z/360+.5}function Ar(Z){var C=Math.sin(Z*Math.PI/180),B=.5-.25*Math.log((1+C)/(1-C))/Math.PI;return B<0?0:B>1?1:B}function Cr(Z,C,B,G,j,ie,ae,ne){if(G/=C,ie>=(B/=C)&&ae<G)return Z;if(ae<B||ie>=G)return null;for(var re=[],oe=0;oe<Z.length;oe++){var we=Z[oe],Oe=we.geometry,be=we.type,ft=j===0?we.minX:we.minY,mt=j===0?we.maxX:we.maxY;if(ft>=B&&mt<G)re.push(we);else if(!(mt<B||ft>=G)){var rt=[];if(be==="Point"||be==="MultiPoint")Rn(Oe,rt,B,G,j);else if(be==="LineString")Xe(Oe,rt,B,G,j,!1,ne.lineMetrics);else if(be==="MultiLineString")Dt(Oe,rt,B,G,j,!1);else if(be==="Polygon")Dt(Oe,rt,B,G,j,!0);else if(be==="MultiPolygon")for(var Et=0;Et<Oe.length;Et++){var Ct=[];Dt(Oe[Et],Ct,B,G,j,!0),Ct.length&&rt.push(Ct)}if(rt.length){if(ne.lineMetrics&&be==="LineString"){for(Et=0;Et<rt.length;Et++)re.push(yn(we.id,be,rt[Et],we.tags));continue}be!=="LineString"&&be!=="MultiLineString"||(rt.length===1?(be="LineString",rt=rt[0]):be="MultiLineString"),be!=="Point"&&be!=="MultiPoint"||(be=rt.length===3?"Point":"MultiPoint"),re.push(yn(we.id,be,rt,we.tags))}}}return re.length?re:null}function Rn(Z,C,B,G,j){for(var ie=0;ie<Z.length;ie+=3){var ae=Z[ie+j];ae>=B&&ae<=G&&(C.push(Z[ie]),C.push(Z[ie+1]),C.push(Z[ie+2]))}}function Xe(Z,C,B,G,j,ie,ae){for(var ne,re,oe=Nt(Z),we=j===0?Bn:Pt,Oe=Z.start,be=0;be<Z.length-3;be+=3){var ft=Z[be],mt=Z[be+1],rt=Z[be+2],Et=Z[be+3],Ct=Z[be+4],Yt=j===0?ft:mt,kt=j===0?Et:Ct,Ut=!1;ae&&(ne=Math.sqrt(Math.pow(ft-Et,2)+Math.pow(mt-Ct,2))),Yt<B?kt>B&&(re=we(oe,ft,mt,Et,Ct,B),ae&&(oe.start=Oe+ne*re)):Yt>G?kt<G&&(re=we(oe,ft,mt,Et,Ct,G),ae&&(oe.start=Oe+ne*re)):er(oe,ft,mt,rt),kt<B&&Yt>=B&&(re=we(oe,ft,mt,Et,Ct,B),Ut=!0),kt>G&&Yt<=G&&(re=we(oe,ft,mt,Et,Ct,G),Ut=!0),!ie&&Ut&&(ae&&(oe.end=Oe+ne*re),C.push(oe),oe=Nt(Z)),ae&&(Oe+=ne)}var Qt=Z.length-3;ft=Z[Qt],mt=Z[Qt+1],rt=Z[Qt+2],(Yt=j===0?ft:mt)>=B&&Yt<=G&&er(oe,ft,mt,rt),Qt=oe.length-3,ie&&Qt>=3&&(oe[Qt]!==oe[0]||oe[Qt+1]!==oe[1])&&er(oe,oe[0],oe[1],oe[2]),oe.length&&C.push(oe)}function Nt(Z){var C=[];return C.size=Z.size,C.start=Z.start,C.end=Z.end,C}function Dt(Z,C,B,G,j,ie){for(var ae=0;ae<Z.length;ae++)Xe(Z[ae],C,B,G,j,ie,!1)}function er(Z,C,B,G){Z.push(C),Z.push(B),Z.push(G)}function Bn(Z,C,B,G,j,ie){var ae=(ie-C)/(G-C);return Z.push(ie),Z.push(B+(j-B)*ae),Z.push(1),ae}function Pt(Z,C,B,G,j,ie){var ae=(ie-B)/(j-B);return Z.push(C+(G-C)*ae),Z.push(ie),Z.push(1),ae}function vn(Z,C){for(var B=[],G=0;G<Z.length;G++){var j,ie=Z[G],ae=ie.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")j=Zi(ie.geometry,C);else if(ae==="MultiLineString"||ae==="Polygon"){j=[];for(var ne=0;ne<ie.geometry.length;ne++)j.push(Zi(ie.geometry[ne],C))}else if(ae==="MultiPolygon")for(j=[],ne=0;ne<ie.geometry.length;ne++){for(var re=[],oe=0;oe<ie.geometry[ne].length;oe++)re.push(Zi(ie.geometry[ne][oe],C));j.push(re)}B.push(yn(ie.id,ae,j,ie.tags))}return B}function Zi(Z,C){var B=[];B.size=Z.size,Z.start!==void 0&&(B.start=Z.start,B.end=Z.end);for(var G=0;G<Z.length;G+=3)B.push(Z[G]+C,Z[G+1],Z[G+2]);return B}function xs(Z,C){if(Z.transformed)return Z;var B,G,j,ie=1<<Z.z,ae=Z.x,ne=Z.y;for(B=0;B<Z.features.length;B++){var re=Z.features[B],oe=re.geometry,we=re.type;if(re.geometry=[],we===1)for(G=0;G<oe.length;G+=2)re.geometry.push(Fi(oe[G],oe[G+1],C,ie,ae,ne));else for(G=0;G<oe.length;G++){var Oe=[];for(j=0;j<oe[G].length;j+=2)Oe.push(Fi(oe[G][j],oe[G][j+1],C,ie,ae,ne));re.geometry.push(Oe)}}return Z.transformed=!0,Z}function Fi(Z,C,B,G,j,ie){return[Math.round(B*(Z*G-j)),Math.round(B*(C*G-ie))]}function hr(Z,C,B,G,j){for(var ie=C===j.maxZoom?0:j.tolerance/((1<<C)*j.extent),ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:G,z:C,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ne=0;ne<Z.length;ne++){ae.numFeatures++,ci(ae,Z[ne],ie,j);var re=Z[ne].minX,oe=Z[ne].minY,we=Z[ne].maxX,Oe=Z[ne].maxY;re<ae.minX&&(ae.minX=re),oe<ae.minY&&(ae.minY=oe),we>ae.maxX&&(ae.maxX=we),Oe>ae.maxY&&(ae.maxY=Oe)}return ae}function ci(Z,C,B,G){var j=C.geometry,ie=C.type,ae=[];if(ie==="Point"||ie==="MultiPoint")for(var ne=0;ne<j.length;ne+=3)ae.push(j[ne]),ae.push(j[ne+1]),Z.numPoints++,Z.numSimplified++;else if(ie==="LineString")bs(ae,j,Z,B,!1,!1);else if(ie==="MultiLineString"||ie==="Polygon")for(ne=0;ne<j.length;ne++)bs(ae,j[ne],Z,B,ie==="Polygon",ne===0);else if(ie==="MultiPolygon")for(var re=0;re<j.length;re++){var oe=j[re];for(ne=0;ne<oe.length;ne++)bs(ae,oe[ne],Z,B,!0,ne===0)}if(ae.length){var we=C.tags||null;if(ie==="LineString"&&G.lineMetrics){for(var Oe in we={},C.tags)we[Oe]=C.tags[Oe];we.mapbox_clip_start=j.start/j.size,we.mapbox_clip_end=j.end/j.size}var be={geometry:ae,type:ie==="Polygon"||ie==="MultiPolygon"?3:ie==="LineString"||ie==="MultiLineString"?2:1,tags:we};C.id!==null&&(be.id=C.id),Z.features.push(be)}}function bs(Z,C,B,G,j,ie){var ae=G*G;if(G>0&&C.size<(j?ae:G))B.numPoints+=C.length/3;else{for(var ne=[],re=0;re<C.length;re+=3)(G===0||C[re+2]>ae)&&(B.numSimplified++,ne.push(C[re]),ne.push(C[re+1])),B.numPoints++;j&&function(oe,we){for(var Oe=0,be=0,ft=oe.length,mt=ft-2;be<ft;mt=be,be+=2)Oe+=(oe[be]-oe[mt])*(oe[be+1]+oe[mt+1]);if(Oe>0===we)for(be=0,ft=oe.length;be<ft/2;be+=2){var rt=oe[be],Et=oe[be+1];oe[be]=oe[ft-2-be],oe[be+1]=oe[ft-1-be],oe[ft-2-be]=rt,oe[ft-1-be]=Et}}(ne,ie),Z.push(ne)}}function an(Z,C){var B=(C=this.options=function(j,ie){for(var ae in ie)j[ae]=ie[ae];return j}(Object.create(this.options),C)).debug;if(B&&console.time("preprocess data"),C.maxZoom<0||C.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(C.promoteId&&C.generateId)throw new Error("promoteId and generateId cannot be used together.");var G=function(j,ie){var ae=[];if(j.type==="FeatureCollection")for(var ne=0;ne<j.features.length;ne++)Ye(ae,j.features[ne],ie,ne);else Ye(ae,j.type==="Feature"?j:{geometry:j},ie);return ae}(Z,C);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",C.indexMaxZoom,C.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),G=function(j,ie){var ae=ie.buffer/ie.extent,ne=j,re=Cr(j,1,-1-ae,ae,0,-1,2,ie),oe=Cr(j,1,1-ae,2+ae,0,-1,2,ie);return(re||oe)&&(ne=Cr(j,1,-ae,1+ae,0,-1,2,ie)||[],re&&(ne=vn(re,1).concat(ne)),oe&&(ne=ne.concat(vn(oe,-1)))),ne}(G,C),G.length&&this.splitTile(G,0,0,0),B&&(G.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Yn(Z,C,B){return 32*((1<<Z)*B+C)+Z}function Qn(Z,C){const B=Z.tileID.canonical;if(!this._geoJSONIndex)return C(null,null);const G=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!G)return C(null,null);const j=new nt(G.features);let ie=Fe.exports(j);ie.byteOffset===0&&ie.byteLength===ie.buffer.byteLength||(ie=new Uint8Array(ie)),C(null,{vectorTile:j,rawData:ie.buffer})}an.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},an.prototype.splitTile=function(Z,C,B,G,j,ie,ae){for(var ne=[Z,C,B,G],re=this.options,oe=re.debug;ne.length;){G=ne.pop(),B=ne.pop(),C=ne.pop(),Z=ne.pop();var we=1<<C,Oe=Yn(C,B,G),be=this.tiles[Oe];if(!be&&(oe>1&&console.time("creation"),be=this.tiles[Oe]=hr(Z,C,B,G,re),this.tileCoords.push({z:C,x:B,y:G}),oe)){oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",C,B,G,be.numFeatures,be.numPoints,be.numSimplified),console.timeEnd("creation"));var ft="z"+C;this.stats[ft]=(this.stats[ft]||0)+1,this.total++}if(be.source=Z,j){if(C===re.maxZoom||C===j)continue;var mt=1<<j-C;if(B!==Math.floor(ie/mt)||G!==Math.floor(ae/mt))continue}else if(C===re.indexMaxZoom||be.numPoints<=re.indexMaxPoints)continue;if(be.source=null,Z.length!==0){oe>1&&console.time("clipping");var rt,Et,Ct,Yt,kt,Ut,Qt=.5*re.buffer/re.extent,fi=.5-Qt,Hi=.5+Qt,Mi=1+Qt;rt=Et=Ct=Yt=null,kt=Cr(Z,we,B-Qt,B+Hi,0,be.minX,be.maxX,re),Ut=Cr(Z,we,B+fi,B+Mi,0,be.minX,be.maxX,re),Z=null,kt&&(rt=Cr(kt,we,G-Qt,G+Hi,1,be.minY,be.maxY,re),Et=Cr(kt,we,G+fi,G+Mi,1,be.minY,be.maxY,re),kt=null),Ut&&(Ct=Cr(Ut,we,G-Qt,G+Hi,1,be.minY,be.maxY,re),Yt=Cr(Ut,we,G+fi,G+Mi,1,be.minY,be.maxY,re),Ut=null),oe>1&&console.timeEnd("clipping"),ne.push(rt||[],C+1,2*B,2*G),ne.push(Et||[],C+1,2*B,2*G+1),ne.push(Ct||[],C+1,2*B+1,2*G),ne.push(Yt||[],C+1,2*B+1,2*G+1)}}},an.prototype.getTile=function(Z,C,B){var G=this.options,j=G.extent,ie=G.debug;if(Z<0||Z>24)return null;var ae=1<<Z,ne=Yn(Z,C=(C%ae+ae)%ae,B);if(this.tiles[ne])return xs(this.tiles[ne],j);ie>1&&console.log("drilling down to z%d-%d-%d",Z,C,B);for(var re,oe=Z,we=C,Oe=B;!re&&oe>0;)oe--,we=Math.floor(we/2),Oe=Math.floor(Oe/2),re=this.tiles[Yn(oe,we,Oe)];return re&&re.source?(ie>1&&console.log("found parent tile z%d-%d-%d",oe,we,Oe),ie>1&&console.time("drilling down"),this.splitTile(re.source,oe,we,Oe,Z,C,B),ie>1&&console.timeEnd("drilling down"),this.tiles[ne]?xs(this.tiles[ne],j):null):null};class ws extends de{constructor(C,B,G,j){super(C,B,G,Qn),j&&(this.loadGeoJSON=j)}loadData(C,B){var G;(G=this._pendingRequest)===null||G===void 0||G.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const j=!!(C&&C.request&&C.request.collectResourceTiming)&&new a.RequestPerformance(C.request);this._pendingCallback=B,this._pendingRequest=this.loadGeoJSON(C,(ie,ae)=>{if(delete this._pendingCallback,delete this._pendingRequest,ie||!ae)return B(ie);if(typeof ae!="object")return B(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`));{De(ae,!0);try{if(C.filter){const re=a.createExpression(C.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(re.result==="error")throw new Error(re.value.map(we=>`${we.key}: ${we.message}`).join(", "));ae={type:"FeatureCollection",features:ae.features.filter(we=>re.value.evaluate({zoom:0},we))}}this._geoJSONIndex=C.cluster?new Pi(function({superclusterOptions:re,clusterProperties:oe}){if(!oe||!re)return re;const we={},Oe={},be={accumulated:null,zoom:0},ft={properties:null},mt=Object.keys(oe);for(const rt of mt){const[Et,Ct]=oe[rt],Yt=a.createExpression(Ct),kt=a.createExpression(typeof Et=="string"?[Et,["accumulated"],["get",rt]]:Et);we[rt]=Yt.value,Oe[rt]=kt.value}return re.map=rt=>{ft.properties=rt;const Et={};for(const Ct of mt)Et[Ct]=we[Ct].evaluate(be,ft);return Et},re.reduce=(rt,Et)=>{ft.properties=Et;for(const Ct of mt)be.accumulated=rt[Ct],rt[Ct]=Oe[Ct].evaluate(be,ft)},re}(C)).load(ae.features):function(re,oe){return new an(re,oe)}(ae,C.geojsonVtOptions)}catch(re){return B(re)}this.loaded={};const ne={};if(j){const re=j.finish();re&&(ne.resourceTiming={},ne.resourceTiming[C.source]=JSON.parse(JSON.stringify(re)))}B(null,ne)}})}reloadTile(C,B){const G=this.loaded;return G&&G[C.uid]?super.reloadTile(C,B):this.loadTile(C,B)}loadGeoJSON(C,B){if(C.request)return a.getJSON(C.request,B);if(typeof C.data=="string")try{B(null,JSON.parse(C.data))}catch{B(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`))}else B(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(C,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()}getClusterExpansionZoom(C,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(C.clusterId))}catch(G){B(G)}}getClusterChildren(C,B){try{B(null,this._geoJSONIndex.getChildren(C.clusterId))}catch(G){B(G)}}getClusterLeaves(C,B){try{B(null,this._geoJSONIndex.getLeaves(C.clusterId,C.limit,C.offset))}catch(G){B(G)}}}class es{constructor(C){this.self=C,this.actor=new a.Actor(C,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:de,geojson:ws},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,G)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=G},this.self.registerRTLTextPlugin=B=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=B.applyArabicShaping,a.plugin.processBidirectionalText=B.processBidirectionalText,a.plugin.processStyledBidirectionalText=B.processStyledBidirectionalText}}setReferrer(C,B){this.referrer=B}setImages(C,B,G){this.availableImages[C]=B;for(const j in this.workerSources[C]){const ie=this.workerSources[C][j];for(const ae in ie)ie[ae].availableImages=B}G()}setLayers(C,B,G){this.getLayerIndex(C).replace(B),G()}updateLayers(C,B,G){this.getLayerIndex(C).update(B.layers,B.removedIds),G()}loadTile(C,B,G){this.getWorkerSource(C,B.type,B.source).loadTile(B,G)}loadDEMTile(C,B,G){this.getDEMWorkerSource(C,B.source).loadTile(B,G)}reloadTile(C,B,G){this.getWorkerSource(C,B.type,B.source).reloadTile(B,G)}abortTile(C,B,G){this.getWorkerSource(C,B.type,B.source).abortTile(B,G)}removeTile(C,B,G){this.getWorkerSource(C,B.type,B.source).removeTile(B,G)}removeDEMTile(C,B){this.getDEMWorkerSource(C,B.source).removeTile(B)}removeSource(C,B,G){if(!this.workerSources[C]||!this.workerSources[C][B.type]||!this.workerSources[C][B.type][B.source])return;const j=this.workerSources[C][B.type][B.source];delete this.workerSources[C][B.type][B.source],j.removeSource!==void 0?j.removeSource(B,G):G()}loadWorkerSource(C,B,G){try{this.self.importScripts(B.url),G()}catch(j){G(j.toString())}}syncRTLPluginState(C,B,G){try{a.plugin.setState(B);const j=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&j!=null){this.self.importScripts(j);const ie=a.plugin.isParsed();G(ie?void 0:new Error(`RTL Text Plugin failed to import scripts from ${j}`),ie)}}catch(j){G(j.toString())}}getAvailableImages(C){let B=this.availableImages[C];return B||(B=[]),B}getLayerIndex(C){let B=this.layerIndexes[C];return B||(B=this.layerIndexes[C]=new q),B}getWorkerSource(C,B,G){if(this.workerSources[C]||(this.workerSources[C]={}),this.workerSources[C][B]||(this.workerSources[C][B]={}),!this.workerSources[C][B][G]){const j={send:(ie,ae,ne)=>{this.actor.send(ie,ae,ne,C)}};this.workerSources[C][B][G]=new this.workerSourceTypes[B](j,this.getLayerIndex(C),this.getAvailableImages(C))}return this.workerSources[C][B][G]}getDEMWorkerSource(C,B){return this.demWorkerSources[C]||(this.demWorkerSources[C]={}),this.demWorkerSources[C][B]||(this.demWorkerSources[C][B]=new fe),this.demWorkerSources[C][B]}enforceCacheSizeLimit(C,B){a.enforceCacheSizeLimit(B)}}return a.isWorker()&&(self.worker=new es(self)),es}),x(["./shared"],function(a){var S=P;function P(u){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,f,_=new Blob([""],{type:"text/javascript"}),v=URL.createObjectURL(_);try{f=new Worker(v),h=!0}catch{h=!1}return f&&f.terminate(),URL.revokeObjectURL(v),h}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var h=document.createElement("canvas");h.width=h.height=1;var f=h.getContext("2d");if(!f)return!1;var _=f.getImageData(0,0,1,1);return _&&_.width===h.width}()?(q[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&(q[s]=function(h){var f,_=function(v){var E=document.createElement("canvas"),T=Object.create(P.webGLContextAttributes);return T.failIfMajorPerformanceCaveat=v,E.getContext("webgl",T)||E.getContext("experimental-webgl",T)}(h);if(!_)return!1;try{f=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!f||_.isContextLost())&&(_.shaderSource(f,"void main() {}"),_.compileShader(f),_.getShaderParameter(f,_.COMPILE_STATUS)===!0)}(s)),q[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(u)}var q={};function R(u,t){if(Array.isArray(u)){if(!Array.isArray(t)||u.length!==t.length)return!1;for(let s=0;s<u.length;s++)if(!R(u[s],t[s]))return!1;return!0}if(typeof u=="object"&&u!==null&&t!==null){if(typeof t!="object"||Object.keys(u).length!==Object.keys(t).length)return!1;for(const s in u)if(!R(u[s],t[s]))return!1;return!0}return u===t}P.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class F{static testProp(t){if(!F.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in F.docStyle)return t[s];return t[0]}static create(t,s,h){const f=window.document.createElement(t);return s!==void 0&&(f.className=s),h&&h.appendChild(f),f}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){F.docStyle&&F.selectProp&&(F.userSelect=F.docStyle[F.selectProp],F.docStyle[F.selectProp]="none")}static enableDrag(){F.docStyle&&F.selectProp&&(F.docStyle[F.selectProp]=F.userSelect)}static setTransform(t,s){t.style[F.transformProp]=s}static addEventListener(t,s,h,f={}){t.addEventListener(s,h,"passive"in f?f:f.capture)}static removeEventListener(t,s,h,f={}){t.removeEventListener(s,h,"passive"in f?f:f.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",F.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",F.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",F.suppressClickInternal,!0)},0)}static mousePos(t,s){const h=t.getBoundingClientRect();return new a.pointGeometry(s.clientX-h.left-t.clientLeft,s.clientY-h.top-t.clientTop)}static touchPos(t,s){const h=t.getBoundingClientRect(),f=[];for(let _=0;_<s.length;_++)f.push(new a.pointGeometry(s[_].clientX-h.left-t.clientLeft,s[_].clientY-h.top-t.clientTop));return f}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}F.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,F.selectProp=F.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),F.transformProp=F.testProp(["transform","WebkitTransform"]);class Q{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,h){const f=function(_){const v=_.match(le);if(!v)throw new Error(`Unable to parse URL "${_}"`);return{protocol:v[1],authority:v[2],path:v[3]||"/",params:v[4]?v[4].split("&"):[]}}(t);return f.path+=`${s}${h}`,function(_){const v=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${v}`}(f)}setTransformRequest(t){this._transformRequestFn=t}}const le=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class de{constructor(t,s,h,f){this.context=t,this.format=h,this.texture=t.gl.createTexture(),this.update(s,f)}update(t,s,h){const{width:f,height:_}=t,v=!(this.size&&this.size[0]===f&&this.size[1]===_||h),{context:E}=this,{gl:T}=E;if(this.useMipmap=Boolean(s&&s.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[f,_],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.isImageBitmap(t)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,t):T.texImage2D(T.TEXTURE_2D,0,this.format,f,_,0,this.format,T.UNSIGNED_BYTE,t.data);else{const{x:A,y:z}=h||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.isImageBitmap(t)?T.texSubImage2D(T.TEXTURE_2D,0,A,z,T.RGBA,T.UNSIGNED_BYTE,t):T.texSubImage2D(T.TEXTURE_2D,0,A,z,f,_,T.RGBA,T.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(t,s,h){const{context:f}=this,{gl:_}=f;_.bindTexture(_.TEXTURE_2D,this.texture),h!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=_.LINEAR),t!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,h||t),this.filter=t),s!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,s),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function fe(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class De extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:h}of this.requestors)this._notify(s,h);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),h=!1),h}_validateStretch(t,s){if(!t)return!0;let h=0;for(const f of t){if(f[0]<h||f[1]<f[0]||s<f[1])return!1;h=f[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){const h=this.images[t];if(h.data.width!==s.data.width||h.data.height!==s.data.height)throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=h.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let h=!0;if(!this.isLoaded())for(const f of t)this.images[f]||(h=!1);this.isLoaded()||h?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const h={};for(const f of t){this.images[f]||this.fire(new a.Event("styleimagemissing",{id:f}));const _=this.images[f];_?h[f]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:Boolean(_.userImage&&_.userImage.render)}:a.warnOnce(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,h)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],h=this.getImage(t);if(!h)return null;if(s&&s.position.version===h.version)return s.position;if(s)s.position.version=h.version;else{const f={w:h.data.width+2,h:h.data.height+2,x:0,y:0},_=new a.ImagePosition(f,h);this.patterns[t]={bin:f,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new de(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:s,h}=a.potpack(t),f=this.atlasImage;f.resize({width:s||1,height:h||1});for(const _ in this.patterns){const{bin:v}=this.patterns[_],E=v.x+1,T=v.y+1,A=this.images[_].data,z=A.width,O=A.height;a.RGBAImage.copy(A,f,{x:0,y:0},{x:E,y:T},{width:z,height:O}),a.RGBAImage.copy(A,f,{x:0,y:O-1},{x:E,y:T-1},{width:z,height:1}),a.RGBAImage.copy(A,f,{x:0,y:0},{x:E,y:T+O},{width:z,height:1}),a.RGBAImage.copy(A,f,{x:z-1,y:0},{x:E-1,y:T},{width:1,height:O}),a.RGBAImage.copy(A,f,{x:0,y:0},{x:E+z,y:T},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const h=this.images[s];h||a.warnOnce(`Image with ID: "${s}" was not found`),fe(h)&&this.updateImage(s,h)}}}const Ee=1e20;function xe(u,t,s,h,f,_,v,E,T){for(let A=t;A<t+h;A++)Te(u,s*_+A,_,f,v,E,T);for(let A=s;A<s+f;A++)Te(u,A*_+t,1,h,v,E,T)}function Te(u,t,s,h,f,_,v){_[0]=0,v[0]=-Ee,v[1]=Ee,f[0]=u[t];for(let E=1,T=0,A=0;E<h;E++){f[E]=u[t+E*s];const z=E*E;do{const O=_[T];A=(f[E]-f[O]+z-O*O)/(E-O)/2}while(A<=v[T]&&--T>-1);T++,_[T]=E,v[T]=A,v[T+1]=Ee}for(let E=0,T=0;E<h;E++){for(;v[T+1]<E;)T++;const A=_[T],z=E-A;u[t+E*s]=f[A]+z*z}}class qe{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t,s){const h=[];for(const f in t)for(const _ of t[f])h.push({stack:f,id:_});a.asyncAll(h,({stack:f,id:_},v)=>{let E=this.entries[f];E||(E=this.entries[f]={glyphs:{},requests:{},ranges:{}});let T=E.glyphs[_];if(T!==void 0)return void v(null,{stack:f,id:_,glyph:T});if(T=this._tinySDF(E,f,_),T)return E.glyphs[_]=T,void v(null,{stack:f,id:_,glyph:T});const A=Math.floor(_/256);if(256*A>65535)return void v(new Error("glyphs > 65535 not supported"));if(E.ranges[A])return void v(null,{stack:f,id:_,glyph:T});let z=E.requests[A];z||(z=E.requests[A]=[],qe.loadGlyphRange(f,A,this.url,this.requestManager,(O,U)=>{if(U){for(const J in U)this._doesCharSupportLocalGlyph(+J)||(E.glyphs[+J]=U[+J]);E.ranges[A]=!0}for(const J of z)J(O,U);delete E.requests[A]})),z.push((O,U)=>{O?v(O):U&&v(null,{stack:f,id:_,glyph:U[_]||null})})},(f,_)=>{if(f)s(f);else if(_){const v={};for(const{stack:E,id:T,glyph:A}of _)(v[E]||(v[E]={}))[T]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};s(null,v)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(a.unicodeBlockLookup["CJK Unified Ideographs"](t)||a.unicodeBlockLookup["Hangul Syllables"](t)||a.unicodeBlockLookup.Hiragana(t)||a.unicodeBlockLookup.Katakana(t))}_tinySDF(t,s,h){const f=this.localIdeographFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let _=t.tinySDF;if(!_){let E="400";/bold/i.test(s)?E="900":/medium/i.test(s)?E="500":/light/i.test(s)&&(E="200"),_=t.tinySDF=new qe.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:f,fontWeight:E})}const v=_.draw(String.fromCharCode(h));return{id:h,bitmap:new a.AlphaImage({width:v.width||30,height:v.height||30},v.data),metrics:{width:v.glyphWidth||24,height:v.glyphHeight||24,left:v.glyphLeft||0,top:v.glyphTop-27||-8,advance:v.glyphAdvance||24}}}}qe.loadGlyphRange=function(u,t,s,h,f){const _=256*t,v=_+255,E=h.transformRequest(s.replace("{fontstack}",u).replace("{range}",`${_}-${v}`),a.ResourceType.Glyphs);a.getArrayBuffer(E,(T,A)=>{if(T)f(T);else if(A){const z={};for(const O of a.parseGlyphPbf(A))z[O.id]=O;f(null,z)}})},qe.TinySDF=class{constructor({fontSize:u=24,buffer:t=3,radius:s=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:_="normal",fontStyle:v="normal"}={}){this.buffer=t,this.cutoff=h,this.radius=s;const E=this.size=u+4*t,T=this._createCanvas(E),A=this.ctx=T.getContext("2d",{willReadFrequently:!0});A.font=`${v} ${_} ${u}px ${f}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(u){const t=document.createElement("canvas");return t.width=t.height=u,t}draw(u){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:_}=this.ctx.measureText(u),v=Math.ceil(s),E=Math.min(this.size-this.buffer,Math.ceil(_-f)),T=Math.min(this.size-this.buffer,v+Math.ceil(h)),A=E+2*this.buffer,z=T+2*this.buffer,O=Math.max(A*z,0),U=new Uint8ClampedArray(O),J={data:U,width:A,height:z,glyphWidth:E,glyphHeight:T,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(E===0||T===0)return J;const{ctx:W,buffer:X,gridInner:se,gridOuter:he}=this;W.clearRect(X,X,E,T),W.fillText(u,X,X+v);const pe=W.getImageData(X,X,E,T);he.fill(Ee,0,O),se.fill(0,0,O);for(let Y=0;Y<T;Y++)for(let ye=0;ye<E;ye++){const ge=pe.data[4*(Y*E+ye)+3]/255;if(ge===0)continue;const Ie=(Y+X)*A+ye+X;if(ge===1)he[Ie]=0,se[Ie]=Ee;else{const Ae=.5-ge;he[Ie]=Ae>0?Ae*Ae:0,se[Ie]=Ae<0?Ae*Ae:0}}xe(he,0,0,A,z,A,this.f,this.v,this.z),xe(se,X,X,E,T,A,this.f,this.v,this.z);for(let Y=0;Y<O;Y++){const ye=Math.sqrt(he[Y])-Math.sqrt(se[Y]);U[Y]=Math.round(255-255*(ye/this.radius+this.cutoff))}return J}};const nt=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(u,t){return a.sphericalToCartesian(u.expression.evaluate(t))}interpolate(u,t,s){return{x:a.number(u.x,t.x,s),y:a.number(u.y,t.y,s),z:a.number(u.z,t.z,s)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),Fe="-transition";class Pe extends a.Evented{constructor(t){super(),this._transitionable=new a.Transitionable(nt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(a.validateLight,t,s))for(const h in t){const f=t[h];h.endsWith(Fe)?this._transitionable.setTransition(h.slice(0,-Fe.length),f):this._transitionable.setValue(h,f)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Se{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const h=t.join(",")+String(s);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(t,s)),this.dashEntry[h]}getDashRanges(t,s,h){const f=[];let _=t.length%2==1?-t[t.length-1]*h:0,v=t[0]*h,E=!0;f.push({left:_,right:v,isDash:E,zeroLength:t[0]===0});let T=t[0];for(let A=1;A<t.length;A++){E=!E;const z=t[A];_=T*h,T+=z,v=T*h,f.push({left:_,right:v,isDash:E,zeroLength:z===0})}return f}addRoundDash(t,s,h){const f=s/2;for(let _=-h;_<=h;_++){const v=this.width*(this.nextRow+h+_);let E=0,T=t[E];for(let A=0;A<this.width;A++){A/T.right>1&&(T=t[++E]);const z=Math.abs(A-T.left),O=Math.abs(A-T.right),U=Math.min(z,O);let J;const W=_/h*(f+1);if(T.isDash){const X=f-Math.abs(W);J=Math.sqrt(U*U+X*X)}else J=f-Math.sqrt(U*U+W*W);this.data[v+A]=Math.max(0,Math.min(255,J+128))}}}addRegularDash(t){for(let E=t.length-1;E>=0;--E){const T=t[E],A=t[E+1];T.zeroLength?t.splice(E,1):A&&A.isDash===T.isDash&&(A.left=T.left,t.splice(E,1))}const s=t[0],h=t[t.length-1];s.isDash===h.isDash&&(s.left=h.left-this.width,h.right=s.right+this.width);const f=this.width*this.nextRow;let _=0,v=t[_];for(let E=0;E<this.width;E++){E/v.right>1&&(v=t[++_]);const T=Math.abs(E-v.left),A=Math.abs(E-v.right),z=Math.min(T,A);this.data[f+E]=Math.max(0,Math.min(255,(v.isDash?z:-z)+128))}}addDash(t,s){const h=s?7:0,f=2*h+1;if(this.nextRow+f>this.height)return a.warnOnce("LineAtlas out of space"),null;let _=0;for(let E=0;E<t.length;E++)_+=t[E];if(_!==0){const E=this.width/_,T=this.getDashRanges(t,this.width,E);s?this.addRoundDash(T,E,h):this.addRegularDash(T)}const v={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:_};return this.nextRow+=f,this.dirty=!0,v}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class He{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const h=this.workerPool.acquire(this.id);for(let f=0;f<h.length;f++){const _=new He.Actor(h[f],s,this.id);_.name=`Worker ${f}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s,h){a.asyncAll(this.actors,(f,_)=>{f.send(t,s,_)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Lt(u,t,s){const h=function(f,_){if(f)return s(f);if(_){const v=a.pick(a.extend(_,u),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);_.vector_layers&&(v.vectorLayers=_.vector_layers,v.vectorLayerIds=v.vectorLayers.map(E=>E.id)),s(null,v)}};return u.url?a.getJSON(t.transformRequest(u.url,a.ResourceType.Source),h):a.exported.frame(()=>h(null,u))}He.Actor=a.Actor;class It{constructor(t,s,h){this.bounds=a.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),h=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*s),f=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*s),_=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*s),v=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=h&&t.x<_&&t.y>=f&&t.y<v}}class Mt extends a.Evented{constructor(t,s,h,f){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(s,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lt(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new a.ErrorEvent(t)):s&&(a.extend(this,s),s.bounds&&(this.tileBounds=new It(s.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(t,s){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(h,a.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function _(v,E){return delete t.request,t.aborted?s(null):v&&v.status!==404?s(v):(E&&E.resourceTiming&&(t.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&t.setExpiryData(E),t.loadVectorData(E,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}f.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",f,_.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",f,_.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class D extends a.Evented{constructor(t,s,h,f){super(),this.id=t,this.dispatcher=h,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},s),a.extend(this,a.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lt(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):s&&(a.extend(this,s),s.bounds&&(this.tileBounds=new It(s.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=a.getImage(this.map._requestManager.transformRequest(h,a.ResourceType.Tile),(f,_,v)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(f)t.state="errored",s(f);else if(_){this.map._refreshExpiredTiles&&t.setExpiryData(v);const E=this.map.painter.context,T=E.gl;t.texture=this.map.painter.getTileTexture(_.width),t.texture?t.texture.update(_,{useMipmap:!0}):(t.texture=new de(E,_,T.RGBA,{useMipmap:!0}),t.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),E.extTextureFilterAnisotropic&&T.texParameterf(T.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax)),t.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let K;class H extends D{constructor(t,s,h,f){super(t,s,h,f),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,s){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function f(_,v){_&&(t.state="errored",s(_)),v&&(t.dem=v,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",s(null))}t.request=a.getImage(this.map._requestManager.transformRequest(h,a.ResourceType.Tile),function(_,v){if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(_)t.state="errored",s(_);else if(v){this.map._refreshExpiredTiles&&t.setExpiryData(v),delete v.cacheControl,delete v.expires;const E=a.isImageBitmap(v)&&(K==null&&(K=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),K)?v:a.exported.getImageData(v,1),T={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:E,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",T,f.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const s=t.canonical,h=Math.pow(2,s.z),f=(s.x-1+h)%h,_=s.x===0?t.wrap-1:t.wrap,v=(s.x+1+h)%h,E=s.x+1===h?t.wrap+1:t.wrap,T={};return T[new a.OverscaledTileID(t.overscaledZ,_,s.z,f,s.y).key]={backfilled:!1},T[new a.OverscaledTileID(t.overscaledZ,E,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(T[new a.OverscaledTileID(t.overscaledZ,_,s.z,f,s.y-1).key]={backfilled:!1},T[new a.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},T[new a.OverscaledTileID(t.overscaledZ,E,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<h&&(T[new a.OverscaledTileID(t.overscaledZ,_,s.z,f,s.y+1).key]={backfilled:!1},T[new a.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},T[new a.OverscaledTileID(t.overscaledZ,E,s.z,v,s.y+1).key]={backfilled:!1}),T}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Be extends a.Evented{constructor(t,s,h,f){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(f),this._data=s.data,this._options=a.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const _=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*_,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*_,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:a.EXTENT,radius:(s.clusterRadius||50)*_,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},s),this}getClusterChildren(t,s){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},s),this}getClusterLeaves(t,s,h,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:s,offset:h},f),this}_updateWorkerData(t){const s=a.extend({},this.workerOptions),h=this._data;typeof h=="string"?(s.request=this.map._requestManager.transformRequest(a.exported.resolveURL(h),a.ResourceType.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(h),this._pendingLoads++,this.fire(new a.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(f,_)=>{if(this._pendingLoads--,this._removed||_&&_.abandoned)return void this.fire(new a.Event("dataabort",{dataType:"source",sourceDataType:t}));let v=null;if(_&&_.resourceTiming&&_.resourceTiming[this.id]&&(v=_.resourceTiming[this.id].slice(0)),f)return void this.fire(new a.ErrorEvent(f));const E={dataType:"source",sourceDataType:t};this._collectResourceTiming&&v&&v.length>0&&a.extend(E,{resourceTiming:v}),this.fire(new a.Event("data",E))})}loaded(){return this._pendingLoads===0}loadTile(t,s){const h=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const f={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(h,f,(_,v)=>(delete t.request,t.unloadVectorData(),t.aborted?s(null):_?s(_):(t.loadVectorData(v,this.map.painter,h==="reloadTile"),s(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var me=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ne extends a.Evented{constructor(t,s,h,f){super(),this.id=t,this.dispatcher=h,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=s}load(t,s){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(h,f)=>{this._loaded=!0,h?this.fire(new a.ErrorEvent(h)):f&&(this.image=f,t&&(this.coordinates=t),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const s=t.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(f){let _=1/0,v=1/0,E=-1/0,T=-1/0;for(const U of f)_=Math.min(_,U.x),v=Math.min(v,U.y),E=Math.max(E,U.x),T=Math.max(T,U.y);const A=Math.max(E-_,T-v),z=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),O=Math.pow(2,z);return new a.CanonicalTileID(z,Math.floor((_+E)/2*O),Math.floor((v+T)/2*O))}(s),this.minzoom=this.maxzoom=this.tileID.z;const h=s.map(f=>this.tileID.getTilePoint(f)._round());return this._boundsArray=new a.RasterBoundsArray,this._boundsArray.emplaceBack(h[0].x,h[0].y,0,0),this._boundsArray.emplaceBack(h[1].x,h[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(h[3].x,h[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(h[2].x,h[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new de(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const h in this.tiles){const f=this.tiles[h];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture)}}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Re extends Ne{constructor(t,s,h,f){super(t,s,h,f),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,a.ResourceType.Source).url);a.getVideo(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new a.ErrorEvent(s)):h&&(this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new de(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const h in this.tiles){const f=this.tiles[h];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ce extends Ne{constructor(t,s,h,f){super(t,s,h,f),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(v=>typeof v!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new de(s,this.canvas,h.RGBA,{premultiply:!0});for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ge={vector:Mt,raster:D,"raster-dem":H,geojson:Be,video:Re,image:Ne,canvas:Ce};function Ve(u,t){const s=a.create();return a.translate(s,s,[1,1,0]),a.scale(s,s,[.5*u.width,.5*u.height,1]),a.multiply(s,s,u.calculatePosMatrix(t.toUnwrapped()))}function st(u,t,s,h,f,_){const v=function(O,U,J){if(O)for(const W of O){const X=U[W];if(X&&X.source===J&&X.type==="fill-extrusion")return!0}else for(const W in U){const X=U[W];if(X.source===J&&X.type==="fill-extrusion")return!0}return!1}(f&&f.layers,t,u.id),E=_.maxPitchScaleFactor(),T=u.tilesIn(h,E,v);T.sort(At);const A=[];for(const O of T)A.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(t,s,u._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,f,_,E,Ve(u.transform,O.tileID))});const z=function(O){const U={},J={};for(const W of O){const X=W.queryResults,se=W.wrappedTileID,he=J[se]=J[se]||{};for(const pe in X){const Y=X[pe],ye=he[pe]=he[pe]||{},ge=U[pe]=U[pe]||[];for(const Ie of Y)ye[Ie.featureIndex]||(ye[Ie.featureIndex]=!0,ge.push(Ie))}}return U}(A);for(const O in z)z[O].forEach(U=>{const J=U.feature,W=u.getFeatureState(J.layer["source-layer"],J.id);J.source=J.layer.source,J.layer["source-layer"]&&(J.sourceLayer=J.layer["source-layer"]),J.state=W});return z}function At(u,t){const s=u.tileID,h=t.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}class zt{constructor(t,s){this.tileID=t,this.uid=a.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<a.exported.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(s=>t.saveTileTexture(s)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,s,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(f,_){const v={};if(!_)return v;for(const E of f){const T=E.layerIds.map(A=>_.getLayer(A)).filter(Boolean);if(T.length!==0){E.layers=T,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(A=>T.filter(z=>z.id===A)[0]));for(const A of T)v[A.id]=E}}return v}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof a.SymbolBucket){if(this.hasSymbolBuckets=!0,!h)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof a.SymbolBucket&&_.hasRTLText){this.hasRTLText=!0,a.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const f in this.buckets){const _=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(f).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new a.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const h in this.buckets){const f=this.buckets[h];f.uploadPending()&&f.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new de(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new de(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,h,f,_,v,E,T,A,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:_,scale:v,tileSize:this.tileSize,pixelPosMatrix:z,transform:T,params:E,queryPadding:this.queryPadding*A},t,s,h):{}}querySourceFeatures(t,s){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const f=h.loadVTLayers(),_=s?s.sourceLayer:"",v=f._geojsonTileLayer||f[_];if(!v)return;const E=a.createFilter(s&&s.filter),{z:T,x:A,y:z}=this.tileID.canonical,O={z:T,x:A,y:z};for(let U=0;U<v.length;U++){const J=v.feature(U);if(E.needGeometry){const se=a.toEvaluationFeature(J,!0);if(!E.filter(new a.EvaluationParameters(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!E.filter(new a.EvaluationParameters(this.tileID.overscaledZ),J))continue;const W=h.getId(J,_),X=new a.GeoJSONFeature(J,T,A,z,W);X.tile=O,t.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const h=a.parseCacheControl(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let f=!1;if(this.expirationTime>h)f=!1;else if(s)if(this.expirationTime<s)f=!0;else{const _=this.expirationTime-s;_?this.expirationTime=h+Math.max(_,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!s.style.hasLayer(f))continue;const _=this.buckets[f],v=_.layers[0].sourceLayer||"_geojsonTileLayer",E=h[v],T=t[v];if(!E||!T||Object.keys(T).length===0)continue;_.update(T,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=s&&s.style&&s.style.getLayer(f);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=a.exported.now()+t}setDependencies(t,s){const h={};for(const f of s)h[f]=!0;this.dependencies[t]=h}hasDependency(t,s){for(const h of t){const f=this.dependencies[h];if(f){for(const _ of s)if(f[_])return!0}}return!1}}class St{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,h){const f=t.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const _={value:s,timeout:void 0};if(h!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},h)),this.data[f].push(_),this.order.push(f),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const h=t.wrapped().key,f=s===void 0?0:this.data[h].indexOf(s),_=this.data[h][f];return this.data[h].splice(f,1),_.timeout&&clearTimeout(_.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const h in this.data)for(const f of this.data[h])t(f.value)||s.push(f);for(const h of s)this.remove(h.value.tileID,h)}}class Ft{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,h){const f=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},a.extend(this.stateChanges[t][f],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==f&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const _ in this.state[t][f])h[_]||(this.deletedStates[t][f][_]=null)}else for(const _ in h)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][_]===null&&delete this.deletedStates[t][f][_]}removeFeatureState(t,s,h){if(this.deletedStates[t]===null)return;const f=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&s!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][h]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(h in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][h]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,s){const h=String(s),f=a.extend({},(this.state[t]||{})[h],(this.stateChanges[t]||{})[h]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][s];if(_===null)return{};for(const v in _)delete f[v]}return f}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const h={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const _={};for(const v in this.stateChanges[f])this.state[f][v]||(this.state[f][v]={}),a.extend(this.state[f][v],this.stateChanges[f][v]),_[v]=this.state[f][v];h[f]=_}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const _={};if(this.deletedStates[f]===null)for(const v in this.state[f])_[v]={},this.state[f][v]={};else for(const v in this.deletedStates[f]){if(this.deletedStates[f][v]===null)this.state[f][v]={};else for(const E of Object.keys(this.deletedStates[f][v]))delete this.state[f][v][E];_[v]=this.state[f][v]}h[f]=h[f]||{},a.extend(h[f],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const f in t)t[f].setFeatureState(h,s)}}class ii extends a.Evented{constructor(t,s,h){super(),this.id=t,this.dispatcher=h,this.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(f,_,v,E){const T=new Ge[_.type](f,_,v,E);if(T.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${T.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],T),T}(t,s,h,this),this._tiles={},this._cache=new St(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ft}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s){return this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new a.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const h=this._tiles[s];h.upload(t),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(ri).map(t=>t.key)}getRenderableIds(t){const s=[];for(const h in this._tiles)this._isIdRenderable(h,t)&&s.push(this._tiles[h]);return t?s.sort((h,f)=>{const _=h.tileID,v=f.tileID,E=new a.pointGeometry(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),T=new a.pointGeometry(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-v.overscaledZ||T.y-E.y||T.x-E.x}).map(h=>h.tileID.key):s.map(h=>h.tileID).sort(ri).map(h=>h.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){const h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=s),this._loadTile(h,this._tileLoaded.bind(this,h,t,s)))}_tileLoaded(t,s,h,f){if(f)return t.state="errored",void(f.status!==404?this._source.fire(new a.ErrorEvent(f,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=a.exported.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new a.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let f=0;f<s.length;f++){const _=s[f];if(t.neighboringTiles&&t.neighboringTiles[_]){const v=this.getTileByID(_);h(t,v),h(v,t)}}function h(f,_){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let v=_.tileID.canonical.x-f.tileID.canonical.x;const E=_.tileID.canonical.y-f.tileID.canonical.y,T=Math.pow(2,f.tileID.canonical.z),A=_.tileID.key;v===0&&E===0||Math.abs(E)>1||(Math.abs(v)>1&&(Math.abs(v+T)===1?v+=T:Math.abs(v-T)===1&&(v-=T)),_.dem&&f.dem&&(f.dem.backfillBorder(_.dem,v,E),f.neighboringTiles&&f.neighboringTiles[A]&&(f.neighboringTiles[A].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,h,f){for(const _ in this._tiles){let v=this._tiles[_];if(f[_]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>h)continue;let E=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const A=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[A.key],v&&v.hasData()&&(E=A)}let T=E;for(;T.overscaledZ>s;)if(T=T.scaledTo(T.overscaledZ-1),t[T.key]){f[E.key]=E;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=s?h:null}for(let h=t.overscaledZ-1;h>=s;h--){const f=t.scaledTo(h),_=this._getLoadedTile(f);if(_)return _}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,h=Math.ceil(t.height/this._source.tileSize)+1,f=Math.floor(s*h*5),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(_)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const h={};for(const f in this._tiles){const _=this._tiles[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+s),h[_.tileID.key]=_}this._tiles=h;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(f,this._tiles[f])}}update(t,s){if(this.transform=t,this.terrain=s,!this._sourceLoaded||this._paused)return;let h;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new a.OverscaledTileID(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(h=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(h=h.filter(A=>this._source.hasTile(A)))):h=[];const f=t.coveringZoomLevel(this._source),_=Math.max(f-ii.maxOverzooming,this._source.minzoom),v=Math.max(f+ii.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const z of h)if(z.canonical.z>this._source.minzoom){const O=z.scaledTo(z.canonical.z-1);A[O.key]=O;const U=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));A[U.key]=U}h=h.concat(Object.values(A))}const E=this._updateRetainedTiles(h,f);if(Bt(this._source.type)){const A={},z={},O=Object.keys(E);for(const U of O){const J=E[U],W=this._tiles[U];if(!W||W.fadeEndTime&&W.fadeEndTime<=a.exported.now())continue;const X=this.findLoadedParent(J,_);X&&(this._addTile(X.tileID),A[X.tileID.key]=X.tileID),z[U]=J}this._retainLoadedChildren(z,f,v,E);for(const U in A)E[U]||(this._coveredTiles[U]=!0,E[U]=A[U]);if(s){const U={},J={};for(const W of h)this._tiles[W.key].hasData()?U[W.key]=W:J[W.key]=W;for(const W in J){const X=J[W].children(this._source.maxzoom);this._tiles[X[0].key]&&this._tiles[X[1].key]&&this._tiles[X[2].key]&&this._tiles[X[3].key]&&(U[X[0].key]=E[X[0].key]=X[0],U[X[1].key]=E[X[1].key]=X[1],U[X[2].key]=E[X[2].key]=X[2],U[X[3].key]=E[X[3].key]=X[3],delete J[W])}for(const W in J){const X=this.findLoadedParent(J[W],this._source.minzoom);if(X){U[X.tileID.key]=E[X.tileID.key]=X.tileID;for(const se in U)U[se].isChildOf(X.tileID)&&delete U[se]}}for(const W in this._tiles)U[W]||(this._coveredTiles[W]=!0)}}for(const A in E)this._tiles[A].clearFadeHold();const T=a.keysDifference(this._tiles,E);for(const A of T){const z=this._tiles[A];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const h={},f={},_=Math.max(s-ii.maxOverzooming,this._source.minzoom),v=Math.max(s+ii.maxUnderzooming,this._source.minzoom),E={};for(const T of t){const A=this._addTile(T);h[T.key]=T,A.hasData()||s<this._source.maxzoom&&(E[T.key]=T)}this._retainLoadedChildren(E,s,v,h);for(const T of t){let A=this._tiles[T.key];if(A.hasData())continue;if(s+1>this._source.maxzoom){const O=T.children(this._source.maxzoom)[0],U=this.getTile(O);if(U&&U.hasData()){h[O.key]=O;continue}}else{const O=T.children(this._source.maxzoom);if(h[O[0].key]&&h[O[1].key]&&h[O[2].key]&&h[O[3].key])continue}let z=A.wasRequested();for(let O=T.overscaledZ-1;O>=_;--O){const U=T.scaledTo(O);if(f[U.key]||(f[U.key]=!0,A=this.getTile(U),!A&&z&&(A=this._addTile(U)),A&&(h[U.key]=U,z=A.wasRequested(),A.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let h,f=this._tiles[t].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){h=this._loadedParentTiles[f.key];break}s.push(f.key);const _=f.scaledTo(f.overscaledZ-1);if(h=this._getLoadedTile(_),h)break;f=_}for(const _ of s)this._loadedParentTiles[_]=h}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const h=s;return s||(s=new zt(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))),s.uses++,this._tiles[t.key]=s,h||this._source.fire(new a.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=s.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,h){const f=[],_=this.transform;if(!_)return f;const v=h?_.getCameraQueryGeometry(t):t,E=t.map(W=>_.pointCoordinate(W,this.terrain)),T=v.map(W=>_.pointCoordinate(W,this.terrain)),A=this.getIds();let z=1/0,O=1/0,U=-1/0,J=-1/0;for(const W of T)z=Math.min(z,W.x),O=Math.min(O,W.y),U=Math.max(U,W.x),J=Math.max(J,W.y);for(let W=0;W<A.length;W++){const X=this._tiles[A[W]];if(X.holdingForFade())continue;const se=X.tileID,he=Math.pow(2,_.zoom-X.tileID.overscaledZ),pe=s*X.queryPadding*a.EXTENT/X.tileSize/he,Y=[se.getTilePoint(new a.MercatorCoordinate(z,O)),se.getTilePoint(new a.MercatorCoordinate(U,J))];if(Y[0].x-pe<a.EXTENT&&Y[0].y-pe<a.EXTENT&&Y[1].x+pe>=0&&Y[1].y+pe>=0){const ye=E.map(Ie=>se.getTilePoint(Ie)),ge=T.map(Ie=>se.getTilePoint(Ie));f.push({tile:X,tileID:se,queryGeometry:ye,cameraQueryGeometry:ge,scale:he})}}return f}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(h=>this._tiles[h].tileID);for(const h of s)h.posMatrix=this.transform.calculatePosMatrix(h.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Bt(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=a.exported.now())return!0}return!1}setFeatureState(t,s,h){this._state.updateState(t=t||"_geojsonTileLayer",s,h)}removeFeatureState(t,s,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,h)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,h){const f=this._tiles[t];f&&f.setDependencies(s,h)}reloadTilesForDependencies(t,s){for(const h in this._tiles)this._tiles[h].hasDependency(t,s)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(t,s))}}function ri(u,t){const s=Math.abs(2*u.wrap)-+(u.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||h-s||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function Bt(u){return u==="raster"||u==="image"||u==="video"}ii.maxOverzooming=10,ii.maxUnderzooming=3;const Ht="mapboxgl_preloaded_worker_pool";class Ot{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ot.workerCount;)this.workers.push(new Worker(ss.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ht]}numActive(){return Object.keys(this.active).length}}const Pi=Math.floor(a.exported.hardwareConcurrency/2);let Vr;function Xr(){return Vr||(Vr=new Ot),Vr}function Dn(u,t){const s={};for(const h in u)h!=="ref"&&(s[h]=u[h]);return a.refProperties.forEach(h=>{h in t&&(s[h]=t[h])}),s}function Kn(u){u=u.slice();const t=Object.create(null);for(let s=0;s<u.length;s++)t[u[s].id]=u[s];for(let s=0;s<u.length;s++)"ref"in u[s]&&(u[s]=Dn(u[s],t[u[s].ref]));return u}Ot.workerCount=Math.max(Math.min(Pi,6),1);const Wt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function _r(u,t,s){s.push({command:Wt.addSource,args:[u,t[u]]})}function lr(u,t,s){t.push({command:Wt.removeSource,args:[u]}),s[u]=!0}function yr(u,t,s,h){lr(u,s,h),_r(u,t,s)}function mn(u,t,s){let h;for(h in u[s])if(Object.prototype.hasOwnProperty.call(u[s],h)&&h!=="data"&&!R(u[s][h],t[s][h]))return!1;for(h in t[s])if(Object.prototype.hasOwnProperty.call(t[s],h)&&h!=="data"&&!R(u[s][h],t[s][h]))return!1;return!0}function gn(u,t,s,h,f,_){let v;for(v in t=t||{},u=u||{})Object.prototype.hasOwnProperty.call(u,v)&&(R(u[v],t[v])||s.push({command:_,args:[h,v,t[v],f]}));for(v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(u,v)&&(R(u[v],t[v])||s.push({command:_,args:[h,v,t[v],f]}))}function _n(u){return u.id}function vs(u,t){return u[t.id]=t,u}class yn{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.clamp(t,0,1);let s=1,h=this._distances[s];const f=t*this.paddedLength+this.padding;for(;h<f&&s<this._distances.length;)h=this._distances[++s];const _=s-1,v=this._distances[_],E=h-v,T=E>0?(f-v)/E:0;return this.points[_].mult(1-T).add(this.points[s].mult(T))}}function ke(u,t){let s=!0;return u==="always"||u!=="never"&&t!=="never"||(s=!1),s}class Ye{constructor(t,s,h){const f=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(s/h);for(let v=0;v<this.xCellCount*this.yCellCount;v++)f.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,h,f,_){this._forEachCell(s,h,f,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(_)}insertCircle(t,s,h,f){this._forEachCell(s-f,h-f,s+f,h+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(h),this.circles.push(f)}_insertBoxCell(t,s,h,f,_,v){this.boxCells[_].push(v)}_insertCircleCell(t,s,h,f,_,v){this.circleCells[_].push(v)}_query(t,s,h,f,_,v,E){if(h<0||t>this.width||f<0||s>this.height)return[];const T=[];if(t<=0&&s<=0&&this.width<=h&&this.height<=f){if(_)return[{key:null,x1:t,y1:s,x2:h,y2:f}];for(let A=0;A<this.boxKeys.length;A++)T.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const z=this.circles[3*A],O=this.circles[3*A+1],U=this.circles[3*A+2];T.push({key:this.circleKeys[A],x1:z-U,y1:O-U,x2:z+U,y2:O+U})}}else this._forEachCell(t,s,h,f,this._queryCell,T,{hitTest:_,overlapMode:v,seenUids:{box:{},circle:{}}},E);return T}query(t,s,h,f){return this._query(t,s,h,f,!1,null)}hitTest(t,s,h,f,_,v){return this._query(t,s,h,f,!0,_,v).length>0}hitTestCircle(t,s,h,f,_){const v=t-h,E=t+h,T=s-h,A=s+h;if(E<0||v>this.width||A<0||T>this.height)return!1;const z=[];return this._forEachCell(v,T,E,A,this._queryCellCircle,z,{hitTest:!0,overlapMode:f,circle:{x:t,y:s,radius:h},seenUids:{box:{},circle:{}}},_),z.length>0}_queryCell(t,s,h,f,_,v,E,T){const{seenUids:A,hitTest:z,overlapMode:O}=E,U=this.boxCells[_];if(U!==null){const W=this.bboxes;for(const X of U)if(!A.box[X]){A.box[X]=!0;const se=4*X,he=this.boxKeys[X];if(t<=W[se+2]&&s<=W[se+3]&&h>=W[se+0]&&f>=W[se+1]&&(!T||T(he))&&(!z||!ke(O,he.overlapMode))&&(v.push({key:he,x1:W[se],y1:W[se+1],x2:W[se+2],y2:W[se+3]}),z))return!0}}const J=this.circleCells[_];if(J!==null){const W=this.circles;for(const X of J)if(!A.circle[X]){A.circle[X]=!0;const se=3*X,he=this.circleKeys[X];if(this._circleAndRectCollide(W[se],W[se+1],W[se+2],t,s,h,f)&&(!T||T(he))&&(!z||!ke(O,he.overlapMode))){const pe=W[se],Y=W[se+1],ye=W[se+2];if(v.push({key:he,x1:pe-ye,y1:Y-ye,x2:pe+ye,y2:Y+ye}),z)return!0}}}return!1}_queryCellCircle(t,s,h,f,_,v,E,T){const{circle:A,seenUids:z,overlapMode:O}=E,U=this.boxCells[_];if(U!==null){const W=this.bboxes;for(const X of U)if(!z.box[X]){z.box[X]=!0;const se=4*X,he=this.boxKeys[X];if(this._circleAndRectCollide(A.x,A.y,A.radius,W[se+0],W[se+1],W[se+2],W[se+3])&&(!T||T(he))&&!ke(O,he.overlapMode))return v.push(!0),!0}}const J=this.circleCells[_];if(J!==null){const W=this.circles;for(const X of J)if(!z.circle[X]){z.circle[X]=!0;const se=3*X,he=this.circleKeys[X];if(this._circlesCollide(W[se],W[se+1],W[se+2],A.x,A.y,A.radius)&&(!T||T(he))&&!ke(O,he.overlapMode))return v.push(!0),!0}}}_forEachCell(t,s,h,f,_,v,E,T){const A=this._convertToXCellCoord(t),z=this._convertToYCellCoord(s),O=this._convertToXCellCoord(h),U=this._convertToYCellCoord(f);for(let J=A;J<=O;J++)for(let W=z;W<=U;W++)if(_.call(this,t,s,h,f,this.xCellCount*W+J,v,E,T))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,h,f,_,v){const E=f-t,T=_-s,A=h+v;return A*A>E*E+T*T}_circleAndRectCollide(t,s,h,f,_,v,E){const T=(v-f)/2,A=Math.abs(t-(f+T));if(A>T+h)return!1;const z=(E-_)/2,O=Math.abs(s-(_+z));if(O>z+h)return!1;if(A<=T||O<=z)return!0;const U=A-T,J=O-z;return U*U+J*J<=h*h}}function Jn(u,t,s,h,f){const _=a.create();return t?(a.scale(_,_,[1/f,1/f,1]),s||a.rotateZ(_,_,h.angle)):a.multiply(_,h.labelPlaneMatrix,u),_}function Kr(u,t,s,h,f){if(t){const _=a.clone(u);return a.scale(_,_,[f,f,1]),s||a.rotateZ(_,_,-h.angle),_}return h.glCoordMatrix}function Jt(u,t,s){let h;s?(h=[u.x,u.y,s(u.x,u.y),1],a.transformMat4(h,h,t)):(h=[u.x,u.y,0,1],vn(h,h,t));const f=h[3];return{point:new a.pointGeometry(h[0]/f,h[1]/f),signedDistanceFromCamera:f}}function $r(u,t){return .5+u/t*.5}function Ar(u,t){const s=u[0]/u[3],h=u[1]/u[3];return s>=-t[0]&&s<=t[0]&&h>=-t[1]&&h<=t[1]}function Cr(u,t,s,h,f,_,v,E,T,A){const z=h?u.textSizeData:u.iconSizeData,O=a.evaluateSizeForZoom(z,s.transform.zoom),U=[256/s.width*2+1,256/s.height*2+1],J=h?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;J.clear();const W=u.lineVertexArray,X=h?u.text.placedSymbolArray:u.icon.placedSymbolArray,se=s.transform.width/s.transform.height;let he=!1;for(let pe=0;pe<X.length;pe++){const Y=X.get(pe);if(Y.hidden||Y.writingMode===a.WritingMode.vertical&&!he){Pt(Y.numGlyphs,J);continue}let ye;if(he=!1,A?(ye=[Y.anchorX,Y.anchorY,A(Y.anchorX,Y.anchorY),1],a.transformMat4(ye,ye,t)):(ye=[Y.anchorX,Y.anchorY,0,1],vn(ye,ye,t)),!Ar(ye,U)){Pt(Y.numGlyphs,J);continue}const ge=$r(s.transform.cameraToCenterDistance,ye[3]),Ie=a.evaluateSizeForFeature(z,O,Y),Ae=v?Ie/ge:Ie*ge,Ue=new a.pointGeometry(Y.anchorX,Y.anchorY),Me=Jt(Ue,f,A).point,at={},Ke=Nt(Y,Ae,!1,E,t,f,_,u.glyphOffsetArray,W,J,Me,Ue,at,se,T,A);he=Ke.useVertical,(Ke.notEnoughRoom||he||Ke.needsFlipping&&Nt(Y,Ae,!0,E,t,f,_,u.glyphOffsetArray,W,J,Me,Ue,at,se,T,A).notEnoughRoom)&&Pt(Y.numGlyphs,J)}h?u.text.dynamicLayoutVertexBuffer.updateData(J):u.icon.dynamicLayoutVertexBuffer.updateData(J)}function Rn(u,t,s,h,f,_,v,E,T,A,z,O,U){const J=E.glyphStartIndex+E.numGlyphs,W=E.lineStartIndex,X=E.lineStartIndex+E.lineLength,se=t.getoffsetX(E.glyphStartIndex),he=t.getoffsetX(J-1),pe=er(u*se,s,h,f,_,v,E.segment,W,X,T,A,z,O,U);if(!pe)return null;const Y=er(u*he,s,h,f,_,v,E.segment,W,X,T,A,z,O,U);return Y?{first:pe,last:Y}:null}function Xe(u,t,s,h){return u===a.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*h?{useVertical:!0}:(u===a.WritingMode.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function Nt(u,t,s,h,f,_,v,E,T,A,z,O,U,J,W,X){const se=t/24,he=u.lineOffsetX*se,pe=u.lineOffsetY*se;let Y;if(u.numGlyphs>1){const ye=u.glyphStartIndex+u.numGlyphs,ge=u.lineStartIndex,Ie=u.lineStartIndex+u.lineLength,Ae=Rn(se,E,he,pe,s,z,O,u,T,_,U,W,X);if(!Ae)return{notEnoughRoom:!0};const Ue=Jt(Ae.first.point,v,X).point,Me=Jt(Ae.last.point,v,X).point;if(h&&!s){const at=Xe(u.writingMode,Ue,Me,J);if(at)return at}Y=[Ae.first];for(let at=u.glyphStartIndex+1;at<ye-1;at++)Y.push(er(se*E.getoffsetX(at),he,pe,s,z,O,u.segment,ge,Ie,T,_,U,W,X));Y.push(Ae.last)}else{if(h&&!s){const ge=Jt(O,f,X).point,Ie=u.lineStartIndex+u.segment+1,Ae=new a.pointGeometry(T.getx(Ie),T.gety(Ie)),Ue=Jt(Ae,f,X),Me=Ue.signedDistanceFromCamera>0?Ue.point:Dt(O,Ae,ge,1,f,X),at=Xe(u.writingMode,ge,Me,J);if(at)return at}const ye=er(se*E.getoffsetX(u.glyphStartIndex),he,pe,s,z,O,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,T,_,U,W,X);if(!ye)return{notEnoughRoom:!0};Y=[ye]}for(const ye of Y)a.addDynamicAttributes(A,ye.point,ye.angle);return{}}function Dt(u,t,s,h,f,_){const v=Jt(u.add(u.sub(t)._unit()),f,_).point,E=s.sub(v);return s.add(E._mult(h/E.mag()))}function er(u,t,s,h,f,_,v,E,T,A,z,O,U,J){const W=h?u-t:u+t;let X=W>0?1:-1,se=0;h&&(X*=-1,se=Math.PI),X<0&&(se+=Math.PI);let he=X>0?E+v:E+v+1,pe=f,Y=f,ye=0,ge=0;const Ie=Math.abs(W),Ae=[];for(;ye+ge<=Ie;){if(he+=X,he<E||he>=T)return null;if(Y=pe,Ae.push(pe),pe=O[he],pe===void 0){const ot=new a.pointGeometry(A.getx(he),A.gety(he)),Rt=Jt(ot,z,J);if(Rt.signedDistanceFromCamera>0)pe=O[he]=Rt.point;else{const Vt=he-X;pe=Dt(ye===0?_:new a.pointGeometry(A.getx(Vt),A.gety(Vt)),ot,Y,Ie-ye+1,z,J)}}ye+=ge,ge=Y.dist(pe)}const Ue=(Ie-ye)/ge,Me=pe.sub(Y),at=Me.mult(Ue)._add(Y);at._add(Me._unit()._perp()._mult(s*X));const Ke=se+Math.atan2(pe.y-Y.y,pe.x-Y.x);return Ae.push(at),{point:at,angle:U?Ke:0,path:Ae}}const Bn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pt(u,t){for(let s=0;s<u;s++){const h=t.length;t.resize(h+4),t.float32.set(Bn,3*h)}}function vn(u,t,s){const h=t[0],f=t[1];return u[0]=s[0]*h+s[4]*f+s[12],u[1]=s[1]*h+s[5]*f+s[13],u[3]=s[3]*h+s[7]*f+s[15],u}const Zi=100;class xs{constructor(t,s=new Ye(t.width+200,t.height+200,25),h=new Ye(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=h,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Zi,this.screenBottomBoundary=t.height+Zi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,h,f,_,v){const E=this.projectAndGetPerspectiveRatio(f,t.anchorPointX,t.anchorPointY,v),T=h*E.perspectiveRatio,A=t.x1*T+E.point.x,z=t.y1*T+E.point.y,O=t.x2*T+E.point.x,U=t.y2*T+E.point.y;return!this.isInsideGrid(A,z,O,U)||s!=="always"&&this.grid.hitTest(A,z,O,U,s,_)||E.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,z,O,U],offscreen:this.isOffscreen(A,z,O,U)}}placeCollisionCircles(t,s,h,f,_,v,E,T,A,z,O,U,J,W){const X=[],se=new a.pointGeometry(s.anchorX,s.anchorY),he=Jt(se,v,W),pe=$r(this.transform.cameraToCenterDistance,he.signedDistanceFromCamera),Y=(z?_/pe:_*pe)/a.ONE_EM,ye=Jt(se,E,W).point,ge=Rn(Y,f,s.lineOffsetX*Y,s.lineOffsetY*Y,!1,ye,se,s,h,E,{},!1,W);let Ie=!1,Ae=!1,Ue=!0;if(ge){const Me=.5*U*pe+J,at=new a.pointGeometry(-100,-100),Ke=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ot=new yn,Rt=ge.first,Vt=ge.last;let bt=[];for(let Kt=Rt.path.length-1;Kt>=1;Kt--)bt.push(Rt.path[Kt]);for(let Kt=1;Kt<Vt.path.length;Kt++)bt.push(Vt.path[Kt]);const li=2.5*Me;if(T){const Kt=bt.map(ei=>Jt(ei,T,W));bt=Kt.some(ei=>ei.signedDistanceFromCamera<=0)?[]:Kt.map(ei=>ei.point)}let hi=[];if(bt.length>0){const Kt=bt[0].clone(),ei=bt[0].clone();for(let ui=1;ui<bt.length;ui++)Kt.x=Math.min(Kt.x,bt[ui].x),Kt.y=Math.min(Kt.y,bt[ui].y),ei.x=Math.max(ei.x,bt[ui].x),ei.y=Math.max(ei.y,bt[ui].y);hi=Kt.x>=at.x&&ei.x<=Ke.x&&Kt.y>=at.y&&ei.y<=Ke.y?[bt]:ei.x<at.x||Kt.x>Ke.x||ei.y<at.y||Kt.y>Ke.y?[]:a.clipLine([bt],at.x,at.y,Ke.x,Ke.y)}for(const Kt of hi){ot.reset(Kt,.25*Me);let ei=0;ei=ot.length<=.5*Me?1:Math.ceil(ot.paddedLength/li)+1;for(let ui=0;ui<ei;ui++){const Wi=ui/Math.max(ei-1,1),hn=ot.lerp(Wi),Yr=hn.x+Zi,cn=hn.y+Zi;X.push(Yr,cn,Me,0);const qn=Yr-Me,Gr=cn-Me,xr=Yr+Me,wn=cn+Me;if(Ue=Ue&&this.isOffscreen(qn,Gr,xr,wn),Ae=Ae||this.isInsideGrid(qn,Gr,xr,wn),t!=="always"&&this.grid.hitTestCircle(Yr,cn,Me,t,O)&&(Ie=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Ie}}}}return{circles:!A&&Ie||!Ae||pe<this.perspectiveRatioCutoff?[]:X,offscreen:Ue,collisionDetected:Ie}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,f=1/0,_=-1/0,v=-1/0;for(const z of t){const O=new a.pointGeometry(z.x+Zi,z.y+Zi);h=Math.min(h,O.x),f=Math.min(f,O.y),_=Math.max(_,O.x),v=Math.max(v,O.y),s.push(O)}const E=this.grid.query(h,f,_,v).concat(this.ignoredGrid.query(h,f,_,v)),T={},A={};for(const z of E){const O=z.key;if(T[O.bucketInstanceId]===void 0&&(T[O.bucketInstanceId]={}),T[O.bucketInstanceId][O.featureIndex])continue;const U=[new a.pointGeometry(z.x1,z.y1),new a.pointGeometry(z.x2,z.y1),new a.pointGeometry(z.x2,z.y2),new a.pointGeometry(z.x1,z.y2)];a.polygonIntersectsPolygon(s,U)&&(T[O.bucketInstanceId][O.featureIndex]=!0,A[O.bucketInstanceId]===void 0&&(A[O.bucketInstanceId]=[]),A[O.bucketInstanceId].push(O.featureIndex))}return A}insertCollisionBox(t,s,h,f,_,v){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:v,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,h,f,_,v){const E=h?this.ignoredGrid:this.grid,T={bucketInstanceId:f,featureIndex:_,collisionGroupID:v,overlapMode:s};for(let A=0;A<t.length;A+=4)E.insertCircle(T,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,s,h,f){let _;return f?(_=[s,h,f(s,h),1],a.transformMat4(_,_,t)):(_=[s,h,0,1],vn(_,_,t)),{point:new a.pointGeometry((_[0]/_[3]+1)/2*this.transform.width+Zi,(-_[1]/_[3]+1)/2*this.transform.height+Zi),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(t,s,h,f){return h<Zi||t>=this.screenRightBoundary||f<Zi||s>this.screenBottomBoundary}isInsideGrid(t,s,h,f){return h>=0&&t<this.gridRightBoundary&&f>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=a.identity([]);return a.translate(t,t,[-100,-100,0]),t}}function Fi(u,t,s){return t*(a.EXTENT/(u.tileSize*Math.pow(2,s-u.tileID.overscaledZ)))}class hr{constructor(t,s,h,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):f&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class ci{constructor(t,s,h,f,_){this.text=new hr(t?t.text:null,s,h,_),this.icon=new hr(t?t.icon:null,s,f,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class bs{constructor(t,s,h){this.text=t,this.icon=s,this.skipFade=h}}class an{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Yn{constructor(t,s,h,f,_){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=f,this.tileID=_}}class Qn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[t]}}function ws(u,t,s,h,f){const{horizontalAlign:_,verticalAlign:v}=a.getAnchorAlignment(u),E=-(_-.5)*t,T=-(v-.5)*s,A=a.evaluateVariableOffset(u,h);return new a.pointGeometry(E+A[0]*f,T+A[1]*f)}function es(u,t,s,h,f,_){const{x1:v,x2:E,y1:T,y2:A,anchorPointX:z,anchorPointY:O}=u,U=new a.pointGeometry(t,s);return h&&U._rotate(f?_:-_),{x1:v+U.x,y1:T+U.y,x2:E+U.x,y2:A+U.y,anchorPointX:z,anchorPointY:O}}class Z{constructor(t,s,h,f,_){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new xs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Qn(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,h,f){const _=h.getBucket(s),v=h.latestFeatureIndex;if(!_||!v||s.id!==_.layerIds[0])return;const E=h.collisionBoxArray,T=_.layers[0].layout,A=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),z=h.tileSize/a.EXTENT,O=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),U=T.get("text-pitch-alignment")==="map",J=T.get("text-rotation-alignment")==="map",W=Fi(h,1,this.transform.zoom),X=Jn(O,U,J,this.transform,W);let se=null;if(U){const pe=Kr(O,U,J,this.transform,W);se=a.multiply([],this.transform.labelPlaneMatrix,pe)}this.retainedQueryData[_.bucketInstanceId]=new Yn(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,h.tileID);const he={bucket:_,layout:T,posMatrix:O,textLabelPlaneMatrix:X,labelToScreenMatrix:se,scale:A,textPixelRatio:z,holdingForFade:h.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(f)for(const pe of _.sortKeyRanges){const{sortKey:Y,symbolInstanceStart:ye,symbolInstanceEnd:ge}=pe;t.push({sortKey:Y,symbolInstanceStart:ye,symbolInstanceEnd:ge,parameters:he})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:he})}attemptAnchorPlacement(t,s,h,f,_,v,E,T,A,z,O,U,J,W,X,se){const he=[U.textOffset0,U.textOffset1],pe=ws(t,h,f,he,_),Y=this.collisionIndex.placeCollisionBox(es(s,pe.x,pe.y,v,E,this.transform.angle),O,T,A,z.predicate,se);if((!X||this.collisionIndex.placeCollisionBox(es(X,pe.x,pe.y,v,E,this.transform.angle),O,T,A,z.predicate,se).box.length!==0)&&Y.box.length>0){let ye;if(this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(ye=this.prevPlacement.variableOffsets[U.crossTileID].anchor),U.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[U.crossTileID]={textOffset:he,width:h,height:f,anchor:t,textBoxScale:_,prevAnchor:ye},this.markUsedJustification(J,t,U,W),J.allowVerticalPlacement&&(this.markUsedOrientation(J,W,U),this.placedOrientations[U.crossTileID]=W),{shift:pe,placedGlyphBoxes:Y}}}placeLayerBucketPart(t,s,h){const{bucket:f,layout:_,posMatrix:v,textLabelPlaneMatrix:E,labelToScreenMatrix:T,textPixelRatio:A,holdingForFade:z,collisionBoxArray:O,partiallyEvaluatedTextSize:U,collisionGroup:J}=t.parameters,W=_.get("text-optional"),X=_.get("icon-optional"),se=a.getOverlapMode(_,"text-overlap","text-allow-overlap"),he=se==="always",pe=a.getOverlapMode(_,"icon-overlap","icon-allow-overlap"),Y=pe==="always",ye=_.get("text-rotation-alignment")==="map",ge=_.get("text-pitch-alignment")==="map",Ie=_.get("icon-text-fit")!=="none",Ae=_.get("symbol-z-order")==="viewport-y",Ue=he&&(Y||!f.hasIconData()||X),Me=Y&&(he||!f.hasTextData()||W);!f.collisionArrays&&O&&f.deserializeCollisionBoxes(O);const at=(Ke,ot)=>{if(s[Ke.crossTileID])return;if(z)return void(this.placements[Ke.crossTileID]=new bs(!1,!1,!1));let Rt=!1,Vt=!1,bt=!0,li=null,hi={box:null,offscreen:null},Kt={box:null,offscreen:null},ei=null,ui=null,Wi=null,hn=0,Yr=0,cn=0;ot.textFeatureIndex?hn=ot.textFeatureIndex:Ke.useRuntimeCollisionCircles&&(hn=Ke.featureIndex),ot.verticalTextFeatureIndex&&(Yr=ot.verticalTextFeatureIndex);const qn=this.retainedQueryData[f.bucketInstanceId].tileID,Gr=this.terrain?($i,Gt)=>this.terrain.getElevation(qn,$i,Gt):null;for(const $i of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Gt=ot[$i];Gt&&(Gt.elevation=Gr?Gr(Gt.anchorPointX,Gt.anchorPointY):0)}const xr=ot.textBox;if(xr){const $i=oi=>{let Xi=a.WritingMode.horizontal;if(f.allowVerticalPlacement&&!oi&&this.prevPlacement){const Ki=this.prevPlacement.placedOrientations[Ke.crossTileID];Ki&&(this.placedOrientations[Ke.crossTileID]=Ki,Xi=Ki,this.markUsedOrientation(f,Xi,Ke))}return Xi},Gt=(oi,Xi)=>{if(f.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&ot.verticalTextBox){for(const Ki of f.writingModes)if(Ki===a.WritingMode.vertical?(hi=Xi(),Kt=hi):hi=oi(),hi&&hi.box&&hi.box.length)break}else hi=oi()};if(_.get("text-variable-anchor")){let oi=_.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ke.crossTileID]){const Ii=this.prevPlacement.variableOffsets[Ke.crossTileID];oi.indexOf(Ii.anchor)>0&&(oi=oi.filter(jr=>jr!==Ii.anchor),oi.unshift(Ii.anchor))}const Xi=(Ii,jr,as)=>{const Qo=Ii.x2-Ii.x1,Rs=Ii.y2-Ii.y1,Ch=Ke.textBoxScale,el=Ie&&pe==="never"?jr:null;let Gn={box:[],offscreen:!1};const os=se!=="never"?2*oi.length:oi.length;for(let ls=0;ls<os;++ls){const ja=this.attemptAnchorPlacement(oi[ls%oi.length],Ii,Qo,Rs,Ch,ye,ge,A,v,J,ls>=oi.length?se:"never",Ke,f,as,el,Gr);if(ja&&(Gn=ja.placedGlyphBoxes,Gn&&Gn.box&&Gn.box.length)){Rt=!0,li=ja.shift;break}}return Gn};Gt(()=>Xi(xr,ot.iconBox,a.WritingMode.horizontal),()=>{const Ii=ot.verticalTextBox;return f.allowVerticalPlacement&&!(hi&&hi.box&&hi.box.length)&&Ke.numVerticalGlyphVertices>0&&Ii?Xi(Ii,ot.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),hi&&(Rt=hi.box,bt=hi.offscreen);const Ki=$i(hi&&hi.box);if(!Rt&&this.prevPlacement){const Ii=this.prevPlacement.variableOffsets[Ke.crossTileID];Ii&&(this.variableOffsets[Ke.crossTileID]=Ii,this.markUsedJustification(f,Ii.anchor,Ke,Ki))}}else{const oi=(Xi,Ki)=>{const Ii=this.collisionIndex.placeCollisionBox(Xi,se,A,v,J.predicate,Gr);return Ii&&Ii.box&&Ii.box.length&&(this.markUsedOrientation(f,Ki,Ke),this.placedOrientations[Ke.crossTileID]=Ki),Ii};Gt(()=>oi(xr,a.WritingMode.horizontal),()=>{const Xi=ot.verticalTextBox;return f.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&Xi?oi(Xi,a.WritingMode.vertical):{box:null,offscreen:null}}),$i(hi&&hi.box&&hi.box.length)}}if(ei=hi,Rt=ei&&ei.box&&ei.box.length>0,bt=ei&&ei.offscreen,Ke.useRuntimeCollisionCircles){const $i=f.text.placedSymbolArray.get(Ke.centerJustifiedTextSymbolIndex),Gt=a.evaluateSizeForFeature(f.textSizeData,U,$i),oi=_.get("text-padding");ui=this.collisionIndex.placeCollisionCircles(se,$i,f.lineVertexArray,f.glyphOffsetArray,Gt,v,E,T,h,ge,J.predicate,Ke.collisionCircleDiameter,oi,Gr),ui.circles.length&&ui.collisionDetected&&!h&&a.warnOnce("Collisions detected, but collision boxes are not shown"),Rt=he||ui.circles.length>0&&!ui.collisionDetected,bt=bt&&ui.offscreen}if(ot.iconFeatureIndex&&(cn=ot.iconFeatureIndex),ot.iconBox){const $i=Gt=>{const oi=Ie&&li?es(Gt,li.x,li.y,ye,ge,this.transform.angle):Gt;return this.collisionIndex.placeCollisionBox(oi,pe,A,v,J.predicate,Gr)};Kt&&Kt.box&&Kt.box.length&&ot.verticalIconBox?(Wi=$i(ot.verticalIconBox),Vt=Wi.box.length>0):(Wi=$i(ot.iconBox),Vt=Wi.box.length>0),bt=bt&&Wi.offscreen}const wn=W||Ke.numHorizontalGlyphVertices===0&&Ke.numVerticalGlyphVertices===0,Ga=X||Ke.numIconVertices===0;if(wn||Ga?Ga?wn||(Vt=Vt&&Rt):Rt=Vt&&Rt:Vt=Rt=Vt&&Rt,Rt&&ei&&ei.box&&this.collisionIndex.insertCollisionBox(ei.box,se,_.get("text-ignore-placement"),f.bucketInstanceId,Kt&&Kt.box&&Yr?Yr:hn,J.ID),Vt&&Wi&&this.collisionIndex.insertCollisionBox(Wi.box,pe,_.get("icon-ignore-placement"),f.bucketInstanceId,cn,J.ID),ui&&(Rt&&this.collisionIndex.insertCollisionCircles(ui.circles,se,_.get("text-ignore-placement"),f.bucketInstanceId,hn,J.ID),h)){const $i=f.bucketInstanceId;let Gt=this.collisionCircleArrays[$i];Gt===void 0&&(Gt=this.collisionCircleArrays[$i]=new an);for(let oi=0;oi<ui.circles.length;oi+=4)Gt.circles.push(ui.circles[oi+0]),Gt.circles.push(ui.circles[oi+1]),Gt.circles.push(ui.circles[oi+2]),Gt.circles.push(ui.collisionDetected?1:0)}if(Ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ke.crossTileID]=new bs(Rt||Ue,Vt||Me,bt||f.justReloaded),s[Ke.crossTileID]=!0};if(Ae){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ke=f.getSortedSymbolIndexes(this.transform.angle);for(let ot=Ke.length-1;ot>=0;--ot){const Rt=Ke[ot];at(f.symbolInstances.get(Rt),f.collisionArrays[Rt])}}else for(let Ke=t.symbolInstanceStart;Ke<t.symbolInstanceEnd;Ke++)at(f.symbolInstances.get(Ke),f.collisionArrays[Ke]);if(h&&f.bucketInstanceId in this.collisionCircleArrays){const Ke=this.collisionCircleArrays[f.bucketInstanceId];a.invert(Ke.invProjMatrix,v),Ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(t,s,h,f){let _;_=f===a.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(s)];const v=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const E of v)E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=_>=0&&E!==_?0:h.crossTileID)}markUsedOrientation(t,s,h){const f=s===a.WritingMode.horizontal||s===a.WritingMode.horizontalOnly?s:0,_=s===a.WritingMode.vertical?s:0,v=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const E of v)t.text.placedSymbolArray.get(E).placedOrientation=f;h.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const f=s?s.symbolFadeChange(t):1,_=s?s.opacities:{},v=s?s.variableOffsets:{},E=s?s.placedOrientations:{};for(const T in this.placements){const A=this.placements[T],z=_[T];z?(this.opacities[T]=new ci(z,f,A.text,A.icon),h=h||A.text!==z.text.placed||A.icon!==z.icon.placed):(this.opacities[T]=new ci(null,f,A.text,A.icon,A.skipFade),h=h||A.text||A.icon)}for(const T in _){const A=_[T];if(!this.opacities[T]){const z=new ci(A,f,!1,!1);z.isHidden()||(this.opacities[T]=z,h=h||A.text.placed||A.icon.placed)}}for(const T in v)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=v[T]);for(const T in E)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=E[T]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const h={};for(const f of s){const _=f.getBucket(t);_&&f.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,h,f.collisionBoxArray)}}updateBucketOpacities(t,s,h){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const f=t.layers[0].layout,_=new ci(null,0,!1,!1,!0),v=f.get("text-allow-overlap"),E=f.get("icon-allow-overlap"),T=f.get("text-variable-anchor"),A=f.get("text-rotation-alignment")==="map",z=f.get("text-pitch-alignment")==="map",O=f.get("icon-text-fit")!=="none",U=new ci(null,0,v&&(E||!t.hasIconData()||f.get("icon-optional")),E&&(v||!t.hasTextData()||f.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const J=(W,X,se)=>{for(let he=0;he<X/4;he++)W.opacityVertexArray.emplaceBack(se)};for(let W=0;W<t.symbolInstances.length;W++){const X=t.symbolInstances.get(W),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:he,crossTileID:pe}=X;let Y=this.opacities[pe];s[pe]?Y=_:Y||(Y=U,this.opacities[pe]=Y),s[pe]=!0;const ye=X.numIconVertices>0,ge=this.placedOrientations[X.crossTileID],Ie=ge===a.WritingMode.vertical,Ae=ge===a.WritingMode.horizontal||ge===a.WritingMode.horizontalOnly;if(se>0||he>0){const Ue=oe(Y.text);J(t.text,se,Ie?we:Ue),J(t.text,he,Ae?we:Ue);const Me=Y.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(ot=>{ot>=0&&(t.text.placedSymbolArray.get(ot).hidden=Me||Ie?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=Me||Ae?1:0);const at=this.variableOffsets[X.crossTileID];at&&this.markUsedJustification(t,at.anchor,X,ge);const Ke=this.placedOrientations[X.crossTileID];Ke&&(this.markUsedJustification(t,"left",X,Ke),this.markUsedOrientation(t,Ke,X))}if(ye){const Ue=oe(Y.icon),Me=!(O&&X.verticalPlacedIconSymbolIndex&&Ie);X.placedIconSymbolIndex>=0&&(J(t.icon,X.numIconVertices,Me?Ue:we),t.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=Y.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&(J(t.icon,X.numVerticalIconVertices,Me?we:Ue),t.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=Y.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ue=t.collisionArrays[W];if(Ue){let Me=new a.pointGeometry(0,0);if(Ue.textBox||Ue.verticalTextBox){let Ke=!0;if(T){const ot=this.variableOffsets[pe];ot?(Me=ws(ot.anchor,ot.width,ot.height,ot.textOffset,ot.textBoxScale),A&&Me._rotate(z?this.transform.angle:-this.transform.angle)):Ke=!1}Ue.textBox&&C(t.textCollisionBox.collisionVertexArray,Y.text.placed,!Ke||Ie,Me.x,Me.y),Ue.verticalTextBox&&C(t.textCollisionBox.collisionVertexArray,Y.text.placed,!Ke||Ae,Me.x,Me.y)}const at=Boolean(!Ae&&Ue.verticalIconBox);Ue.iconBox&&C(t.iconCollisionBox.collisionVertexArray,Y.icon.placed,at,O?Me.x:0,O?Me.y:0),Ue.verticalIconBox&&C(t.iconCollisionBox.collisionVertexArray,Y.icon.placed,!at,O?Me.x:0,O?Me.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const W=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=W.invProjMatrix,t.placementViewportMatrix=W.viewportMatrix,t.collisionCircleArray=W.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function C(u,t,s,h,f){u.emplaceBack(t?1:0,s?1:0,h||0,f||0),u.emplaceBack(t?1:0,s?1:0,h||0,f||0),u.emplaceBack(t?1:0,s?1:0,h||0,f||0),u.emplaceBack(t?1:0,s?1:0,h||0,f||0)}const B=Math.pow(2,25),G=Math.pow(2,24),j=Math.pow(2,17),ie=Math.pow(2,16),ae=Math.pow(2,9),ne=Math.pow(2,8),re=Math.pow(2,1);function oe(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,s=Math.floor(127*u.opacity);return s*B+t*G+s*j+t*ie+s*ae+t*ne+s*re+t}const we=0;class Oe{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,h,f,_){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(v,f,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((E,T)=>E.sortKey-T.sortKey));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,_())return!0;return!1}}class be{constructor(t,s,h,f,_,v,E,T){this.placement=new Z(t,s,v,E,T),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,s,h){const f=a.exported.now(),_=()=>{const v=a.exported.now()-f;return!this._forceFullPlacement&&v>2};for(;this._currentPlacementIndex>=0;){const v=s[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=E)&&(!v.maxzoom||v.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Oe(v)),this._inProgressLayer.continuePlacement(h[v.source],this.placement,this._showCollisionBoxes,v,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ft=512/a.EXTENT/2;class mt{constructor(t,s,h){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(let f=0;f<s.length;f++){const _=s.get(f),v=_.key;this.indexedSymbolInstances[v]||(this.indexedSymbolInstances[v]=[]),this.indexedSymbolInstances[v].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,t)})}}getScaledCoordinates(t,s){const h=ft/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*a.EXTENT+t.anchorX)*h),y:Math.floor((s.canonical.y*a.EXTENT+t.anchorY)*h)}}findMatches(t,s,h){const f=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let _=0;_<t.length;_++){const v=t.get(_);if(v.crossTileID)continue;const E=this.indexedSymbolInstances[v.key];if(!E)continue;const T=this.getScaledCoordinates(v,s);for(const A of E)if(Math.abs(A.coord.x-T.x)<=f&&Math.abs(A.coord.y-T.y)<=f&&!h[A.crossTileID]){h[A.crossTileID]=!0,v.crossTileID=A.crossTileID;break}}}}class rt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Et{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const h in this.indexes){const f=this.indexes[h],_={};for(const v in f){const E=f[v];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+s),_[E.tileID.key]=E}this.indexes[h]=_}this.lng=t}addBucket(t,s,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<s.symbolInstances.length;_++)s.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const f=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>t.overscaledZ)for(const E in v){const T=v[E];T.tileID.isChildOf(t)&&T.findMatches(s.symbolInstances,t,f)}else{const E=v[t.scaledTo(Number(_)).key];E&&E.findMatches(s.symbolInstances,t,f)}}for(let _=0;_<s.symbolInstances.length;_++){const v=s.symbolInstances.get(_);v.crossTileID||(v.crossTileID=h.generate(),f[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new mt(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const h in s.indexedSymbolInstances)for(const f of s.indexedSymbolInstances[h])delete this.usedCrossTileIDs[t][f.crossTileID]}removeStaleBuckets(t){let s=!1;for(const h in this.indexes){const f=this.indexes[h];for(const _ in f)t[f[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,f[_]),delete f[_],s=!0)}return s}}class Ct{constructor(){this.layerIndexes={},this.crossTileIDs=new rt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,h){let f=this.layerIndexes[t.id];f===void 0&&(f=this.layerIndexes[t.id]=new Et);let _=!1;const v={};f.handleWrapJump(h);for(const E of s){const T=E.getBucket(t);T&&t.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(E.tileID,T,this.crossTileIDs)&&(_=!0),v[T.bucketInstanceId]=!0)}return f.removeStaleBuckets(v)&&(_=!0),_}pruneUnusedLayers(t){const s={};t.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}var Yt=a.createLayout([{name:"a_pos",type:"Int16",components:2}]);class kt extends a.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const s=this._tiles[t];s.textures.forEach(h=>h.destroy()),s.textures=[]}}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];for(const h of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.posMatrix=new Float64Array(16),a.ortho(h.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),this._tiles[h.key]=new zt(h,this.tileSize))}removeOutdated(t){const s={};this.renderHistory=this.renderHistory.filter((h,f)=>this.renderHistory.indexOf(h)===f).slice(0,this.renderHistorySize);for(const h of this._renderableTilesKeys)s[h]=!0;for(const h of this.renderHistory)s[h]=!0;for(const h in this._tiles)s[h]||(this._tiles[h].clearTextures(t),delete this._tiles[h])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const h of this._renderableTilesKeys){const f=this._tiles[h].tileID;if(f.canonical.equals(t.canonical)){const _=t.clone();_.posMatrix=new Float64Array(16),a.ortho(_.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),s[h]=_}else if(f.canonical.isChildOf(t.canonical)){const _=t.clone();_.posMatrix=new Float64Array(16);const v=f.canonical.z-t.canonical.z,E=f.canonical.x-(f.canonical.x>>v<<v),T=f.canonical.y-(f.canonical.y>>v<<v),A=a.EXTENT>>v;a.ortho(_.posMatrix,0,A,0,A,0,1),a.translate(_.posMatrix,_.posMatrix,[-E*A,-T*A,0]),s[h]=_}else if(t.canonical.isChildOf(f.canonical)){const _=t.clone();_.posMatrix=new Float64Array(16);const v=t.canonical.z-f.canonical.z,E=t.canonical.x-(t.canonical.x>>v<<v),T=t.canonical.y-(t.canonical.y>>v<<v),A=a.EXTENT>>v;a.ortho(_.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),a.translate(_.posMatrix,_.posMatrix,[E*A,T*A,0]),a.scale(_.posMatrix,_.posMatrix,[1/2**v,1/2**v,0]),s[h]=_}}return s}getSourceTile(t,s){const h=this.sourceCache._source;let f=t.overscaledZ-this.deltaZoom;if(f>h.maxzoom&&(f=h.maxzoom),f<h.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(f).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!_||!_.dem)&&s)for(;f>=h.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(t.scaledTo(f--).key);return _}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeLoaded>=t)}}class Ut{constructor(t,s,h){this.style=t,this.sourceCache=new kt(s),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.elevationOffset=typeof h.elevationOffset=="number"?h.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,s,h,f=a.EXTENT){if(!(s>=0&&s<f&&h>=0&&h<f))return this.elevationOffset;let _=0;const v=this.getTerrainData(t);if(v.tile&&v.tile.dem){const E=a.transformMat4$1([],[s/f*a.EXTENT,h/f*a.EXTENT],v.u_terrain_matrix),T=[E[0]*v.tile.dem.dim,E[1]*v.tile.dem.dim],A=[Math.floor(T[0]),Math.floor(T[1])],z=v.tile.dem.get(A[0],A[1]),O=v.tile.dem.get(A[0],A[1]+1),U=v.tile.dem.get(A[0]+1,A[1]),J=v.tile.dem.get(A[0]+1,A[1]+1);_=a.number(a.number(z,O,T[0]-A[0]),a.number(U,J,T[0]-A[0]),T[1]-A[1])}return _}rememberForRerender(t,s){for(const h in this.sourceCache._tiles){const f=this.sourceCache._tiles[h];(f.tileID.equals(s)||f.tileID.isChildOf(s))&&(t===this.sourceCache.sourceCache.id&&(f.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][f.tileID.key]=!0)}}needsRerender(t,s){return this._rerender[t]&&this._rerender[t][s.key]}clearRerenderCache(){this._rerender={}}getElevation(t,s,h,f=a.EXTENT){return(this.getDEMElevation(t,s,h,f)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const f=this.style.map.painter.context,_=new a.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new de(f,_,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new de(f,new a.RGBAImage({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.identity([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const f=this.style.map.painter.context;s.demTexture=this.style.map.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new de(f,s.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),s.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const h=s&&s+s.tileID.key+t.key;if(h&&!this._demMatrixCache[h]){const f=this.sourceCache.sourceCache._source.maxzoom;let _=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=f?_=t.canonical.z-f:a.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>_<<_),E=t.canonical.y-(t.canonical.y>>_<<_),T=a.fromScaling(new Float64Array(16),[1/(a.EXTENT<<_),1/(a.EXTENT<<_),0]);a.translate(T,T,[v*a.EXTENT,E*a.EXTENT,0]),this._demMatrixCache[t.key]={matrix:T,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const s=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(s,s,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,s,s))}return this._rttFramebuffer}getFramebuffer(t){const s=this.style.map.painter,h=s.width/devicePixelRatio,f=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new de(s.context,{width:h,height:f,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new de(s.context,{width:h,height:f,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(h,f,!0),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,h,f))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,v=0;_<this._coordsTextureSize;_++)for(let E=0;E<this._coordsTextureSize;E++,v+=4)s[v+0]=255&E,s[v+1]=255&_,s[v+2]=E>>8<<4|_>>8,s[v+3]=0;const h=new a.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),f=new de(t,h,t.gl.RGBA,{premultiply:!1});return f.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(t){const s=new Uint8Array(4),h=this.style.map.painter,f=h.context,_=f.gl;f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),_.readPixels(t.x,h.height/devicePixelRatio-t.y-1,1,1,_.RGBA,_.UNSIGNED_BYTE,s),f.bindFramebuffer.set(null);const v=s[0]+(s[2]>>4<<8),E=s[1]+((15&s[2])<<8),T=this.coordsIndex[255-s[3]],A=T&&this.sourceCache.getTileByID(T);if(!A)return null;const z=this._coordsTextureSize,O=(1<<A.tileID.canonical.z)*z;return new a.MercatorCoordinate((A.tileID.canonical.x*z+v)/O,(A.tileID.canonical.y*z+E)/O,this.getElevation(A.tileID,v,E,z))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,s=new a.PosArray,h=new a.TriangleIndexArray,f=this.meshSize,_=a.EXTENT/f,v=f*f;for(let E=0;E<=f;E++)for(let T=0;T<=f;T++)s.emplaceBack(T*_,E*_);for(let E=0;E<v;E+=f+1)for(let T=0;T<f;T++)h.emplaceBack(T+E,f+T+E+1,f+T+E+2),h.emplaceBack(T+E,f+T+E+2,T+E+1);return this._mesh={indexBuffer:t.createIndexBuffer(h),vertexBuffer:t.createVertexBuffer(s,Yt.members),segments:a.SegmentVector.simpleSegment(0,0,s.length,h.length)},this._mesh}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,h={minElevation:null,maxElevation:null};return s&&s.dem&&(h.minElevation=(s.dem.min+this.elevationOffset)*this.exaggeration,h.maxElevation=(s.dem.max+this.elevationOffset)*this.exaggeration),h}}const Qt=(u,t)=>a.emitValidationErrors(u,t&&t.filter(s=>s.identifier!=="source.canvas")),fi=a.pick(Wt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Hi=a.pick(Wt,["setCenter","setZoom","setBearing","setPitch"]),Mi=function(){const u={},t=a.spec.$version;for(const s in a.spec.$root){const h=a.spec.$root[s];if(h.required){let f=null;f=s==="version"?t:h.type==="array"?[]:{},f!=null&&(u[s]=f)}}return u}();class rr extends a.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new He(Xr(),this),this.imageManager=new De,this.imageManager.setEventedParent(this),this.glyphManager=new qe(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Se(256,512),this.crossTileSymbolIndex=new Ct,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const h=this;this._rtlTextPluginCallback=rr.registerForPluginStateChange(f=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(_,v)=>{if(a.triggerPluginCompletionEvent(_),v&&v.every(E=>E))for(const E in h.sourceCaches)h.sourceCaches[E].reload()})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const _=this.sourceCaches[f.sourceId];if(!_)return;const v=_.getSource();if(v&&v.vectorLayerIds)for(const E in this._layers){const T=this._layers[E];T.source===v.id&&this._validateLayer(T)}})}loadURL(t,s={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const h=typeof s.validate!="boolean"||s.validate,f=this.map._requestManager.transformRequest(t,a.ResourceType.Style);this._request=a.getJSON(f,(_,v)=>{this._request=null,_?this.fire(new a.ErrorEvent(_)):v&&this._load(v,h)})}loadJSON(t,s={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Mi,!1)}_load(t,s){if(s&&Qt(this,a.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const f in t.sources)this.addSource(f,t.sources[f],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const h=Kn(this.stylesheet.layers);this._order=h.map(f=>f.id),this._layers={},this._serializedLayers={};for(let f of h)f=a.createStyleLayer(f),f.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=f,this._serializedLayers[f.id]=f.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Pe(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(s,h,f,_){let v,E,T;const A=f>1?"@2x":"";let z=a.getJSON(h.transformRequest(h.normalizeSpriteURL(s,A,".json"),a.ResourceType.SpriteJSON),(J,W)=>{z=null,T||(T=J,v=W,U())}),O=a.getImage(h.transformRequest(h.normalizeSpriteURL(s,A,".png"),a.ResourceType.SpriteImage),(J,W)=>{O=null,T||(T=J,E=W,U())});function U(){if(T)_(T);else if(v&&E){const J=a.exported.getImageData(E),W={};for(const X in v){const{width:se,height:he,x:pe,y:Y,sdf:ye,pixelRatio:ge,stretchX:Ie,stretchY:Ae,content:Ue}=v[X],Me=new a.RGBAImage({width:se,height:he});a.RGBAImage.copy(J,Me,{x:pe,y:Y},{x:0,y:0},{width:se,height:he}),W[X]={data:Me,pixelRatio:ge,sdf:ye,stretchX:Ie,stretchY:Ae,content:Ue}}_(null,W)}}return{cancel(){z&&(z.cancel(),z=null),O&&(O.cancel(),O=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(s,h)=>{if(this._spriteRequest=null,s)this.fire(new a.ErrorEvent(s));else if(h)for(const f in h)this.imageManager.addImage(f,h[f]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const h=t.sourceLayer;if(!h)return;const f=s.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(h)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${f.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const s=[];for(const h of t){const f=this._layers[h];f.type!=="custom"&&s.push(f.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const f=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(f.length||_.length)&&this._updateWorkerLayers(f,_);for(const v in this._updatedSources){const E=this._updatedSources[v];if(E==="reload")this._reloadSource(v);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(v)}}this._updateTilesForChangedImages();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const h={};for(const f in this.sourceCaches){const _=this.sourceCaches[f];h[f]=_.used,_.used=!1}for(const f of this._order){const _=this._layers[f];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const f in h){const _=this.sourceCaches[f];h[f]!==_.used&&_.fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const s=this.sourceCaches[t.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new Ut(this,s,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=h=>{h.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=h=>{h.tile&&(h.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(h.sourceId,h.tile.tileID)):h.source.type==="geojson"&&this.terrain.rememberForRerender(h.sourceId,h.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new a.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),Qt(this,a.validateStyle(t)))return!1;(t=a.clone$1(t)).layers=Kn(t.layers);const s=function(f,_){if(!f)return[{command:Wt.setStyle,args:[_]}];let v=[];try{if(!R(f.version,_.version))return[{command:Wt.setStyle,args:[_]}];R(f.center,_.center)||v.push({command:Wt.setCenter,args:[_.center]}),R(f.zoom,_.zoom)||v.push({command:Wt.setZoom,args:[_.zoom]}),R(f.bearing,_.bearing)||v.push({command:Wt.setBearing,args:[_.bearing]}),R(f.pitch,_.pitch)||v.push({command:Wt.setPitch,args:[_.pitch]}),R(f.sprite,_.sprite)||v.push({command:Wt.setSprite,args:[_.sprite]}),R(f.glyphs,_.glyphs)||v.push({command:Wt.setGlyphs,args:[_.glyphs]}),R(f.transition,_.transition)||v.push({command:Wt.setTransition,args:[_.transition]}),R(f.light,_.light)||v.push({command:Wt.setLight,args:[_.light]});const E={},T=[];(function(z,O,U,J){let W;for(W in O=O||{},z=z||{})Object.prototype.hasOwnProperty.call(z,W)&&(Object.prototype.hasOwnProperty.call(O,W)||lr(W,U,J));for(W in O)Object.prototype.hasOwnProperty.call(O,W)&&(Object.prototype.hasOwnProperty.call(z,W)?R(z[W],O[W])||(z[W].type==="geojson"&&O[W].type==="geojson"&&mn(z,O,W)?U.push({command:Wt.setGeoJSONSourceData,args:[W,O[W].data]}):yr(W,O,U,J)):_r(W,O,U))})(f.sources,_.sources,T,E);const A=[];f.layers&&f.layers.forEach(z=>{E[z.source]?v.push({command:Wt.removeLayer,args:[z.id]}):A.push(z)}),v=v.concat(T),function(z,O,U){O=O||[];const J=(z=z||[]).map(_n),W=O.map(_n),X=z.reduce(vs,{}),se=O.reduce(vs,{}),he=J.slice(),pe=Object.create(null);let Y,ye,ge,Ie,Ae,Ue,Me;for(Y=0,ye=0;Y<J.length;Y++)ge=J[Y],Object.prototype.hasOwnProperty.call(se,ge)?ye++:(U.push({command:Wt.removeLayer,args:[ge]}),he.splice(he.indexOf(ge,ye),1));for(Y=0,ye=0;Y<W.length;Y++)ge=W[W.length-1-Y],he[he.length-1-Y]!==ge&&(Object.prototype.hasOwnProperty.call(X,ge)?(U.push({command:Wt.removeLayer,args:[ge]}),he.splice(he.lastIndexOf(ge,he.length-ye),1)):ye++,Ue=he[he.length-Y],U.push({command:Wt.addLayer,args:[se[ge],Ue]}),he.splice(he.length-Y,0,ge),pe[ge]=!0);for(Y=0;Y<W.length;Y++)if(ge=W[Y],Ie=X[ge],Ae=se[ge],!pe[ge]&&!R(Ie,Ae))if(R(Ie.source,Ae.source)&&R(Ie["source-layer"],Ae["source-layer"])&&R(Ie.type,Ae.type)){for(Me in gn(Ie.layout,Ae.layout,U,ge,null,Wt.setLayoutProperty),gn(Ie.paint,Ae.paint,U,ge,null,Wt.setPaintProperty),R(Ie.filter,Ae.filter)||U.push({command:Wt.setFilter,args:[ge,Ae.filter]}),R(Ie.minzoom,Ae.minzoom)&&R(Ie.maxzoom,Ae.maxzoom)||U.push({command:Wt.setLayerZoomRange,args:[ge,Ae.minzoom,Ae.maxzoom]}),Ie)Object.prototype.hasOwnProperty.call(Ie,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?gn(Ie[Me],Ae[Me],U,ge,Me.slice(6),Wt.setPaintProperty):R(Ie[Me],Ae[Me])||U.push({command:Wt.setLayerProperty,args:[ge,Me,Ae[Me]]}));for(Me in Ae)Object.prototype.hasOwnProperty.call(Ae,Me)&&!Object.prototype.hasOwnProperty.call(Ie,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?gn(Ie[Me],Ae[Me],U,ge,Me.slice(6),Wt.setPaintProperty):R(Ie[Me],Ae[Me])||U.push({command:Wt.setLayerProperty,args:[ge,Me,Ae[Me]]}))}else U.push({command:Wt.removeLayer,args:[ge]}),Ue=he[he.lastIndexOf(ge)+1],U.push({command:Wt.addLayer,args:[Ae,Ue]})}(A,_.layers,v)}catch(E){console.warn("Unable to compute style diff:",E),v=[{command:Wt.setStyle,args:[_]}]}return v}(this.serialize(),t).filter(f=>!(f.command in Hi));if(s.length===0)return!1;const h=s.filter(f=>!(f.command in fi));if(h.length>0)throw new Error(`Unimplemented: ${h.map(f=>f.command).join(", ")}.`);return s.forEach(f=>{f.command!=="setTransition"&&this[f.command].apply(this,f.args)}),this.stylesheet=t,!0}addImage(t,s){if(this.getImage(t))return this.fire(new a.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,h={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(a.validateStyle.source,`sources.${t}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const f=this.sourceCaches[t]=new ii(t,s,this.dispatcher);f.style=this,f.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:f.serialize(),sourceId:t})),f.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${h}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const h=this.sourceCaches[t].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,h={}){this._checkLoaded();const f=t.id;if(this.getLayer(f))return void this.fire(new a.ErrorEvent(new Error(`Layer "${f}" already exists on this map.`)));let _;if(t.type==="custom"){if(Qt(this,a.validateCustomStyleLayer(t)))return;_=a.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(f,t.source),t=a.clone$1(t),t=a.extend(t,{source:f})),this._validate(a.validateStyle.layer,`layers.${f}`,t,{arrayIndex:-1},h))return;_=a.createStyleLayer(t),this._validateLayer(_),_.setEventedParent(this,{layer:{id:f}}),this._serializedLayers[_.id]=_.serialize()}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new a.ErrorEvent(new Error(`Cannot add layer "${f}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,f),this._layerOrderChanged=!0,this._layers[f]=_,this._removedLayers[f]&&_.source&&_.type!=="custom"){const E=this._removedLayers[f];delete this._removedLayers[f],E.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const h=this._order.indexOf(t);this._order.splice(h,1);const f=s?this._order.indexOf(s):this._order.length;s&&f===-1?this.fire(new a.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(f,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new a.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,h){this._checkLoaded();const f=this.getLayer(t);f?f.minzoom===s&&f.maxzoom===h||(s!=null&&(f.minzoom=s),h!=null&&(f.maxzoom=h),this._updateLayer(f)):this.fire(new a.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,h={}){this._checkLoaded();const f=this.getLayer(t);if(f){if(!R(f.filter,s))return s==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(a.validateStyle.filter,`layers.${f.id}.filter`,s,null,h)||(f.filter=a.clone$1(s),this._updateLayer(f)))}else this.fire(new a.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return a.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,s,h,f={}){this._checkLoaded();const _=this.getLayer(t);_?R(_.getLayoutProperty(s),h)||(_.setLayoutProperty(s,h,f),this._updateLayer(_)):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const h=this.getLayer(t);if(h)return h.getLayoutProperty(s);this.fire(new a.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,h,f={}){this._checkLoaded();const _=this.getLayer(t);_?R(_.getPaintProperty(s),h)||(_.setPaintProperty(s,h,f)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const h=t.source,f=t.sourceLayer,_=this.sourceCaches[h];if(_===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const v=_.getSource().type;v==="geojson"&&f?this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||f?(t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),_.setFeatureState(f,t.id,s)):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const h=t.source,f=this.sourceCaches[h];if(f===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const _=f.getSource().type,v=_==="vector"?t.sourceLayer:void 0;_!=="vector"||v?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(v,t.id,s):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,h=t.sourceLayer,f=this.sourceCaches[s];if(f!==void 0)return f.getSource().type!=="vector"||h?(t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),f.getFeatureState(h,t.id)):void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:a.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=v=>this._layers[v].type==="fill-extrusion",h={},f=[];for(let v=this._order.length-1;v>=0;v--){const E=this._order[v];if(s(E)){h[E]=v;for(const T of t){const A=T[E];if(A)for(const z of A)f.push(z)}}}f.sort((v,E)=>E.intersectionZ-v.intersectionZ);const _=[];for(let v=this._order.length-1;v>=0;v--){const E=this._order[v];if(s(E))for(let T=f.length-1;T>=0;T--){const A=f[T].feature;if(h[A.layer.id]<v)break;_.push(A),f.pop()}else for(const T of t){const A=T[E];if(A)for(const z of A)_.push(z.feature)}}return _}queryRenderedFeatures(t,s,h){s&&s.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const f={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const v of s.layers){const E=this._layers[v];if(!E)return this.fire(new a.ErrorEvent(new Error(`The layer '${v}' does not exist in the map's style and cannot be queried for features.`))),[];f[E.source]=!0}}const _=[];s.availableImages=this._availableImages;for(const v in this.sourceCaches)s.layers&&!f[v]||_.push(st(this.sourceCaches[v],this._layers,this._serializedLayers,t,s,h));return this.placement&&_.push(function(v,E,T,A,z,O,U){const J={},W=O.queryRenderedSymbols(A),X=[];for(const se of Object.keys(W).map(Number))X.push(U[se]);X.sort(At);for(const se of X){const he=se.featureIndex.lookupSymbolFeatures(W[se.bucketInstanceId],E,se.bucketIndex,se.sourceLayerIndex,z.filter,z.layers,z.availableImages,v);for(const pe in he){const Y=J[pe]=J[pe]||[],ye=he[pe];ye.sort((ge,Ie)=>{const Ae=se.featureSortOrder;if(Ae){const Ue=Ae.indexOf(ge.featureIndex);return Ae.indexOf(Ie.featureIndex)-Ue}return Ie.featureIndex-ge.featureIndex});for(const ge of ye)Y.push(ge)}}for(const se in J)J[se].forEach(he=>{const pe=he.feature,Y=T[v[se].source].getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=Y});return J}(this._layers,this._serializedLayers,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,s){s&&s.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const h=this.sourceCaches[t];return h?function(f,_){const v=f.getRenderableIds().map(A=>f.getTileByID(A)),E=[],T={};for(let A=0;A<v.length;A++){const z=v[A],O=z.tileID.canonical.key;T[O]||(T[O]=!0,z.querySourceFeatures(E,_))}return E}(h,s):[]}addSourceType(t,s,h){return rr.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(rr.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const h=this.light.getLight();let f=!1;for(const v in t)if(!R(t[v],h[v])){f=!0;break}if(!f)return;const _={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(_)}_validate(t,s,h,f,_={}){return(!_||_.validate!==!1)&&Qt(this,t.call(a.validateStyle,a.extend({key:s,style:this.serialize(),value:h,styleSpec:a.spec},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const s=this.sourceCaches[t];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,h,f,_=!1){let v=!1,E=!1;const T={};for(const A of this._order){const z=this._layers[A];if(z.type!=="symbol")continue;if(!T[z.source]){const U=this.sourceCaches[z.source];T[z.source]=U.getRenderableIds(!0).map(J=>U.getTileByID(J)).sort((J,W)=>W.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(W.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(z,T[z.source],t.center.lng);v=v||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),t.zoom))&&(this.pauseablePlacement=new be(t,this.terrain,this._order,_,s,h,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),E=!0),v&&this.pauseablePlacement.placement.setStale()),E||v)for(const A of this._order){const z=this._layers[A];z.type==="symbol"&&this.placement.updateLayerOpacities(z,T[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,h){this.imageManager.getImages(s.icons,h),this._updateTilesForChangedImages();const f=this.sourceCaches[s.source];f&&f.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(t,s,h){this.glyphManager.getGlyphs(s.stacks,h)}getResource(t,s,h){return a.makeRequest(s,h)}}rr.getSourceType=function(u){return Ge[u]},rr.setSourceType=function(u,t){Ge[u]=t},rr.registerForPluginStateChange=a.registerForPluginStateChange;var Ms="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Zs={prelude:pi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:pi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:pi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:pi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:pi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:pi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:pi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:pi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:pi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:pi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:pi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:pi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:pi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:pi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:pi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:pi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:pi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:pi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:pi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:pi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:pi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:pi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:pi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ms),terrainDepth:pi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ms),terrainCoords:pi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ms)};function pi(u,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=t.match(/attribute ([\w]+) ([\w]+)/g),f=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=_?_.concat(f):f,E={};return{fragmentSource:u=u.replace(s,(T,A,z,O,U)=>(E[U]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${U}
varying ${z} ${O} ${U};
#else
uniform ${z} ${O} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${z} ${O} ${U} = u_${U};
#endif
`)),vertexSource:t=t.replace(s,(T,A,z,O,U)=>{const J=O==="float"?"vec2":"vec4",W=U.match(/color/)?"color":J;return E[U]?A==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${z} ${J} a_${U};
varying ${z} ${O} ${U};
#else
uniform ${z} ${O} u_${U};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${z} ${O} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${W}(a_${U}, u_${U}_t);
#else
    ${z} ${O} ${U} = u_${U};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${z} ${J} a_${U};
#else
uniform ${z} ${O} u_${U};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${z} ${O} ${U} = a_${U};
#else
    ${z} ${O} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${z} ${O} ${U} = unpack_mix_${W}(a_${U}, u_${U}_t);
#else
    ${z} ${O} ${U} = u_${U};
#endif
`}),staticAttributes:h,staticUniforms:v}}class bo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,h,f,_,v,E,T,A){this.context=t;let z=this.boundPaintVertexBuffers.length!==f.length;for(let O=0;!z&&O<f.length;O++)this.boundPaintVertexBuffers[O]!==f[O]&&(z=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===h&&!z&&this.boundIndexBuffer===_&&this.boundVertexOffset===v&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===T&&this.boundDynamicVertexBuffer3===A?(t.bindVertexArrayOES.set(this.vao),E&&E.bind(),_&&_.dynamicDraw&&_.bind(),T&&T.bind(),A&&A.bind()):this.freshBind(s,h,f,_,v,E,T,A)}freshBind(t,s,h,f,_,v,E,T){let A;const z=t.numAttributes,O=this.context,U=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=f,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=T;else{A=O.currentNumAttributes||0;for(let J=z;J<A;J++)U.disableVertexAttribArray(J)}s.enableAttributes(U,t);for(const J of h)J.enableAttributes(U,t);v&&v.enableAttributes(U,t),E&&E.enableAttributes(U,t),T&&T.enableAttributes(U,t),s.bind(),s.setVertexAttribPointers(U,t,_);for(const J of h)J.bind(),J.setVertexAttribPointers(U,t,_);v&&(v.bind(),v.setVertexAttribPointers(U,t,_)),f&&f.bind(),E&&(E.bind(),E.setVertexAttribPointers(U,t,_)),T&&(T.bind(),T.setVertexAttribPointers(U,t,_)),O.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function wo(u){const t=[];for(let s=0;s<u.length;s++){if(u[s]===null)continue;const h=u[s].split(" ");t.push(h.pop())}return t}class jl{constructor(t,s,h,f,_,v,E){const T=t.gl;this.program=T.createProgram();const A=wo(h.staticAttributes),z=f?f.getBinderAttributes():[],O=A.concat(z),U=Zs.prelude.staticUniforms?wo(Zs.prelude.staticUniforms):[],J=h.staticUniforms?wo(h.staticUniforms):[],W=f?f.getBinderUniforms():[],X=U.concat(J).concat(W),se=[];for(const Ae of X)se.indexOf(Ae)<0&&se.push(Ae);const he=f?f.defines():[];v&&he.push("#define OVERDRAW_INSPECTOR;"),E&&he.push("#define TERRAIN3D;");const pe=he.concat(Zs.prelude.fragmentSource,h.fragmentSource).join(`
`),Y=he.concat(Zs.prelude.vertexSource,h.vertexSource).join(`
`),ye=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(ye,pe),T.compileShader(ye),T.attachShader(this.program,ye);const ge=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(ge,Y),T.compileShader(ge),T.attachShader(this.program,ge),this.attributes={};const Ie={};this.numAttributes=O.length;for(let Ae=0;Ae<this.numAttributes;Ae++)O[Ae]&&(T.bindAttribLocation(this.program,Ae,O[Ae]),this.attributes[O[Ae]]=Ae);T.linkProgram(this.program),T.deleteShader(ge),T.deleteShader(ye);for(let Ae=0;Ae<se.length;Ae++){const Ue=se[Ae];if(Ue&&!Ie[Ue]){const Me=T.getUniformLocation(this.program,Ue);Me&&(Ie[Ue]=Me)}}this.fixedUniforms=_(t,Ie),this.terrainUniforms=((Ae,Ue)=>({u_depth:new a.Uniform1i(Ae,Ue.u_depth),u_terrain:new a.Uniform1i(Ae,Ue.u_terrain),u_terrain_dim:new a.Uniform1f(Ae,Ue.u_terrain_dim),u_terrain_matrix:new a.UniformMatrix4f(Ae,Ue.u_terrain_matrix),u_terrain_unpack:new a.Uniform4f(Ae,Ue.u_terrain_unpack),u_terrain_offset:new a.Uniform1f(Ae,Ue.u_terrain_offset),u_terrain_exaggeration:new a.Uniform1f(Ae,Ue.u_terrain_exaggeration)}))(t,Ie),this.binderUniforms=f?f.getUniforms(t,Ie):[]}draw(t,s,h,f,_,v,E,T,A,z,O,U,J,W,X,se,he,pe){const Y=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(h),t.setStencilMode(f),t.setColorMode(_),t.setCullFace(v),T){t.activeTexture.set(Y.TEXTURE2),Y.bindTexture(Y.TEXTURE_2D,T.depthTexture),t.activeTexture.set(Y.TEXTURE3),Y.bindTexture(Y.TEXTURE_2D,T.texture);for(const ge in this.terrainUniforms)this.terrainUniforms[ge].set(T[ge])}for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(E[ge]);X&&X.setUniforms(t,this.binderUniforms,J,{zoom:W});let ye=0;switch(s){case Y.LINES:ye=2;break;case Y.TRIANGLES:ye=3;break;case Y.LINE_STRIP:ye=1}for(const ge of U.get()){const Ie=ge.vaos||(ge.vaos={});(Ie[A]||(Ie[A]=new bo)).bind(t,this,z,X?X.getPaintVertexBuffers():[],O,ge.vertexOffset,se,he,pe),Y.drawElements(s,ge.primitiveLength*ye,Y.UNSIGNED_SHORT,ge.primitiveOffset*ye*2)}}}function Zl(u,t,s){const h=1/Fi(s,1,t.transform.tileZoom),f=Math.pow(2,s.tileID.overscaledZ),_=s.tileSize*Math.pow(2,t.transform.tileZoom)/f,v=_*(s.tileID.canonical.x+s.tileID.wrap*f),E=_*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[h,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[v>>16,E>>16],u_pixel_coord_lower:[65535&v,65535&E]}}const Mo=(u,t,s,h)=>{const f=t.style.light,_=f.properties.get("position"),v=[_.x,_.y,_.z],E=a.create$1();f.properties.get("anchor")==="viewport"&&a.fromRotation(E,-t.transform.angle),a.transformMat3(v,v,E);const T=f.properties.get("color");return{u_matrix:u,u_lightpos:v,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+s,u_opacity:h}},Ic=(u,t,s,h,f,_,v)=>a.extend(Mo(u,t,s,h),Zl(_,t,v),{u_height_factor:-Math.pow(2,f.overscaledZ)/v.tileSize/8}),Ta=u=>({u_matrix:u}),Eo=(u,t,s,h)=>a.extend(Ta(u),Zl(s,t,h)),Hl=(u,t)=>({u_matrix:u,u_world:t}),Wl=(u,t,s,h,f)=>a.extend(Eo(u,t,s,h),{u_world:f}),Xl=(u,t,s,h)=>{const f=u.transform;let _,v;if(h.paint.get("circle-pitch-alignment")==="map"){const E=Fi(s,1,f.zoom);_=!0,v=[E,E]}else _=!1,v=f.pixelsToGLUnits;return{u_camera_to_center_distance:f.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:u.translatePosMatrix(t.posMatrix,s,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:v}},ts=(u,t,s)=>{const h=Fi(s,1,t.zoom),f=Math.pow(2,t.zoom-s.tileID.overscaledZ),_=s.tileID.overscaleFactor();return{u_matrix:u,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[t.pixelsToGLUnits[0]/(h*f),t.pixelsToGLUnits[1]/(h*f)],u_overscale_factor:_}},Hs=(u,t,s=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:s}),Es=u=>({u_matrix:u}),Sa=(u,t,s,h)=>({u_matrix:u,u_extrude_scale:Fi(t,1,s),u_intensity:h});function Ia(u,t){const s=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new a.MercatorCoordinate(0,h/s).toLngLat().lat,new a.MercatorCoordinate(0,(h+1)/s).toLngLat().lat]}const Ts=(u,t,s,h)=>{const f=u.transform;return{u_matrix:Xs(u,t,s,h),u_ratio:1/Fi(t,1,f.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},To=(u,t,s,h,f)=>a.extend(Ts(u,t,s,f),{u_image:0,u_image_height:h}),Aa=(u,t,s,h,f)=>{const _=u.transform,v=Ei(t,_);return{u_matrix:Xs(u,t,s,f),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Fi(t,1,_.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[v,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Ws=(u,t,s,h,f,_)=>{const v=u.lineAtlas,E=Ei(t,u.transform),T=s.layout.get("line-cap")==="round",A=v.getDash(h.from,T),z=v.getDash(h.to,T),O=A.width*f.fromScale,U=z.width*f.toScale;return a.extend(Ts(u,t,s,_),{u_patternscale_a:[E/O,-A.height/2],u_patternscale_b:[E/U,-z.height/2],u_sdfgamma:v.width/(256*Math.min(O,U)*u.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:z.y,u_mix:f.t})};function Ei(u,t){return 1/Fi(u,1,t.tileZoom)}function Xs(u,t,s,h){return u.translatePosMatrix(h?h.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Kl=(u,t,s,h,f)=>{return{u_matrix:u,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(v=f.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(_=f.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:Jl(f.paint.get("raster-hue-rotate"))};var _,v};function Jl(u){u*=Math.PI/180;const t=Math.sin(u),s=Math.cos(u);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const So=(u,t,s,h,f,_,v,E,T,A)=>{const z=f.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:z.width/z.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:v,u_coord_matrix:E,u_is_text:+T,u_pitch_with_map:+h,u_texsize:A,u_texture:0}},Ca=(u,t,s,h,f,_,v,E,T,A,z)=>{const O=f.transform;return a.extend(So(u,t,s,h,f,_,v,E,T,A),{u_gamma_scale:h?Math.cos(O._pitch)*O.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:+z})},Yl=(u,t,s,h,f,_,v,E,T,A)=>a.extend(Ca(u,t,s,h,f,_,v,E,!0,T,!0),{u_texsize_icon:A,u_texture_icon:1}),Ac=(u,t,s)=>({u_matrix:u,u_opacity:t,u_color:s}),Cc=(u,t,s,h,f,_)=>a.extend(function(v,E,T,A){const z=T.imageManager.getPattern(v.from.toString()),O=T.imageManager.getPattern(v.to.toString()),{width:U,height:J}=T.imageManager.getPixelSize(),W=Math.pow(2,A.tileID.overscaledZ),X=A.tileSize*Math.pow(2,T.transform.tileZoom)/W,se=X*(A.tileID.canonical.x+A.tileID.wrap*W),he=X*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[U,J],u_mix:E.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/Fi(A,1,T.transform.tileZoom),u_pixel_coord_upper:[se>>16,he>>16],u_pixel_coord_lower:[65535&se,65535&he]}}(h,_,s,f),{u_matrix:u,u_opacity:t}),Io={fillExtrusion:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_lightpos:new a.Uniform3f(u,t.u_lightpos),u_lightintensity:new a.Uniform1f(u,t.u_lightintensity),u_lightcolor:new a.Uniform3f(u,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(u,t.u_vertical_gradient),u_opacity:new a.Uniform1f(u,t.u_opacity)}),fillExtrusionPattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_lightpos:new a.Uniform3f(u,t.u_lightpos),u_lightintensity:new a.Uniform1f(u,t.u_lightintensity),u_lightcolor:new a.Uniform3f(u,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(u,t.u_vertical_gradient),u_height_factor:new a.Uniform1f(u,t.u_height_factor),u_image:new a.Uniform1i(u,t.u_image),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade),u_opacity:new a.Uniform1f(u,t.u_opacity)}),fill:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),fillPattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image:new a.Uniform1i(u,t.u_image),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade)}),fillOutline:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_world:new a.Uniform2f(u,t.u_world)}),fillOutlinePattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_world:new a.Uniform2f(u,t.u_world),u_image:new a.Uniform1i(u,t.u_image),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade)}),circle:(u,t)=>({u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_scale_with_map:new a.Uniform1i(u,t.u_scale_with_map),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_extrude_scale:new a.Uniform2f(u,t.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),collisionBox:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pixels_to_tile_units:new a.Uniform1f(u,t.u_pixels_to_tile_units),u_extrude_scale:new a.Uniform2f(u,t.u_extrude_scale),u_overscale_factor:new a.Uniform1f(u,t.u_overscale_factor)}),collisionCircle:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_inv_matrix:new a.UniformMatrix4f(u,t.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(u,t.u_viewport_size)}),debug:(u,t)=>({u_color:new a.UniformColor(u,t.u_color),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_overlay:new a.Uniform1i(u,t.u_overlay),u_overlay_scale:new a.Uniform1f(u,t.u_overlay_scale)}),clippingMask:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),heatmap:(u,t)=>({u_extrude_scale:new a.Uniform1f(u,t.u_extrude_scale),u_intensity:new a.Uniform1f(u,t.u_intensity),u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),heatmapTexture:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_world:new a.Uniform2f(u,t.u_world),u_image:new a.Uniform1i(u,t.u_image),u_color_ramp:new a.Uniform1i(u,t.u_color_ramp),u_opacity:new a.Uniform1f(u,t.u_opacity)}),hillshade:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image:new a.Uniform1i(u,t.u_image),u_latrange:new a.Uniform2f(u,t.u_latrange),u_light:new a.Uniform2f(u,t.u_light),u_shadow:new a.UniformColor(u,t.u_shadow),u_highlight:new a.UniformColor(u,t.u_highlight),u_accent:new a.UniformColor(u,t.u_accent)}),hillshadePrepare:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image:new a.Uniform1i(u,t.u_image),u_dimension:new a.Uniform2f(u,t.u_dimension),u_zoom:new a.Uniform1f(u,t.u_zoom),u_unpack:new a.Uniform4f(u,t.u_unpack)}),line:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_ratio:new a.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(u,t.u_units_to_pixels)}),lineGradient:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_ratio:new a.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(u,t.u_units_to_pixels),u_image:new a.Uniform1i(u,t.u_image),u_image_height:new a.Uniform1f(u,t.u_image_height)}),linePattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_texsize:new a.Uniform2f(u,t.u_texsize),u_ratio:new a.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_image:new a.Uniform1i(u,t.u_image),u_units_to_pixels:new a.Uniform2f(u,t.u_units_to_pixels),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade)}),lineSDF:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_ratio:new a.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(u,t.u_units_to_pixels),u_patternscale_a:new a.Uniform2f(u,t.u_patternscale_a),u_patternscale_b:new a.Uniform2f(u,t.u_patternscale_b),u_sdfgamma:new a.Uniform1f(u,t.u_sdfgamma),u_image:new a.Uniform1i(u,t.u_image),u_tex_y_a:new a.Uniform1f(u,t.u_tex_y_a),u_tex_y_b:new a.Uniform1f(u,t.u_tex_y_b),u_mix:new a.Uniform1f(u,t.u_mix)}),raster:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_tl_parent:new a.Uniform2f(u,t.u_tl_parent),u_scale_parent:new a.Uniform1f(u,t.u_scale_parent),u_buffer_scale:new a.Uniform1f(u,t.u_buffer_scale),u_fade_t:new a.Uniform1f(u,t.u_fade_t),u_opacity:new a.Uniform1f(u,t.u_opacity),u_image0:new a.Uniform1i(u,t.u_image0),u_image1:new a.Uniform1i(u,t.u_image1),u_brightness_low:new a.Uniform1f(u,t.u_brightness_low),u_brightness_high:new a.Uniform1f(u,t.u_brightness_high),u_saturation_factor:new a.Uniform1f(u,t.u_saturation_factor),u_contrast_factor:new a.Uniform1f(u,t.u_contrast_factor),u_spin_weights:new a.Uniform3f(u,t.u_spin_weights)}),symbolIcon:(u,t)=>({u_is_size_zoom_constant:new a.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(u,t.u_size_t),u_size:new a.Uniform1f(u,t.u_size),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(u,t.u_pitch),u_rotate_symbol:new a.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(u,t.u_fade_change),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new a.Uniform1i(u,t.u_is_text),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_texsize:new a.Uniform2f(u,t.u_texsize),u_texture:new a.Uniform1i(u,t.u_texture)}),symbolSDF:(u,t)=>({u_is_size_zoom_constant:new a.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(u,t.u_size_t),u_size:new a.Uniform1f(u,t.u_size),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(u,t.u_pitch),u_rotate_symbol:new a.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(u,t.u_fade_change),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new a.Uniform1i(u,t.u_is_text),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_texsize:new a.Uniform2f(u,t.u_texsize),u_texture:new a.Uniform1i(u,t.u_texture),u_gamma_scale:new a.Uniform1f(u,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(u,t.u_is_halo)}),symbolTextAndIcon:(u,t)=>({u_is_size_zoom_constant:new a.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(u,t.u_size_t),u_size:new a.Uniform1f(u,t.u_size),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(u,t.u_pitch),u_rotate_symbol:new a.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(u,t.u_fade_change),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new a.Uniform1i(u,t.u_is_text),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_texsize:new a.Uniform2f(u,t.u_texsize),u_texsize_icon:new a.Uniform2f(u,t.u_texsize_icon),u_texture:new a.Uniform1i(u,t.u_texture),u_texture_icon:new a.Uniform1i(u,t.u_texture_icon),u_gamma_scale:new a.Uniform1f(u,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(u,t.u_is_halo)}),background:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_opacity:new a.Uniform1f(u,t.u_opacity),u_color:new a.UniformColor(u,t.u_color)}),backgroundPattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_opacity:new a.Uniform1f(u,t.u_opacity),u_image:new a.Uniform1i(u,t.u_image),u_pattern_tl_a:new a.Uniform2f(u,t.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(u,t.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(u,t.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(u,t.u_pattern_br_b),u_texsize:new a.Uniform2f(u,t.u_texsize),u_mix:new a.Uniform1f(u,t.u_mix),u_pattern_size_a:new a.Uniform2f(u,t.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(u,t.u_pattern_size_b),u_scale_a:new a.Uniform1f(u,t.u_scale_a),u_scale_b:new a.Uniform1f(u,t.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(u,t.u_tile_units_to_pixels)}),terrain:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_texture:new a.Uniform1i(u,t.u_texture)}),terrainDepth:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),terrainCoords:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_texture:new a.Uniform1i(u,t.u_texture),u_terrain_coords_id:new a.Uniform1f(u,t.u_terrain_coords_id)})};class Ao{constructor(t,s,h){this.context=t;const f=t.gl;this.buffer=f.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Co={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ko{constructor(t,s,h,f){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=f,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let h=0;h<this.attributes.length;h++){const f=s.attributes[this.attributes[h].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,s,h){for(let f=0;f<this.attributes.length;f++){const _=this.attributes[f],v=s.attributes[_.name];v!==void 0&&t.vertexAttribPointer(v,_.components,t[Co[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class si{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ql extends si{getDefault(){return a.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class kc extends si{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ks extends si{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Js extends si{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class eh extends si{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class kr extends si{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Po extends si{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ka extends si{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Pa extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class zo extends si{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Lo extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class za extends si{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Do extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Ro extends si{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class La extends si{getDefault(){return a.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class th extends si{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class ih extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class Ss extends si{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Pc extends si{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class zc extends si{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Lc extends si{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Dc extends si{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Rc extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Bc extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Bo extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Da extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Oo extends si{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Fo extends si{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Is extends si{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class rh extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class nh extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ra extends si{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class is extends Ra{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class sh extends Ra{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class As{constructor(t,s,h,f){this.context=t,this.width=s,this.height=h;const _=t.gl,v=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new is(t,v),f&&(this.depthAttachment=new sh(t,v)),_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const h=this.depthAttachment.get();h&&t.deleteRenderbuffer(h)}t.deleteFramebuffer(this.framebuffer)}}class bi{constructor(t,s,h){this.blendFunction=t,this.blendColor=s,this.mask=h}}bi.Replace=[1,0],bi.disabled=new bi(bi.Replace,a.Color.transparent,[!1,!1,!1,!1]),bi.unblended=new bi(bi.Replace,a.Color.transparent,[!0,!0,!0,!0]),bi.alphaBlended=new bi([1,771],a.Color.transparent,[!0,!0,!0,!0]);class ah{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ql(this),this.clearDepth=new kc(this),this.clearStencil=new Ks(this),this.colorMask=new Js(this),this.depthMask=new eh(this),this.stencilMask=new kr(this),this.stencilFunc=new Po(this),this.stencilOp=new ka(this),this.stencilTest=new Pa(this),this.depthRange=new zo(this),this.depthTest=new Lo(this),this.depthFunc=new za(this),this.blend=new Do(this),this.blendFunc=new Ro(this),this.blendColor=new La(this),this.blendEquation=new th(this),this.cullFace=new ih(this),this.cullFaceSide=new Ss(this),this.frontFace=new Pc(this),this.program=new zc(this),this.activeTexture=new Lc(this),this.viewport=new Dc(this),this.bindFramebuffer=new Rc(this),this.bindRenderbuffer=new Bc(this),this.bindTexture=new Bo(this),this.bindVertexBuffer=new Da(this),this.bindElementBuffer=new Oo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Fo(this),this.pixelStoreUnpack=new Is(this),this.pixelStoreUnpackPremultiplyAlpha=new rh(this),this.pixelStoreUnpackFlipY=new nh(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Ao(this,t,s)}createVertexBuffer(t,s,h){return new ko(this,t,s,h)}createRenderbuffer(t,s,h){const f=this.gl,_=f.createRenderbuffer();return this.bindRenderbuffer.set(_),f.renderbufferStorage(f.RENDERBUFFER,t,s,h),this.bindRenderbuffer.set(null),_}createFramebuffer(t,s,h){return new As(this,t,s,h)}clear({color:t,depth:s}){const h=this.gl;let f=0;t&&(f|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(f|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h.clear(f)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){R(t.blendFunction,bi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Xt{constructor(t,s,h){this.func=t,this.mask=s,this.range=h}}Xt.ReadOnly=!1,Xt.ReadWrite=!0,Xt.disabled=new Xt(519,Xt.ReadOnly,[0,1]);const ai=7680;class xi{constructor(t,s,h,f,_,v){this.test=t,this.ref=s,this.mask=h,this.fail=f,this.depthFail=_,this.pass=v}}xi.disabled=new xi({func:519,mask:0},0,0,ai,ai,ai);class Ti{constructor(t,s,h){this.enable=t,this.mode=s,this.frontFace=h}}let Ys;function Cs(u,t,s,h,f,_,v){const E=u.context,T=E.gl,A=u.useProgram("collisionBox"),z=[];let O=0,U=0;for(let Y=0;Y<h.length;Y++){const ye=h[Y],ge=t.getTile(ye),Ie=ge.getBucket(s);if(!Ie)continue;let Ae=ye.posMatrix;f[0]===0&&f[1]===0||(Ae=u.translatePosMatrix(ye.posMatrix,ge,f,_));const Ue=v?Ie.textCollisionBox:Ie.iconCollisionBox,Me=Ie.collisionCircleArray;if(Me.length>0){const at=a.create(),Ke=Ae;a.mul(at,Ie.placementInvProjMatrix,u.transform.glCoordMatrix),a.mul(at,at,Ie.placementViewportMatrix),z.push({circleArray:Me,circleOffset:U,transform:Ke,invTransform:at,coord:ye}),O+=Me.length/4,U=O}Ue&&A.draw(E,T.LINES,Xt.disabled,xi.disabled,u.colorModeForRenderPass(),Ti.disabled,ts(Ae,u.transform,ge),u.style.terrain&&u.style.terrain.getTerrainData(ye),s.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,null,u.transform.zoom,null,null,Ue.collisionVertexBuffer)}if(!v||!z.length)return;const J=u.useProgram("collisionCircle"),W=new a.CollisionCircleLayoutArray;W.resize(4*O),W._trim();let X=0;for(const Y of z)for(let ye=0;ye<Y.circleArray.length/4;ye++){const ge=4*ye,Ie=Y.circleArray[ge+0],Ae=Y.circleArray[ge+1],Ue=Y.circleArray[ge+2],Me=Y.circleArray[ge+3];W.emplace(X++,Ie,Ae,Ue,Me,0),W.emplace(X++,Ie,Ae,Ue,Me,1),W.emplace(X++,Ie,Ae,Ue,Me,2),W.emplace(X++,Ie,Ae,Ue,Me,3)}(!Ys||Ys.length<2*O)&&(Ys=function(Y){const ye=2*Y,ge=new a.QuadTriangleArray;ge.resize(ye),ge._trim();for(let Ie=0;Ie<ye;Ie++){const Ae=6*Ie;ge.uint16[Ae+0]=4*Ie+0,ge.uint16[Ae+1]=4*Ie+1,ge.uint16[Ae+2]=4*Ie+2,ge.uint16[Ae+3]=4*Ie+2,ge.uint16[Ae+4]=4*Ie+3,ge.uint16[Ae+5]=4*Ie+0}return ge}(O));const se=E.createIndexBuffer(Ys,!0),he=E.createVertexBuffer(W,a.collisionCircleLayout.members,!0);for(const Y of z){const ye={u_matrix:Y.transform,u_inv_matrix:Y.invTransform,u_camera_to_center_distance:(pe=u.transform).cameraToCenterDistance,u_viewport_size:[pe.width,pe.height]};J.draw(E,T.TRIANGLES,Xt.disabled,xi.disabled,u.colorModeForRenderPass(),Ti.disabled,ye,u.style.terrain&&u.style.terrain.getTerrainData(Y.coord),s.id,he,se,a.SegmentVector.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,u.transform.zoom,null,null,null)}var pe;he.destroy(),se.destroy()}Ti.disabled=new Ti(!1,1029,2305),Ti.backCCW=new Ti(!0,1029,2305);const Oc=a.identity(new Float32Array(16));function Fc(u,t,s,h,f,_){const{horizontalAlign:v,verticalAlign:E}=a.getAnchorAlignment(u),T=-(v-.5)*t,A=-(E-.5)*s,z=a.evaluateVariableOffset(u,h);return new a.pointGeometry((T/f+z[0])*_,(A/f+z[1])*_)}function oh(u,t,s,h,f,_,v,E,T,A,z){const O=u.text.placedSymbolArray,U=u.text.dynamicLayoutVertexArray,J=u.icon.dynamicLayoutVertexArray,W={};U.clear();for(let X=0;X<O.length;X++){const se=O.get(X),he=u.allowVerticalPlacement&&!se.placedOrientation,pe=se.hidden||!se.crossTileID||he?null:h[se.crossTileID];if(pe){const Y=new a.pointGeometry(se.anchorX,se.anchorY),ye=Jt(Y,s?v:_,z),ge=$r(f.cameraToCenterDistance,ye.signedDistanceFromCamera);let Ie=a.evaluateSizeForFeature(u.textSizeData,T,se)*ge/a.ONE_EM;s&&(Ie*=u.tilePixelRatio/E);const{width:Ae,height:Ue,anchor:Me,textOffset:at,textBoxScale:Ke}=pe,ot=Fc(Me,Ae,Ue,at,Ke,Ie),Rt=s?Jt(Y.add(ot),_,z).point:ye.point.add(t?ot.rotate(-f.angle):ot),Vt=u.allowVerticalPlacement&&se.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let bt=0;bt<se.numGlyphs;bt++)a.addDynamicAttributes(U,Rt,Vt);A&&se.associatedIconIndex>=0&&(W[se.associatedIconIndex]={shiftedAnchor:Rt,angle:Vt})}else Pt(se.numGlyphs,U)}if(A){J.clear();const X=u.icon.placedSymbolArray;for(let se=0;se<X.length;se++){const he=X.get(se);if(he.hidden)Pt(he.numGlyphs,J);else{const pe=W[se];if(pe)for(let Y=0;Y<he.numGlyphs;Y++)a.addDynamicAttributes(J,pe.shiftedAnchor,pe.angle);else Pt(he.numGlyphs,J)}}u.icon.dynamicLayoutVertexBuffer.updateData(J)}u.text.dynamicLayoutVertexBuffer.updateData(U)}function Nc(u,t,s){return s.iconsInText&&t?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function Ba(u,t,s,h,f,_,v,E,T,A,z,O){const U=u.context,J=U.gl,W=u.transform,X=E==="map",se=T==="map",he=E!=="viewport"&&s.layout.get("symbol-placement")!=="point",pe=X&&!se&&!he,Y=!s.layout.get("symbol-sort-key").isConstant();let ye=!1;const ge=u.depthModeForSublayer(0,Xt.ReadOnly),Ie=s.layout.get("text-variable-anchor"),Ae=[];for(const Ue of h){const Me=t.getTile(Ue),at=Me.getBucket(s);if(!at)continue;const Ke=f?at.text:at.icon;if(!Ke||!Ke.segments.get().length)continue;const ot=Ke.programConfigurations.get(s.id),Rt=f||at.sdfIcons,Vt=f?at.textSizeData:at.iconSizeData,bt=se||W.pitch!==0,li=u.useProgram(Nc(Rt,f,at),ot),hi=a.evaluateSizeForZoom(Vt,W.zoom),Kt=u.style.terrain&&u.style.terrain.getTerrainData(Ue);let ei,ui,Wi,hn,Yr=[0,0],cn=null;if(f){if(ui=Me.glyphAtlasTexture,Wi=J.LINEAR,ei=Me.glyphAtlasTexture.size,at.iconsInText){Yr=Me.imageAtlasTexture.size,cn=Me.imageAtlasTexture;const jr=Vt.kind==="composite"||Vt.kind==="camera";hn=bt||u.options.rotating||u.options.zooming||jr?J.LINEAR:J.NEAREST}}else{const jr=s.layout.get("icon-size").constantOr(0)!==1||at.iconsNeedLinear;ui=Me.imageAtlasTexture,Wi=Rt||u.options.rotating||u.options.zooming||jr||bt?J.LINEAR:J.NEAREST,ei=Me.imageAtlasTexture.size}const qn=Fi(Me,1,u.transform.zoom),Gr=Jn(Ue.posMatrix,se,X,u.transform,qn),xr=Kr(Ue.posMatrix,se,X,u.transform,qn),wn=Ie&&at.hasTextData(),Ga=s.layout.get("icon-text-fit")!=="none"&&wn&&at.hasIconData();if(he){const jr=u.style.terrain?(Qo,Rs)=>u.style.terrain.getElevation(Ue,Qo,Rs):null,as=s.layout.get("text-rotation-alignment")==="map";Cr(at,Ue.posMatrix,u,f,Gr,xr,se,A,as,jr)}const $i=u.translatePosMatrix(Ue.posMatrix,Me,_,v),Gt=he||f&&Ie||Ga?Oc:Gr,oi=u.translatePosMatrix(xr,Me,_,v,!0),Xi=Rt&&s.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ki;Ki=Rt?at.iconsInText?Yl(Vt.kind,hi,pe,se,u,$i,Gt,oi,ei,Yr):Ca(Vt.kind,hi,pe,se,u,$i,Gt,oi,f,ei,!0):So(Vt.kind,hi,pe,se,u,$i,Gt,oi,f,ei);const Ii={program:li,buffers:Ke,uniformValues:Ki,atlasTexture:ui,atlasTextureIcon:cn,atlasInterpolation:Wi,atlasInterpolationIcon:hn,isSDF:Rt,hasHalo:Xi};if(Y&&at.canOverlap){ye=!0;const jr=Ke.segments.get();for(const as of jr)Ae.push({segments:new a.SegmentVector([as]),sortKey:as.sortKey,state:Ii,terrainData:Kt})}else Ae.push({segments:Ke.segments,sortKey:0,state:Ii,terrainData:Kt})}ye&&Ae.sort((Ue,Me)=>Ue.sortKey-Me.sortKey);for(const Ue of Ae){const Me=Ue.state;if(U.activeTexture.set(J.TEXTURE0),Me.atlasTexture.bind(Me.atlasInterpolation,J.CLAMP_TO_EDGE),Me.atlasTextureIcon&&(U.activeTexture.set(J.TEXTURE1),Me.atlasTextureIcon&&Me.atlasTextureIcon.bind(Me.atlasInterpolationIcon,J.CLAMP_TO_EDGE)),Me.isSDF){const at=Me.uniformValues;Me.hasHalo&&(at.u_is_halo=1,Qs(Me.buffers,Ue.segments,s,u,Me.program,ge,z,O,at,Ue.terrainData)),at.u_is_halo=0}Qs(Me.buffers,Ue.segments,s,u,Me.program,ge,z,O,Me.uniformValues,Ue.terrainData)}}function Qs(u,t,s,h,f,_,v,E,T,A){const z=h.context;f.draw(z,z.gl.TRIANGLES,_,v,E,Ti.disabled,T,A,s.id,u.layoutVertexBuffer,u.indexBuffer,t,s.paint,h.transform.zoom,u.programConfigurations.get(s.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function ea(u,t,s,h,f,_,v){const E=u.context.gl,T=s.paint.get("fill-pattern"),A=T&&T.constantOr(1),z=s.getCrossfadeParameters();let O,U,J,W,X;v?(U=A&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=E.LINES):(U=A?"fillPattern":"fill",O=E.TRIANGLES);for(const se of h){const he=t.getTile(se);if(A&&!he.patternsLoaded())continue;const pe=he.getBucket(s);if(!pe)continue;const Y=pe.programConfigurations.get(s.id),ye=u.useProgram(U,Y),ge=u.style.terrain&&u.style.terrain.getTerrainData(se);A&&(u.context.activeTexture.set(E.TEXTURE0),he.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Y.updatePaintBuffers(z));const Ie=T.constantOr(null);if(Ie&&he.imageAtlas){const Me=he.imageAtlas,at=Me.patternPositions[Ie.to.toString()],Ke=Me.patternPositions[Ie.from.toString()];at&&Ke&&Y.setConstantPatternPositions(at,Ke)}const Ae=ge?se:null,Ue=u.translatePosMatrix(Ae?Ae.posMatrix:se.posMatrix,he,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){W=pe.indexBuffer2,X=pe.segments2;const Me=[E.drawingBufferWidth,E.drawingBufferHeight];J=U==="fillOutlinePattern"&&A?Wl(Ue,u,z,he,Me):Hl(Ue,Me)}else W=pe.indexBuffer,X=pe.segments,J=A?Eo(Ue,u,z,he):Ta(Ue);ye.draw(u.context,O,f,u.stencilModeForClipping(se),_,Ti.disabled,J,ge,s.id,pe.layoutVertexBuffer,W,X,s.paint,u.transform.zoom,Y)}}function ta(u,t,s,h,f,_,v){const E=u.context,T=E.gl,A=s.paint.get("fill-extrusion-pattern"),z=A.constantOr(1),O=s.getCrossfadeParameters(),U=s.paint.get("fill-extrusion-opacity");for(const J of h){const W=t.getTile(J),X=W.getBucket(s);if(!X)continue;const se=u.style.terrain&&u.style.terrain.getTerrainData(J),he=X.programConfigurations.get(s.id),pe=u.useProgram(z?"fillExtrusionPattern":"fillExtrusion",he);z&&(u.context.activeTexture.set(T.TEXTURE0),W.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),he.updatePaintBuffers(O));const Y=A.constantOr(null);if(Y&&W.imageAtlas){const Ae=W.imageAtlas,Ue=Ae.patternPositions[Y.to.toString()],Me=Ae.patternPositions[Y.from.toString()];Ue&&Me&&he.setConstantPatternPositions(Ue,Me)}const ye=u.translatePosMatrix(J.posMatrix,W,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),ge=s.paint.get("fill-extrusion-vertical-gradient"),Ie=z?Ic(ye,u,ge,U,J,O,W):Mo(ye,u,ge,U);pe.draw(E,E.gl.TRIANGLES,f,_,v,Ti.backCCW,Ie,se,s.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,s.paint,u.transform.zoom,he,u.style.terrain&&X.centroidVertexBuffer)}}function No(u,t,s,h,f,_,v){const E=u.context,T=E.gl,A=s.fbo;if(!A)return;const z=u.useProgram("hillshade"),O=u.style.terrain&&u.style.terrain.getTerrainData(t);E.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,A.colorAttachment.get()),z.draw(E,T.TRIANGLES,f,_,v,Ti.disabled,((U,J,W,X)=>{const se=W.paint.get("hillshade-shadow-color"),he=W.paint.get("hillshade-highlight-color"),pe=W.paint.get("hillshade-accent-color");let Y=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(Y-=U.transform.angle);const ye=!U.options.moving;return{u_matrix:X?X.posMatrix:U.transform.calculatePosMatrix(J.tileID.toUnwrapped(),ye),u_image:0,u_latrange:Ia(0,J.tileID),u_light:[W.paint.get("hillshade-exaggeration"),Y],u_shadow:se,u_highlight:he,u_accent:pe}})(u,s,h,O?t:null),O,h.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function lh(u,t,s,h,f,_){const v=u.context,E=v.gl,T=t.dem;if(T&&T.data){const A=T.dim,z=T.stride,O=T.getPixels();if(v.activeTexture.set(E.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(z),t.demTexture){const J=t.demTexture;J.update(O,{premultiply:!1}),J.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else t.demTexture=new de(v,O,E.RGBA,{premultiply:!1}),t.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);v.activeTexture.set(E.TEXTURE0);let U=t.fbo;if(!U){const J=new de(v,{width:A,height:A,data:null},E.RGBA);J.bind(E.LINEAR,E.CLAMP_TO_EDGE),U=t.fbo=v.createFramebuffer(A,A,!0),U.colorAttachment.set(J.texture)}v.bindFramebuffer.set(U.framebuffer),v.viewport.set([0,0,A,A]),u.useProgram("hillshadePrepare").draw(v,E.TRIANGLES,h,f,_,Ti.disabled,((J,W)=>{const X=W.stride,se=a.create();return a.ortho(se,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(se,se,[0,-a.EXTENT,0]),{u_matrix:se,u_image:1,u_dimension:[X,X],u_zoom:J.overscaledZ,u_unpack:W.getUnpackVector()}})(t.tileID,T),null,s.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Oa(u,t,s,h,f,_){const v=h.paint.get("raster-fade-duration");if(!_&&v>0){const E=a.exported.now(),T=(E-u.timeAdded)/v,A=t?(E-t.timeAdded)/v:-1,z=s.getSource(),O=f.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),U=!t||Math.abs(t.tileID.overscaledZ-O)>Math.abs(u.tileID.overscaledZ-O),J=U&&u.refreshedUponExpiration?1:a.clamp(U?T:1-A,0,1);return u.refreshedUponExpiration&&T>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-J}:{opacity:J,mix:0}}return{opacity:1,mix:0}}const Fa=new a.Color(1,0,0,1),Jr=new a.Color(0,1,0,1),hh=new a.Color(0,0,1,1),Uo=new a.Color(1,0,1,1),ch=new a.Color(0,1,1,1);function rs(u,t,s,h){ks(u,0,t+s/2,u.transform.width,s,h)}function ia(u,t,s,h){ks(u,t-s/2,0,s,u.transform.height,h)}function ks(u,t,s,h,f,_){const v=u.context,E=v.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*u.pixelRatio,s*u.pixelRatio,h*u.pixelRatio,f*u.pixelRatio),v.clear({color:_}),E.disable(E.SCISSOR_TEST)}function Uc(u,t,s){const h=u.context,f=h.gl,_=s.posMatrix,v=u.useProgram("debug"),E=Xt.disabled,T=xi.disabled,A=u.colorModeForRenderPass(),z="$debug",O=u.style.terrain&&u.style.terrain.getTerrainData(s);h.activeTexture.set(f.TEXTURE0),u.emptyTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE);const U=t.getTileByID(s.key).latestRawTileData,J=Math.floor((U&&U.byteLength||0)/1024),W=t.getTile(s).tileSize,X=512/Math.min(W,512)*(s.overscaledZ/u.transform.zoom)*.5;let se=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(se+=` => ${s.overscaledZ}`),function(he,pe){he.initDebugOverlayCanvas();const Y=he.debugOverlayCanvas,ye=he.context.gl,ge=he.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,Y.width,Y.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(pe,5,5),ge.strokeText(pe,5,5),he.debugOverlayTexture.update(Y),he.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}(u,`${se} ${J}kB`),v.draw(h,f.TRIANGLES,E,T,bi.alphaBlended,Ti.disabled,Hs(_,a.Color.transparent,X),null,z,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),v.draw(h,f.LINE_STRIP,E,T,A,Ti.disabled,Hs(_,a.Color.red),O,z,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function Na(u,t,s){const h=u.context,f=h.gl,_=u.colorModeForRenderPass(),v=new Xt(f.LEQUAL,Xt.ReadWrite,u.depthRangeFor3D),E=u.useProgram("terrain"),T=t.getTerrainMesh(),A=t.getTerrainData(s.tileID);h.bindFramebuffer.set(null),h.viewport.set([0,0,u.width,u.height]),h.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const z=u.transform.calculatePosMatrix(s.tileID.toUnwrapped());E.draw(h,f.TRIANGLES,v,xi.disabled,_,Ti.backCCW,{u_matrix:z,u_texture:0},A,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}function uh(u,t,s,h){const f=u.context,_=s.tileSize*t.qualityFactor;s.textures[h]||(s.textures[h]=u.getTileTexture(_)||new de(f,{width:_,height:_,data:null},f.gl.RGBA),s.textures[h].bind(f.gl.LINEAR,f.gl.CLAMP_TO_EDGE),h===0&&t.sourceCache.renderHistory.unshift(s.tileID.key));const v=t.getRTTFramebuffer();v.colorAttachment.set(s.textures[h].texture),f.bindFramebuffer.set(v.framebuffer),f.viewport.set([0,0,_,_])}class dh{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,s=t.terrain;for(const h in t.sourceCaches){this._coordsDescendingInv[h]={};const f=t.sourceCaches[h].getVisibleCoordinates();for(const _ of f){const v=s.sourceCache.getTerrainCoords(_);for(const E in v)this._coordsDescendingInv[h][E]||(this._coordsDescendingInv[h][E]=[]),this._coordsDescendingInv[h][E].push(v[E])}}for(const h of t._order){const f=t._layers[h],_=f.source;if(this._renderToTexture[f.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(const v in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][v]=this._coordsDescendingInv[_][v].map(E=>E.key).sort().join()}}return this._renderableTiles.forEach(h=>{for(const f in this._coordsDescendingInvStr){const _=this._coordsDescendingInvStr[f][h.tileID.key];_&&_!==h.textureCoords[f]&&h.clearTextures(this.painter),s.needsRerender(f,h.tileID)&&h.clearTextures(this.painter)}this._rerender[h.tileID.key]=!h.textures.length}),s.clearRerenderCache(),s.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const s=t.type,h=this.painter,f=h.style._order,_=h.currentLayer,v=_+1===f.length;if(this._renderToTexture[s]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(f[_]),!v))return!0;if(this._renderToTexture[this._prevType]||s==="hillshade"||this._renderToTexture[s]&&v){this._prevType=s;const E=this._stacks.length-1,T=this._stacks[E]||[];for(const A of this._renderableTiles){if(uh(h,h.style.terrain,A,E),this._rerender[A.tileID.key]){h.context.clear({color:a.Color.transparent});for(let z=0;z<T.length;z++){const O=h.style._layers[T[z]],U=O.source?this._coordsDescendingInv[O.source][A.tileID.key]:[A.tileID];h._renderTileClippingMasks(O,U),h.renderLayer(h,h.style.sourceCaches[O.source],O,U),O.source&&(A.textureCoords[O.source]=this._coordsDescendingInvStr[O.source][A.tileID.key])}}Na(h,h.style.terrain,A)}if(s==="hillshade"){this._stacks.push([f[_]]);for(const A of this._renderableTiles){const z=this._coordsDescendingInv[t.source][A.tileID.key];uh(h,h.style.terrain,A,this._stacks.length-1),h.context.clear({color:a.Color.transparent}),h._renderTileClippingMasks(t,z),h.renderLayer(h,h.style.sourceCaches[t.source],t,z),Na(h,h.style.terrain,A)}return!0}return this._renderToTexture[s]}return!1}}const ra={symbol:function(u,t,s,h,f){if(u.renderPass!=="translucent")return;const _=xi.disabled,v=u.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(E,T,A,z,O,U,J){const W=T.transform,X=O==="map",se=U==="map";for(const he of E){const pe=z.getTile(he),Y=pe.getBucket(A);if(!Y||!Y.text||!Y.text.segments.get().length)continue;const ye=a.evaluateSizeForZoom(Y.textSizeData,W.zoom),ge=Fi(pe,1,T.transform.zoom),Ie=Jn(he.posMatrix,se,X,T.transform,ge),Ae=A.layout.get("icon-text-fit")!=="none"&&Y.hasIconData();if(ye){const Ue=Math.pow(2,W.zoom-pe.tileID.overscaledZ);oh(Y,X,se,J,W,Ie,he.posMatrix,Ue,ye,Ae,T.style.terrain?(Me,at)=>T.style.terrain.getElevation(he,Me,at):null)}}}(h,u,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),f),s.paint.get("icon-opacity").constantOr(1)!==0&&Ba(u,t,s,h,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),_,v),s.paint.get("text-opacity").constantOr(1)!==0&&Ba(u,t,s,h,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),_,v),t.map.showCollisionBoxes&&(Cs(u,t,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Cs(u,t,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,s,h){if(u.renderPass!=="translucent")return;const f=s.paint.get("circle-opacity"),_=s.paint.get("circle-stroke-width"),v=s.paint.get("circle-stroke-opacity"),E=!s.layout.get("circle-sort-key").isConstant();if(f.constantOr(1)===0&&(_.constantOr(1)===0||v.constantOr(1)===0))return;const T=u.context,A=T.gl,z=u.depthModeForSublayer(0,Xt.ReadOnly),O=xi.disabled,U=u.colorModeForRenderPass(),J=[];for(let W=0;W<h.length;W++){const X=h[W],se=t.getTile(X),he=se.getBucket(s);if(!he)continue;const pe=he.programConfigurations.get(s.id),Y=u.useProgram("circle",pe),ye=he.layoutVertexBuffer,ge=he.indexBuffer,Ie=u.style.terrain&&u.style.terrain.getTerrainData(X),Ae={programConfiguration:pe,program:Y,layoutVertexBuffer:ye,indexBuffer:ge,uniformValues:Xl(u,X,se,s),terrainData:Ie};if(E){const Ue=he.segments.get();for(const Me of Ue)J.push({segments:new a.SegmentVector([Me]),sortKey:Me.sortKey,state:Ae})}else J.push({segments:he.segments,sortKey:0,state:Ae})}E&&J.sort((W,X)=>W.sortKey-X.sortKey);for(const W of J){const{programConfiguration:X,program:se,layoutVertexBuffer:he,indexBuffer:pe,uniformValues:Y,terrainData:ye}=W.state;se.draw(T,A.TRIANGLES,z,O,U,Ti.disabled,Y,ye,s.id,he,pe,W.segments,s.paint,u.transform.zoom,X)}},heatmap:function(u,t,s,h){if(s.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const f=u.context,_=f.gl,v=xi.disabled,E=new bi([_.ONE,_.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(T,A,z){const O=T.gl;T.activeTexture.set(O.TEXTURE1),T.viewport.set([0,0,A.width/4,A.height/4]);let U=z.heatmapFbo;if(U)O.bindTexture(O.TEXTURE_2D,U.colorAttachment.get()),T.bindFramebuffer.set(U.framebuffer);else{const J=O.createTexture();O.bindTexture(O.TEXTURE_2D,J),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),U=z.heatmapFbo=T.createFramebuffer(A.width/4,A.height/4,!1),function(W,X,se,he){const pe=W.gl;pe.texImage2D(pe.TEXTURE_2D,0,pe.RGBA,X.width/4,X.height/4,0,pe.RGBA,W.extRenderToTextureHalfFloat?W.extTextureHalfFloat.HALF_FLOAT_OES:pe.UNSIGNED_BYTE,null),he.colorAttachment.set(se)}(T,A,J,U)}})(f,u,s),f.clear({color:a.Color.transparent});for(let T=0;T<h.length;T++){const A=h[T];if(t.hasRenderableParent(A))continue;const z=t.getTile(A),O=z.getBucket(s);if(!O)continue;const U=O.programConfigurations.get(s.id),J=u.useProgram("heatmap",U),{zoom:W}=u.transform;J.draw(f,_.TRIANGLES,Xt.disabled,v,E,Ti.disabled,Sa(A.posMatrix,z,W,s.paint.get("heatmap-intensity")),null,s.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,s.paint,u.transform.zoom,U)}f.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(f,_){const v=f.context,E=v.gl,T=_.heatmapFbo;if(!T)return;v.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,T.colorAttachment.get()),v.activeTexture.set(E.TEXTURE1);let A=_.colorRampTexture;A||(A=_.colorRampTexture=new de(v,_.colorRamp,E.RGBA)),A.bind(E.LINEAR,E.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(v,E.TRIANGLES,Xt.disabled,xi.disabled,f.colorModeForRenderPass(),Ti.disabled,((z,O,U,J)=>{const W=a.create();a.ortho(W,0,z.width,z.height,0,0,1);const X=z.context.gl;return{u_matrix:W,u_world:[X.drawingBufferWidth,X.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}})(f,_),null,_.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,_.paint,f.transform.zoom)}(u,s))},line:function(u,t,s,h){if(u.renderPass!=="translucent")return;const f=s.paint.get("line-opacity"),_=s.paint.get("line-width");if(f.constantOr(1)===0||_.constantOr(1)===0)return;const v=u.depthModeForSublayer(0,Xt.ReadOnly),E=u.colorModeForRenderPass(),T=s.paint.get("line-dasharray"),A=s.paint.get("line-pattern"),z=A.constantOr(1),O=s.paint.get("line-gradient"),U=s.getCrossfadeParameters(),J=z?"linePattern":T?"lineSDF":O?"lineGradient":"line",W=u.context,X=W.gl;let se=!0;for(const he of h){const pe=t.getTile(he);if(z&&!pe.patternsLoaded())continue;const Y=pe.getBucket(s);if(!Y)continue;const ye=Y.programConfigurations.get(s.id),ge=u.context.program.get(),Ie=u.useProgram(J,ye),Ae=se||Ie.program!==ge,Ue=u.style.terrain&&u.style.terrain.getTerrainData(he),Me=A.constantOr(null);if(Me&&pe.imageAtlas){const ot=pe.imageAtlas,Rt=ot.patternPositions[Me.to.toString()],Vt=ot.patternPositions[Me.from.toString()];Rt&&Vt&&ye.setConstantPatternPositions(Rt,Vt)}const at=Ue?he:null,Ke=z?Aa(u,pe,s,U,at):T?Ws(u,pe,s,T,U,at):O?To(u,pe,s,Y.lineClipsArray.length,at):Ts(u,pe,s,at);if(z)W.activeTexture.set(X.TEXTURE0),pe.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),ye.updatePaintBuffers(U);else if(T&&(Ae||u.lineAtlas.dirty))W.activeTexture.set(X.TEXTURE0),u.lineAtlas.bind(W);else if(O){const ot=Y.gradients[s.id];let Rt=ot.texture;if(s.gradientVersion!==ot.version){let Vt=256;if(s.stepInterpolant){const bt=t.getSource().maxzoom,li=he.canonical.z===bt?Math.ceil(1<<u.transform.maxZoom-he.canonical.z):1;Vt=a.clamp(a.nextPowerOfTwo(Y.maxLineLength/a.EXTENT*1024*li),256,W.maxTextureSize)}ot.gradient=a.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Vt,image:ot.gradient||void 0,clips:Y.lineClipsArray}),ot.texture?ot.texture.update(ot.gradient):ot.texture=new de(W,ot.gradient,X.RGBA),ot.version=s.gradientVersion,Rt=ot.texture}W.activeTexture.set(X.TEXTURE0),Rt.bind(s.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}Ie.draw(W,X.TRIANGLES,v,u.stencilModeForClipping(he),E,Ti.disabled,Ke,Ue,s.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,s.paint,u.transform.zoom,ye,Y.layoutVertexBuffer2),se=!1}},fill:function(u,t,s,h){const f=s.paint.get("fill-color"),_=s.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const v=u.colorModeForRenderPass(),E=s.paint.get("fill-pattern"),T=u.opaquePassEnabledForLayer()&&!E.constantOr(1)&&f.constantOr(a.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===T){const A=u.depthModeForSublayer(1,u.renderPass==="opaque"?Xt.ReadWrite:Xt.ReadOnly);ea(u,t,s,h,A,v,!1)}if(u.renderPass==="translucent"&&s.paint.get("fill-antialias")){const A=u.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Xt.ReadOnly);ea(u,t,s,h,A,v,!0)}},"fill-extrusion":function(u,t,s,h){const f=s.paint.get("fill-extrusion-opacity");if(f!==0&&u.renderPass==="translucent"){const _=new Xt(u.context.gl.LEQUAL,Xt.ReadWrite,u.depthRangeFor3D);if(f!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))ta(u,t,s,h,_,xi.disabled,bi.disabled),ta(u,t,s,h,_,u.stencilModeFor3D(),u.colorModeForRenderPass());else{const v=u.colorModeForRenderPass();ta(u,t,s,h,_,xi.disabled,v)}}},hillshade:function(u,t,s,h){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent")return;const f=u.context,_=u.depthModeForSublayer(0,Xt.ReadOnly),v=u.colorModeForRenderPass(),[E,T]=u.renderPass==="translucent"?u.stencilConfigForOverlap(h):[{},h];for(const A of T){const z=t.getTile(A);z.needsHillshadePrepare!==void 0&&z.needsHillshadePrepare&&u.renderPass==="offscreen"?lh(u,z,s,_,xi.disabled,v):u.renderPass==="translucent"&&No(u,A,z,s,_,E[A.overscaledZ],v)}f.viewport.set([0,0,u.width,u.height])},raster:function(u,t,s,h){if(u.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!h.length)return;const f=u.context,_=f.gl,v=t.getSource(),E=u.useProgram("raster"),T=u.colorModeForRenderPass(),[A,z]=v instanceof Ne?[{},h]:u.stencilConfigForOverlap(h),O=z[z.length-1].overscaledZ,U=!u.options.moving;for(const J of z){const W=u.depthModeForSublayer(J.overscaledZ-O,s.paint.get("raster-opacity")===1?Xt.ReadWrite:Xt.ReadOnly,_.LESS),X=t.getTile(J);X.registerFadeDuration(s.paint.get("raster-fade-duration"));const se=t.findLoadedParent(J,0),he=Oa(X,se,t,s,u.transform,u.style.terrain);let pe,Y;const ye=s.paint.get("raster-resampling")==="nearest"?_.NEAREST:_.LINEAR;f.activeTexture.set(_.TEXTURE0),X.texture.bind(ye,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),f.activeTexture.set(_.TEXTURE1),se?(se.texture.bind(ye,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),pe=Math.pow(2,se.tileID.overscaledZ-X.tileID.overscaledZ),Y=[X.tileID.canonical.x*pe%1,X.tileID.canonical.y*pe%1]):X.texture.bind(ye,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST);const ge=u.style.terrain&&u.style.terrain.getTerrainData(J),Ie=ge?J:null,Ae=Ie?Ie.posMatrix:u.transform.calculatePosMatrix(J.toUnwrapped(),U),Ue=Kl(Ae,Y||[0,0],pe||1,he,s);v instanceof Ne?E.draw(f,_.TRIANGLES,W,xi.disabled,T,Ti.disabled,Ue,ge,s.id,v.boundsBuffer,u.quadTriangleIndexBuffer,v.boundsSegments):E.draw(f,_.TRIANGLES,W,A[J.overscaledZ],T,Ti.disabled,Ue,ge,s.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}},background:function(u,t,s,h){const f=s.paint.get("background-color"),_=s.paint.get("background-opacity");if(_===0)return;const v=u.context,E=v.gl,T=u.transform,A=T.tileSize,z=s.paint.get("background-pattern");if(u.isPatternMissing(z))return;const O=!z&&f.a===1&&_===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==O)return;const U=xi.disabled,J=u.depthModeForSublayer(0,O==="opaque"?Xt.ReadWrite:Xt.ReadOnly),W=u.colorModeForRenderPass(),X=u.useProgram(z?"backgroundPattern":"background"),se=h||T.coveringTiles({tileSize:A,terrain:u.style.terrain});z&&(v.activeTexture.set(E.TEXTURE0),u.imageManager.bind(u.context));const he=s.getCrossfadeParameters();for(const pe of se){const Y=h?pe.posMatrix:u.transform.calculatePosMatrix(pe.toUnwrapped()),ye=z?Cc(Y,_,u,z,{tileID:pe,tileSize:A},he):Ac(Y,_,f),ge=u.style.terrain&&u.style.terrain.getTerrainData(pe);X.draw(v,E.TRIANGLES,J,U,W,Ti.disabled,ye,ge,s.id,u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}},debug:function(u,t,s){for(let h=0;h<s.length;h++)Uc(u,t,s[h])},custom:function(u,t,s){const h=u.context,f=s.implementation;if(u.renderPass==="offscreen"){const _=f.prerender;_&&(u.setCustomLayerDefaults(),h.setColorMode(u.colorModeForRenderPass()),_.call(f,h.gl,u.transform.customLayerMatrix()),h.setDirty(),u.setBaseState())}else if(u.renderPass==="translucent"){u.setCustomLayerDefaults(),h.setColorMode(u.colorModeForRenderPass()),h.setStencilMode(xi.disabled);const _=f.renderingMode==="3d"?new Xt(u.context.gl.LEQUAL,Xt.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,Xt.ReadOnly);h.setDepthMode(_),f.render(h.gl,u.transform.customLayerMatrix()),h.setDirty(),u.setBaseState(),h.bindFramebuffer.set(null)}}};class Vo{constructor(t,s){this.context=new ah(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.create(),renderTime:0},this.setup(),this.numSublayers=ii.maxUnderzooming+ii.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ct,this.gpuTimers={}}resize(t,s,h){if(this.width=t*h,this.height=s*h,this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const t=this.context,s=new a.PosArray;s.emplaceBack(0,0),s.emplaceBack(a.EXTENT,0),s.emplaceBack(0,a.EXTENT),s.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,Yt.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const h=new a.PosArray;h.emplaceBack(0,0),h.emplaceBack(a.EXTENT,0),h.emplaceBack(0,a.EXTENT),h.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=t.createVertexBuffer(h,Yt.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const f=new a.RasterBoundsArray;f.emplaceBack(0,0,0,0),f.emplaceBack(a.EXTENT,0,a.EXTENT,0),f.emplaceBack(0,a.EXTENT,0,a.EXTENT),f.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(f,me.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const _=new a.PosArray;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,Yt.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const v=new a.LineStripIndexArray;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(v);const E=new a.TriangleIndexArray;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E),this.emptyTexture=new de(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const T=this.context.gl;this.stencilClearMode=new xi({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=a.create();a.ortho(h,0,this.width,this.height,0,0,1),a.scale(h,h,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,Xt.disabled,this.stencilClearMode,bi.disabled,Ti.disabled,Es(h),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const h=this.context,f=h.gl;this.nextStencilID+s.length>256&&this.clearStencil(),h.setColorMode(bi.disabled),h.setDepthMode(Xt.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const E=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,T=this.style.terrain&&this.style.terrain.getTerrainData(v);_.draw(h,f.TRIANGLES,Xt.disabled,new xi({func:f.ALWAYS,mask:0},E,255,f.KEEP,f.KEEP,f.REPLACE),bi.disabled,Ti.disabled,Es(v.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new xi({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new xi({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,h=t.sort((v,E)=>E.overscaledZ-v.overscaledZ),f=h[h.length-1].overscaledZ,_=h[0].overscaledZ-f+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let E=0;E<_;E++)v[E+f]=new xi({func:s.GEQUAL,mask:255},E+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=_,[v,h]}return[{[f]:xi.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new bi([t.CONSTANT_COLOR,t.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?bi.unblended:bi.alphaBlended}depthModeForSublayer(t,s,h){if(!this.opaquePassEnabledForLayer())return Xt.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Xt(h||this.context.gl.LEQUAL,s,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const h=this.style._order,f=this.style.sourceCaches,_=this.style.terrain&&new dh(this);for(const A in f){const z=f[A];z.used&&z.prepare(this.context)}const v={},E={},T={};for(const A in f){const z=f[A];v[A]=z.getVisibleCoordinates(),E[A]=v[A].slice().reverse(),T[A]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<h.length;A++)if(this.style._layers[h[A]].is3D()){this.opaquePassCutoff=A;break}if(_){this.opaquePassCutoff=0;const A=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||A.length)&&(a.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(z,O){const U=z.context,J=U.gl,W=bi.unblended,X=new Xt(J.LEQUAL,Xt.ReadWrite,[0,1]),se=O.getTerrainMesh(),he=O.sourceCache.getRenderableTiles(),pe=z.useProgram("terrainDepth");U.bindFramebuffer.set(O.getFramebuffer("depth").framebuffer),U.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),U.clear({color:a.Color.transparent,depth:1});for(const Y of he){const ye=O.getTerrainData(Y.tileID),ge=z.transform.calculatePosMatrix(Y.tileID.toUnwrapped());pe.draw(U,J.TRIANGLES,X,xi.disabled,W,Ti.backCCW,{u_matrix:ge},ye,"terrain",se.vertexBuffer,se.indexBuffer,se.segments)}U.bindFramebuffer.set(null),U.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain),function(z,O){const U=z.context,J=U.gl,W=bi.unblended,X=new Xt(J.LEQUAL,Xt.ReadWrite,[0,1]),se=O.getTerrainMesh(),he=O.getCoordsTexture(),pe=O.sourceCache.getRenderableTiles(),Y=z.useProgram("terrainCoords");U.bindFramebuffer.set(O.getFramebuffer("coords").framebuffer),U.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),U.clear({color:a.Color.transparent,depth:1}),O.coordsIndex=[];for(const ye of pe){const ge=O.getTerrainData(ye.tileID);U.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,he.texture);const Ie=z.transform.calculatePosMatrix(ye.tileID.toUnwrapped());Y.draw(U,J.TRIANGLES,X,xi.disabled,W,Ti.backCCW,{u_matrix:Ie,u_terrain_coords_id:(255-O.coordsIndex.length)/255,u_texture:0},ge,"terrain",se.vertexBuffer,se.indexBuffer,se.segments),O.coordsIndex.push(ye.tileID.key)}U.bindFramebuffer.set(null),U.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const A of h){const z=this.style._layers[A];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const O=E[z.source];(z.type==="custom"||O.length)&&this.renderLayer(this,f[z.source],z,O)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!_)for(this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[h[this.currentLayer]],z=f[A.source],O=v[A.source];this._renderTileClippingMasks(A,O),this.renderLayer(this,z,A,O)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const A=this.style._layers[h[this.currentLayer]],z=f[A.source];if(_&&_.renderLayer(A))continue;const O=(A.type==="symbol"?T:E)[A.source];this._renderTileClippingMasks(A,v[A.source]),this.renderLayer(this,z,A,O)}if(this.options.showTileBoundaries){let A,z;Object.values(this.style._layers).forEach(O=>{O.source&&!O.isHidden(this.transform.zoom)&&(O.source!==(z&&z.id)&&(z=this.style.sourceCaches[O.source]),(!A||A.getSource().maxzoom<z.getSource().maxzoom)&&(A=z))}),A&&ra.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const z=A.transform.padding;rs(A,A.transform.height-(z.top||0),3,Fa),rs(A,z.bottom||0,3,Jr),ia(A,z.left||0,3,hh),ia(A,A.transform.width-(z.right||0),3,Uo);const O=A.transform.centerPoint;(function(U,J,W,X){ks(U,J-1,W-10,2,20,X),ks(U,J-10,W-1,20,2,X)})(A,O.x,A.transform.height-O.y,ch)}(this),this.context.setDefault()}renderLayer(t,s,h,f){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||(f||[]).length)&&(this.id=h.id,this.gpuTimingStart(h),ra[h.type](t,s,h,f,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let h=this.gpuTimers[t.id];h||(h=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),h.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,h.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const s={};for(const h in t){const f=t[h],_=this.context.extTimerQuery,v=_.getQueryObjectEXT(f.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(f.query),s[h]=v}return s}translatePosMatrix(t,s,h,f,_){if(!h[0]&&!h[1])return t;const v=_?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(v){const A=Math.sin(v),z=Math.cos(v);h=[h[0]*z-h[1]*A,h[0]*A+h[1]*z]}const E=[_?h[0]:Fi(s,h[0],this.transform.zoom),_?h[1]:Fi(s,h[1],this.transform.zoom),0],T=new Float32Array(16);return a.translate(T,t,E),T}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),h=this.imageManager.getPattern(t.to.toString());return!s||!h}useProgram(t,s){this.cache=this.cache||{};const h=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[h]||(this.cache[h]=new jl(this.context,t,Zs[t],s,Io[t],this._showOverdrawInspector,this.style.terrain)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new de(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Ua{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,h){const f=Math.pow(2,h),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const T=1/(E=a.transformMat4([],E,t))[3]/s*f;return a.mul$1(E,E,[T,T,1/E[3],T])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const T=a.sub([],_[E[0]],_[E[1]]),A=a.sub([],_[E[2]],_[E[1]]),z=a.normalize([],a.cross([],T,A)),O=-a.dot(z,_[E[1]]);return z.concat(O)});return new Ua(_,v)}}class na{constructor(t,s){this.min=t,this.max=s,this.center=a.scale$1([],a.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],h=a.clone$2(this.min),f=a.clone$2(this.max);for(let _=0;_<s.length;_++)h[_]=s[_]?this.min[_]:this.center[_],f[_]=s[_]?this.center[_]:this.max[_];return f[2]=this.max[2],new na(h,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let h=!0;for(let f=0;f<t.planes.length;f++){const _=t.planes[f];let v=0;for(let E=0;E<s.length;E++)a.dot$1(_,s[E])>=0&&v++;if(v===0)return 0;v!==s.length&&(h=!1)}if(h)return 2;for(let f=0;f<3;f++){let _=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let E=0;E<t.points.length;E++){const T=t.points[E][f]-this.min[f];_=Math.min(_,T),v=Math.max(v,T)}if(v<0||_>this.max[f]-this.min[f])return 0}return 1}}class Ps{constructor(t=0,s=0,h=0,f=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=h,this.right=f}interpolate(t,s,h){return s.top!=null&&t.top!=null&&(this.top=a.number(t.top,s.top,h)),s.bottom!=null&&t.bottom!=null&&(this.bottom=a.number(t.bottom,s.bottom,h)),s.left!=null&&t.left!=null&&(this.left=a.number(t.left,s.left,h)),s.right!=null&&t.right!=null&&(this.right=a.number(t.right,s.right,h)),this}getCenter(t,s){const h=a.clamp((this.left+t-this.right)/2,0,t),f=a.clamp((this.top+s-this.bottom)/2,0,s);return new a.pointGeometry(h,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ps(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class sa{constructor(t,s,h,f,_){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=_===void 0||!!_,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=h??0,this._maxPitch=f??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ps,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new sa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-a.wrap(t,-180,180)*Math.PI/180;var h;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(h=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),function(f,_,v){var E=_[0],T=_[1],A=_[2],z=_[3],O=Math.sin(v),U=Math.cos(v);f[0]=E*U+A*O,f[1]=T*U+z*O,f[2]=E*-O+A*U,f[3]=T*-O+z*U}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=a.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,h){this._unmodified=!1,this._edgeInsets.interpolate(t,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new a.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const h=this.pointCoordinate(new a.pointGeometry(0,0)),f=this.pointCoordinate(new a.pointGeometry(this.width,0)),_=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),v=this.pointCoordinate(new a.pointGeometry(0,this.height)),E=Math.floor(Math.min(h.x,f.x,_.x,v.x)),T=Math.floor(Math.max(h.x,f.x,_.x,v.x)),A=1;for(let z=E-A;z<=T+A;z++)z!==0&&s.push(new a.UnwrappedTileID(z,t))}return s}coveringTiles(t){var s,h;let f=this.coveringZoomLevel(t);const _=f;if(t.minzoom!==void 0&&f<t.minzoom)return[];t.maxzoom!==void 0&&f>t.maxzoom&&(f=t.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),E=a.MercatorCoordinate.fromLngLat(this.center),T=Math.pow(2,f),A=[T*v.x,T*v.y,0],z=[T*E.x,T*E.y,0],O=Ua.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f);let U=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(U=f);const J=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,W=Y=>({aabb:new na([Y*T,0,0],[(Y+1)*T,T,0]),zoom:0,x:0,y:0,wrap:Y,fullyVisible:!1}),X=[],se=[],he=f,pe=t.reparseOverscaled?_:f;if(this._renderWorldCopies)for(let Y=1;Y<=3;Y++)X.push(W(-Y)),X.push(W(Y));for(X.push(W(0));X.length>0;){const Y=X.pop(),ye=Y.x,ge=Y.y;let Ie=Y.fullyVisible;if(!Ie){const ot=Y.aabb.intersects(O);if(ot===0)continue;Ie=ot===2}const Ae=t.terrain?A:z,Ue=Y.aabb.distanceX(Ae),Me=Y.aabb.distanceY(Ae),at=Math.max(Math.abs(Ue),Math.abs(Me)),Ke=J+(1<<he-Y.zoom)-2;if(Y.zoom===he||at>Ke&&Y.zoom>=U){const ot=he-Y.zoom,Rt=A[0]-.5-(ye<<ot),Vt=A[1]-.5-(ge<<ot);se.push({tileID:new a.OverscaledTileID(Y.zoom===he?pe:Y.zoom,Y.wrap,Y.zoom,ye,ge),distanceSq:a.sqrLen([z[0]-.5-ye,z[1]-.5-ge]),tileDistanceToCamera:Math.sqrt(Rt*Rt+Vt*Vt)})}else for(let ot=0;ot<4;ot++){const Rt=(ye<<1)+ot%2,Vt=(ge<<1)+(ot>>1),bt=Y.zoom+1;let li=Y.aabb.quadrant(ot);if(t.terrain){const hi=new a.OverscaledTileID(bt,Y.wrap,bt,Rt,Vt),Kt=t.terrain.getMinMaxElevation(hi),ei=(s=Kt.minElevation)!==null&&s!==void 0?s:this.elevation,ui=(h=Kt.maxElevation)!==null&&h!==void 0?h:this.elevation;li=new na([li.min[0],li.min[1],ei],[li.max[0],li.max[1],ui])}X.push({aabb:li,zoom:bt,x:Rt,y:Vt,wrap:Y.wrap,fullyVisible:Ie})}}return se.sort((Y,ye)=>Y.distanceSq-ye.distanceSq).map(Y=>Y.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=a.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.pointGeometry(a.mercatorXfromLng(t.lng)*this.worldSize,a.mercatorYfromLat(s)*this.worldSize)}unproject(t){return new a.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,s){const h=a.MercatorCoordinate.fromLngLat(t),f=(1<<this.tileZoom)*a.EXTENT,_=h.x*f,v=h.y*f,E=Math.floor(_/a.EXTENT),T=Math.floor(v/a.EXTENT),A=new a.OverscaledTileID(this.tileZoom,0,this.tileZoom,E,T);return s.getElevation(A,_%a.EXTENT,v%a.EXTENT,a.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.pointLocation(this.centerPoint,t),h=this.getElevation(s,t);if(!(this.elevation-h))return;const f=this.getCameraPosition(),_=a.MercatorCoordinate.fromLngLat(f.lngLat,f.altitude),v=a.MercatorCoordinate.fromLngLat(s,h),E=_.x-v.x,T=_.y-v.y,A=_.z-v.z,z=Math.sqrt(E*E+T*T+A*A),O=this.scaleZoom(this.cameraToCenterDistance/z/this.tileSize);this._elevation=h,this._center=s,this.zoom=O}setLocationAtPoint(t,s){const h=this.pointCoordinate(s),f=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(t),v=new a.MercatorCoordinate(_.x-(h.x-f.x),_.y-(h.y-f.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,s),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return a.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const U=s.pointCoordinate(t);if(U!=null)return U}const h=[t.x,t.y,0,1],f=[t.x,t.y,1,1];a.transformMat4(h,h,this.pixelMatrixInverse),a.transformMat4(f,f,this.pixelMatrixInverse);const _=h[3],v=f[3],E=h[1]/_,T=f[1]/v,A=h[2]/_,z=f[2]/v,O=A===z?0:(0-A)/(z-A);return new a.MercatorCoordinate(a.number(h[0]/_,f[0]/v,O)/this.worldSize,a.number(E,T,O)/this.worldSize)}coordinatePoint(t,s=0,h=this.pixelMatrix){const f=[t.x*this.worldSize,t.y*this.worldSize,s,1];return a.transformMat4(f,f,h),new a.pointGeometry(f[0]/f[3],f[1]/f[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new a.LngLatBounds().extend(this.pointLocation(new a.pointGeometry(0,t))).extend(this.pointLocation(new a.pointGeometry(this.width,t))).extend(this.pointLocation(new a.pointGeometry(this.width,this.height))).extend(this.pointLocation(new a.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new a.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,s=!1){const h=t.key,f=s?this._alignedPosMatrixCache:this._posMatrixCache;if(f[h])return f[h];const _=t.canonical,v=this.worldSize/this.zoomScale(_.z),E=_.x+Math.pow(2,_.z)*t.wrap,T=a.identity(new Float64Array(16));return a.translate(T,T,[E*v,_.y*v,0]),a.scale(T,T,[v/a.EXTENT,v/a.EXTENT,1]),a.multiply(T,s?this.alignedProjMatrix:this.projMatrix,T),f[h]=new Float32Array(T),f[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,h,f,_=-90,v=90,E=-180,T=180;const A=this.size,z=this._unmodified;if(this.latRange){const J=this.latRange;_=a.mercatorYfromLat(J[1])*this.worldSize,v=a.mercatorYfromLat(J[0])*this.worldSize,t=v-_<A.y?A.y/(v-_):0}if(this.lngRange){const J=this.lngRange;E=a.wrap(a.mercatorXfromLng(J[0])*this.worldSize,0,this.worldSize),T=a.wrap(a.mercatorXfromLng(J[1])*this.worldSize,0,this.worldSize),T<E&&(T+=this.worldSize),s=T-E<A.x?A.x/(T-E):0}const O=this.point,U=Math.max(s||0,t||0);if(U)return this.center=this.unproject(new a.pointGeometry(s?(T+E)/2:O.x,t?(v+_)/2:O.y)),this.zoom+=this.scaleZoom(U),this._unmodified=z,void(this._constraining=!1);if(this.latRange){const J=O.y,W=A.y/2;J-W<_&&(f=_+W),J+W>v&&(f=v-W)}if(this.lngRange){const J=(E+T)/2,W=a.wrap(O.x,J-this.worldSize/2,J+this.worldSize/2),X=A.x/2;W-X<E&&(h=E+X),W+X>T&&(h=T-X)}h===void 0&&f===void 0||(this.center=this.unproject(new a.pointGeometry(h!==void 0?h:O.x,f!==void 0?f:O.y)).wrap()),this._unmodified=z,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,h=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let f=a.identity(new Float64Array(16));a.scale(f,f,[this.width/2,-this.height/2,1]),a.translate(f,f,[1,-1,0]),this.labelPlaneMatrix=f,f=a.identity(new Float64Array(16)),a.scale(f,f,[1,-1,1]),a.translate(f,f,[-1,-1,0]),a.scale(f,f,[2/this.width,2/this.height,1]),this.glCoordMatrix=f,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const _=Math.PI/2+this._pitch,v=this._fov*(.5+t.y/this.height),E=Math.sin(v)*this.cameraToSeaLevelDistance/Math.sin(a.clamp(Math.PI-_-v,.01,Math.PI-.01)),T=this.getHorizon(),A=2*Math.atan(T/this.cameraToCenterDistance)*(.5+t.y/(2*T)),z=Math.sin(A)*this.cameraToSeaLevelDistance/Math.sin(a.clamp(Math.PI-_-A,.01,Math.PI-.01)),O=Math.cos(Math.PI/2-this._pitch)*E+this.cameraToSeaLevelDistance,U=Math.cos(Math.PI/2-this._pitch)*z+this.cameraToSeaLevelDistance,J=1.01*Math.min(O,U),W=this.height/50;f=new Float64Array(16),a.perspective(f,this._fov,this.width/this.height,W,J),f[8]=2*-t.x/this.width,f[9]=2*t.y/this.height,a.scale(f,f,[1,-1,1]),a.translate(f,f,[0,0,-this.cameraToCenterDistance]),a.rotateX(f,f,this._pitch),a.rotateZ(f,f,this.angle),a.translate(f,f,[-s,-h,0]),this.mercatorMatrix=a.scale([],f,[this.worldSize,this.worldSize,this.worldSize]),a.scale(f,f,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,f),a.translate(f,f,[0,0,-this.elevation]),this.projMatrix=f,this.invProjMatrix=a.invert([],f),this.pixelMatrix3D=a.multiply(new Float64Array(16),this.labelPlaneMatrix,f);const X=this.width%2/2,se=this.height%2/2,he=Math.cos(this.angle),pe=Math.sin(this.angle),Y=s-Math.round(s)+he*X+pe*se,ye=h-Math.round(h)+he*se+pe*X,ge=new Float64Array(f);if(a.translate(ge,ge,[Y>.5?Y-1:Y,ye>.5?ye-1:ye,0]),this.alignedProjMatrix=ge,f=a.invert(new Float64Array(16),this.pixelMatrix),!f)throw new Error("failed to invert matrix");this.pixelMatrixInverse=f,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new a.pointGeometry(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let h=s.x,f=s.y,_=s.x,v=s.y;for(const E of t)h=Math.min(h,E.x),f=Math.min(f,E.y),_=Math.max(_,E.x),v=Math.max(v,E.y);return[new a.pointGeometry(h,f),new a.pointGeometry(_,f),new a.pointGeometry(_,v),new a.pointGeometry(h,v),new a.pointGeometry(h,f)]}}}class fh{constructor(t){this._hashName=t&&encodeURIComponent(t),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(s,h){let f=!1,_=null;const v=()=>{_=null,f&&(s(),_=setTimeout(v,300),f=!1)};return()=>(f=!0,_||v(),_)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,f=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,f),v=Math.round(s.lng*_)/_,E=Math.round(s.lat*_)/_,T=this._map.getBearing(),A=this._map.getPitch();let z="";if(z+=t?`/${v}/${E}/${h}`:`${h}/${E}/${v}`,(T||A)&&(z+="/"+Math.round(10*T)/10),A&&(z+=`/${Math.round(A)}`),this._hashName){const O=this._hashName;let U=!1;const J=window.location.hash.slice(1).split("&").map(W=>{const X=W.split("=")[0];return X===O?(U=!0,`${X}=${z}`):W}).filter(W=>W);return U||J.push(`${O}=${z}`),`#${J.join("&")}`}return`#${z}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:s,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const aa={linearity:.3,easing:a.bezier(0,0,.3,1)},ph=a.extend({deceleration:2500,maxSpeed:1400},aa),mh=a.extend({deceleration:20,maxSpeed:1400},aa),gh=a.extend({deceleration:1e3,maxSpeed:360},aa),zs=a.extend({deceleration:1e3,maxSpeed:90},aa);class _h{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=a.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)s.zoom+=_.zoomDelta||0,s.bearing+=_.bearingDelta||0,s.pitch+=_.pitchDelta||0,_.panDelta&&s.pan._add(_.panDelta),_.around&&(s.around=_.around),_.pinchAround&&(s.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(s.pan.mag()){const _=la(s.pan.mag(),h,a.extend({},ph,t||{}));f.offset=s.pan.mult(_.amount/s.pan.mag()),f.center=this._map.transform.center,oa(f,_)}if(s.zoom){const _=la(s.zoom,h,mh);f.zoom=this._map.transform.zoom+_.amount,oa(f,_)}if(s.bearing){const _=la(s.bearing,h,gh);f.bearing=this._map.transform.bearing+a.clamp(_.amount,-179,179),oa(f,_)}if(s.pitch){const _=la(s.pitch,h,zs);f.pitch=this._map.transform.pitch+_.amount,oa(f,_)}if(f.zoom||f.bearing){const _=s.pinchAround===void 0?s.around:s.pinchAround;f.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),a.extend(f,{noMoveStart:!0})}}function oa(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function la(u,t,s){const{maxSpeed:h,linearity:f,deceleration:_}=s,v=a.clamp(u*f/(t/1e3),-h,h),E=Math.abs(v)/(_*f);return{easing:s.easing,duration:1e3*E,amount:v*(E/2)}}class Pr extends a.Event{constructor(t,s,h,f={}){const _=F.mousePos(s.getCanvasContainer(),h),v=s.unproject(_);super(t,a.extend({point:_,lngLat:v,originalEvent:h},f)),this._defaultPrevented=!1,this.target=s}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ha extends a.Event{constructor(t,s,h){const f=t==="touchend"?h.changedTouches:h.touches,_=F.touchPos(s.getCanvasContainer(),f),v=_.map(T=>s.unproject(T)),E=_.reduce((T,A,z,O)=>T.add(A.div(O.length)),new a.pointGeometry(0,0));super(t,{points:_,point:E,lngLats:v,lngLat:s.unproject(E),originalEvent:h}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class zr extends a.Event{constructor(t,s,h){super(t,{originalEvent:h}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Vc{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new zr(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Pr(t.type,this._map,t))}mouseup(t){this._map.fire(new Pr(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Pr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Pr(t.type,this._map,t))}mouseover(t){this._map.fire(new Pr(t.type,this._map,t))}mouseout(t){this._map.fire(new Pr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ha(t.type,this._map,t))}touchmove(t){this._map.fire(new ha(t.type,this._map,t))}touchend(t){this._map.fire(new ha(t.type,this._map,t))}touchcancel(t){this._map.fire(new ha(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class On{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Pr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Pr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yh{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(F.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const h=s;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=h,this._box||(this._box=F.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(f.x,h.x),v=Math.max(f.x,h.x),E=Math.min(f.y,h.y),T=Math.max(f.y,h.y);F.setTransform(this._box,`translate(${_}px,${E}px)`),this._box.style.width=v-_+"px",this._box.style.height=T-E+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const h=this._startPos,f=s;if(this.reset(),F.suppressClick(),h.x!==f.x||h.y!==f.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(h,f,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(F.remove(this._box),this._box=null),F.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new a.Event(t,{originalEvent:s}))}}function xn(u,t){if(u.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${t.length}`);const s={};for(let h=0;h<u.length;h++)s[u[h].identifier]=t[h];return s}class ca{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(f){const _=new a.pointGeometry(0,0);for(const v of f)_._add(v);return _.div(f.length)}(s),this.touches=xn(h,s)))}touchmove(t,s,h){if(this.aborted||!this.centroid)return;const f=xn(h,s);for(const _ in this.touches){const v=this.touches[_],E=f[_];(!E||E.dist(v)>30)&&(this.aborted=!0)}}touchend(t,s,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class $o{constructor(t){this.singleTap=new ca(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,h){this.singleTap.touchstart(t,s,h)}touchmove(t,s,h){this.singleTap.touchmove(t,s,h)}touchend(t,s,h){const f=this.singleTap.touchend(t,s,h);if(f){const _=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(f)<30;if(_&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class $c{constructor(){this._zoomIn=new $o({numTouches:1,numTaps:2}),this._zoomOut=new $o({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,h){this._zoomIn.touchstart(t,s,h),this._zoomOut.touchstart(t,s,h)}touchmove(t,s,h){this._zoomIn.touchmove(t,s,h),this._zoomOut.touchmove(t,s,h)}touchend(t,s,h){const f=this._zoomIn.touchend(t,s,h),_=this._zoomOut.touchend(t,s,h);return f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(f)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qc={0:1,2:2};class Va{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const h=F.mouseButton(t);this._correctButton(t,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(t,s){const h=this._lastPoint;if(h){if(t.preventDefault(),function(f,_){const v=qc[_];return f.buttons===void 0||(f.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(t){this._lastPoint&&F.mouseButton(t)===this._eventButton&&(this._moved&&F.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ua extends Va{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class bn extends Va{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const h=.8*(s.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){t.preventDefault()}}class ct extends Va{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const h=-.5*(s.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){t.preventDefault()}}class vh{constructor(t,s){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,s,h){return this._calculateTransform(t,s,h)}touchmove(t,s,h){if(this._map._cooperativeGestures&&(this._minTouches===2&&h.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,h.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(h.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,h)}touchend(t,s,h){this._calculateTransform(t,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,h){h.length>0&&(this._active=!0);const f=xn(h,s),_=new a.pointGeometry(0,0),v=new a.pointGeometry(0,0);let E=0;for(const A in f){const z=f[A],O=this._touches[A];O&&(_._add(z),v._add(z.sub(O)),E++,f[A]=z)}if(this._touches=f,E<this._minTouches||!v.mag())return;const T=v.div(E);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(E),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ns{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,s,h){return{}}touchstart(t,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,h){if(!this._firstTwoTouches)return;t.preventDefault();const[f,_]=this._firstTwoTouches,v=Fn(h,s,f),E=Fn(h,s,_);if(!v||!E)return;const T=this._aroundCenter?null:v.add(E).div(2);return this._move([v,E],T,t)}touchend(t,s,h){if(!this._firstTwoTouches)return;const[f,_]=this._firstTwoTouches,v=Fn(h,s,f),E=Fn(h,s,_);v&&E||(this._active&&F.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Fn(u,t,s){for(let h=0;h<u.length;h++)if(u[h].identifier===s)return t[h]}function qo(u,t){return Math.log(u/t)/Math.LN2}class et extends ns{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(qo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qo(this._distance,h),pinchAround:s}}}function $a(u,t){return 180*u.angleWith(t)/Math.PI}class Gc extends ns{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:$a(this._vector,h),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,h=$a(t,this._startVector);return Math.abs(h)<s}}function Go(u){return Math.abs(u.y)>Math.abs(u.x)}class jo extends ns{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,h){super.touchstart(t,s,h),this._currentTouchCount=h.length}_start(t){this._lastPoints=t,Go(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,h){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const f=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,_,h.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(f.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,h){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,_=s.mag()>=2;if(!f&&!_)return;if(!f||!_)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const v=t.y>0==s.y>0;return Go(t)&&Go(s)&&v}}const xh={panStep:100,bearingStep:15,pitchStep:10};class bh{constructor(){const t=xh;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,h=0,f=0,_=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(h=0,f=0),{cameraAnimation:E=>{const T=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:jc,zoom:s?Math.round(T)+s*(t.shiftKey?2:1):T,bearing:E.getBearing()+h*this._bearingStep,pitch:E.getPitch()+f*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:E.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jc(u){return u*(2-u)}const wh=4.000244140625;class Zo{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=a.exported.now(),f=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%wh==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=F.mousePos(this._el,t);this._around=a.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(s)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>wh?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&T!==0&&(T=1/T);const A=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(A*T))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,h=this._startZoom,f=this._easing;let _,v=!1;if(this._type==="wheel"&&h&&f){const E=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),T=f(E);_=a.number(h,s,T),E<1?this._frameId||(this._frameId=!0):v=!0}else _=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=a.ease;if(this._prevEase){const h=this._prevEase,f=(a.exported.now()-h.start)/h.duration,_=h.easing(f+.01)-h.easing(f),v=.27/Math.sqrt(_*_+1e-4)*.01,E=Math.sqrt(.0729-v*v);s=a.bezier(v,E,.25,1)}return this._prevEase={start:a.exported.now(),duration:t,easing:s},s}reset(){this._active=!1}}class Ho{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wo{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xo{constructor(){this._tap=new $o({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,s,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,s,h))}touchmove(t,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const f=s[0],_=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,s,h)}touchend(t,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,s,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vr{constructor(t,s,h){this._el=t,this._mousePan=s,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Nn{constructor(t,s,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Mh{constructor(t,s,h,f){this._el=t,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ls=u=>u.zoom||u.drag||u.pitch||u.rotate;class Ko extends a.Event{}function da(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Eh{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new _h(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s),a.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,_,v]of this._listeners)F.addEventListener(f,_,f===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,s,h]of this._listeners)F.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(t){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new Vc(s,t));const f=s.boxZoom=new yh(s,t);this._add("boxZoom",f);const _=new $c,v=new Wo;s.doubleClickZoom=new Ho(v,_),this._add("tapZoom",_),this._add("clickZoom",v);const E=new Xo;this._add("tapDragZoom",E);const T=s.touchPitch=new jo(s);this._add("touchPitch",T);const A=new bn(t),z=new ct(t);s.dragRotate=new Nn(t,A,z),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const O=new ua(t),U=new vh(t,s);s.dragPan=new vr(h,O,U),this._add("mousePan",O),this._add("touchPan",U,["touchZoom","touchRotate"]);const J=new Gc,W=new et;s.touchZoomRotate=new Mh(h,W,J,E),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]);const X=s.scrollZoom=new Zo(s,this);this._add("scrollZoom",X,["mousePan"]);const se=s.keyboard=new bh;this._add("keyboard",se),this._add("blockableMapEvent",new On(s));for(const he of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[he]&&s[he].enable(t[he])}_add(t,s,h){this._handlers.push({handlerName:t,handler:s,allowed:h}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ls(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,s,h){for(const f in t)if(f!==h&&(!s||s.indexOf(f)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const h of t)this._el.contains(h.target)&&s.push(h);return s}handleEvent(t,s){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const h=t.type==="renderFrame"?void 0:t,f={needsRenderFrame:!1},_={},v={},E=t.touches,T=E?this._getMapTouches(E):void 0,A=T?F.touchPos(this._el,T):F.mousePos(this._el,t);for(const{handlerName:U,handler:J,allowed:W}of this._handlers){if(!J.isEnabled())continue;let X;this._blockedByActive(v,W,U)?J.reset():J[s||t.type]&&(X=J[s||t.type](t,A,T),this.mergeHandlerResult(f,_,X,U,h),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||J.isActive())&&(v[U]=J)}const z={};for(const U in this._previousActiveHandlers)v[U]||(z[U]=h);this._previousActiveHandlers=v,(Object.keys(z).length||da(f))&&(this._changes.push([f,_,z]),this._triggerRenderFrame()),(Object.keys(v).length||da(f))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=f;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(t,s,h,f,_){if(!h)return;a.extend(t,h);const v={handlerName:f,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(s.zoom=v),h.panDelta!==void 0&&(s.drag=v),h.pitchDelta!==void 0&&(s.pitch=v),h.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const t={},s={},h={};for(const[f,_,v]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new a.pointGeometry(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(t.around=f.around),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),a.extend(s,_),a.extend(h,v);this._updateMapTransform(t,s,h),this._changes=[]}_updateMapTransform(t,s,h){const f=this._map,_=f.transform,v=f.style&&f.style.terrain;if(!(da(t)||v&&this._drag))return this._fireEvents(s,h,!0);let{panDelta:E,zoomDelta:T,bearingDelta:A,pitchDelta:z,around:O,pinchAround:U}=t;U!==void 0&&(O=U),f._stop(!0),O=O||f.transform.centerPoint;const J=_.pointLocation(E?O.sub(E):O);A&&(_.bearing+=A),z&&(_.pitch+=z),T&&(_.zoom+=T),v?s.drag&&!this._drag?(this._drag={center:_.centerPoint,lngLat:_.pointLocation(O),point:O,handlerName:s.drag.handlerName},f.fire(new a.Event("freezeElevation",{freeze:!0}))):this._drag&&h[this._drag.handlerName]?(f.fire(new a.Event("freezeElevation",{freeze:!1})),this._drag=null):s.drag&&this._drag&&(_.center=_.pointLocation(_.centerPoint.sub(E))):_.setLocationAtPoint(J,O),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,h,!0)}_fireEvents(t,s,h){const f=Ls(this._eventsInProgress),_=Ls(t),v={};for(const z in t){const{originalEvent:O}=t[z];this._eventsInProgress[z]||(v[`${z}start`]=O),this._eventsInProgress[z]=t[z]}!f&&_&&this._fireEvent("movestart",_.originalEvent);for(const z in v)this._fireEvent(z,v[z]);_&&this._fireEvent("move",_.originalEvent);for(const z in t){const{originalEvent:O}=t[z];this._fireEvent(z,O)}const E={};let T;for(const z in this._eventsInProgress){const{handlerName:O,originalEvent:U}=this._eventsInProgress[z];this._handlersById[O].isActive()||(delete this._eventsInProgress[z],T=s[O]||U,E[`${z}end`]=T)}for(const z in E)this._fireEvent(z,E[z]);const A=Ls(this._eventsInProgress);if(h&&(f||_)&&!A){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;z?(O(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:T})):(this._map.fire(new a.Event("moveend",{originalEvent:T})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new a.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Ko("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const qr={extend:(u,...t)=>a.extend(u,...t),run(u){u()},logToElement(u,t=!1,s="log"){const h=window.document.getElementById(s);h&&(t&&(h.innerHTML=""),h.innerHTML+=`<br>${u}`)}};class Si extends a.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,h){return t=a.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,a.extend({offset:t},s),h)}panTo(t,s,h){return this.easeTo(a.extend({center:t},s),h)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,h){return this.easeTo(a.extend({zoom:t},s),h)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,h){return this.easeTo(a.extend({bearing:t},s),h)}resetNorth(t,s){return this.rotateTo(0,a.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=a.LngLatBounds.convert(t);const h=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),h,s)}_cameraForBoxAndBearing(t,s,h,f){const _={top:0,bottom:0,right:0,left:0};if(typeof(f=a.extend({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const ge=f.padding;f.padding={top:ge,bottom:ge,right:ge,left:ge}}f.padding=a.extend(_,f.padding);const v=this.transform,E=v.padding,T=v.project(a.LngLat.convert(t)),A=v.project(a.LngLat.convert(s)),z=T.rotate(-h*Math.PI/180),O=A.rotate(-h*Math.PI/180),U=new a.pointGeometry(Math.max(z.x,O.x),Math.max(z.y,O.y)),J=new a.pointGeometry(Math.min(z.x,O.x),Math.min(z.y,O.y)),W=U.sub(J),X=(v.width-(E.left+E.right+f.padding.left+f.padding.right))/W.x,se=(v.height-(E.top+E.bottom+f.padding.top+f.padding.bottom))/W.y;if(se<0||X<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const he=Math.min(v.scaleZoom(v.scale*Math.min(X,se)),f.maxZoom),pe=a.pointGeometry.convert(f.offset),Y=new a.pointGeometry((f.padding.left-f.padding.right)/2,(f.padding.top-f.padding.bottom)/2).rotate(h*Math.PI/180),ye=pe.add(Y).mult(v.scale/v.zoomScale(he));return{center:v.unproject(T.add(A).div(2).sub(ye)),zoom:he,bearing:h}}fitBounds(t,s,h){return this._fitInternal(this.cameraForBounds(t,s),s,h)}fitScreenCoordinates(t,s,h,f,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(t)),this.transform.pointLocation(a.pointGeometry.convert(s)),h,f),f,_)}_fitInternal(t,s,h){return t?(delete(s=a.extend(t,s)).padding,s.linear?this.easeTo(s,h):this.flyTo(s,h)):this}jumpTo(t,s){this.stop();const h=this.transform;let f=!1,_=!1,v=!1;return"zoom"in t&&h.zoom!==+t.zoom&&(f=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=a.LngLat.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(_=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(v=!0,h.pitch=+t.pitch),t.padding==null||h.isPaddingEqual(t.padding)||(h.padding=t.padding),this.fire(new a.Event("movestart",s)).fire(new a.Event("move",s)),f&&this.fire(new a.Event("zoomstart",s)).fire(new a.Event("zoom",s)).fire(new a.Event("zoomend",s)),_&&this.fire(new a.Event("rotatestart",s)).fire(new a.Event("rotate",s)).fire(new a.Event("rotateend",s)),v&&this.fire(new a.Event("pitchstart",s)).fire(new a.Event("pitch",s)).fire(new a.Event("pitchend",s)),this.fire(new a.Event("moveend",s))}calculateCameraOptionsFromTo(t,s,h,f=0){const _=a.MercatorCoordinate.fromLngLat(t,s),v=a.MercatorCoordinate.fromLngLat(h,f),E=v.x-_.x,T=v.y-_.y,A=v.z-_.z,z=Math.hypot(E,T,A);if(z===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(E,T),U=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),J=180*Math.atan2(E,-T)/Math.PI;let W=180*Math.acos(O/z)/Math.PI;return W=A<0?90-W:90+W,{center:v.toLngLat(),zoom:U,pitch:W,bearing:J}}easeTo(t,s){this._stop(!1,t.easeId),((t=a.extend({offset:[0,0],duration:500,easing:a.ease},t)).animate===!1||!t.essential&&a.exported.prefersReducedMotion)&&(t.duration=0);const h=this.transform,f=this.getZoom(),_=this.getBearing(),v=this.getPitch(),E=this.getPadding(),T="zoom"in t?+t.zoom:f,A="bearing"in t?this._normalizeBearing(t.bearing,_):_,z="pitch"in t?+t.pitch:v,O="padding"in t?t.padding:h.padding,U=a.pointGeometry.convert(t.offset);let J=h.centerPoint.add(U);const W=h.pointLocation(J),X=a.LngLat.convert(t.center||W);this._normalizeCenter(X);const se=h.project(W),he=h.project(X).sub(se),pe=h.zoomScale(T-f);let Y,ye;t.around&&(Y=a.LngLat.convert(t.around),ye=h.locationPoint(Y));const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||T!==f,this._rotating=this._rotating||_!==A,this._pitching=this._pitching||z!==v,this._padding=!h.isPaddingEqual(O),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,ge),this._ease(Ie=>{if(this._zooming&&(h.zoom=a.number(f,T,Ie)),this._rotating&&(h.bearing=a.number(_,A,Ie)),this._pitching&&(h.pitch=a.number(v,z,Ie)),this._padding&&(h.interpolatePadding(E,O,Ie),J=h.centerPoint.add(U)),Y)h.setLocationAtPoint(Y,ye);else{const Ae=h.zoomScale(h.zoom-f),Ue=T>f?Math.min(2,pe):Math.max(.5,pe),Me=Math.pow(Ue,1-Ie),at=h.unproject(se.add(he.mult(Ie*Me)).mult(Ae));h.setLocationAtPoint(h.renderWorldCopies?at.wrap():at,J)}this._fireMoveEvents(s)},Ie=>{this._afterEase(s,Ie)},t),this}_prepareEase(t,s,h={}){this._moving=!0,this.fire(new a.Event("freezeElevation",{freeze:!0})),s||h.moving||this.fire(new a.Event("movestart",t)),this._zooming&&!h.zooming&&this.fire(new a.Event("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new a.Event("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new a.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new a.Event("move",t)),this._zooming&&this.fire(new a.Event("zoom",t)),this._rotating&&this.fire(new a.Event("rotate",t)),this._pitching&&this.fire(new a.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.fire(new a.Event("freezeElevation",{freeze:!1}));const h=this._zooming,f=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new a.Event("zoomend",t)),f&&this.fire(new a.Event("rotateend",t)),_&&this.fire(new a.Event("pitchend",t)),this.fire(new a.Event("moveend",t))}flyTo(t,s){if(!t.essential&&a.exported.prefersReducedMotion){const bt=a.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(bt,s)}this.stop(),t=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},t);const h=this.transform,f=this.getZoom(),_=this.getBearing(),v=this.getPitch(),E=this.getPadding(),T="zoom"in t?a.clamp(+t.zoom,h.minZoom,h.maxZoom):f,A="bearing"in t?this._normalizeBearing(t.bearing,_):_,z="pitch"in t?+t.pitch:v,O="padding"in t?t.padding:h.padding,U=h.zoomScale(T-f),J=a.pointGeometry.convert(t.offset);let W=h.centerPoint.add(J);const X=h.pointLocation(W),se=a.LngLat.convert(t.center||X);this._normalizeCenter(se);const he=h.project(X),pe=h.project(se).sub(he);let Y=t.curve;const ye=Math.max(h.width,h.height),ge=ye/U,Ie=pe.mag();if("minZoom"in t){const bt=a.clamp(Math.min(t.minZoom,f,T),h.minZoom,h.maxZoom),li=ye/h.zoomScale(bt-f);Y=Math.sqrt(li/Ie*2)}const Ae=Y*Y;function Ue(bt){const li=(ge*ge-ye*ye+(bt?-1:1)*Ae*Ae*Ie*Ie)/(2*(bt?ge:ye)*Ae*Ie);return Math.log(Math.sqrt(li*li+1)-li)}function Me(bt){return(Math.exp(bt)-Math.exp(-bt))/2}function at(bt){return(Math.exp(bt)+Math.exp(-bt))/2}const Ke=Ue(0);let ot=function(bt){return at(Ke)/at(Ke+Y*bt)},Rt=function(bt){return ye*((at(Ke)*(Me(li=Ke+Y*bt)/at(li))-Me(Ke))/Ae)/Ie;var li},Vt=(Ue(1)-Ke)/Y;if(Math.abs(Ie)<1e-6||!isFinite(Vt)){if(Math.abs(ye-ge)<1e-6)return this.easeTo(t,s);const bt=ge<ye?-1:1;Vt=Math.abs(Math.log(ge/ye))/Y,Rt=function(){return 0},ot=function(li){return Math.exp(bt*Y*li)}}return t.duration="duration"in t?+t.duration:1e3*Vt/("screenSpeed"in t?+t.screenSpeed/Y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=_!==A,this._pitching=z!==v,this._padding=!h.isPaddingEqual(O),this._prepareEase(s,!1),this._ease(bt=>{const li=bt*Vt,hi=1/ot(li);h.zoom=bt===1?T:f+h.scaleZoom(hi),this._rotating&&(h.bearing=a.number(_,A,bt)),this._pitching&&(h.pitch=a.number(v,z,bt)),this._padding&&(h.interpolatePadding(E,O,bt),W=h.centerPoint.add(J));const Kt=bt===1?se:h.unproject(he.add(pe.mult(Rt(li))).mult(hi));h.setLocationAtPoint(h.renderWorldCopies?Kt.wrap():Kt,W),this._fireMoveEvents(s)},()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,s)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,s,h){h.animate===!1||h.duration===0?(t(1),s()):(this._easeStart=a.exported.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=a.wrap(t,-180,180);const h=Math.abs(t-s);return Math.abs(t-360-s)<h&&(t-=360),Math.abs(t+360-s)<h&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const h=t.lng-s.center.lng;t.lng+=h>180?-360:h<-180?360:0}}class fa{constructor(t={}){this.options=t,a.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=F.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){F.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const h=this._map._getUIString(`AttributionControl.${s}`);t.title=h,t.setAttribute("aria-label",h)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(f=>typeof f!="string"?"":f)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const s=this._map.style.sourceCaches;for(const f in s){const _=s[f];if(_.used||_.usedForTerrain){const v=_.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter(f=>String(f).trim()),t.sort((f,_)=>f.length-_.length),t=t.filter((f,_)=>{for(let v=_+1;v<t.length;v++)if(t[v].indexOf(f)>=0)return!1;return!0});const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class qa{constructor(t={}){this.options=t,a.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=F.create("div","maplibregl-ctrl mapboxgl-ctrl");const s=F.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){F.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact","mapboxgl-compact"):s.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Th{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const f of h)if(f.id===t)return void(f.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Sh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Ih={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Zc={showCompass:!0,showZoom:!0,visualizePitch:!1};class on{constructor(t,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new bn({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new ct({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),F.addEventListener(s,"mousedown",this.mousedown),F.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),F.addEventListener(s,"touchmove",this.touchmove),F.addEventListener(s,"touchend",this.touchend),F.addEventListener(s,"touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),F.disableDrag()}move(t,s){const h=this.map,f=this.mouseRotate.mousemoveWindow(t,s);if(f&&f.bearingDelta&&h.setBearing(h.getBearing()+f.bearingDelta),this.mousePitch){const _=this.mousePitch.mousemoveWindow(t,s);_&&_.pitchDelta&&h.setPitch(h.getPitch()+_.pitchDelta)}}off(){const t=this.element;F.removeEventListener(t,"mousedown",this.mousedown),F.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),F.removeEventListener(t,"touchmove",this.touchmove),F.removeEventListener(t,"touchend",this.touchend),F.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){F.enableDrag(),F.removeEventListener(window,"mousemove",this.mousemove),F.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(a.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),F.mousePos(this.element,t)),F.addEventListener(window,"mousemove",this.mousemove),F.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,F.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=F.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=F.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function pa(u,t,s){if(u=new a.LngLat(u.lng,u.lat),t){const h=new a.LngLat(u.lng-360,u.lat),f=new a.LngLat(u.lng+360,u.lat),_=s.locationPoint(u).distSqr(t);s.locationPoint(h).distSqr(t)<_?u=h:s.locationPoint(f).distSqr(t)<_&&(u=f)}for(;Math.abs(u.lng-s.center.lng)>180;){const h=s.locationPoint(u);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;u.lng>s.center.lng?u.lng-=360:u.lng+=360}return u}const _t={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Tt(u,t,s){const h=u.classList;for(const f in _t)h.remove(`maplibregl-${s}-anchor-${f}`,`mapboxgl-${s}-anchor-${f}`);h.add(`maplibregl-${s}-anchor-${t}`,`mapboxgl-${s}-anchor-${t}`)}class Ds extends a.Evented{constructor(t,s){if(super(),(t instanceof HTMLElement||s)&&(t=a.extend({element:t},s)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=a.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=F.create("div"),this._element.setAttribute("aria-label","Map marker");const h=F.createNS("http://www.w3.org/2000/svg","svg"),f=41,_=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${f}px`),h.setAttributeNS(null,"width",`${_}px`),h.setAttributeNS(null,"viewBox",`0 0 ${_} ${f}`);const v=F.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const E=F.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const T=F.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const pe of A){const Y=F.createNS("http://www.w3.org/2000/svg","ellipse");Y.setAttributeNS(null,"opacity","0.04"),Y.setAttributeNS(null,"cx","10.5"),Y.setAttributeNS(null,"cy","5.80029008"),Y.setAttributeNS(null,"rx",pe.rx),Y.setAttributeNS(null,"ry",pe.ry),T.appendChild(Y)}const z=F.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const O=F.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(O);const U=F.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const J=F.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(J);const W=F.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(6.0, 7.0)"),W.setAttributeNS(null,"fill","#FFFFFF");const X=F.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=F.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const he=F.createNS("http://www.w3.org/2000/svg","circle");he.setAttributeNS(null,"fill","#FFFFFF"),he.setAttributeNS(null,"cx","5.5"),he.setAttributeNS(null,"cy","5.5"),he.setAttributeNS(null,"r","5.4999962"),X.appendChild(se),X.appendChild(he),E.appendChild(T),E.appendChild(z),E.appendChild(U),E.appendChild(W),E.appendChild(X),h.appendChild(E),h.setAttributeNS(null,"height",f*this._scale+"px"),h.setAttributeNS(null,"width",_*this._scale+"px"),this._element.appendChild(h),this._offset=a.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Tt(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),F.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const s=t.code,h=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=pa(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let h="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?h="rotateX(0deg)":this._pitchAlignment==="map"&&(h=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),F.setTransform(this._element,`${_t[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${h} ${s}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const f=this._map.unproject(this._pos),_=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=f.distanceTo(this._lngLat)>20*_?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=a.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Jo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Un,tr=0,Vn=!1;const ln={maxWidth:100,unit:"metric"};function Ah(u,t,s){const h=s&&s.maxWidth||100,f=u._container.clientHeight/2,_=u.unproject([0,f]),v=u.unproject([h,f]),E=_.distanceTo(v);if(s&&s.unit==="imperial"){const T=3.2808*E;T>5280?$n(t,h,T/5280,u._getUIString("ScaleControl.Miles")):$n(t,h,T,u._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?$n(t,h,E/1852,u._getUIString("ScaleControl.NauticalMiles")):E>=1e3?$n(t,h,E/1e3,u._getUIString("ScaleControl.Kilometers")):$n(t,h,E,u._getUIString("ScaleControl.Meters"))}function $n(u,t,s,h){const f=function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let E=_/v;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(T){const A=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*A)/A}(E),v*E}(s);u.style.width=t*(f/s)+"px",u.innerHTML=`${f}&nbsp;${h}`}const zi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ni=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yo(u){if(u){if(typeof u=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(u,2)));return{center:new a.pointGeometry(0,0),top:new a.pointGeometry(0,u),"top-left":new a.pointGeometry(t,t),"top-right":new a.pointGeometry(-t,t),bottom:new a.pointGeometry(0,-u),"bottom-left":new a.pointGeometry(t,-t),"bottom-right":new a.pointGeometry(-t,-t),left:new a.pointGeometry(u,0),right:new a.pointGeometry(-u,0)}}if(u instanceof a.pointGeometry||Array.isArray(u)){const t=a.pointGeometry.convert(u);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:a.pointGeometry.convert(u.center||[0,0]),top:a.pointGeometry.convert(u.top||[0,0]),"top-left":a.pointGeometry.convert(u["top-left"]||[0,0]),"top-right":a.pointGeometry.convert(u["top-right"]||[0,0]),bottom:a.pointGeometry.convert(u.bottom||[0,0]),"bottom-left":a.pointGeometry.convert(u["bottom-left"]||[0,0]),"bottom-right":a.pointGeometry.convert(u["bottom-right"]||[0,0]),left:a.pointGeometry.convert(u.left||[0,0]),right:a.pointGeometry.convert(u.right||[0,0])}}return Yo(new a.pointGeometry(0,0))}const ss={supported:S,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Si{constructor(u){var t;if(a.PerformanceUtils.mark(a.PerformanceMarkers.create),(u=a.extend({},Ih,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new sa(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),{bearingSnap:u.bearingSnap}),this._interactive=u.interactive,this._cooperativeGestures=u.cooperativeGestures,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._renderTaskQueue=new Th,this._controls=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Sh,u.locale),this._clickTolerance=u.clickTolerance,this._pixelRatio=(t=u.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new Q(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Eh(this,u),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=u.hash&&new fh(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,a.extend({},u.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=u.localIdeographFontFamily,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new fa({customAttribution:u.customAttribution})),u.maplibreLogo&&this.addControl(new qa,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new a.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new a.Event(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new a.Event("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=u.onAdd(this);this._controls.push(u);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,t,s,h){return h==null&&this.style.terrain&&(h=this.transform.getElevation(s,this.style.terrain)),super.calculateCameraOptionsFromTo(u,t,s,h)}resize(u){const t=this._containerDimensions(),s=t[0],h=t[1];this._resizeCanvas(s,h,this.getPixelRatio()),this.transform.resize(s,h),this.painter.resize(s,h,this.getPixelRatio());const f=!this._moving;return f&&(this.stop(),this.fire(new a.Event("movestart",u)).fire(new a.Event("move",u))),this.fire(new a.Event("resize",u)),f&&this.fire(new a.Event("moveend",u)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(u){const[t,s]=this._containerDimensions();this._pixelRatio=u,this._resizeCanvas(t,s,u),this.painter.resize(t,s,u)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(a.LngLatBounds.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}project(u){return this.transform.locationPoint(a.LngLat.convert(u),this.style&&this.style.terrain)}unproject(u){return this.transform.pointLocation(a.pointGeometry.convert(u),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(u,t,s){if(u==="mouseenter"||u==="mouseover"){let h=!1;return{layer:t,listener:s,delegates:{mousemove:_=>{const v=this.getLayer(t)?this.queryRenderedFeatures(_.point,{layers:[t]}):[];v.length?h||(h=!0,s.call(this,new Pr(u,this,_.originalEvent,{features:v}))):h=!1},mouseout:()=>{h=!1}}}}if(u==="mouseleave"||u==="mouseout"){let h=!1;return{layer:t,listener:s,delegates:{mousemove:v=>{(this.getLayer(t)?this.queryRenderedFeatures(v.point,{layers:[t]}):[]).length?h=!0:h&&(h=!1,s.call(this,new Pr(u,this,v.originalEvent)))},mouseout:v=>{h&&(h=!1,s.call(this,new Pr(u,this,v.originalEvent)))}}}}{const h=f=>{const _=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];_.length&&(f.features=_,s.call(this,f),delete f.features)};return{layer:t,listener:s,delegates:{[u]:h}}}}on(u,t,s){if(s===void 0)return super.on(u,t);const h=this._createDelegatedListener(u,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(h);for(const f in h.delegates)this.on(f,h.delegates[f]);return this}once(u,t,s){if(s===void 0)return super.once(u,t);const h=this._createDelegatedListener(u,t,s);for(const f in h.delegates)this.once(f,h.delegates[f]);return this}off(u,t,s){return s===void 0?super.off(u,t):(this._delegatedListeners&&this._delegatedListeners[u]&&(h=>{const f=this._delegatedListeners[u];for(let _=0;_<f.length;_++){const v=f[_];if(v.layer===t&&v.listener===s){for(const E in v.delegates)this.off(E,v.delegates[E]);return f.splice(_,1),this}}})(),this)}queryRenderedFeatures(u,t){if(!this.style)return[];let s;if(t!==void 0||u===void 0||u instanceof a.pointGeometry||Array.isArray(u)||(t=u,u=void 0),t=t||{},(u=u||[[0,0],[this.transform.width,this.transform.height]])instanceof a.pointGeometry||typeof u[0]=="number")s=[a.pointGeometry.convert(u)];else{const h=a.pointGeometry.convert(u[0]),f=a.pointGeometry.convert(u[1]);s=[h,new a.pointGeometry(f.x,h.y),f,new a.pointGeometry(h.x,f.y),h]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(u,t){return this.style.querySourceFeatures(u,t)}setStyle(u,t){return(t=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(u,t))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),u?(this.style=new rr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new rr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,t){if(typeof u=="string"){const s=this._requestManager.transformRequest(u,a.ResourceType.Style);a.getJSON(s,(h,f)=>{h?this.fire(new a.ErrorEvent(h)):f&&this._updateDiff(f,t)})}else typeof u=="object"&&this._updateDiff(u,t)}_updateDiff(u,t){try{this.style.setState(u)&&this._update(!0)}catch(s){a.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(u,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(u,t){return this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)}isSourceLoaded(u){const t=this.style&&this.style.sourceCaches[u];if(t!==void 0)return t.loaded();this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){return this.style.setTerrain(u),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const t in u){const s=u[t]._tiles;for(const h in s){const f=s[h];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}addSourceType(u,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,s)}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,t,{pixelRatio:s=1,sdf:h=!1,stretchX:f,stretchY:_,content:v}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||a.isImageBitmap(t)){const{width:E,height:T,data:A}=a.exported.getImageData(t);this.style.addImage(u,{data:new a.RGBAImage({width:E,height:T},A),pixelRatio:s,stretchX:f,stretchY:_,content:v,sdf:h,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:T,data:A}=t,z=t;this.style.addImage(u,{data:new a.RGBAImage({width:E,height:T},new Uint8Array(A)),pixelRatio:s,stretchX:f,stretchY:_,content:v,sdf:h,version:0,userImage:z}),z.onAdd&&z.onAdd(this,u)}}}updateImage(u,t){const s=this.style.getImage(u);if(!s)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=t instanceof HTMLImageElement||a.isImageBitmap(t)?a.exported.getImageData(t):t,{width:f,height:_,data:v}=h;if(f===void 0||_===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==s.data.width||_!==s.data.height)return this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(t instanceof HTMLImageElement||a.isImageBitmap(t));s.data.replace(v,E),this.style.updateImage(u,s)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){a.getImage(this._requestManager.transformRequest(u,a.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(u,t){return this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)}moveLayer(u,t){return this.style.moveLayer(u,t),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}setLayerZoomRange(u,t,s){return this.style.setLayerZoomRange(u,t,s),this._update(!0)}setFilter(u,t,s={}){return this.style.setFilter(u,t,s),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,t,s,h={}){return this.style.setPaintProperty(u,t,s,h),this._update(!0)}getPaintProperty(u,t){return this.style.getPaintProperty(u,t)}setLayoutProperty(u,t,s,h={}){return this.style.setLayoutProperty(u,t,s,h),this._update(!0)}getLayoutProperty(u,t){return this.style.getLayoutProperty(u,t)}setLight(u,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(u,t){return this.style.setFeatureState(u,t),this._update()}removeFeatureState(u,t){return this.style.removeFeatureState(u,t),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,t=0;return this._container&&(u=this._container.clientWidth||400,t=this._container.clientHeight||300),[u,t]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=F.create("div","maplibregl-canvas-container mapboxgl-canvas-container",u);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=F.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1],this.getPixelRatio());const h=this._controlContainer=F.create("div","maplibregl-control-container mapboxgl-control-container",u),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{f[_]=F.create("div",`maplibregl-ctrl-${_} mapboxgl-ctrl-${_}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const u=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=F.create("div","maplibregl-cooperative-gesture-screen",u);let t="Control",s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${s}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",h=>{h.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",h=>{h.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",h=>{this._onCooperativeGesture(h,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(u,t,s){this._canvas.width=s*u,this._canvas.height=s*t,this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const u=a.extend({},S.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",u)||this._canvas.getContext("experimental-webgl",u);t?(this.painter=new Vo(t,this.transform),a.exported$1.testSupport(t)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(u,t,s){return!t&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){let t,s=0;const h=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,t),s=a.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,E=a.exported.now();this.style.zoomHistory.update(v,E);const T=new a.EvaluationParameters(v,{now:E,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),A=T.crossFadingFactor();A===1&&A===this._crossFadingFactor||(f=!0,this._crossFadingFactor=A),this.style.update(T)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.load),this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const v=a.exported.now()-s;h.endQueryEXT(h.TIME_ELAPSED_EXT,t),setTimeout(()=>{const E=h.getQueryObjectEXT(t,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(t),this.fire(new a.Event("gpu-timing-frame",{cpuTime:v,gpuTime:E}))},50)}if(this.listens("gpu-timing-layer")){const v=this.painter.collectGpuTimers();setTimeout(()=>{const E=this.painter.queryGpuTimers(v);this.fire(new a.Event("gpu-timing-layer",{layerTimes:E}))},50)}const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.Event("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),F.remove(this._canvasContainer),F.remove(this._controlContainer),this._cooperativeGestures&&F.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),a.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.exported.frame(u=>{a.PerformanceUtils.frame(u),this._frame=null,this._render(u)}))}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}_setCacheLimits(u,t){a.setCacheLimits(u,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(u){this.options=a.extend({},Zc,u),this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),F.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),F.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=F.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map.getZoom(),t=u===this._map.getMaxZoom(),s=u===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const u=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=u}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new on(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){F.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,t){const s=F.create("button",u,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(u,t){const s=this._map._getUIString(`NavigationControl.${t}`);u.title=s,u.setAttribute("aria-label",s)}},GeolocateControl:class extends a.Evented{constructor(u){super(),this.options=a.extend({},Jo,u),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(u){var t;return this._map=u,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Un!==void 0?t(Un):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(s=>{Un=s.state!=="denied",t(Un)}):(Un=!!window.navigator.geolocation,t(Un)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),F.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,tr=0,Vn=!1}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),s=u.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",u)),this._finish()}}_updateCamera(u){const t=new a.LngLat(u.coords.longitude,u.coords.latitude),s=u.coords.accuracy,h=this._map.getBearing(),f=a.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),f,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new a.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map._container.clientHeight/2,t=this._map.unproject([0,u]),s=this._map.unproject([1,u]),h=t.distanceTo(s),f=Math.ceil(2*this._accuracy/h);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&Vn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=F.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),F.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ds(this._dotElement),this._circleElement=F.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ds({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":tr--,Vn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),tr++,tr>1?(u={maximumAge:6e5,timeout:0},Vn=!0):(u=this.options.positionOptions,Vn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:fa,LogoControl:qa,ScaleControl:class{constructor(u){this.options=a.extend({},ln,u),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ah(this._map,this._container,this.options)}onAdd(u){return this._map=u,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){F.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(u){this.options.unit=u,Ah(this._map,this._container,this.options)}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=F.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){F.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=F.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);F.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(u){this.options=u,a.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(u){return this._map=u,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=F.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),F.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){F.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends a.Evented{constructor(u){super(),this.options=a.extend(Object.create(zi),u),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&F.remove(this._content),this._container&&(F.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=a.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),s=document.createElement("body");let h;for(s.innerHTML=u;h=s.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=F.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){this._container&&this._container.classList.add(u)}removeClassName(u){this._container&&this._container.classList.remove(u)}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}_createCloseButton(){this.options.closeButton&&(this._closeButton=F.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(u){this._update(u.point)}_onMouseMove(u){this._update(u.point)}_onDrag(u){this._update(u.point)}_update(u){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=F.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=F.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(_=>this._container.classList.add(_)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pa(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!u))return;const t=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat);let s=this.options.anchor;const h=Yo(this.options.offset);if(!s){const _=this._container.offsetWidth,v=this._container.offsetHeight;let E;E=t.y+h.bottom.y<v?["top"]:t.y>this._map.transform.height-v?["bottom"]:[],t.x<_/2?E.push("left"):t.x>this._map.transform.width-_/2&&E.push("right"),s=E.length===0?"bottom":E.join("-")}const f=t.add(h[s]).round();F.setTransform(this._container,`${_t[s]} translate(${f.x}px,${f.y}px)`),Tt(this._container,s,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Ni);u&&u.focus()}_onClose(){this.remove()}},Marker:Ds,Style:rr,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,Evented:a.Evented,AJAXError:a.AJAXError,config:a.config,CanvasSource:Ce,GeoJSONSource:Be,ImageSource:Ne,RasterDEMTileSource:H,RasterTileSource:D,VectorTileSource:Mt,VideoSource:Re,prewarm:function(){Xr().acquire(Ht)},clearPrewarmedResources:function(){const u=Vr;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(Ht),Vr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Ot.workerCount},set workerCount(u){Ot.workerCount=u},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){a.config.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){a.clearTileCache(u)},workerUrl:"",addProtocol(u,t){a.config.REGISTERED_PROTOCOLS[u]=t},removeProtocol(u){delete a.config.REGISTERED_PROTOCOLS[u]}};return qr.extend(ss,{isSafari:a.isSafari,getPerformanceMetrics:a.PerformanceUtils.getPerformanceMetrics}),ss});var w=g;return w})})(hy);var Nr=(n,l,c)=>new Promise((m,g)=>{var x=S=>{try{a(c.next(S))}catch(P){g(P)}},w=S=>{try{a(c.throw(S))}catch(P){g(P)}},a=S=>S.done?m(S.value):Promise.resolve(S.value).then(x,w);a((c=c.apply(n,l)).next())}),nn=Uint8Array,wa=Uint16Array,Kp=Uint32Array,Jp=new nn([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Yp=new nn([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),cy=new nn([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Qp=function(n,l){for(var c=new wa(31),m=0;m<31;++m)c[m]=l+=1<<n[m-1];for(var g=new Kp(c[30]),m=1;m<30;++m)for(var x=c[m];x<c[m+1];++x)g[x]=x-c[m]<<5|m;return[c,g]},em=Qp(Jp,2),tm=em[0],uy=em[1];tm[28]=258,uy[258]=28;var dy=Qp(Yp,0),fy=dy[0],qu=new wa(32768);for(_i=0;_i<32768;++_i)ms=(_i&43690)>>>1|(_i&21845)<<1,ms=(ms&52428)>>>2|(ms&13107)<<2,ms=(ms&61680)>>>4|(ms&3855)<<4,qu[_i]=((ms&65280)>>>8|(ms&255)<<8)>>>1;var ms,_i,kl=function(n,l,c){for(var m=n.length,g=0,x=new wa(l);g<m;++g)n[g]&&++x[n[g]-1];var w=new wa(l);for(g=0;g<l;++g)w[g]=w[g-1]+x[g-1]<<1;var a;if(c){a=new wa(1<<l);var S=15-l;for(g=0;g<m;++g)if(n[g])for(var P=g<<4|n[g],q=l-n[g],R=w[n[g]-1]++<<q,F=R|(1<<q)-1;R<=F;++R)a[qu[R]>>>S]=P}else for(a=new wa(m),g=0;g<m;++g)n[g]&&(a[g]=qu[w[n[g]-1]++]>>>15-n[g]);return a},Nl=new nn(288);for(_i=0;_i<144;++_i)Nl[_i]=8;var _i;for(_i=144;_i<256;++_i)Nl[_i]=9;var _i;for(_i=256;_i<280;++_i)Nl[_i]=7;var _i;for(_i=280;_i<288;++_i)Nl[_i]=8;var _i,im=new nn(32);for(_i=0;_i<32;++_i)im[_i]=5;var _i,py=kl(Nl,9,1),my=kl(im,5,1),Du=function(n){for(var l=n[0],c=1;c<n.length;++c)n[c]>l&&(l=n[c]);return l},An=function(n,l,c){var m=l/8|0;return(n[m]|n[m+1]<<8)>>(l&7)&c},Ru=function(n,l){var c=l/8|0;return(n[c]|n[c+1]<<8|n[c+2]<<16)>>(l&7)},gy=function(n){return(n+7)/8|0},_y=function(n,l,c){(l==null||l<0)&&(l=0),(c==null||c>n.length)&&(c=n.length);var m=new(n.BYTES_PER_ELEMENT==2?wa:n.BYTES_PER_ELEMENT==4?Kp:nn)(c-l);return m.set(n.subarray(l,c)),m},yy=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],kn=function(n,l,c){var m=new Error(l||yy[n]);if(m.code=n,Error.captureStackTrace&&Error.captureStackTrace(m,kn),!c)throw m;return m},nd=function(n,l,c){var m=n.length;if(!m||c&&c.f&&!c.l)return l||new nn(0);var g=!l||c,x=!c||c.i;c||(c={}),l||(l=new nn(m*3));var w=function(zt){var St=l.length;if(zt>St){var Ft=new nn(Math.max(St*2,zt));Ft.set(l),l=Ft}},a=c.f||0,S=c.p||0,P=c.b||0,q=c.l,R=c.d,F=c.m,Q=c.n,le=m*8;do{if(!q){a=An(n,S,1);var de=An(n,S+1,3);if(S+=3,de)if(de==1)q=py,R=my,F=9,Q=5;else if(de==2){var xe=An(n,S,31)+257,Te=An(n,S+10,15)+4,qe=xe+An(n,S+5,31)+1;S+=14;for(var nt=new nn(qe),Fe=new nn(19),Pe=0;Pe<Te;++Pe)Fe[cy[Pe]]=An(n,S+Pe*3,7);S+=Te*3;for(var Se=Du(Fe),He=(1<<Se)-1,Lt=kl(Fe,Se,1),Pe=0;Pe<qe;){var It=Lt[An(n,S,He)];S+=It&15;var fe=It>>>4;if(fe<16)nt[Pe++]=fe;else{var Mt=0,D=0;for(fe==16?(D=3+An(n,S,3),S+=2,Mt=nt[Pe-1]):fe==17?(D=3+An(n,S,7),S+=3):fe==18&&(D=11+An(n,S,127),S+=7);D--;)nt[Pe++]=Mt}}var K=nt.subarray(0,xe),H=nt.subarray(xe);F=Du(K),Q=Du(H),q=kl(K,F,1),R=kl(H,Q,1)}else kn(1);else{var fe=gy(S)+4,De=n[fe-4]|n[fe-3]<<8,Ee=fe+De;if(Ee>m){x&&kn(0);break}g&&w(P+De),l.set(n.subarray(fe,Ee),P),c.b=P+=De,c.p=S=Ee*8,c.f=a;continue}if(S>le){x&&kn(0);break}}g&&w(P+131072);for(var Be=(1<<F)-1,me=(1<<Q)-1,Ne=S;;Ne=S){var Mt=q[Ru(n,S)&Be],Re=Mt>>>4;if(S+=Mt&15,S>le){x&&kn(0);break}if(Mt||kn(2),Re<256)l[P++]=Re;else if(Re==256){Ne=S,q=null;break}else{var Ce=Re-254;if(Re>264){var Pe=Re-257,Ge=Jp[Pe];Ce=An(n,S,(1<<Ge)-1)+tm[Pe],S+=Ge}var Ve=R[Ru(n,S)&me],st=Ve>>>4;Ve||kn(3),S+=Ve&15;var H=fy[st];if(st>3){var Ge=Yp[st];H+=Ru(n,S)&(1<<Ge)-1,S+=Ge}if(S>le){x&&kn(0);break}g&&w(P+131072);for(var At=P+Ce;P<At;P+=4)l[P]=l[P-H],l[P+1]=l[P+1-H],l[P+2]=l[P+2-H],l[P+3]=l[P+3-H];P=At}}c.l=q,c.p=Ne,c.b=P,c.f=a,q&&(a=1,c.m=F,c.d=R,c.n=Q)}while(!a);return P==l.length?l:_y(l,0,P)},vy=new nn(0),xy=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&kn(6,"invalid gzip data");var l=n[3],c=10;l&4&&(c+=n[10]|(n[11]<<8)+2);for(var m=(l>>3&1)+(l>>4&1);m>0;m-=!n[c++]);return c+(l&2)},by=function(n){var l=n.length;return(n[l-4]|n[l-3]<<8|n[l-2]<<16|n[l-1]<<24)>>>0},wy=function(n){((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)&&kn(6,"invalid zlib data"),n[1]&32&&kn(6,"invalid zlib data: preset dictionaries not supported")};function My(n,l){return nd(n,l)}function Ey(n,l){return nd(n.subarray(xy(n),-8),l||new nn(by(n)))}function Ty(n,l){return nd((wy(n),n.subarray(2,-4)),l)}function Gu(n,l){return n[0]==31&&n[1]==139&&n[2]==8?Ey(n,l):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?My(n,l):Ty(n,l)}var Sy=typeof TextDecoder<"u"&&new TextDecoder,Iy=0;try{Sy.decode(vy,{stream:!0}),Iy=1}catch{}var rm=(n,l)=>n*Math.pow(2,l),vl=(n,l)=>Math.floor(n/Math.pow(2,l)),mc=(n,l)=>rm(n.getUint16(l+1,!0),8)+n.getUint8(l),nm=(n,l)=>rm(n.getUint32(l+2,!0),16)+n.getUint16(l,!0),Ay=(n,l,c,m,g)=>{if(n!=m.getUint8(g))return n-m.getUint8(g);const x=mc(m,g+1);if(l!=x)return l-x;const w=mc(m,g+4);return c!=w?c-w:0},Cy=(n,l,c,m)=>{const g=sm(n,l|128,c,m);return g?{z:l,x:c,y:m,offset:g[0],length:g[1],is_dir:!0}:null},Gf=(n,l,c,m)=>{const g=sm(n,l,c,m);return g?{z:l,x:c,y:m,offset:g[0],length:g[1],is_dir:!1}:null},sm=(n,l,c,m)=>{let g=0,x=n.byteLength/17-1;for(;g<=x;){const w=x+g>>1,a=Ay(l,c,m,n,w*17);if(a>0)g=w+1;else if(a<0)x=w-1;else return[nm(n,w*17+7),n.getUint32(w*17+13,!0)]}return null},ky=(n,l)=>n.is_dir&&!l.is_dir?1:!n.is_dir&&l.is_dir?-1:n.z!==l.z?n.z-l.z:n.x!==l.x?n.x-l.x:n.y-l.y,am=(n,l)=>{const c=n.getUint8(l*17);return{z:c&127,x:mc(n,l*17+1),y:mc(n,l*17+4),offset:nm(n,l*17+7),length:n.getUint32(l*17+13,!0),is_dir:c>>7===1}},jf=n=>{const l=[],c=new DataView(n);for(let m=0;m<c.byteLength/17;m++)l.push(am(c,m));return Py(l)},Py=n=>{n.sort(ky);const l=new ArrayBuffer(17*n.length),c=new Uint8Array(l);for(let m=0;m<n.length;m++){const g=n[m];let x=g.z;g.is_dir&&(x=x|128),c[m*17]=x,c[m*17+1]=g.x&255,c[m*17+2]=g.x>>8&255,c[m*17+3]=g.x>>16&255,c[m*17+4]=g.y&255,c[m*17+5]=g.y>>8&255,c[m*17+6]=g.y>>16&255,c[m*17+7]=g.offset&255,c[m*17+8]=vl(g.offset,8)&255,c[m*17+9]=vl(g.offset,16)&255,c[m*17+10]=vl(g.offset,24)&255,c[m*17+11]=vl(g.offset,32)&255,c[m*17+12]=vl(g.offset,48)&255,c[m*17+13]=g.length&255,c[m*17+14]=g.length>>8&255,c[m*17+15]=g.length>>16&255,c[m*17+16]=g.length>>24&255}return l},zy=(n,l)=>{if(n.byteLength<17)return null;const c=n.byteLength/17,m=am(n,c-1);if(m.is_dir){const g=m.z,x=l.z-g,w=Math.trunc(l.x/(1<<x)),a=Math.trunc(l.y/(1<<x));return{z:g,x:w,y:a}}return null};function Ly(n){return Nr(this,null,function*(){const l=yield n.getBytes(0,512e3),c=new DataView(l.data),m=c.getUint32(4,!0),g=c.getUint16(8,!0),x=new TextDecoder("utf-8"),w=JSON.parse(x.decode(new DataView(l.data,10,m)));let a=0;w.compression==="gzip"&&(a=2);let S=0;"minzoom"in w&&(S=+w.minzoom);let P=0;"maxzoom"in w&&(P=+w.maxzoom);let q=0,R=0,F=0,Q=-180,le=-85,de=180,fe=85;if(w.bounds){const Ee=w.bounds.split(",");Q=+Ee[0],le=+Ee[1],de=+Ee[2],fe=+Ee[3]}if(w.center){const Ee=w.center.split(",");q=+Ee[0],R=+Ee[1],F=+Ee[2]}return{specVersion:c.getUint16(2,!0),rootDirectoryOffset:10+m,rootDirectoryLength:g*17,jsonMetadataOffset:10,jsonMetadataLength:m,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:S,maxZoom:P,minLon:Q,minLat:le,maxLon:de,maxLat:fe,centerZoom:F,centerLon:q,centerLat:R,etag:l.etag}})}function Dy(n,l,c,m,g,x,w){return Nr(this,null,function*(){let a=yield c.getArrayBuffer(l,n.rootDirectoryOffset,n.rootDirectoryLength,n);n.specVersion===1&&(a=jf(a));const S=Gf(new DataView(a),m,g,x);if(S){let R=(yield l.getBytes(S.offset,S.length,w)).data;const F=new DataView(R);return F.getUint8(0)==31&&F.getUint8(1)==139&&(R=Gu(new Uint8Array(R))),{data:R}}const P=zy(new DataView(a),{z:m,x:g,y:x});if(P){const q=Cy(new DataView(a),P.z,P.x,P.y);if(q){let R=yield c.getArrayBuffer(l,q.offset,q.length,n);n.specVersion===1&&(R=jf(R));const F=Gf(new DataView(R),m,g,x);if(F){let le=(yield l.getBytes(F.offset,F.length,w)).data;const de=new DataView(le);return de.getUint8(0)==31&&de.getUint8(1)==139&&(le=Gu(new Uint8Array(le))),{data:le}}}}})}var om={getHeader:Ly,getZxy:Dy},Ry=class{constructor(){this.tile=(n,l)=>{if(n.type=="json"){const c=n.url.substr(10);let m=this.tiles.get(c);return m||(m=new ju(c),this.tiles.set(c,m)),m.getHeader().then(g=>{const x={tiles:[n.url+"/{z}/{x}/{y}"],minzoom:g.minZoom,maxzoom:g.maxZoom};l(null,x,null,null)}),{cancel:()=>{}}}else{const c=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),m=n.url.match(c);if(!m)throw new Error("Invalid PMTiles protocol URL");const g=m[1];let x=this.tiles.get(g);x||(x=new ju(g),this.tiles.set(g,x));const w=m[2],a=m[3],S=m[4],P=new AbortController,q=P.signal;let R=()=>{P.abort()};return x.getHeader().then(F=>{x.getZxy(+w,+a,+S,q).then(Q=>{Q?l(null,new Uint8Array(Q.data),Q.cacheControl,Q.expires):F.tileType==1?l(null,new Uint8Array,null,null):l(null,null,null,null)}).catch(Q=>{if(Q.name!=="AbortError")throw Q})}),{cancel:R}}},this.tiles=new Map}add(n){this.tiles.set(n.source.getKey(),n)}get(n){return this.tiles.get(n)}};function io(n,l){return(l>>>0)*4294967296+(n>>>0)}function By(n,l){const c=l.buf;let m,g;if(g=c[l.pos++],m=(g&112)>>4,g<128||(g=c[l.pos++],m|=(g&127)<<3,g<128)||(g=c[l.pos++],m|=(g&127)<<10,g<128)||(g=c[l.pos++],m|=(g&127)<<17,g<128)||(g=c[l.pos++],m|=(g&127)<<24,g<128)||(g=c[l.pos++],m|=(g&1)<<31,g<128))return io(n,m);throw new Error("Expected varint not more than 10 bytes")}function xl(n){const l=n.buf;let c,m;return m=l[n.pos++],c=m&127,m<128||(m=l[n.pos++],c|=(m&127)<<7,m<128)||(m=l[n.pos++],c|=(m&127)<<14,m<128)||(m=l[n.pos++],c|=(m&127)<<21,m<128)?c:(m=l[n.pos],c|=(m&15)<<28,By(c,n))}function Oy(n,l,c,m){if(m==0){c==1&&(l[0]=n-1-l[0],l[1]=n-1-l[1]);const g=l[0];l[0]=l[1],l[1]=g}}var Fy=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Ny(n,l,c){if(n>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(l>Math.pow(2,n)-1||c>Math.pow(2,n)-1)throw Error("tile x/y outside zoom level bounds");const m=Fy[n],g=Math.pow(2,n);let x=0,w=0,a=0;const S=[l,c];let P=g/2;for(;P>0;)x=(S[0]&P)>0?1:0,w=(S[1]&P)>0?1:0,a+=P*P*(3*x^w),Oy(P,S,x,w),P=P/2;return m+a}function lm(n,l){return Nr(this,null,function*(){if(l===1||l===0)return n;if(l===2)return Gu(new Uint8Array(n));throw Error("Compression method not supported")})}var Uy=127;function Vy(n,l){let c=0,m=n.length-1;for(;c<=m;){const g=m+c>>1,x=l-n[g].tileId;if(x>0)c=g+1;else if(x<0)m=g-1;else return n[g]}return m>=0&&(n[m].runLength===0||l-n[m].tileId<n[m].runLength)?n[m]:null}var $y=class{constructor(n){this.url=n}getKey(){return this.url}getBytes(n,l,c){return Nr(this,null,function*(){let m;c||(m=new AbortController,c=m.signal);let g=yield fetch(this.url,{signal:c,headers:{Range:"bytes="+n+"-"+(n+l-1)}});if(g.status===416&&n===0){const a=g.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const S=+a.substr(8);g=yield fetch(this.url,{signal:c,headers:{Range:"bytes=0-"+(S-1)}})}if(g.status>=300)throw Error("Bad response code: "+g.status);const x=g.headers.get("Content-Length");if(g.status===200&&(!x||+x>l))throw m&&m.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield g.arrayBuffer(),etag:g.headers.get("ETag")||void 0,cacheControl:g.headers.get("Cache-Control")||void 0,expires:g.headers.get("Expires")||void 0}})}};function Cn(n,l){const c=n.getUint32(l+4,!0),m=n.getUint32(l+0,!0);return c*Math.pow(2,32)+m}function qy(n,l){const c=new DataView(n),m=c.getUint8(7);if(m>3)throw Error(`Archive is spec version ${m} but this library supports up to spec version 3`);return{specVersion:m,rootDirectoryOffset:Cn(c,8),rootDirectoryLength:Cn(c,16),jsonMetadataOffset:Cn(c,24),jsonMetadataLength:Cn(c,32),leafDirectoryOffset:Cn(c,40),leafDirectoryLength:Cn(c,48),tileDataOffset:Cn(c,56),tileDataLength:Cn(c,64),numAddressedTiles:Cn(c,72),numTileEntries:Cn(c,80),numTileContents:Cn(c,88),clustered:c.getUint8(96)===1,internalCompression:c.getUint8(97),tileCompression:c.getUint8(98),tileType:c.getUint8(99),minZoom:c.getUint8(100),maxZoom:c.getUint8(101),minLon:c.getInt32(102,!0)/1e7,minLat:c.getInt32(106,!0)/1e7,maxLon:c.getInt32(110,!0)/1e7,maxLat:c.getInt32(114,!0)/1e7,centerZoom:c.getUint8(118),centerLon:c.getInt32(119,!0)/1e7,centerLat:c.getInt32(123,!0)/1e7,etag:l}}function hm(n){const l={buf:new Uint8Array(n),pos:0},c=xl(l),m=[];let g=0;for(let x=0;x<c;x++){const w=xl(l);m.push({tileId:g+w,offset:0,length:0,runLength:1}),g+=w}for(let x=0;x<c;x++)m[x].runLength=xl(l);for(let x=0;x<c;x++)m[x].length=xl(l);for(let x=0;x<c;x++){const w=xl(l);w===0&&x>0?m[x].offset=m[x-1].offset+m[x-1].length:m[x].offset=w-1}return m}function Gy(n){const l=new DataView(n);return l.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):l.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var so=class extends Error{};function jy(n,l,c,m){return Nr(this,null,function*(){const g=yield n.getBytes(0,16384);if(new DataView(g.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Gy(g.data)<3)return[yield om.getHeader(n)];const w=g.data.slice(0,Uy);let a=g.etag;m&&g.etag!=m&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+n.getKey()),a=void 0);const S=qy(w,a);if(c){const P=g.data.slice(S.rootDirectoryOffset,S.rootDirectoryOffset+S.rootDirectoryLength),q=n.getKey()+"|"+(S.etag||"")+"|"+S.rootDirectoryOffset+"|"+S.rootDirectoryLength,R=hm(yield l(P,S.internalCompression));return[S,[q,R.length,R]]}return[S,void 0]})}function Zy(n,l,c,m,g){return Nr(this,null,function*(){const x=yield n.getBytes(c,m);if(g.etag&&g.etag!==x.etag)throw new so(x.etag);const w=yield l(x.data,g.internalCompression),a=hm(w);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var Hy=class{constructor(n=100,l=!0,c=lm){this.cache=new Map,this.maxCacheEntries=n,this.counter=1,this.prefetch=l,this.decompress=c}getHeader(n,l){return Nr(this,null,function*(){const c=n.getKey();if(this.cache.has(c))return this.cache.get(c).lastUsed=this.counter++,yield this.cache.get(c).data;const m=new Promise((g,x)=>{jy(n,this.decompress,this.prefetch,l).then(w=>{w[1]&&this.cache.set(w[1][0],{lastUsed:this.counter++,data:Promise.resolve(w[1][2])}),g(w[0]),this.prune()}).catch(w=>{x(w)})});return this.cache.set(c,{lastUsed:this.counter++,data:m}),m})}getDirectory(n,l,c,m){return Nr(this,null,function*(){const g=n.getKey()+"|"+(m.etag||"")+"|"+l+"|"+c;if(this.cache.has(g))return this.cache.get(g).lastUsed=this.counter++,yield this.cache.get(g).data;const x=new Promise((w,a)=>{Zy(n,this.decompress,l,c,m).then(S=>{w(S),this.prune()}).catch(S=>{a(S)})});return this.cache.set(g,{lastUsed:this.counter++,data:x}),x})}getArrayBuffer(n,l,c,m){return Nr(this,null,function*(){const g=n.getKey()+"|"+(m.etag||"")+"|"+l+"|"+c;if(this.cache.has(g))return this.cache.get(g).lastUsed=this.counter++,yield this.cache.get(g).data;const x=new Promise((w,a)=>{n.getBytes(l,c).then(S=>{if(m.etag&&m.etag!==S.etag)throw new so(S.etag);w(S.data),this.cache.has(g),this.prune()}).catch(S=>{a(S)})});return this.cache.set(g,{lastUsed:this.counter++,data:x}),x})}prune(){if(this.cache.size>=this.maxCacheEntries){let n=1/0,l;this.cache.forEach((c,m)=>{c.lastUsed<n&&(n=c.lastUsed,l=m)}),l&&this.cache.delete(l)}}invalidate(n,l){return Nr(this,null,function*(){this.cache.delete(n.getKey()),yield this.getHeader(n,l)})}},ju=class{constructor(n,l,c){typeof n=="string"?this.source=new $y(n):this.source=n,c?this.decompress=c:this.decompress=lm,l?this.cache=l:this.cache=new Hy}getHeader(){return Nr(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(n,l,c,m){return Nr(this,null,function*(){const g=Ny(n,l,c),x=yield this.cache.getHeader(this.source);if(x.specVersion<3)return om.getZxy(x,this.source,this.cache,n,l,c,m);if(n<x.minZoom||n>x.maxZoom)return;let w=x.rootDirectoryOffset,a=x.rootDirectoryLength;for(let S=0;S<=3;S++){const P=yield this.cache.getDirectory(this.source,w,a,x),q=Vy(P,g);if(q)if(q.runLength>0){const R=yield this.source.getBytes(x.tileDataOffset+q.offset,q.length,m);if(x.etag&&x.etag!==R.etag)throw new so(R.etag);return{data:yield this.decompress(R.data,x.tileCompression),cacheControl:R.cacheControl,expires:R.expires}}else w=x.leafDirectoryOffset+q.offset,a=q.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(n,l,c,m){return Nr(this,null,function*(){try{return yield this.getZxyAttempt(n,l,c,m)}catch(g){if(g instanceof so)return this.cache.invalidate(this.source,g.message),yield this.getZxyAttempt(n,l,c,m);throw g}})}getMetadataAttempt(){return Nr(this,null,function*(){const n=yield this.cache.getHeader(this.source),l=yield this.source.getBytes(n.jsonMetadataOffset,n.jsonMetadataLength);if(n.etag&&n.etag!==l.etag)throw new so(l.etag);const c=yield this.decompress(l.data,n.internalCompression),m=new TextDecoder("utf-8");return JSON.parse(m.decode(c))})}getMetadata(){return Nr(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(n){if(n instanceof so)return this.cache.invalidate(this.source,n.message),yield this.getMetadataAttempt();throw n}})}};function Zf(n){let l;const c=n[4].default,m=Ju(c,n,n[3],null);return{c(){m&&m.c()},m(g,x){m&&m.m(g,x),l=!0},p(g,x){m&&m.p&&(!l||x&8)&&Qu(m,c,g,g[3],l?Yu(c,g[3],x,null):ed(g[3]),null)},i(g){l||(ti(m,g),l=!0)},o(g){gi(m,g),l=!1},d(g){m&&m.d(g)}}}function Wy(n){let l,c,m=n[2]&&Zf(n);return{c(){l=gt("div"),m&&m.c(),Oi(l,"height",n[0]-113+"px")},m(g,x){ut(g,l,x),m&&m.m(l,null),n[5](l),c=!0},p(g,[x]){g[2]?m?(m.p(g,x),x&4&&ti(m,1)):(m=Zf(g),m.c(),ti(m,1),m.m(l,null)):m&&(go(),gi(m,1,1,()=>{m=null}),_o()),(!c||x&1)&&Oi(l,"height",g[0]-113+"px")},i(g){c||(ti(m),c=!0)},o(g){gi(m),c=!1},d(g){g&&ht(l),m&&m.d(),n[5](null)}}}let Xy="https://storage.googleapis.com/very-nice-tiles-bucket/blackpool_scores.pmtiles";function Ky(n,l,c){let{$$slots:m={},$$scope:g}=l,x=new Ry;no.addProtocol("pmtiles",x.tile);let{innerHeight:w}=l,a,S,P=!1;const q=new ju(Xy);x.add(q),Mc("map",{getMap:()=>a}),id(()=>{let F=!window.location.hash;a=new no.Map({container:S,style:"https://api.maptiler.com/maps/streets/style.json?key=KhrJl1uDAOHLgJ4c6Px9",hash:!0}),a.addControl(new no.ScaleControl),a.addControl(new no.NavigationControl,"bottom-right"),F&&a.jumpTo({center:[-.47,52.879],zoom:6}),a.on("load",()=>{c(2,P=!0)}),new ResizeObserver(()=>{a.resize()}).observe(S)}),Np(()=>{a.remove()});function R(F){pn[F?"unshift":"push"](()=>{S=F,c(1,S)})}return n.$$set=F=>{"innerHeight"in F&&c(0,w=F.innerHeight),"$$scope"in F&&c(3,g=F.$$scope)},[w,S,P,g,m,R]}class Jy extends Ir{constructor(l){super(),Sr(this,l,Ky,Wy,gr,{innerHeight:0})}}function Yy(n){let l;return{c(){l=gt("header"),l.innerHTML=`<div class="govuk-header__container govuk-width-container"><div class="govuk-header__logo"><a href="https://www.gov.uk/government/organisations/department-for-transport" class="govuk-header__link govuk-header__link--homepage svelte-6yrc4x" title="Go to DfT homepage" target="_blank"><span class="govuk-header__logotype"><img aria-label="DfT logo" src="https://raw.githubusercontent.com/ADD-William-WaltersDavis/dft_hackathon/main/assets/images/dft-logo-white.png" height="32" style="width:230px"/></span></a></div> 
    <div class="govuk-header__content"><span class="govuk-header__link govuk-header__link--service-name">Connectivity planning tool</span></div></div>`,We(l,"class","govuk-header"),We(l,"role","banner"),We(l,"data-module","govuk-header")},m(c,m){ut(c,l,m)},p:ni,i:ni,o:ni,d(c){c&&ht(l)}}}class Qy extends Ir{constructor(l){super(),Sr(this,l,null,Yy,gr,{})}}function e0(n){let l;return{c(){l=gt("div"),l.innerHTML=`<p class="govuk-phase-banner__content"><strong class="govuk-tag govuk-phase-banner__content__tag">prototype</strong> 
    <span class="govuk-phase-banner__text">This is a new service  your <a class="govuk-link" href="#">feedback</a> will
      help us to improve at william.waltersdavis@dft.gov.uk</span></p>`,We(l,"class","govuk-phase-banner")},m(c,m){ut(c,l,m)},p:ni,i:ni,o:ni,d(c){c&&ht(l)}}}class t0 extends Ir{constructor(l){super(),Sr(this,l,null,e0,gr,{})}}function Hf(n,l,c){const m=n.slice();return m[6]=l[c],m}function Wf(n){let l,c=n[6]+"",m;return{c(){l=gt("option"),m=Di(c),l.__value=n[6],l.value=l.__value},m(g,x){ut(g,l,x),xt(l,m)},p:ni,d(g){g&&ht(l)}}}function i0(n){let l,c,m,g,x,w,a=Xf(),S=[];for(let P=0;P<a.length;P+=1)S[P]=Wf(Hf(n,a,P));return{c(){l=gt("div"),c=gt("label"),c.textContent="Tile layer score purpose:",m=jt(),g=gt("select");for(let P=0;P<S.length;P+=1)S[P].c();We(c,"class","govuk-label"),We(c,"for","scoreLayer"),Oi(c,"margin-right","10px"),Oi(c,"margin-top","5px"),Oi(c,"font-size","1.2rem"),We(g,"class","govuk-select svelte-v7d4l8"),We(g,"id","scoreLayer"),We(g,"name","scoreLayer"),n[0]===void 0&&_s(()=>n[3].call(g)),We(l,"class","govuk-form-group svelte-v7d4l8"),Oi(l,"display","flex")},m(P,q){ut(P,l,q),xt(l,c),xt(l,m),xt(l,g);for(let R=0;R<S.length;R+=1)S[R].m(g,null);uc(g,n[0]),x||(w=[ki(g,"change",n[3]),ki(g,"change",n[1])],x=!0)},p(P,[q]){if(q&0){a=Xf();let R;for(R=0;R<a.length;R+=1){const F=Hf(P,a,R);S[R]?S[R].p(F,q):(S[R]=Wf(F),S[R].c(),S[R].m(g,null))}for(;R<S.length;R+=1)S[R].d(1);S.length=a.length}q&1&&uc(g,P[0])},i:ni,o:ni,d(P){P&&ht(l),zl(S,P),x=!1,Ln(w)}}}let bl="https://storage.googleapis.com/very-nice-tiles-bucket/";const Bu="tiles";function Xf(){return["Hide","Business","Education","Shopping","Residential","Entertainment"]}function r0(n,l,c){const{getMap:m}=mo("map"),g=m();let{tileOpacity:x=70}=l,w="Hide";id(async()=>{g.addSource("Business",{type:"raster",url:"pmtiles://"+bl+"ew_Business_nipy_spectral.pmtiles"}),g.addSource("Entertainment",{type:"raster",url:"pmtiles://"+bl+"ew_Entertainment_nipy_spectral.pmtiles"}),g.addSource("Education",{type:"raster",url:"pmtiles://"+bl+"ew_Education_nipy_spectral.pmtiles"}),g.addSource("Shopping",{type:"raster",url:"pmtiles://"+bl+"ew_Shopping_nipy_spectral.pmtiles"}),g.addSource("Residential",{type:"raster",url:"pmtiles://"+bl+"ew_Residential_nipy_spectral.pmtiles"}),a()});function a(){g.getLayer(Bu)&&g.removeLayer(Bu),w!="Hide"&&g.addLayer({id:Bu,type:"raster",source:w,paint:{"raster-opacity":x/100}})}function S(){w=Bp(this),c(0,w)}return n.$$set=P=>{"tileOpacity"in P&&c(2,x=P.tileOpacity)},n.$$.update=()=>{n.$$.dirty&4&&(Mc("tileOpacity",x),a())},a(),[w,a,x,S]}class n0 extends Ir{constructor(l){super(),Sr(this,l,r0,i0,gr,{tileOpacity:2})}}const s0="https://815d-35-189-123-220.ngrok-free.app",a0="https://11af-35-189-123-220.ngrok-free.app",o0="https://00dc-34-89-73-233.ngrok-free.app",l0="https://7480-34-89-73-233.eu.ngrok.io";async function h0(n){return await(await fetch(s0,{method:"POST",headers:Ec(),body:JSON.stringify(n)})).json()}async function c0(n){return await(await fetch(a0+"/floodfill_pt/",{method:"POST",headers:Ec(),body:JSON.stringify(n)})).json()}async function u0(n){let l;return l=await fetch(l0,{method:"POST",headers:Ec(),body:JSON.stringify({postcodeToSearch:n})}),await l.json()}async function d0(n){let l;return l=await fetch(o0,{method:"POST",headers:Ec(),body:JSON.stringify({square_ID:n})}),await l.json()}function Ec(){return{"Bypass-Tunnel-Reminder":"haha",Accept:"application/json","Access-Control-Allow-Origin":"*","Content-Type":"application/json"}}function Kf(n,l,c){const m=n.slice();return m[17]=l[c],m}function Jf(n){let l,c=n[17]+"",m;return{c(){l=gt("option"),m=Di(c),l.__value=n[17],l.value=l.__value},m(g,x){ut(g,l,x),xt(l,m)},p:ni,d(g){g&&ht(l)}}}function f0(n){let l,c,m,g,x,w,a,S,P,q,R,F,Q,le,de,fe=n[1],De=[];for(let Ee=0;Ee<fe.length;Ee+=1)De[Ee]=Jf(Kf(n,fe,Ee));return{c(){l=gt("div"),c=gt("label"),c.textContent="Displayed route purpose:",m=jt(),g=gt("select");for(let Ee=0;Ee<De.length;Ee+=1)De[Ee].c();x=jt(),w=gt("button"),w.textContent="Clear polygons (right click)",a=jt(),S=gt("div"),P=gt("label"),P.textContent="Start Time:",q=jt(),R=gt("input"),F=jt(),Q=gt("span"),We(c,"class","govuk-label"),We(c,"for","purpose"),Oi(c,"margin-right","10px"),Oi(c,"margin-top","5px"),Oi(c,"font-size","1.2rem"),We(g,"class","govuk-select svelte-11fuig8"),We(g,"id","purpose"),We(g,"name","purpose"),n[0]===void 0&&_s(()=>n[7].call(g)),We(l,"class","purposeBox svelte-11fuig8"),Oi(l,"display","flex"),We(w,"class","govuk-label svelte-11fuig8"),Oi(w,"font-size","1.2rem"),We(P,"for","start-time-input"),We(R,"id","start-time-input"),We(R,"type","time"),We(R,"name","start-time-input"),R.value="08:00",We(R,"min","06:00"),We(R,"max","22:00"),Oi(R,"font-size","15px"),Oi(R,"padding","5px"),We(R,"class","svelte-11fuig8"),We(Q,"class","validity svelte-11fuig8"),We(S,"class","startTimeSelection svelte-11fuig8")},m(Ee,xe){ut(Ee,l,xe),xt(l,c),xt(l,m),xt(l,g);for(let Te=0;Te<De.length;Te+=1)De[Te].m(g,null);uc(g,n[0]),ut(Ee,x,xe),ut(Ee,w,xe),ut(Ee,a,xe),ut(Ee,S,xe),xt(S,P),xt(S,q),xt(S,R),xt(S,F),xt(S,Q),le||(de=[ki(g,"change",n[7]),ki(g,"change",n[2]),ki(w,"click",n[3]),ki(R,"change",n[8])],le=!0)},p(Ee,[xe]){if(xe&2){fe=Ee[1];let Te;for(Te=0;Te<fe.length;Te+=1){const qe=Kf(Ee,fe,Te);De[Te]?De[Te].p(qe,xe):(De[Te]=Jf(qe),De[Te].c(),De[Te].m(g,null))}for(;Te<De.length;Te+=1)De[Te].d(1);De.length=fe.length}xe&3&&uc(g,Ee[0])},i:ni,o:ni,d(Ee){Ee&&ht(l),zl(De,Ee),Ee&&ht(x),Ee&&ht(w),Ee&&ht(a),Ee&&ht(S),le=!1,Ln(de)}}}const gs="squareInfoGeoJson",tc="floodPoints",ic="floodLines",ba="squareOutline";function Yf(){return{type:"FeatureCollection",features:[]}}function Qf(n){let[l,c]=n.split(",");return[parseFloat(l),parseFloat(c)]}function p0(n,l,c){const{getMap:m}=mo("map"),g=m();let x=28800,{squareID:w}=l,a,S="Business",{hoverInfo:P="no_selection"}=l,q=!1,R=["Business","Education","Entertainment","Shopping","Residential"];id(()=>{g.addSource(gs,{type:"geojson",data:Yf()})}),Np(()=>{for(let Te of[tc,ic,ba])g.getLayer(Te)&&g.removeLayer(Te);g.getSource(gs)&&g.removeSource(gs)}),g.on("click",async function(Te){if(q){console.log("Click is already being processed");return}if(q=!0,x>=21600&&x<=79200){console.log(`Lookup square for ${Te.lngLat}`),console.time("square API");let qe=await h0(Te.lngLat);if(console.timeEnd("square API"),qe=="click_not_on_square"){console.log("Click not on square"),q=!1;return}c(5,w=qe.name);let nt=qe.square_coords,Fe=F(nt);delete qe.square_coords;let Pe={...qe,trip_start_seconds:x};console.time("floodfill API");let Se=await c0(Pe);console.timeEnd("floodfill API"),le(Se,Fe),q=!1}else alert("Start time must be between 06:00 and 22:00"),q=!1});function F(Te){let qe=Yf();return qe.features.push({type:"Feature",geometry:{type:"LineString",coordinates:Te},properties:{name:"square"}}),g.getSource(gs).setData(qe),Q(),qe}function Q(){g.getLayer(ba)&&g.removeLayer(ba),g.addLayer({source:gs,id:ba,filter:["all",["==","$type","LineString"],["==","name","square"]],type:"line",paint:{"line-color":"#000000","line-width":3}})}function le(Te,qe){console.time("Build GJ data");for(let[nt,Fe]of Te.key_destinations_per_purpose.entries())for(let Pe of Fe)qe.features.push({type:"Feature",geometry:{type:"Point",coordinates:Pe},properties:{purpose:nt}});a=[0,0,0,0,0];for(let[nt,Fe]of Object.entries(Te.link_coordinates)){let Pe=Te.per_link_score_per_purpose[nt];for(let[Mt,D]of Pe.entries())a[Mt]=Math.max(a[Mt],D);let[Se,He]=Qf(Fe[0]),[Lt,It]=Qf(Fe[1]);qe.features.push({type:"Feature",geometry:{type:"LineString",coordinates:[[Se,He],[Lt,It]]},properties:{Business:Pe[0],Education:Pe[1],Entertainment:Pe[2],Shopping:Pe[3],Residential:Pe[4],link_type:Te.link_is_pt[nt],routeDetails:Te.link_route_details[nt],name:"link"},id:nt})}console.timeEnd("Build GJ data"),g.getSource(gs).setData(qe),console.time("Set layers"),de(),console.timeEnd("Set layers")}function de(){let Te=R.indexOf(S);for(let qe of[tc,ic,ba])g.getLayer(qe)&&g.removeLayer(qe);g.addLayer({source:gs,id:ba,filter:["all",["==","$type","LineString"],["==","name","square"]],type:"line",paint:{"line-color":"#000000","line-width":3}}),g.addLayer({source:gs,id:tc,filter:["all",["==","$type","Point"],["==","purpose",Te]],type:"circle",paint:{"circle-radius":10,"circle-color":"white","circle-opacity":1,"circle-stroke-color":"black","circle-stroke-width":2}}),g.addLayer({source:gs,id:ic,filter:["all",["==","$type","LineString"],["==","name","link"]],type:"line",paint:{"line-color":["match",["get","link_type"],0,"#1f493d",1,"#EE7C0E","red"],"line-width":["*",10,["/",["sqrt",["get",S]],Math.sqrt(a[Te])]],"line-opacity":1}}),g.on("mousemove",qe=>{const nt=g.queryRenderedFeatures(qe.point);if(nt[0])if(nt[0].properties.routeDetails){let Fe=nt[0];Fe.properties.routeDetails!="{}"?c(6,P={routeDetails:JSON.parse(Fe.properties.routeDetails),cursorxy:qe.point}):c(6,P="no_selection")}else c(6,P="no_selection");else c(6,P="no_selection")})}function fe(){c(5,w=null);for(let Te of[tc,ic,ba])g.getLayer(Te)&&g.removeLayer(Te)}g.on("contextmenu",function(){fe()});function De(Te){let[qe,nt]=Te.target.value.split(":");x=parseInt(qe)*3600+parseInt(nt)*60}function Ee(){S=Bp(this),c(0,S),c(1,R)}const xe=Te=>De(Te);return n.$$set=Te=>{"squareID"in Te&&c(5,w=Te.squareID),"hoverInfo"in Te&&c(6,P=Te.hoverInfo)},[S,R,de,fe,De,w,P,Ee,xe]}class m0 extends Ir{constructor(l){super(),Sr(this,l,p0,f0,gr,{squareID:5,hoverInfo:6})}}function ep(n,l,c){const m=n.slice();return m[3]=l[c],m}function tp(n,l,c){const m=n.slice();return m[6]=l[c],m}function ip(n){let l;return{c(){l=gt("div"),We(l,"class","square svelte-lcwcsz"),Oi(l,"background-color",n[6]),Oi(l,"opacity",n[0]/100)},m(c,m){ut(c,l,m)},p(c,m){m&1&&Oi(l,"opacity",c[0]/100)},d(c){c&&ht(l)}}}function rp(n){let l,c=n[3]+"",m,g;return{c(){l=gt("div"),m=Di(c),g=jt(),We(l,"class","numbers svelte-lcwcsz")},m(x,w){ut(x,l,w),xt(l,m),xt(l,g)},p:ni,d(x){x&&ht(l)}}}function g0(n){let l,c,m,g,x,w,a=n[2],S=[];for(let R=0;R<a.length;R+=1)S[R]=ip(tp(n,a,R));let P=n[1],q=[];for(let R=0;R<P.length;R+=1)q[R]=rp(ep(n,P,R));return{c(){l=gt("div"),c=gt("div"),c.textContent="Connectivity score",m=jt(),g=gt("div");for(let R=0;R<S.length;R+=1)S[R].c();x=jt(),w=gt("div");for(let R=0;R<q.length;R+=1)q[R].c();We(c,"class","legendtitle svelte-lcwcsz"),We(g,"class","legend svelte-lcwcsz"),We(w,"class","legend svelte-lcwcsz"),We(l,"class","box svelte-lcwcsz")},m(R,F){ut(R,l,F),xt(l,c),xt(l,m),xt(l,g);for(let Q=0;Q<S.length;Q+=1)S[Q].m(g,null);xt(l,x),xt(l,w);for(let Q=0;Q<q.length;Q+=1)q[Q].m(w,null)},p(R,[F]){if(F&5){a=R[2];let Q;for(Q=0;Q<a.length;Q+=1){const le=tp(R,a,Q);S[Q]?S[Q].p(le,F):(S[Q]=ip(le),S[Q].c(),S[Q].m(g,null))}for(;Q<S.length;Q+=1)S[Q].d(1);S.length=a.length}if(F&2){P=R[1];let Q;for(Q=0;Q<P.length;Q+=1){const le=ep(R,P,Q);q[Q]?q[Q].p(le,F):(q[Q]=rp(le),q[Q].c(),q[Q].m(w,null))}for(;Q<q.length;Q+=1)q[Q].d(1);q.length=P.length}},i:ni,o:ni,d(R){R&&ht(l),zl(S,R),zl(q,R)}}}function _0(n,l,c){let{tileOpacity:m}=l,g=[0," "," "," ",25," "," "," ",50," "," "," ",75," "," "," ",100],x=["#000000","#130015","#2f0035","#41004b","#5d006b","#700080","#7a008b","#7d008e","#810092","#850096","#870098","#6d009c","#58009f","#3800a3","#2300a6","#0300aa","#0000b1","#0000bd","#0000c9","#0000d1","#0000dd","#0013dd","#002fdd","#0041dd","#005ddd","#0078dd","#007ddd","#0085dd","#008add","#0092dd","#0098dd","#009cd3","#009fcb","#00a3bf","#00a7b3","#00aaab","#00aaa3","#00aa9d","#00aa95","#00aa90","#00aa88","#00a773","#00a353","#009f33","#009d1d","#009a00","#009f00","#00a700","#00ac00","#00b400","#00bc00","#00c200","#00ca00","#00cf00","#00d700","#00dc00","#00e400","#00ea00","#00f200","#00fa00","#00ff00","#2cff00","#49ff00","#75ff00","#93ff00","#bcff00","#c4fc00","#d0f800","#dcf400","#e4f100","#efed00","#f1e700","#f5df00","#f8da00","#fcd200","#ffc900","#ffc100","#ffb500","#ffad00","#ffa100","#ff9900","#ff7500","#ff5d00","#ff3900","#ff1500","#fe0000","#f60000","#f10000","#e90000","#e40000","#dc0000","#da0000","#d60000","#d20000","#cf0000","#cc0c0c","#cc2c2c","#cc5c5c","#cc7c7c","#ccacac","#cccccc"];return n.$$set=w=>{"tileOpacity"in w&&c(0,m=w.tileOpacity)},[m,g,x]}class y0 extends Ir{constructor(l){super(),Sr(this,l,_0,g0,gr,{tileOpacity:0})}}function v0(n){let l,c,m,g,x,w;return{c(){l=gt("div"),c=gt("button"),m=Di("Download report PDF"),We(c,"class","pdfDownloadButton svelte-y1ph1h"),c.disabled=g=n[0]==null},m(a,S){ut(a,l,S),xt(l,c),xt(c,m),x||(w=ki(c,"click",n[2]),x=!0)},p(a,[S]){S&1&&g!==(g=a[0]==null)&&(c.disabled=g)},i:ni,o:ni,d(a){a&&ht(l),x=!1,w()}}}function x0(n,l,c){let{squareID:m}=l;function g(){console.log(m)}const x=()=>g();return n.$$set=w=>{"squareID"in w&&c(0,m=w.squareID)},[m,g,x]}class b0 extends Ir{constructor(l){super(),Sr(this,l,x0,v0,gr,{squareID:0})}}function w0(n){const l=n-1;return l*l*l+1}function M0(n,{delay:l=0,duration:c=400,easing:m=Ku}={}){const g=+getComputedStyle(n).opacity;return{delay:l,duration:c,easing:m,css:x=>`opacity: ${x*g}`}}function E0(n,{delay:l=0,duration:c=400,easing:m=w0,x:g=0,y:x=0,opacity:w=0}={}){const a=getComputedStyle(n),S=+a.opacity,P=a.transform==="none"?"":a.transform,q=S*(1-w);return{delay:l,duration:c,easing:m,css:(R,F)=>`
			transform: ${P} translate(${(1-R)*g}px, ${(1-R)*x}px);
			opacity: ${S-q*F}`}}const{document:T0}=N_;function np(n){let l,c,m,g,x;return{c(){l=gt("div"),c=Di(n[0]),We(l,"class","range__tooltip svelte-189kcx4")},m(w,a){ut(w,l,a),xt(l,c),x=!0},p(w,a){(!x||a[0]&1)&&Vs(c,w[0])},i(w){x||(_s(()=>{g&&g.end(1),m=O_(l,E0,{y:7,duration:200}),m.start()}),x=!0)},o(w){m&&m.invalidate(),g=F_(l,M0,{duration:100}),x=!1},d(w){w&&ht(l),w&&g&&g.end()}}}function S0(n){let l,c,m,g,x,w,a,S,P,q,R,F=(n[8]||n[9])&&np(n);return{c(){l=gt("div"),c=gt("div"),m=gt("div"),g=gt("div"),x=jt(),w=gt("div"),F&&F.c(),a=jt(),S=gt("style"),S.textContent=`.mouse-over-shield {
      position: fixed;
      top: 0px;
      left: 0px;
      height: 100%;
      width: 100%;
      background-color: rgba(255, 0, 0, 0);
      z-index: 10000;
      cursor: grabbing;
    }`,We(g,"class","range__track--highlighted svelte-189kcx4"),We(w,"class","range__thumb svelte-189kcx4"),Bf(w,"range__thumb--holding",n[8]),We(m,"class","range__track svelte-189kcx4"),We(c,"class","range__wrapper svelte-189kcx4"),We(c,"tabindex","0"),We(c,"role","slider"),We(c,"aria-valuemin",n[1]),We(c,"aria-valuemax",n[2]),We(c,"aria-valuenow",n[0]),We(c,"id",n[3]),We(l,"class","range svelte-189kcx4")},m(Q,le){ut(Q,l,le),xt(l,c),xt(c,m),xt(m,g),n[18](g),xt(m,x),xt(m,w),F&&F.m(w,null),n[19](w),n[22](m),n[23](c),ut(Q,a,le),xt(T0.head,S),P=!0,q||(R=[ki(window,"touchmove",n[15],{passive:!1}),ki(window,"touchcancel",n[13]),ki(window,"touchend",n[13]),ki(window,"mousemove",n[15]),ki(window,"mouseup",n[13]),ki(window,"resize",n[10]),ki(w,"touchstart",n[12]),ki(w,"mousedown",n[12]),ki(w,"mouseover",n[20]),ki(w,"mouseout",n[21]),ki(c,"keydown",n[14]),ki(c,"mousedown",n[11]),ki(c,"touchstart",n[11])],q=!0)},p(Q,le){Q[8]||Q[9]?F?(F.p(Q,le),le[0]&768&&ti(F,1)):(F=np(Q),F.c(),ti(F,1),F.m(w,null)):F&&(go(),gi(F,1,1,()=>{F=null}),_o()),(!P||le[0]&256)&&Bf(w,"range__thumb--holding",Q[8]),(!P||le[0]&2)&&We(c,"aria-valuemin",Q[1]),(!P||le[0]&4)&&We(c,"aria-valuemax",Q[2]),(!P||le[0]&1)&&We(c,"aria-valuenow",Q[0]),(!P||le[0]&8)&&We(c,"id",Q[3])},i(Q){P||(ti(F),P=!0)},o(Q){gi(F),P=!1},d(Q){Q&&ht(l),n[18](null),F&&F.d(),n[19](null),n[22](null),n[23](null),Q&&ht(a),ht(S),q=!1,Ln(R)}}}function I0(n,l){let c=l.getBoundingClientRect(),{clientX:m,clientY:g}=n;return!(m<c.left||m>=c.right||g<c.top||g>=c.bottom)}function A0(n,l,c){let{min:m=0}=l,{max:g=100}=l,{initialValue:x=70}=l,{id:w=null}=l,{value:a=typeof x=="string"?parseInt(x):x}=l,S=null,P=null,q=null,R=null,F=null,Q=null,le=!1,de=!1,fe=0,De=null;const Ee=D_(),xe=document.createElement("div");xe.setAttribute("class","mouse-over-shield"),xe.addEventListener("mouseover",me=>{me.preventDefault(),me.stopPropagation()});function Te(){F=R.getBoundingClientRect().left}function qe(me){c(0,a=me),Ee("change",{value:a})}function nt(me){Lt(me),Fe(me)}function Fe(me){me.type==="mousedown"&&document.body.append(xe),c(17,Q=P)}function Pe(me){me.type==="mouseup"&&(document.body.contains(xe)&&document.body.removeChild(xe),I0(me,P)&&c(9,de=!0)),c(17,Q=null)}function Se(me){fe<50&&fe++;let Ne=Math.ceil(fe/5);(me.key==="ArrowUp"||me.key==="ArrowRight")&&(a+Ne>g||a>=g?qe(g):qe(a+Ne)),(me.key==="ArrowDown"||me.key==="ArrowLeft")&&(a-Ne<m||a<=m?qe(m):qe(a-Ne)),clearTimeout(De),De=setTimeout(()=>fe=1,100)}function He(me){let Re=(me-(F+10))*100/(S.clientWidth-10);Re=Re<0?0:Re>100?100:Re,qe(parseInt(Re*(g-m)/100)+m)}function Lt(me){if(!Q&&me.type!=="touchstart"&&me.type!=="mousedown")return!1;me.stopPropagation&&me.stopPropagation(),me.preventDefault&&me.preventDefault();const Ne=me.type==="touchmove"||me.type==="touchstart"?me.touches[0].clientX:me.clientX;He(Ne)}function It(me){pn[me?"unshift":"push"](()=>{q=me,c(6,q),c(5,P),c(0,a),c(1,m),c(2,g),c(4,S)})}function Mt(me){pn[me?"unshift":"push"](()=>{P=me,c(5,P),c(6,q),c(0,a),c(1,m),c(2,g),c(4,S)})}const D=()=>c(9,de=!0),K=()=>c(9,de=!1);function H(me){pn[me?"unshift":"push"](()=>{S=me,c(4,S)})}function Be(me){pn[me?"unshift":"push"](()=>{R=me,c(7,R)})}return n.$$set=me=>{"min"in me&&c(1,m=me.min),"max"in me&&c(2,g=me.max),"initialValue"in me&&c(16,x=me.initialValue),"id"in me&&c(3,w=me.id),"value"in me&&c(0,a=me.value)},n.$$.update=()=>{if(n.$$.dirty[0]&128&&R&&(F=R.getBoundingClientRect().left),n.$$.dirty[0]&131072&&c(8,le=Boolean(Q)),n.$$.dirty[0]&119&&q&&P){c(0,a=a>m?a:m),c(0,a=a<g?a:g);let me=(a-m)*100/(g-m),Ne=(S.clientWidth-10)*(me/100)+5;c(5,P.style.left=`${Ne}px`,P),c(6,q.style.width=`${Ne}px`,q)}},[a,m,g,w,S,P,q,R,le,de,Te,nt,Fe,Pe,Se,Lt,x,Q,It,Mt,D,K,H,Be]}class C0 extends Ir{constructor(l){super(),Sr(this,l,A0,S0,gr,{min:1,max:2,initialValue:16,id:3,value:0},null,[-1,-1])}}function k0(n){let l,c,m,g,x,w,a,S,P;return S=new C0({props:{id:"basic-slider"}}),S.$on("change",n[1]),{c(){l=gt("div"),c=gt("h3"),m=Di("Tile opacity: "),g=Di(n[0]),x=Di(" %"),w=jt(),a=gt("div"),Er(S.$$.fragment),We(c,"class","svelte-16jt29t"),We(l,"class","whitebox svelte-16jt29t")},m(q,R){ut(q,l,R),xt(l,c),xt(c,m),xt(c,g),xt(c,x),xt(l,w),xt(l,a),pr(S,a,null),P=!0},p(q,[R]){(!P||R&1)&&Vs(g,q[0])},i(q){P||(ti(S.$$.fragment,q),P=!0)},o(q){gi(S.$$.fragment,q),P=!1},d(q){q&&ht(l),mr(S)}}}function P0(n,l,c){let{tileOpacity:m=70}=l;const g=x=>c(0,m=x.detail.value);return n.$$set=x=>{"tileOpacity"in x&&c(0,m=x.tileOpacity)},[m,g]}class z0 extends Ir{constructor(l){super(),Sr(this,l,P0,k0,gr,{tileOpacity:0})}}function L0(n){let l,c,m,g,x,w,a;return{c(){l=gt("div"),c=gt("input"),m=jt(),g=Rf("svg"),x=Rf("path"),We(c,"type","text"),Oi(c,"font-size","1.2rem"),Oi(c,"width","160px"),We(c,"placeholder","Find postcode..."),We(x,"xmlns","http://www.w3.org/2000/svg"),We(x,"d","M10 4C6.68629 4 4 6.68629 4 10C4 13.3137 6.68629 16 10 16C13.3137 16 16 13.3137 16 10C16 6.68629 13.3137 4 10 4ZM2 10C2 5.58172 5.58172 2 10 2C14.4183 2 18 5.58172 18 10C18 11.8487 17.3729 13.551 16.3199 14.9056L21.7071 20.2929C22.0976 20.6834 22.0976 21.3166 21.7071 21.7071C21.3166 22.0976 20.6834 22.0976 20.2929 21.7071L14.9056 16.3199C13.551 17.3729 11.8487 18 10 18C5.58172 18 2 14.4183 2 10Z"),We(x,"fill","#0D0D0D"),We(g,"fill","none"),We(g,"viewBox","0 0 24 24"),We(g,"height","24"),We(g,"width","24"),We(g,"xmlns","http://www.w3.org/2000/svg"),We(l,"class","whitebox svelte-xrjd1p")},m(S,P){ut(S,l,P),xt(l,c),xt(l,m),xt(l,g),xt(g,x),w||(a=[ki(c,"input",n[1]),ki(c,"keydown",n[0])],w=!0)},p:ni,i:ni,o:ni,d(S){S&&ht(l),w=!1,Ln(a)}}}function D0(n){const{getMap:l}=mo("map"),c=l();let m="";async function g(){let a=await u0(m);if(a!="no_match"){let S=a.postcodeMatch;c.jumpTo({center:S,zoom:14})}}function x(a){a.key==="Enter"&&g()}function w(a){m=a.target.value}return[x,w]}class R0 extends Ir{constructor(l){super(),Sr(this,l,D0,L0,gr,{})}}function B0(n){let l;return{c(){l=gt("p"),l.textContent="Hover to see route info",We(l,"class","govuk-body")},m(c,m){ut(c,l,m)},p:ni,d(c){c&&ht(l)}}}function O0(n){let l,c=n[0].routeDetails.vehicle_mode+"",m,g,x,w,a=n[0].routeDetails.route_number+"",S,P,q,R,F=n[0].routeDetails.origin_stop_name+"",Q,le,de,fe,De=n[0].routeDetails.destination_stop_name+"",Ee;return{c(){l=gt("b"),m=Di(c),g=jt(),x=gt("br"),w=Di(`
    Route: `),S=Di(a),P=jt(),q=gt("br"),R=Di(`
    From: `),Q=Di(F),le=jt(),de=gt("br"),fe=Di(`
    To: `),Ee=Di(De),Oi(l,"font-weight","bold")},m(xe,Te){ut(xe,l,Te),xt(l,m),ut(xe,g,Te),ut(xe,x,Te),ut(xe,w,Te),ut(xe,S,Te),ut(xe,P,Te),ut(xe,q,Te),ut(xe,R,Te),ut(xe,Q,Te),ut(xe,le,Te),ut(xe,de,Te),ut(xe,fe,Te),ut(xe,Ee,Te)},p(xe,Te){Te&1&&c!==(c=xe[0].routeDetails.vehicle_mode+"")&&Vs(m,c),Te&1&&a!==(a=xe[0].routeDetails.route_number+"")&&Vs(S,a),Te&1&&F!==(F=xe[0].routeDetails.origin_stop_name+"")&&Vs(Q,F),Te&1&&De!==(De=xe[0].routeDetails.destination_stop_name+"")&&Vs(Ee,De)},d(xe){xe&&ht(l),xe&&ht(g),xe&&ht(x),xe&&ht(w),xe&&ht(S),xe&&ht(P),xe&&ht(q),xe&&ht(R),xe&&ht(Q),xe&&ht(le),xe&&ht(de),xe&&ht(fe),xe&&ht(Ee)}}}function F0(n){let l,c;function m(w,a){if(w[0]!="no_selection")return O0;if(w[0]=="no_selection")return B0}let g=m(n),x=g&&g(n);return{c(){l=gt("div"),x&&x.c(),We(l,"class",c=Df(n[1])+" svelte-jlw8k1"),Oi(l,"left",rc(n[0],"x")+"px"),Oi(l,"top",rc(n[0],"y")+"px")},m(w,a){ut(w,l,a),x&&x.m(l,null)},p(w,[a]){g===(g=m(w))&&x?x.p(w,a):(x&&x.d(1),x=g&&g(w),x&&(x.c(),x.m(l,null))),a&2&&c!==(c=Df(w[1])+" svelte-jlw8k1")&&We(l,"class",c),a&1&&Oi(l,"left",rc(w[0],"x")+"px"),a&1&&Oi(l,"top",rc(w[0],"y")+"px")},i:ni,o:ni,d(w){w&&ht(l),x&&x.d()}}}function rc(n,l){if(n!="no_selection")return l=="x"?n.cursorxy.x:n.cursorxy.y}function N0(n,l,c){let{hoverInfo:m="no_selection"}=l,g="hoverOff";function x(w){w=="no_selection"?c(1,g="hoverOff"):c(1,g="hoverOn")}return n.$$set=w=>{"hoverInfo"in w&&c(0,m=w.hoverInfo)},n.$$.update=()=>{n.$$.dirty&1&&x(m)},[m,g]}class U0 extends Ir{constructor(l){super(),Sr(this,l,N0,F0,gr,{hoverInfo:0})}}function V0(n){n("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),n("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),n("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),n.WGS84=n["EPSG:4326"],n["EPSG:3785"]=n["EPSG:3857"],n.GOOGLE=n["EPSG:3857"],n["EPSG:900913"]=n["EPSG:3857"],n["EPSG:102113"]=n["EPSG:3857"]}var Ma=1,Ea=2,fo=3,$0=4,Zu=5,sp=6378137,q0=6356752314e-3,ap=.0066943799901413165,Pl=484813681109536e-20,je=Math.PI/2,G0=.16666666666666666,j0=.04722222222222222,Z0=.022156084656084655,dt=1e-10,fr=.017453292519943295,Hn=57.29577951308232,yi=Math.PI/4,Dl=Math.PI*2,ji=3.14159265359,Wr={};Wr.greenwich=0;Wr.lisbon=-9.131906111111;Wr.paris=2.337229166667;Wr.bogota=-74.080916666667;Wr.madrid=-3.687938888889;Wr.rome=12.452333333333;Wr.bern=7.439583333333;Wr.jakarta=106.807719444444;Wr.ferro=-17.666666666667;Wr.brussels=4.367975;Wr.stockholm=18.058277777778;Wr.athens=23.7163375;Wr.oslo=10.722916666667;const H0={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var op=/[\s_\-\/\(\)]/g;function Gs(n,l){if(n[l])return n[l];for(var c=Object.keys(n),m=l.toLowerCase().replace(op,""),g=-1,x,w;++g<c.length;)if(x=c[g],w=x.toLowerCase().replace(op,""),w===m)return n[x]}function Hu(n){var l={},c=n.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).reduce(function(a,S){var P=S.split("=");return P.push(!0),a[P[0].toLowerCase()]=P[1],a},{}),m,g,x,w={proj:"projName",datum:"datumCode",rf:function(a){l.rf=parseFloat(a)},lat_0:function(a){l.lat0=a*fr},lat_1:function(a){l.lat1=a*fr},lat_2:function(a){l.lat2=a*fr},lat_ts:function(a){l.lat_ts=a*fr},lon_0:function(a){l.long0=a*fr},lon_1:function(a){l.long1=a*fr},lon_2:function(a){l.long2=a*fr},alpha:function(a){l.alpha=parseFloat(a)*fr},gamma:function(a){l.rectified_grid_angle=parseFloat(a)},lonc:function(a){l.longc=a*fr},x_0:function(a){l.x0=parseFloat(a)},y_0:function(a){l.y0=parseFloat(a)},k_0:function(a){l.k0=parseFloat(a)},k:function(a){l.k0=parseFloat(a)},a:function(a){l.a=parseFloat(a)},b:function(a){l.b=parseFloat(a)},r_a:function(){l.R_A=!0},zone:function(a){l.zone=parseInt(a,10)},south:function(){l.utmSouth=!0},towgs84:function(a){l.datum_params=a.split(",").map(function(S){return parseFloat(S)})},to_meter:function(a){l.to_meter=parseFloat(a)},units:function(a){l.units=a;var S=Gs(H0,a);S&&(l.to_meter=S.to_meter)},from_greenwich:function(a){l.from_greenwich=a*fr},pm:function(a){var S=Gs(Wr,a);l.from_greenwich=(S||parseFloat(a))*fr},nadgrids:function(a){a==="@null"?l.datumCode="none":l.nadgrids=a},axis:function(a){var S="ewnsud";a.length===3&&S.indexOf(a.substr(0,1))!==-1&&S.indexOf(a.substr(1,1))!==-1&&S.indexOf(a.substr(2,1))!==-1&&(l.axis=a)},approx:function(){l.approx=!0}};for(m in c)g=c[m],m in w?(x=w[m],typeof x=="function"?x(g):l[x]=g):l[m]=g;return typeof l.datumCode=="string"&&l.datumCode!=="WGS84"&&(l.datumCode=l.datumCode.toLowerCase()),l}var Rl=1,cm=2,um=3,gc=4,dm=5,sd=-1,W0=/\s/,X0=/[A-Za-z]/,K0=/[A-Za-z84_]/,Tc=/[,\]]/,fm=/[\d\.E\-\+]/;function ys(n){if(typeof n!="string")throw new Error("not a string");this.text=n.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Rl}ys.prototype.readCharicter=function(){var n=this.text[this.place++];if(this.state!==gc)for(;W0.test(n);){if(this.place>=this.text.length)return;n=this.text[this.place++]}switch(this.state){case Rl:return this.neutral(n);case cm:return this.keyword(n);case gc:return this.quoted(n);case dm:return this.afterquote(n);case um:return this.number(n);case sd:return}};ys.prototype.afterquote=function(n){if(n==='"'){this.word+='"',this.state=gc;return}if(Tc.test(n)){this.word=this.word.trim(),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in afterquote yet, index '+this.place)};ys.prototype.afterItem=function(n){if(n===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Rl;return}if(n==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Rl,this.currentObject=this.stack.pop(),this.currentObject||(this.state=sd);return}};ys.prototype.number=function(n){if(fm.test(n)){this.word+=n;return}if(Tc.test(n)){this.word=parseFloat(this.word),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in number yet, index '+this.place)};ys.prototype.quoted=function(n){if(n==='"'){this.state=dm;return}this.word+=n};ys.prototype.keyword=function(n){if(K0.test(n)){this.word+=n;return}if(n==="["){var l=[];l.push(this.word),this.level++,this.root===null?this.root=l:this.currentObject.push(l),this.stack.push(this.currentObject),this.currentObject=l,this.state=Rl;return}if(Tc.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in keyword yet, index '+this.place)};ys.prototype.neutral=function(n){if(X0.test(n)){this.word=n,this.state=cm;return}if(n==='"'){this.word="",this.state=gc;return}if(fm.test(n)){this.word=n,this.state=um;return}if(Tc.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in neutral yet, index '+this.place)};ys.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===sd)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function J0(n){var l=new ys(n);return l.output()}function lp(n,l,c){Array.isArray(l)&&(c.unshift(l),l=null);var m=l?{}:n,g=c.reduce(function(x,w){return ao(w,x),x},m);l&&(n[l]=g)}function ao(n,l){if(!Array.isArray(n)){l[n]=!0;return}var c=n.shift();if(c==="PARAMETER"&&(c=n.shift()),n.length===1){if(Array.isArray(n[0])){l[c]={},ao(n[0],l[c]);return}l[c]=n[0];return}if(!n.length){l[c]=!0;return}if(c==="TOWGS84"){l[c]=n;return}if(c==="AXIS"){c in l||(l[c]=[]),l[c].push(n);return}Array.isArray(c)||(l[c]={});var m;switch(c){case"UNIT":case"PRIMEM":case"VERT_DATUM":l[c]={name:n[0].toLowerCase(),convert:n[1]},n.length===3&&ao(n[2],l[c]);return;case"SPHEROID":case"ELLIPSOID":l[c]={name:n[0],a:n[1],rf:n[2]},n.length===4&&ao(n[3],l[c]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":n[0]=["name",n[0]],lp(l,c,n);return;default:for(m=-1;++m<n.length;)if(!Array.isArray(n[m]))return ao(n,l[c]);return lp(l,c,n)}}var Y0=.017453292519943295;function Q0(n,l){var c=l[0],m=l[1];!(c in n)&&m in n&&(n[c]=n[m],l.length===3&&(n[c]=l[2](n[c])))}function Zn(n){return n*Y0}function ev(n){if(n.type==="GEOGCS"?n.projName="longlat":n.type==="LOCAL_CS"?(n.projName="identity",n.local=!0):typeof n.PROJECTION=="object"?n.projName=Object.keys(n.PROJECTION)[0]:n.projName=n.PROJECTION,n.AXIS){for(var l="",c=0,m=n.AXIS.length;c<m;++c){var g=[n.AXIS[c][0].toLowerCase(),n.AXIS[c][1].toLowerCase()];g[0].indexOf("north")!==-1||(g[0]==="y"||g[0]==="lat")&&g[1]==="north"?l+="n":g[0].indexOf("south")!==-1||(g[0]==="y"||g[0]==="lat")&&g[1]==="south"?l+="s":g[0].indexOf("east")!==-1||(g[0]==="x"||g[0]==="lon")&&g[1]==="east"?l+="e":(g[0].indexOf("west")!==-1||(g[0]==="x"||g[0]==="lon")&&g[1]==="west")&&(l+="w")}l.length===2&&(l+="u"),l.length===3&&(n.axis=l)}n.UNIT&&(n.units=n.UNIT.name.toLowerCase(),n.units==="metre"&&(n.units="meter"),n.UNIT.convert&&(n.type==="GEOGCS"?n.DATUM&&n.DATUM.SPHEROID&&(n.to_meter=n.UNIT.convert*n.DATUM.SPHEROID.a):n.to_meter=n.UNIT.convert));var x=n.GEOGCS;n.type==="GEOGCS"&&(x=n),x&&(x.DATUM?n.datumCode=x.DATUM.name.toLowerCase():n.datumCode=x.name.toLowerCase(),n.datumCode.slice(0,2)==="d_"&&(n.datumCode=n.datumCode.slice(2)),(n.datumCode==="new_zealand_geodetic_datum_1949"||n.datumCode==="new_zealand_1949")&&(n.datumCode="nzgd49"),(n.datumCode==="wgs_1984"||n.datumCode==="world_geodetic_system_1984")&&(n.PROJECTION==="Mercator_Auxiliary_Sphere"&&(n.sphere=!0),n.datumCode="wgs84"),n.datumCode.slice(-6)==="_ferro"&&(n.datumCode=n.datumCode.slice(0,-6)),n.datumCode.slice(-8)==="_jakarta"&&(n.datumCode=n.datumCode.slice(0,-8)),~n.datumCode.indexOf("belge")&&(n.datumCode="rnb72"),x.DATUM&&x.DATUM.SPHEROID&&(n.ellps=x.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),n.ellps.toLowerCase().slice(0,13)==="international"&&(n.ellps="intl"),n.a=x.DATUM.SPHEROID.a,n.rf=parseFloat(x.DATUM.SPHEROID.rf,10)),x.DATUM&&x.DATUM.TOWGS84&&(n.datum_params=x.DATUM.TOWGS84),~n.datumCode.indexOf("osgb_1936")&&(n.datumCode="osgb36"),~n.datumCode.indexOf("osni_1952")&&(n.datumCode="osni52"),(~n.datumCode.indexOf("tm65")||~n.datumCode.indexOf("geodetic_datum_of_1965"))&&(n.datumCode="ire65"),n.datumCode==="ch1903+"&&(n.datumCode="ch1903"),~n.datumCode.indexOf("israel")&&(n.datumCode="isr93")),n.b&&!isFinite(n.b)&&(n.b=n.a);function w(P){var q=n.to_meter||1;return P*q}var a=function(P){return Q0(n,P)},S=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Zn],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Zn],["x0","false_easting",w],["y0","false_northing",w],["long0","central_meridian",Zn],["lat0","latitude_of_origin",Zn],["lat0","standard_parallel_1",Zn],["lat1","standard_parallel_1",Zn],["lat2","standard_parallel_2",Zn],["azimuth","Azimuth"],["alpha","azimuth",Zn],["srsCode","name"]];S.forEach(a),!n.long0&&n.longc&&(n.projName==="Albers_Conic_Equal_Area"||n.projName==="Lambert_Azimuthal_Equal_Area")&&(n.long0=n.longc),!n.lat_ts&&n.lat1&&(n.projName==="Stereographic_South_Pole"||n.projName==="Polar Stereographic (variant B)")?(n.lat0=Zn(n.lat1>0?90:-90),n.lat_ts=n.lat1):!n.lat_ts&&n.lat0&&n.projName==="Polar_Stereographic"&&(n.lat_ts=n.lat0,n.lat0=Zn(n.lat0>0?90:-90))}function pm(n){var l=J0(n),c=l.shift(),m=l.shift();l.unshift(["name",m]),l.unshift(["type",c]);var g={};return ao(l,g),ev(g),g}function Fr(n){var l=this;if(arguments.length===2){var c=arguments[1];typeof c=="string"?c.charAt(0)==="+"?Fr[n]=Hu(arguments[1]):Fr[n]=pm(arguments[1]):Fr[n]=c}else if(arguments.length===1){if(Array.isArray(n))return n.map(function(m){Array.isArray(m)?Fr.apply(l,m):Fr(m)});if(typeof n=="string"){if(n in Fr)return Fr[n]}else"EPSG"in n?Fr["EPSG:"+n.EPSG]=n:"ESRI"in n?Fr["ESRI:"+n.ESRI]=n:"IAU2000"in n?Fr["IAU2000:"+n.IAU2000]=n:console.log(n);return}}V0(Fr);function tv(n){return typeof n=="string"}function iv(n){return n in Fr}var rv=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function nv(n){return rv.some(function(l){return n.indexOf(l)>-1})}var sv=["3857","900913","3785","102113"];function av(n){var l=Gs(n,"authority");if(l){var c=Gs(l,"epsg");return c&&sv.indexOf(c)>-1}}function ov(n){var l=Gs(n,"extension");if(l)return Gs(l,"proj4")}function lv(n){return n[0]==="+"}function hv(n){if(tv(n)){if(iv(n))return Fr[n];if(nv(n)){var l=pm(n);if(av(l))return Fr["EPSG:3857"];var c=ov(l);return c?Hu(c):l}if(lv(n))return Hu(n)}else return n}function hp(n,l){n=n||{};var c,m;if(!l)return n;for(m in l)c=l[m],c!==void 0&&(n[m]=c);return n}function Xn(n,l,c){var m=n*l;return c/Math.sqrt(1-m*m)}function Ul(n){return n<0?-1:1}function vt(n){return Math.abs(n)<=ji?n:n-Ul(n)*Dl}function zn(n,l,c){var m=n*c,g=.5*n;return m=Math.pow((1-m)/(1+m),g),Math.tan(.5*(je-l))/m}function Bl(n,l){for(var c=.5*n,m,g,x=je-2*Math.atan(l),w=0;w<=15;w++)if(m=n*Math.sin(x),g=je-2*Math.atan(l*Math.pow((1-m)/(1+m),c))-x,x+=g,Math.abs(g)<=1e-10)return x;return-9999}function cv(){var n=this.b/this.a;this.es=1-n*n,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Xn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function uv(n){var l=n.x,c=n.y;if(c*Hn>90&&c*Hn<-90&&l*Hn>180&&l*Hn<-180)return null;var m,g;if(Math.abs(Math.abs(c)-je)<=dt)return null;if(this.sphere)m=this.x0+this.a*this.k0*vt(l-this.long0),g=this.y0+this.a*this.k0*Math.log(Math.tan(yi+.5*c));else{var x=Math.sin(c),w=zn(this.e,c,x);m=this.x0+this.a*this.k0*vt(l-this.long0),g=this.y0-this.a*this.k0*Math.log(w)}return n.x=m,n.y=g,n}function dv(n){var l=n.x-this.x0,c=n.y-this.y0,m,g;if(this.sphere)g=je-2*Math.atan(Math.exp(-c/(this.a*this.k0)));else{var x=Math.exp(-c/(this.a*this.k0));if(g=Bl(this.e,x),g===-9999)return null}return m=vt(this.long0+l/(this.a*this.k0)),n.x=m,n.y=g,n}var fv=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const pv={init:cv,forward:uv,inverse:dv,names:fv};function mv(){}function cp(n){return n}var gv=["longlat","identity"];const _v={init:mv,forward:cp,inverse:cp,names:gv};var yv=[pv,_v],lc={},_c=[];function mm(n,l){var c=_c.length;return n.names?(_c[c]=n,n.names.forEach(function(m){lc[m.toLowerCase()]=c}),this):(console.log(l),!0)}function vv(n){if(!n)return!1;var l=n.toLowerCase();if(typeof lc[l]<"u"&&_c[lc[l]])return _c[lc[l]]}function xv(){yv.forEach(mm)}const bv={start:xv,add:mm,get:vv};var qt={};qt.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};qt.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};qt.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};qt.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};qt.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};qt.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};qt.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};qt.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};qt.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};qt.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};qt.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};qt.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};qt.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};qt.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};qt.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};qt.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};qt.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};qt.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};qt.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};qt.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};qt.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};qt.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};qt.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};qt.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};qt.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};qt.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};qt.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};qt.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};qt.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};qt.hough={a:6378270,rf:297,ellipseName:"Hough"};qt.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};qt.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};qt.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};qt.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};qt.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};qt.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};qt.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};qt.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};qt.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};qt.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};qt.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};qt.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var wv=qt.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};qt.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function Mv(n,l,c,m){var g=n*n,x=l*l,w=(g-x)/g,a=0;m?(n*=1-w*(G0+w*(j0+w*Z0)),g=n*n,w=0):a=Math.sqrt(w);var S=(g-x)/x;return{es:w,e:a,ep2:S}}function Ev(n,l,c,m,g){if(!n){var x=Gs(qt,m);x||(x=wv),n=x.a,l=x.b,c=x.rf}return c&&!l&&(l=(1-1/c)*n),(c===0||Math.abs(n-l)<dt)&&(g=!0,l=n),{a:n,b:l,rf:c,sphere:g}}var Qi={};Qi.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Qi.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Qi.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Qi.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Qi.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Qi.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Qi.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Qi.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Qi.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Qi.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Qi.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Qi.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Qi.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Qi.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Qi.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Qi.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Qi.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function Tv(n,l,c,m,g,x,w){var a={};return n===void 0||n==="none"?a.datum_type=Zu:a.datum_type=$0,l&&(a.datum_params=l.map(parseFloat),(a.datum_params[0]!==0||a.datum_params[1]!==0||a.datum_params[2]!==0)&&(a.datum_type=Ma),a.datum_params.length>3&&(a.datum_params[3]!==0||a.datum_params[4]!==0||a.datum_params[5]!==0||a.datum_params[6]!==0)&&(a.datum_type=Ea,a.datum_params[3]*=Pl,a.datum_params[4]*=Pl,a.datum_params[5]*=Pl,a.datum_params[6]=a.datum_params[6]/1e6+1)),w&&(a.datum_type=fo,a.grids=w),a.a=c,a.b=m,a.es=g,a.ep2=x,a}var gm={};function Sv(n,l){var c=new DataView(l),m=Cv(c),g=kv(c,m);g.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var x=Pv(c,g,m),w={header:g,subgrids:x};return gm[n]=w,w}function Iv(n){if(n===void 0)return null;var l=n.split(",");return l.map(Av)}function Av(n){if(n.length===0)return null;var l=n[0]==="@";return l&&(n=n.slice(1)),n==="null"?{name:"null",mandatory:!l,grid:null,isNull:!0}:{name:n,mandatory:!l,grid:gm[n]||null,isNull:!1}}function oo(n){return n/3600*Math.PI/180}function Cv(n){var l=n.getInt32(8,!1);return l===11?!1:(l=n.getInt32(8,!0),l!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function kv(n,l){return{nFields:n.getInt32(8,l),nSubgridFields:n.getInt32(24,l),nSubgrids:n.getInt32(40,l),shiftType:Wu(n,56,56+8).trim(),fromSemiMajorAxis:n.getFloat64(120,l),fromSemiMinorAxis:n.getFloat64(136,l),toSemiMajorAxis:n.getFloat64(152,l),toSemiMinorAxis:n.getFloat64(168,l)}}function Wu(n,l,c){return String.fromCharCode.apply(null,new Uint8Array(n.buffer.slice(l,c)))}function Pv(n,l,c){for(var m=176,g=[],x=0;x<l.nSubgrids;x++){var w=Lv(n,m,c),a=Dv(n,m,w,c),S=Math.round(1+(w.upperLongitude-w.lowerLongitude)/w.longitudeInterval),P=Math.round(1+(w.upperLatitude-w.lowerLatitude)/w.latitudeInterval);g.push({ll:[oo(w.lowerLongitude),oo(w.lowerLatitude)],del:[oo(w.longitudeInterval),oo(w.latitudeInterval)],lim:[S,P],count:w.gridNodeCount,cvs:zv(a)})}return g}function zv(n){return n.map(function(l){return[oo(l.longitudeShift),oo(l.latitudeShift)]})}function Lv(n,l,c){return{name:Wu(n,l+8,l+16).trim(),parent:Wu(n,l+24,l+24+8).trim(),lowerLatitude:n.getFloat64(l+72,c),upperLatitude:n.getFloat64(l+88,c),lowerLongitude:n.getFloat64(l+104,c),upperLongitude:n.getFloat64(l+120,c),latitudeInterval:n.getFloat64(l+136,c),longitudeInterval:n.getFloat64(l+152,c),gridNodeCount:n.getInt32(l+168,c)}}function Dv(n,l,c,m){for(var g=l+176,x=16,w=[],a=0;a<c.gridNodeCount;a++){var S={latitudeShift:n.getFloat32(g+a*x,m),longitudeShift:n.getFloat32(g+a*x+4,m),latitudeAccuracy:n.getFloat32(g+a*x+8,m),longitudeAccuracy:n.getFloat32(g+a*x+12,m)};w.push(S)}return w}function Wn(n,l){if(!(this instanceof Wn))return new Wn(n);l=l||function(P){if(P)throw P};var c=hv(n);if(typeof c!="object"){l(n);return}var m=Wn.projections.get(c.projName);if(!m){l(n);return}if(c.datumCode&&c.datumCode!=="none"){var g=Gs(Qi,c.datumCode);g&&(c.datum_params=c.datum_params||(g.towgs84?g.towgs84.split(","):null),c.ellps=g.ellipse,c.datumName=g.datumName?g.datumName:c.datumCode)}c.k0=c.k0||1,c.axis=c.axis||"enu",c.ellps=c.ellps||"wgs84",c.lat1=c.lat1||c.lat0;var x=Ev(c.a,c.b,c.rf,c.ellps,c.sphere),w=Mv(x.a,x.b,x.rf,c.R_A),a=Iv(c.nadgrids),S=c.datum||Tv(c.datumCode,c.datum_params,x.a,x.b,w.es,w.ep2,a);hp(this,c),hp(this,m),this.a=x.a,this.b=x.b,this.rf=x.rf,this.sphere=x.sphere,this.es=w.es,this.e=w.e,this.ep2=w.ep2,this.datum=S,this.init(),l(null,this)}Wn.projections=bv;Wn.projections.start();function Rv(n,l){return n.datum_type!==l.datum_type||n.a!==l.a||Math.abs(n.es-l.es)>5e-11?!1:n.datum_type===Ma?n.datum_params[0]===l.datum_params[0]&&n.datum_params[1]===l.datum_params[1]&&n.datum_params[2]===l.datum_params[2]:n.datum_type===Ea?n.datum_params[0]===l.datum_params[0]&&n.datum_params[1]===l.datum_params[1]&&n.datum_params[2]===l.datum_params[2]&&n.datum_params[3]===l.datum_params[3]&&n.datum_params[4]===l.datum_params[4]&&n.datum_params[5]===l.datum_params[5]&&n.datum_params[6]===l.datum_params[6]:!0}function _m(n,l,c){var m=n.x,g=n.y,x=n.z?n.z:0,w,a,S,P;if(g<-je&&g>-1.001*je)g=-je;else if(g>je&&g<1.001*je)g=je;else{if(g<-je)return{x:-1/0,y:-1/0,z:n.z};if(g>je)return{x:1/0,y:1/0,z:n.z}}return m>Math.PI&&(m-=2*Math.PI),a=Math.sin(g),P=Math.cos(g),S=a*a,w=c/Math.sqrt(1-l*S),{x:(w+x)*P*Math.cos(m),y:(w+x)*P*Math.sin(m),z:(w*(1-l)+x)*a}}function ym(n,l,c,m){var g=1e-12,x=g*g,w=30,a,S,P,q,R,F,Q,le,de,fe,De,Ee,xe,Te=n.x,qe=n.y,nt=n.z?n.z:0,Fe,Pe,Se;if(a=Math.sqrt(Te*Te+qe*qe),S=Math.sqrt(Te*Te+qe*qe+nt*nt),a/c<g){if(Fe=0,S/c<g)return Pe=je,Se=-m,{x:n.x,y:n.y,z:n.z}}else Fe=Math.atan2(qe,Te);P=nt/S,q=a/S,R=1/Math.sqrt(1-l*(2-l)*q*q),le=q*(1-l)*R,de=P*R,xe=0;do xe++,Q=c/Math.sqrt(1-l*de*de),Se=a*le+nt*de-Q*(1-l*de*de),F=l*Q/(Q+Se),R=1/Math.sqrt(1-F*(2-F)*q*q),fe=q*(1-F)*R,De=P*R,Ee=De*le-fe*de,le=fe,de=De;while(Ee*Ee>x&&xe<w);return Pe=Math.atan(De/Math.abs(fe)),{x:Fe,y:Pe,z:Se}}function Bv(n,l,c){if(l===Ma)return{x:n.x+c[0],y:n.y+c[1],z:n.z+c[2]};if(l===Ea){var m=c[0],g=c[1],x=c[2],w=c[3],a=c[4],S=c[5],P=c[6];return{x:P*(n.x-S*n.y+a*n.z)+m,y:P*(S*n.x+n.y-w*n.z)+g,z:P*(-a*n.x+w*n.y+n.z)+x}}}function Ov(n,l,c){if(l===Ma)return{x:n.x-c[0],y:n.y-c[1],z:n.z-c[2]};if(l===Ea){var m=c[0],g=c[1],x=c[2],w=c[3],a=c[4],S=c[5],P=c[6],q=(n.x-m)/P,R=(n.y-g)/P,F=(n.z-x)/P;return{x:q+S*R-a*F,y:-S*q+R+w*F,z:a*q-w*R+F}}}function nc(n){return n===Ma||n===Ea}function Fv(n,l,c){if(Rv(n,l)||n.datum_type===Zu||l.datum_type===Zu)return c;var m=n.a,g=n.es;if(n.datum_type===fo){var x=up(n,!1,c);if(x!==0)return;m=sp,g=ap}var w=l.a,a=l.b,S=l.es;if(l.datum_type===fo&&(w=sp,a=q0,S=ap),g===S&&m===w&&!nc(n.datum_type)&&!nc(l.datum_type))return c;if(c=_m(c,g,m),nc(n.datum_type)&&(c=Bv(c,n.datum_type,n.datum_params)),nc(l.datum_type)&&(c=Ov(c,l.datum_type,l.datum_params)),c=ym(c,S,w,a),l.datum_type===fo){var P=up(l,!0,c);if(P!==0)return}return c}function up(n,l,c){if(n.grids===null||n.grids.length===0)return console.log("Grid shift grids not found"),-1;for(var m={x:-c.x,y:c.y},g={x:Number.NaN,y:Number.NaN},x=[],w=0;w<n.grids.length;w++){var a=n.grids[w];if(x.push(a.name),a.isNull){g=m;break}if(a.mandatory,a.grid===null){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1;continue}var S=a.grid.subgrids[0],P=(Math.abs(S.del[1])+Math.abs(S.del[0]))/1e4,q=S.ll[0]-P,R=S.ll[1]-P,F=S.ll[0]+(S.lim[0]-1)*S.del[0]+P,Q=S.ll[1]+(S.lim[1]-1)*S.del[1]+P;if(!(R>m.y||q>m.x||Q<m.y||F<m.x)&&(g=Nv(m,l,S),!isNaN(g.x)))break}return isNaN(g.x)?(console.log("Failed to find a grid shift table for location '"+-m.x*Hn+" "+m.y*Hn+" tried: '"+x+"'"),-1):(c.x=-g.x,c.y=g.y,0)}function Nv(n,l,c){var m={x:Number.NaN,y:Number.NaN};if(isNaN(n.x))return m;var g={x:n.x,y:n.y};g.x-=c.ll[0],g.y-=c.ll[1],g.x=vt(g.x-Math.PI)+Math.PI;var x=dp(g,c);if(l){if(isNaN(x.x))return m;x.x=g.x-x.x,x.y=g.y-x.y;var w=9,a=1e-12,S,P;do{if(P=dp(x,c),isNaN(P.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}S={x:g.x-(P.x+x.x),y:g.y-(P.y+x.y)},x.x+=S.x,x.y+=S.y}while(w--&&Math.abs(S.x)>a&&Math.abs(S.y)>a);if(w<0)return console.log("Inverse grid shift iterator failed to converge."),m;m.x=vt(x.x+c.ll[0]),m.y=x.y+c.ll[1]}else isNaN(x.x)||(m.x=n.x+x.x,m.y=n.y+x.y);return m}function dp(n,l){var c={x:n.x/l.del[0],y:n.y/l.del[1]},m={x:Math.floor(c.x),y:Math.floor(c.y)},g={x:c.x-1*m.x,y:c.y-1*m.y},x={x:Number.NaN,y:Number.NaN},w;if(m.x<0||m.x>=l.lim[0]||m.y<0||m.y>=l.lim[1])return x;w=m.y*l.lim[0]+m.x;var a={x:l.cvs[w][0],y:l.cvs[w][1]};w++;var S={x:l.cvs[w][0],y:l.cvs[w][1]};w+=l.lim[0];var P={x:l.cvs[w][0],y:l.cvs[w][1]};w--;var q={x:l.cvs[w][0],y:l.cvs[w][1]},R=g.x*g.y,F=g.x*(1-g.y),Q=(1-g.x)*(1-g.y),le=(1-g.x)*g.y;return x.x=Q*a.x+F*S.x+le*q.x+R*P.x,x.y=Q*a.y+F*S.y+le*q.y+R*P.y,x}function fp(n,l,c){var m=c.x,g=c.y,x=c.z||0,w,a,S,P={};for(S=0;S<3;S++)if(!(l&&S===2&&c.z===void 0))switch(S===0?(w=m,"ew".indexOf(n.axis[S])!==-1?a="x":a="y"):S===1?(w=g,"ns".indexOf(n.axis[S])!==-1?a="y":a="x"):(w=x,a="z"),n.axis[S]){case"e":P[a]=w;break;case"w":P[a]=-w;break;case"n":P[a]=w;break;case"s":P[a]=-w;break;case"u":c[a]!==void 0&&(P.z=w);break;case"d":c[a]!==void 0&&(P.z=-w);break;default:return null}return P}function vm(n){var l={x:n[0],y:n[1]};return n.length>2&&(l.z=n[2]),n.length>3&&(l.m=n[3]),l}function Uv(n){pp(n.x),pp(n.y)}function pp(n){if(typeof Number.isFinite=="function"){if(Number.isFinite(n))return;throw new TypeError("coordinates must be finite numbers")}if(typeof n!="number"||n!==n||!isFinite(n))throw new TypeError("coordinates must be finite numbers")}function Vv(n,l){return(n.datum.datum_type===Ma||n.datum.datum_type===Ea||n.datum.datum_type===fo)&&l.datumCode!=="WGS84"||(l.datum.datum_type===Ma||l.datum.datum_type===Ea||l.datum.datum_type===fo)&&n.datumCode!=="WGS84"}function yc(n,l,c,m){var g;Array.isArray(c)?c=vm(c):c={x:c.x,y:c.y,z:c.z,m:c.m};var x=c.z!==void 0;if(Uv(c),n.datum&&l.datum&&Vv(n,l)&&(g=new Wn("WGS84"),c=yc(n,g,c,m),n=g),m&&n.axis!=="enu"&&(c=fp(n,!1,c)),n.projName==="longlat")c={x:c.x*fr,y:c.y*fr,z:c.z||0};else if(n.to_meter&&(c={x:c.x*n.to_meter,y:c.y*n.to_meter,z:c.z||0}),c=n.inverse(c),!c)return;if(n.from_greenwich&&(c.x+=n.from_greenwich),c=Fv(n.datum,l.datum,c),!!c)return l.from_greenwich&&(c={x:c.x-l.from_greenwich,y:c.y,z:c.z||0}),l.projName==="longlat"?c={x:c.x*Hn,y:c.y*Hn,z:c.z||0}:(c=l.forward(c),l.to_meter&&(c={x:c.x/l.to_meter,y:c.y/l.to_meter,z:c.z||0})),m&&l.axis!=="enu"?fp(l,!0,c):(x||delete c.z,c)}var mp=Wn("WGS84");function Ou(n,l,c,m){var g,x,w;return Array.isArray(c)?(g=yc(n,l,c,m)||{x:NaN,y:NaN},c.length>2?typeof n.name<"u"&&n.name==="geocent"||typeof l.name<"u"&&l.name==="geocent"?typeof g.z=="number"?[g.x,g.y,g.z].concat(c.splice(3)):[g.x,g.y,c[2]].concat(c.splice(3)):[g.x,g.y].concat(c.splice(2)):[g.x,g.y]):(x=yc(n,l,c,m),w=Object.keys(c),w.length===2||w.forEach(function(a){if(typeof n.name<"u"&&n.name==="geocent"||typeof l.name<"u"&&l.name==="geocent"){if(a==="x"||a==="y"||a==="z")return}else if(a==="x"||a==="y")return;x[a]=c[a]}),x)}function gp(n){return n instanceof Wn?n:n.oProj?n.oProj:Wn(n)}function sn(n,l,c){n=gp(n);var m=!1,g;return typeof l>"u"?(l=n,n=mp,m=!0):(typeof l.x<"u"||Array.isArray(l))&&(c=l,l=n,n=mp,m=!0),l=gp(l),c?Ou(n,l,c):(g={forward:function(x,w){return Ou(n,l,x,w)},inverse:function(x,w){return Ou(l,n,x,w)}},m&&(g.oProj=l),g)}var _p=6,xm="AJSAJS",bm="AFAFAF",lo=65,Hr=73,fn=79,El=86,Tl=90;const $v={forward:wm,inverse:qv,toPoint:Mm};function wm(n,l){return l=l||5,Zv(Gv({lat:n[1],lon:n[0]}),l)}function qv(n){var l=ad(Tm(n.toUpperCase()));return l.lat&&l.lon?[l.lon,l.lat,l.lon,l.lat]:[l.left,l.bottom,l.right,l.top]}function Mm(n){var l=ad(Tm(n.toUpperCase()));return l.lat&&l.lon?[l.lon,l.lat]:[(l.left+l.right)/2,(l.top+l.bottom)/2]}function Fu(n){return n*(Math.PI/180)}function yp(n){return 180*(n/Math.PI)}function Gv(n){var l=n.lat,c=n.lon,m=6378137,g=.00669438,x=.9996,w,a,S,P,q,R,F,Q=Fu(l),le=Fu(c),de,fe;fe=Math.floor((c+180)/6)+1,c===180&&(fe=60),l>=56&&l<64&&c>=3&&c<12&&(fe=32),l>=72&&l<84&&(c>=0&&c<9?fe=31:c>=9&&c<21?fe=33:c>=21&&c<33?fe=35:c>=33&&c<42&&(fe=37)),w=(fe-1)*6-180+3,de=Fu(w),a=g/(1-g),S=m/Math.sqrt(1-g*Math.sin(Q)*Math.sin(Q)),P=Math.tan(Q)*Math.tan(Q),q=a*Math.cos(Q)*Math.cos(Q),R=Math.cos(Q)*(le-de),F=m*((1-g/4-3*g*g/64-5*g*g*g/256)*Q-(3*g/8+3*g*g/32+45*g*g*g/1024)*Math.sin(2*Q)+(15*g*g/256+45*g*g*g/1024)*Math.sin(4*Q)-35*g*g*g/3072*Math.sin(6*Q));var De=x*S*(R+(1-P+q)*R*R*R/6+(5-18*P+P*P+72*q-58*a)*R*R*R*R*R/120)+5e5,Ee=x*(F+S*Math.tan(Q)*(R*R/2+(5-P+9*q+4*q*q)*R*R*R*R/24+(61-58*P+P*P+600*q-330*a)*R*R*R*R*R*R/720));return l<0&&(Ee+=1e7),{northing:Math.round(Ee),easting:Math.round(De),zoneNumber:fe,zoneLetter:jv(l)}}function ad(n){var l=n.northing,c=n.easting,m=n.zoneLetter,g=n.zoneNumber;if(g<0||g>60)return null;var x=.9996,w=6378137,a=.00669438,S,P=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),q,R,F,Q,le,de,fe,De,Ee,xe=c-5e5,Te=l;m<"N"&&(Te-=1e7),fe=(g-1)*6-180+3,S=a/(1-a),de=Te/x,De=de/(w*(1-a/4-3*a*a/64-5*a*a*a/256)),Ee=De+(3*P/2-27*P*P*P/32)*Math.sin(2*De)+(21*P*P/16-55*P*P*P*P/32)*Math.sin(4*De)+151*P*P*P/96*Math.sin(6*De),q=w/Math.sqrt(1-a*Math.sin(Ee)*Math.sin(Ee)),R=Math.tan(Ee)*Math.tan(Ee),F=S*Math.cos(Ee)*Math.cos(Ee),Q=w*(1-a)/Math.pow(1-a*Math.sin(Ee)*Math.sin(Ee),1.5),le=xe/(q*x);var qe=Ee-q*Math.tan(Ee)/Q*(le*le/2-(5+3*R+10*F-4*F*F-9*S)*le*le*le*le/24+(61+90*R+298*F+45*R*R-252*S-3*F*F)*le*le*le*le*le*le/720);qe=yp(qe);var nt=(le-(1+2*R+F)*le*le*le/6+(5-2*F+28*R-3*F*F+8*S+24*R*R)*le*le*le*le*le/120)/Math.cos(Ee);nt=fe+yp(nt);var Fe;if(n.accuracy){var Pe=ad({northing:n.northing+n.accuracy,easting:n.easting+n.accuracy,zoneLetter:n.zoneLetter,zoneNumber:n.zoneNumber});Fe={top:Pe.lat,right:Pe.lon,bottom:qe,left:nt}}else Fe={lat:qe,lon:nt};return Fe}function jv(n){var l="Z";return 84>=n&&n>=72?l="X":72>n&&n>=64?l="W":64>n&&n>=56?l="V":56>n&&n>=48?l="U":48>n&&n>=40?l="T":40>n&&n>=32?l="S":32>n&&n>=24?l="R":24>n&&n>=16?l="Q":16>n&&n>=8?l="P":8>n&&n>=0?l="N":0>n&&n>=-8?l="M":-8>n&&n>=-16?l="L":-16>n&&n>=-24?l="K":-24>n&&n>=-32?l="J":-32>n&&n>=-40?l="H":-40>n&&n>=-48?l="G":-48>n&&n>=-56?l="F":-56>n&&n>=-64?l="E":-64>n&&n>=-72?l="D":-72>n&&n>=-80&&(l="C"),l}function Zv(n,l){var c="00000"+n.easting,m="00000"+n.northing;return n.zoneNumber+n.zoneLetter+Hv(n.easting,n.northing,n.zoneNumber)+c.substr(c.length-5,l)+m.substr(m.length-5,l)}function Hv(n,l,c){var m=Em(c),g=Math.floor(n/1e5),x=Math.floor(l/1e5)%20;return Wv(g,x,m)}function Em(n){var l=n%_p;return l===0&&(l=_p),l}function Wv(n,l,c){var m=c-1,g=xm.charCodeAt(m),x=bm.charCodeAt(m),w=g+n-1,a=x+l,S=!1;w>Tl&&(w=w-Tl+lo-1,S=!0),(w===Hr||g<Hr&&w>Hr||(w>Hr||g<Hr)&&S)&&w++,(w===fn||g<fn&&w>fn||(w>fn||g<fn)&&S)&&(w++,w===Hr&&w++),w>Tl&&(w=w-Tl+lo-1),a>El?(a=a-El+lo-1,S=!0):S=!1,(a===Hr||x<Hr&&a>Hr||(a>Hr||x<Hr)&&S)&&a++,(a===fn||x<fn&&a>fn||(a>fn||x<fn)&&S)&&(a++,a===Hr&&a++),a>El&&(a=a-El+lo-1);var P=String.fromCharCode(w)+String.fromCharCode(a);return P}function Tm(n){if(n&&n.length===0)throw"MGRSPoint coverting from nothing";for(var l=n.length,c=null,m="",g,x=0;!/[A-Z]/.test(g=n.charAt(x));){if(x>=2)throw"MGRSPoint bad conversion from: "+n;m+=g,x++}var w=parseInt(m,10);if(x===0||x+3>l)throw"MGRSPoint bad conversion from: "+n;var a=n.charAt(x++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+n;c=n.substring(x,x+=2);for(var S=Em(w),P=Xv(c.charAt(0),S),q=Kv(c.charAt(1),S);q<Jv(a);)q+=2e6;var R=l-x;if(R%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+n;var F=R/2,Q=0,le=0,de,fe,De,Ee,xe;return F>0&&(de=1e5/Math.pow(10,F),fe=n.substring(x,x+F),Q=parseFloat(fe)*de,De=n.substring(x+F),le=parseFloat(De)*de),Ee=Q+P,xe=le+q,{easting:Ee,northing:xe,zoneLetter:a,zoneNumber:w,accuracy:de}}function Xv(n,l){for(var c=xm.charCodeAt(l-1),m=1e5,g=!1;c!==n.charCodeAt(0);){if(c++,c===Hr&&c++,c===fn&&c++,c>Tl){if(g)throw"Bad character: "+n;c=lo,g=!0}m+=1e5}return m}function Kv(n,l){if(n>"V")throw"MGRSPoint given invalid Northing "+n;for(var c=bm.charCodeAt(l-1),m=0,g=!1;c!==n.charCodeAt(0);){if(c++,c===Hr&&c++,c===fn&&c++,c>El){if(g)throw"Bad character: "+n;c=lo,g=!0}m+=1e5}return m}function Jv(n){var l;switch(n){case"C":l=11e5;break;case"D":l=2e6;break;case"E":l=28e5;break;case"F":l=37e5;break;case"G":l=46e5;break;case"H":l=55e5;break;case"J":l=64e5;break;case"K":l=73e5;break;case"L":l=82e5;break;case"M":l=91e5;break;case"N":l=0;break;case"P":l=8e5;break;case"Q":l=17e5;break;case"R":l=26e5;break;case"S":l=35e5;break;case"T":l=44e5;break;case"U":l=53e5;break;case"V":l=62e5;break;case"W":l=7e6;break;case"X":l=79e5;break;default:l=-1}if(l>=0)return l;throw"Invalid zone letter: "+n}function yo(n,l,c){if(!(this instanceof yo))return new yo(n,l,c);if(Array.isArray(n))this.x=n[0],this.y=n[1],this.z=n[2]||0;else if(typeof n=="object")this.x=n.x,this.y=n.y,this.z=n.z||0;else if(typeof n=="string"&&typeof l>"u"){var m=n.split(",");this.x=parseFloat(m[0],10),this.y=parseFloat(m[1],10),this.z=parseFloat(m[2],10)||0}else this.x=n,this.y=l,this.z=c||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}yo.fromMGRS=function(n){return new yo(Mm(n))};yo.prototype.toMGRS=function(n){return wm([this.x,this.y],n)};var Yv=1,Qv=.25,vp=.046875,xp=.01953125,bp=.01068115234375,e1=.75,t1=.46875,i1=.013020833333333334,r1=.007120768229166667,n1=.3645833333333333,s1=.005696614583333333,a1=.3076171875;function Sm(n){var l=[];l[0]=Yv-n*(Qv+n*(vp+n*(xp+n*bp))),l[1]=n*(e1-n*(vp+n*(xp+n*bp)));var c=n*n;return l[2]=c*(t1-n*(i1+n*r1)),c*=n,l[3]=c*(n1-n*s1),l[4]=c*n*a1,l}function Sc(n,l,c,m){return c*=l,l*=l,m[0]*n-c*(m[1]+l*(m[2]+l*(m[3]+l*m[4])))}var o1=20;function Im(n,l,c){for(var m=1/(1-l),g=n,x=o1;x;--x){var w=Math.sin(g),a=1-l*w*w;if(a=(Sc(g,w,Math.cos(g),c)-n)*(a*Math.sqrt(a))*m,g-=a,Math.abs(a)<dt)return g}return g}function l1(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Sm(this.es),this.ml0=Sc(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function h1(n){var l=n.x,c=n.y,m=vt(l-this.long0),g,x,w,a=Math.sin(c),S=Math.cos(c);if(this.es){var q=S*m,R=Math.pow(q,2),F=this.ep2*Math.pow(S,2),Q=Math.pow(F,2),le=Math.abs(S)>dt?Math.tan(c):0,de=Math.pow(le,2),fe=Math.pow(de,2);g=1-this.es*Math.pow(a,2),q=q/Math.sqrt(g);var De=Sc(c,a,S,this.en);x=this.a*(this.k0*q*(1+R/6*(1-de+F+R/20*(5-18*de+fe+14*F-58*de*F+R/42*(61+179*fe-fe*de-479*de)))))+this.x0,w=this.a*(this.k0*(De-this.ml0+a*m*q/2*(1+R/12*(5-de+9*F+4*Q+R/30*(61+fe-58*de+270*F-330*de*F+R/56*(1385+543*fe-fe*de-3111*de))))))+this.y0}else{var P=S*Math.sin(m);if(Math.abs(Math.abs(P)-1)<dt)return 93;if(x=.5*this.a*this.k0*Math.log((1+P)/(1-P))+this.x0,w=S*Math.cos(m)/Math.sqrt(1-Math.pow(P,2)),P=Math.abs(w),P>=1){if(P-1>dt)return 93;w=0}else w=Math.acos(w);c<0&&(w=-w),w=this.a*this.k0*(w-this.lat0)+this.y0}return n.x=x,n.y=w,n}function c1(n){var l,c,m,g,x=(n.x-this.x0)*(1/this.a),w=(n.y-this.y0)*(1/this.a);if(this.es)if(l=this.ml0+w/this.k0,c=Im(l,this.es,this.en),Math.abs(c)<je){var R=Math.sin(c),F=Math.cos(c),Q=Math.abs(F)>dt?Math.tan(c):0,le=this.ep2*Math.pow(F,2),de=Math.pow(le,2),fe=Math.pow(Q,2),De=Math.pow(fe,2);l=1-this.es*Math.pow(R,2);var Ee=x*Math.sqrt(l)/this.k0,xe=Math.pow(Ee,2);l=l*Q,m=c-l*xe/(1-this.es)*.5*(1-xe/12*(5+3*fe-9*le*fe+le-4*de-xe/30*(61+90*fe-252*le*fe+45*De+46*le-xe/56*(1385+3633*fe+4095*De+1574*De*fe)))),g=vt(this.long0+Ee*(1-xe/6*(1+2*fe+le-xe/20*(5+28*fe+24*De+8*le*fe+6*le-xe/42*(61+662*fe+1320*De+720*De*fe))))/F)}else m=je*Ul(w),g=0;else{var a=Math.exp(x/this.k0),S=.5*(a-1/a),P=this.lat0+w/this.k0,q=Math.cos(P);l=Math.sqrt((1-Math.pow(q,2))/(1+Math.pow(S,2))),m=Math.asin(l),w<0&&(m=-m),S===0&&q===0?g=0:g=vt(Math.atan2(S,q)+this.long0)}return n.x=g,n.y=m,n}var u1=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const hc={init:l1,forward:h1,inverse:c1,names:u1};function Am(n){var l=Math.exp(n);return l=(l-1/l)/2,l}function Pn(n,l){n=Math.abs(n),l=Math.abs(l);var c=Math.max(n,l),m=Math.min(n,l)/(c||1);return c*Math.sqrt(1+Math.pow(m,2))}function d1(n){var l=1+n,c=l-1;return c===0?n:n*Math.log(l)/c}function f1(n){var l=Math.abs(n);return l=d1(l*(1+l/(Pn(1,l)+1))),n<0?-l:l}function od(n,l){for(var c=2*Math.cos(2*l),m=n.length-1,g=n[m],x=0,w;--m>=0;)w=-x+c*g+n[m],x=g,g=w;return l+w*Math.sin(2*l)}function p1(n,l){for(var c=2*Math.cos(l),m=n.length-1,g=n[m],x=0,w;--m>=0;)w=-x+c*g+n[m],x=g,g=w;return Math.sin(l)*w}function m1(n){var l=Math.exp(n);return l=(l+1/l)/2,l}function Cm(n,l,c){for(var m=Math.sin(l),g=Math.cos(l),x=Am(c),w=m1(c),a=2*g*w,S=-2*m*x,P=n.length-1,q=n[P],R=0,F=0,Q=0,le,de;--P>=0;)le=F,de=R,F=q,R=Q,q=-le+a*F-S*R+n[P],Q=-de+S*F+a*R;return a=m*w,S=g*x,[a*q-S*Q,a*Q+S*q]}function g1(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(hc.init.apply(this),this.forward=hc.forward,this.inverse=hc.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var n=this.es/(1+Math.sqrt(1-this.es)),l=n/(2-n),c=l;this.cgb[0]=l*(2+l*(-2/3+l*(-2+l*(116/45+l*(26/45+l*(-2854/675)))))),this.cbg[0]=l*(-2+l*(2/3+l*(4/3+l*(-82/45+l*(32/45+l*(4642/4725)))))),c=c*l,this.cgb[1]=c*(7/3+l*(-8/5+l*(-227/45+l*(2704/315+l*(2323/945))))),this.cbg[1]=c*(5/3+l*(-16/15+l*(-13/9+l*(904/315+l*(-1522/945))))),c=c*l,this.cgb[2]=c*(56/15+l*(-136/35+l*(-1262/105+l*(73814/2835)))),this.cbg[2]=c*(-26/15+l*(34/21+l*(8/5+l*(-12686/2835)))),c=c*l,this.cgb[3]=c*(4279/630+l*(-332/35+l*(-399572/14175))),this.cbg[3]=c*(1237/630+l*(-12/5+l*(-24832/14175))),c=c*l,this.cgb[4]=c*(4174/315+l*(-144838/6237)),this.cbg[4]=c*(-734/315+l*(109598/31185)),c=c*l,this.cgb[5]=c*(601676/22275),this.cbg[5]=c*(444337/155925),c=Math.pow(l,2),this.Qn=this.k0/(1+l)*(1+c*(1/4+c*(1/64+c/256))),this.utg[0]=l*(-.5+l*(2/3+l*(-37/96+l*(1/360+l*(81/512+l*(-96199/604800)))))),this.gtu[0]=l*(.5+l*(-2/3+l*(5/16+l*(41/180+l*(-127/288+l*(7891/37800)))))),this.utg[1]=c*(-1/48+l*(-1/15+l*(437/1440+l*(-46/105+l*(1118711/3870720))))),this.gtu[1]=c*(13/48+l*(-3/5+l*(557/1440+l*(281/630+l*(-1983433/1935360))))),c=c*l,this.utg[2]=c*(-17/480+l*(37/840+l*(209/4480+l*(-5569/90720)))),this.gtu[2]=c*(61/240+l*(-103/140+l*(15061/26880+l*(167603/181440)))),c=c*l,this.utg[3]=c*(-4397/161280+l*(11/504+l*(830251/7257600))),this.gtu[3]=c*(49561/161280+l*(-179/168+l*(6601661/7257600))),c=c*l,this.utg[4]=c*(-4583/161280+l*(108847/3991680)),this.gtu[4]=c*(34729/80640+l*(-3418889/1995840)),c=c*l,this.utg[5]=c*(-20648693/638668800),this.gtu[5]=c*(212378941/319334400);var m=od(this.cbg,this.lat0);this.Zb=-this.Qn*(m+p1(this.gtu,2*m))}function _1(n){var l=vt(n.x-this.long0),c=n.y;c=od(this.cbg,c);var m=Math.sin(c),g=Math.cos(c),x=Math.sin(l),w=Math.cos(l);c=Math.atan2(m,w*g),l=Math.atan2(x*g,Pn(m,g*w)),l=f1(Math.tan(l));var a=Cm(this.gtu,2*c,2*l);c=c+a[0],l=l+a[1];var S,P;return Math.abs(l)<=2.623395162778?(S=this.a*(this.Qn*l)+this.x0,P=this.a*(this.Qn*c+this.Zb)+this.y0):(S=1/0,P=1/0),n.x=S,n.y=P,n}function y1(n){var l=(n.x-this.x0)*(1/this.a),c=(n.y-this.y0)*(1/this.a);c=(c-this.Zb)/this.Qn,l=l/this.Qn;var m,g;if(Math.abs(l)<=2.623395162778){var x=Cm(this.utg,2*c,2*l);c=c+x[0],l=l+x[1],l=Math.atan(Am(l));var w=Math.sin(c),a=Math.cos(c),S=Math.sin(l),P=Math.cos(l);c=Math.atan2(w*P,Pn(S,P*a)),l=Math.atan2(S,P*a),m=vt(l+this.long0),g=od(this.cgb,c)}else m=1/0,g=1/0;return n.x=m,n.y=g,n}var v1=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"];const cc={init:g1,forward:_1,inverse:y1,names:v1};function x1(n,l){if(n===void 0){if(n=Math.floor((vt(l)+Math.PI)*30/Math.PI)+1,n<0)return 0;if(n>60)return 60}return n}var b1="etmerc";function w1(){var n=x1(this.zone,this.long0);if(n===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(n)-183)*fr,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,cc.init.apply(this),this.forward=cc.forward,this.inverse=cc.inverse}var M1=["Universal Transverse Mercator System","utm"];const E1={init:w1,names:M1,dependsOn:b1};function ld(n,l){return Math.pow((1-n)/(1+n),l)}var T1=20;function S1(){var n=Math.sin(this.lat0),l=Math.cos(this.lat0);l*=l,this.rc=Math.sqrt(1-this.es)/(1-this.es*n*n),this.C=Math.sqrt(1+this.es*l*l/(1-this.es)),this.phic0=Math.asin(n/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+yi)/(Math.pow(Math.tan(.5*this.lat0+yi),this.C)*ld(this.e*n,this.ratexp))}function I1(n){var l=n.x,c=n.y;return n.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*c+yi),this.C)*ld(this.e*Math.sin(c),this.ratexp))-je,n.x=this.C*l,n}function A1(n){for(var l=1e-14,c=n.x/this.C,m=n.y,g=Math.pow(Math.tan(.5*m+yi)/this.K,1/this.C),x=T1;x>0&&(m=2*Math.atan(g*ld(this.e*Math.sin(n.y),-.5*this.e))-je,!(Math.abs(m-n.y)<l));--x)n.y=m;return x?(n.x=c,n.y=m,n):null}var C1=["gauss"];const hd={init:S1,forward:I1,inverse:A1,names:C1};function k1(){hd.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function P1(n){var l,c,m,g;return n.x=vt(n.x-this.long0),hd.forward.apply(this,[n]),l=Math.sin(n.y),c=Math.cos(n.y),m=Math.cos(n.x),g=this.k0*this.R2/(1+this.sinc0*l+this.cosc0*c*m),n.x=g*c*Math.sin(n.x),n.y=g*(this.cosc0*l-this.sinc0*c*m),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function z1(n){var l,c,m,g,x;if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,x=Math.sqrt(n.x*n.x+n.y*n.y)){var w=2*Math.atan2(x,this.R2);l=Math.sin(w),c=Math.cos(w),g=Math.asin(c*this.sinc0+n.y*l*this.cosc0/x),m=Math.atan2(n.x*l,x*this.cosc0*c-n.y*this.sinc0*l)}else g=this.phic0,m=0;return n.x=m,n.y=g,hd.inverse.apply(this,[n]),n.x=vt(n.x+this.long0),n}var L1=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const D1={init:k1,forward:P1,inverse:z1,names:L1};function R1(n,l,c){return l*=c,Math.tan(.5*(je+n))*Math.pow((1-l)/(1+l),.5*c)}function B1(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=dt&&(this.k0=.5*(1+Ul(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=dt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=dt&&(this.k0=.5*this.cons*Xn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/zn(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Xn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-je,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function O1(n){var l=n.x,c=n.y,m=Math.sin(c),g=Math.cos(c),x,w,a,S,P,q,R=vt(l-this.long0);return Math.abs(Math.abs(l-this.long0)-Math.PI)<=dt&&Math.abs(c+this.lat0)<=dt?(n.x=NaN,n.y=NaN,n):this.sphere?(x=2*this.k0/(1+this.sinlat0*m+this.coslat0*g*Math.cos(R)),n.x=this.a*x*g*Math.sin(R)+this.x0,n.y=this.a*x*(this.coslat0*m-this.sinlat0*g*Math.cos(R))+this.y0,n):(w=2*Math.atan(this.ssfn_(c,m,this.e))-je,S=Math.cos(w),a=Math.sin(w),Math.abs(this.coslat0)<=dt?(P=zn(this.e,c*this.con,this.con*m),q=2*this.a*this.k0*P/this.cons,n.x=this.x0+q*Math.sin(l-this.long0),n.y=this.y0-this.con*q*Math.cos(l-this.long0),n):(Math.abs(this.sinlat0)<dt?(x=2*this.a*this.k0/(1+S*Math.cos(R)),n.y=x*a):(x=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*S*Math.cos(R))),n.y=x*(this.cosX0*a-this.sinX0*S*Math.cos(R))+this.y0),n.x=x*S*Math.sin(R)+this.x0,n))}function F1(n){n.x-=this.x0,n.y-=this.y0;var l,c,m,g,x,w=Math.sqrt(n.x*n.x+n.y*n.y);if(this.sphere){var a=2*Math.atan(w/(2*this.a*this.k0));return l=this.long0,c=this.lat0,w<=dt?(n.x=l,n.y=c,n):(c=Math.asin(Math.cos(a)*this.sinlat0+n.y*Math.sin(a)*this.coslat0/w),Math.abs(this.coslat0)<dt?this.lat0>0?l=vt(this.long0+Math.atan2(n.x,-1*n.y)):l=vt(this.long0+Math.atan2(n.x,n.y)):l=vt(this.long0+Math.atan2(n.x*Math.sin(a),w*this.coslat0*Math.cos(a)-n.y*this.sinlat0*Math.sin(a))),n.x=l,n.y=c,n)}else if(Math.abs(this.coslat0)<=dt){if(w<=dt)return c=this.lat0,l=this.long0,n.x=l,n.y=c,n;n.x*=this.con,n.y*=this.con,m=w*this.cons/(2*this.a*this.k0),c=this.con*Bl(this.e,m),l=this.con*vt(this.con*this.long0+Math.atan2(n.x,-1*n.y))}else g=2*Math.atan(w*this.cosX0/(2*this.a*this.k0*this.ms1)),l=this.long0,w<=dt?x=this.X0:(x=Math.asin(Math.cos(g)*this.sinX0+n.y*Math.sin(g)*this.cosX0/w),l=vt(this.long0+Math.atan2(n.x*Math.sin(g),w*this.cosX0*Math.cos(g)-n.y*this.sinX0*Math.sin(g)))),c=-1*Bl(this.e,Math.tan(.5*(je+x)));return n.x=l,n.y=c,n}var N1=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"];const U1={init:B1,forward:O1,inverse:F1,names:N1,ssfn_:R1};function V1(){var n=this.lat0;this.lambda0=this.long0;var l=Math.sin(n),c=this.a,m=this.rf,g=1/m,x=2*g-Math.pow(g,2),w=this.e=Math.sqrt(x);this.R=this.k0*c*Math.sqrt(1-x)/(1-x*Math.pow(l,2)),this.alpha=Math.sqrt(1+x/(1-x)*Math.pow(Math.cos(n),4)),this.b0=Math.asin(l/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),S=Math.log(Math.tan(Math.PI/4+n/2)),P=Math.log((1+w*l)/(1-w*l));this.K=a-this.alpha*S+this.alpha*w/2*P}function $1(n){var l=Math.log(Math.tan(Math.PI/4-n.y/2)),c=this.e/2*Math.log((1+this.e*Math.sin(n.y))/(1-this.e*Math.sin(n.y))),m=-this.alpha*(l+c)+this.K,g=2*(Math.atan(Math.exp(m))-Math.PI/4),x=this.alpha*(n.x-this.lambda0),w=Math.atan(Math.sin(x)/(Math.sin(this.b0)*Math.tan(g)+Math.cos(this.b0)*Math.cos(x))),a=Math.asin(Math.cos(this.b0)*Math.sin(g)-Math.sin(this.b0)*Math.cos(g)*Math.cos(x));return n.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,n.x=this.R*w+this.x0,n}function q1(n){for(var l=n.x-this.x0,c=n.y-this.y0,m=l/this.R,g=2*(Math.atan(Math.exp(c/this.R))-Math.PI/4),x=Math.asin(Math.cos(this.b0)*Math.sin(g)+Math.sin(this.b0)*Math.cos(g)*Math.cos(m)),w=Math.atan(Math.sin(m)/(Math.cos(this.b0)*Math.cos(m)-Math.sin(this.b0)*Math.tan(g))),a=this.lambda0+w/this.alpha,S=0,P=x,q=-1e3,R=0;Math.abs(P-q)>1e-7;){if(++R>20)return;S=1/this.alpha*(Math.log(Math.tan(Math.PI/4+x/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(P))/2)),q=P,P=2*Math.atan(Math.exp(S))-Math.PI/2}return n.x=a,n.y=P,n}var G1=["somerc"];const j1={init:V1,forward:$1,inverse:q1,names:G1};var ro=1e-7;function Z1(n){var l=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],c=typeof n.PROJECTION=="object"?Object.keys(n.PROJECTION)[0]:n.PROJECTION;return"no_uoff"in n||"no_off"in n||l.indexOf(c)!==-1}function H1(){var n,l,c,m,g,x,w,a,S,P,q=0,R,F=0,Q=0,le=0,de=0,fe=0,De=0;this.no_off=Z1(this),this.no_rot="no_rot"in this;var Ee=!1;"alpha"in this&&(Ee=!0);var xe=!1;if("rectified_grid_angle"in this&&(xe=!0),Ee&&(De=this.alpha),xe&&(q=this.rectified_grid_angle*fr),Ee||xe)F=this.longc;else if(Q=this.long1,de=this.lat1,le=this.long2,fe=this.lat2,Math.abs(de-fe)<=ro||(n=Math.abs(de))<=ro||Math.abs(n-je)<=ro||Math.abs(Math.abs(this.lat0)-je)<=ro||Math.abs(Math.abs(fe)-je)<=ro)throw new Error;var Te=1-this.es;l=Math.sqrt(Te),Math.abs(this.lat0)>dt?(a=Math.sin(this.lat0),c=Math.cos(this.lat0),n=1-this.es*a*a,this.B=c*c,this.B=Math.sqrt(1+this.es*this.B*this.B/Te),this.A=this.B*this.k0*l/n,m=this.B*l/(c*Math.sqrt(n)),g=m*m-1,g<=0?g=0:(g=Math.sqrt(g),this.lat0<0&&(g=-g)),this.E=g+=m,this.E*=Math.pow(zn(this.e,this.lat0,a),this.B)):(this.B=1/l,this.A=this.k0,this.E=m=g=1),Ee||xe?(Ee?(R=Math.asin(Math.sin(De)/m),xe||(q=De)):(R=q,De=Math.asin(m*Math.sin(R))),this.lam0=F-Math.asin(.5*(g-1/g)*Math.tan(R))/this.B):(x=Math.pow(zn(this.e,de,Math.sin(de)),this.B),w=Math.pow(zn(this.e,fe,Math.sin(fe)),this.B),g=this.E/x,S=(w-x)/(w+x),P=this.E*this.E,P=(P-w*x)/(P+w*x),n=Q-le,n<-Math.pi?le-=Dl:n>Math.pi&&(le+=Dl),this.lam0=vt(.5*(Q+le)-Math.atan(P*Math.tan(.5*this.B*(Q-le))/S)/this.B),R=Math.atan(2*Math.sin(this.B*vt(Q-this.lam0))/(g-1/g)),q=De=Math.asin(m*Math.sin(R))),this.singam=Math.sin(R),this.cosgam=Math.cos(R),this.sinrot=Math.sin(q),this.cosrot=Math.cos(q),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(m*m-1)/Math.cos(De))),this.lat0<0&&(this.u_0=-this.u_0)),g=.5*R,this.v_pole_n=this.ArB*Math.log(Math.tan(yi-g)),this.v_pole_s=this.ArB*Math.log(Math.tan(yi+g))}function W1(n){var l={},c,m,g,x,w,a,S,P;if(n.x=n.x-this.lam0,Math.abs(Math.abs(n.y)-je)>dt){if(w=this.E/Math.pow(zn(this.e,n.y,Math.sin(n.y)),this.B),a=1/w,c=.5*(w-a),m=.5*(w+a),x=Math.sin(this.B*n.x),g=(c*this.singam-x*this.cosgam)/m,Math.abs(Math.abs(g)-1)<dt)throw new Error;P=.5*this.ArB*Math.log((1-g)/(1+g)),a=Math.cos(this.B*n.x),Math.abs(a)<ro?S=this.A*n.x:S=this.ArB*Math.atan2(c*this.cosgam+x*this.singam,a)}else P=n.y>0?this.v_pole_n:this.v_pole_s,S=this.ArB*n.y;return this.no_rot?(l.x=S,l.y=P):(S-=this.u_0,l.x=P*this.cosrot+S*this.sinrot,l.y=S*this.cosrot-P*this.sinrot),l.x=this.a*l.x+this.x0,l.y=this.a*l.y+this.y0,l}function X1(n){var l,c,m,g,x,w,a,S={};if(n.x=(n.x-this.x0)*(1/this.a),n.y=(n.y-this.y0)*(1/this.a),this.no_rot?(c=n.y,l=n.x):(c=n.x*this.cosrot-n.y*this.sinrot,l=n.y*this.cosrot+n.x*this.sinrot+this.u_0),m=Math.exp(-this.BrA*c),g=.5*(m-1/m),x=.5*(m+1/m),w=Math.sin(this.BrA*l),a=(w*this.cosgam+g*this.singam)/x,Math.abs(Math.abs(a)-1)<dt)S.x=0,S.y=a<0?-je:je;else{if(S.y=this.E/Math.sqrt((1+a)/(1-a)),S.y=Bl(this.e,Math.pow(S.y,1/this.B)),S.y===1/0)throw new Error;S.x=-this.rB*Math.atan2(g*this.cosgam-w*this.singam,Math.cos(this.BrA*l))}return S.x+=this.lam0,S}var K1=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const J1={init:H1,forward:W1,inverse:X1,names:K1};function Y1(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<dt)){var n=this.b/this.a;this.e=Math.sqrt(1-n*n);var l=Math.sin(this.lat1),c=Math.cos(this.lat1),m=Xn(this.e,l,c),g=zn(this.e,this.lat1,l),x=Math.sin(this.lat2),w=Math.cos(this.lat2),a=Xn(this.e,x,w),S=zn(this.e,this.lat2,x),P=zn(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>dt?this.ns=Math.log(m/a)/Math.log(g/S):this.ns=l,isNaN(this.ns)&&(this.ns=l),this.f0=m/(this.ns*Math.pow(g,this.ns)),this.rh=this.a*this.f0*Math.pow(P,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function Q1(n){var l=n.x,c=n.y;Math.abs(2*Math.abs(c)-Math.PI)<=dt&&(c=Ul(c)*(je-2*dt));var m=Math.abs(Math.abs(c)-je),g,x;if(m>dt)g=zn(this.e,c,Math.sin(c)),x=this.a*this.f0*Math.pow(g,this.ns);else{if(m=c*this.ns,m<=0)return null;x=0}var w=this.ns*vt(l-this.long0);return n.x=this.k0*(x*Math.sin(w))+this.x0,n.y=this.k0*(this.rh-x*Math.cos(w))+this.y0,n}function ex(n){var l,c,m,g,x,w=(n.x-this.x0)/this.k0,a=this.rh-(n.y-this.y0)/this.k0;this.ns>0?(l=Math.sqrt(w*w+a*a),c=1):(l=-Math.sqrt(w*w+a*a),c=-1);var S=0;if(l!==0&&(S=Math.atan2(c*w,c*a)),l!==0||this.ns>0){if(c=1/this.ns,m=Math.pow(l/(this.a*this.f0),c),g=Bl(this.e,m),g===-9999)return null}else g=-je;return x=vt(S/this.ns+this.long0),n.x=x,n.y=g,n}var tx=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const ix={init:Y1,forward:Q1,inverse:ex,names:tx};function rx(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function nx(n){var l,c,m,g,x,w,a,S=n.x,P=n.y,q=vt(S-this.long0);return l=Math.pow((1+this.e*Math.sin(P))/(1-this.e*Math.sin(P)),this.alfa*this.e/2),c=2*(Math.atan(this.k*Math.pow(Math.tan(P/2+this.s45),this.alfa)/l)-this.s45),m=-q*this.alfa,g=Math.asin(Math.cos(this.ad)*Math.sin(c)+Math.sin(this.ad)*Math.cos(c)*Math.cos(m)),x=Math.asin(Math.cos(c)*Math.sin(m)/Math.cos(g)),w=this.n*x,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(g/2+this.s45),this.n),n.y=a*Math.cos(w)/1,n.x=a*Math.sin(w)/1,this.czech||(n.y*=-1,n.x*=-1),n}function sx(n){var l,c,m,g,x,w,a,S,P=n.x;n.x=n.y,n.y=P,this.czech||(n.y*=-1,n.x*=-1),w=Math.sqrt(n.x*n.x+n.y*n.y),x=Math.atan2(n.y,n.x),g=x/Math.sin(this.s0),m=2*(Math.atan(Math.pow(this.ro0/w,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),l=Math.asin(Math.cos(this.ad)*Math.sin(m)-Math.sin(this.ad)*Math.cos(m)*Math.cos(g)),c=Math.asin(Math.cos(m)*Math.sin(g)/Math.cos(l)),n.x=this.long0-c/this.alfa,a=l,S=0;var q=0;do n.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(l/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-n.y)<1e-10&&(S=1),a=n.y,q+=1;while(S===0&&q<15);return q>=15?null:n}var ax=["Krovak","krovak"];const ox={init:rx,forward:nx,inverse:sx,names:ax};function Ur(n,l,c,m,g){return n*g-l*Math.sin(2*g)+c*Math.sin(4*g)-m*Math.sin(6*g)}function Vl(n){return 1-.25*n*(1+n/16*(3+1.25*n))}function $l(n){return .375*n*(1+.25*n*(1+.46875*n))}function ql(n){return .05859375*n*n*(1+.75*n)}function Gl(n){return n*n*n*(35/3072)}function vo(n,l,c){var m=l*c;return n/Math.sqrt(1-m*m)}function xo(n){return Math.abs(n)<je?n:n-Ul(n)*Math.PI}function vc(n,l,c,m,g){var x,w;x=n/l;for(var a=0;a<15;a++)if(w=(n-(l*x-c*Math.sin(2*x)+m*Math.sin(4*x)-g*Math.sin(6*x)))/(l-2*c*Math.cos(2*x)+4*m*Math.cos(4*x)-6*g*Math.cos(6*x)),x+=w,Math.abs(w)<=1e-10)return x;return NaN}function lx(){this.sphere||(this.e0=Vl(this.es),this.e1=$l(this.es),this.e2=ql(this.es),this.e3=Gl(this.es),this.ml0=this.a*Ur(this.e0,this.e1,this.e2,this.e3,this.lat0))}function hx(n){var l,c,m=n.x,g=n.y;if(m=vt(m-this.long0),this.sphere)l=this.a*Math.asin(Math.cos(g)*Math.sin(m)),c=this.a*(Math.atan2(Math.tan(g),Math.cos(m))-this.lat0);else{var x=Math.sin(g),w=Math.cos(g),a=vo(this.a,this.e,x),S=Math.tan(g)*Math.tan(g),P=m*Math.cos(g),q=P*P,R=this.es*w*w/(1-this.es),F=this.a*Ur(this.e0,this.e1,this.e2,this.e3,g);l=a*P*(1-q*S*(1/6-(8-S+8*R)*q/120)),c=F-this.ml0+a*x/w*q*(.5+(5-S+6*R)*q/24)}return n.x=l+this.x0,n.y=c+this.y0,n}function cx(n){n.x-=this.x0,n.y-=this.y0;var l=n.x/this.a,c=n.y/this.a,m,g;if(this.sphere){var x=c+this.lat0;m=Math.asin(Math.sin(x)*Math.cos(l)),g=Math.atan2(Math.tan(l),Math.cos(x))}else{var w=this.ml0/this.a+c,a=vc(w,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-je)<=dt)return n.x=this.long0,n.y=je,c<0&&(n.y*=-1),n;var S=vo(this.a,this.e,Math.sin(a)),P=S*S*S/this.a/this.a*(1-this.es),q=Math.pow(Math.tan(a),2),R=l*this.a/S,F=R*R;m=a-S*Math.tan(a)/P*R*R*(.5-(1+3*q)*R*R/24),g=R*(1-F*(q/3+(1+3*q)*q*F/15))/Math.cos(a)}return n.x=vt(g+this.long0),n.y=xo(m),n}var ux=["Cassini","Cassini_Soldner","cass"];const dx={init:lx,forward:hx,inverse:cx,names:ux};function qs(n,l){var c;return n>1e-7?(c=n*l,(1-n*n)*(l/(1-c*c)-.5/n*Math.log((1-c)/(1+c)))):2*l}var fx=1,px=2,mx=3,gx=4;function _x(){var n=Math.abs(this.lat0);if(Math.abs(n-je)<dt?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(n)<dt?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var l;switch(this.qp=qs(this.e,1),this.mmf=.5/(1-this.es),this.apa=Sx(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),l=Math.sin(this.lat0),this.sinb1=qs(this.e,l)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*l*l)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function yx(n){var l,c,m,g,x,w,a,S,P,q,R=n.x,F=n.y;if(R=vt(R-this.long0),this.sphere){if(x=Math.sin(F),q=Math.cos(F),m=Math.cos(R),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(c=this.mode===this.EQUIT?1+q*m:1+this.sinph0*x+this.cosph0*q*m,c<=dt)return null;c=Math.sqrt(2/c),l=c*q*Math.sin(R),c*=this.mode===this.EQUIT?x:this.cosph0*x-this.sinph0*q*m}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(m=-m),Math.abs(F+this.lat0)<dt)return null;c=yi-F*.5,c=2*(this.mode===this.S_POLE?Math.cos(c):Math.sin(c)),l=c*Math.sin(R),c*=m}}else{switch(a=0,S=0,P=0,m=Math.cos(R),g=Math.sin(R),x=Math.sin(F),w=qs(this.e,x),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(a=w/this.qp,S=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:P=1+this.sinb1*a+this.cosb1*S*m;break;case this.EQUIT:P=1+S*m;break;case this.N_POLE:P=je+F,w=this.qp-w;break;case this.S_POLE:P=F-je,w=this.qp+w;break}if(Math.abs(P)<dt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:P=Math.sqrt(2/P),this.mode===this.OBLIQ?c=this.ymf*P*(this.cosb1*a-this.sinb1*S*m):c=(P=Math.sqrt(2/(1+S*m)))*a*this.ymf,l=this.xmf*P*S*g;break;case this.N_POLE:case this.S_POLE:w>=0?(l=(P=Math.sqrt(w))*g,c=m*(this.mode===this.S_POLE?P:-P)):l=c=0;break}}return n.x=this.a*l+this.x0,n.y=this.a*c+this.y0,n}function vx(n){n.x-=this.x0,n.y-=this.y0;var l=n.x/this.a,c=n.y/this.a,m,g,x,w,a,S,P;if(this.sphere){var q=0,R,F=0;if(R=Math.sqrt(l*l+c*c),g=R*.5,g>1)return null;switch(g=2*Math.asin(g),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(F=Math.sin(g),q=Math.cos(g)),this.mode){case this.EQUIT:g=Math.abs(R)<=dt?0:Math.asin(c*F/R),l*=F,c=q*R;break;case this.OBLIQ:g=Math.abs(R)<=dt?this.lat0:Math.asin(q*this.sinph0+c*F*this.cosph0/R),l*=F*this.cosph0,c=(q-Math.sin(g)*this.sinph0)*R;break;case this.N_POLE:c=-c,g=je-g;break;case this.S_POLE:g-=je;break}m=c===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(l,c)}else{if(P=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(l/=this.dd,c*=this.dd,S=Math.sqrt(l*l+c*c),S<dt)return n.x=this.long0,n.y=this.lat0,n;w=2*Math.asin(.5*S/this.rq),x=Math.cos(w),l*=w=Math.sin(w),this.mode===this.OBLIQ?(P=x*this.sinb1+c*w*this.cosb1/S,a=this.qp*P,c=S*this.cosb1*x-c*this.sinb1*w):(P=c*w/S,a=this.qp*P,c=S*x)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(c=-c),a=l*l+c*c,!a)return n.x=this.long0,n.y=this.lat0,n;P=1-a/this.qp,this.mode===this.S_POLE&&(P=-P)}m=Math.atan2(l,c),g=Ix(Math.asin(P),this.apa)}return n.x=vt(this.long0+m),n.y=g,n}var xx=.3333333333333333,bx=.17222222222222222,wx=.10257936507936508,Mx=.06388888888888888,Ex=.0664021164021164,Tx=.016415012942191543;function Sx(n){var l,c=[];return c[0]=n*xx,l=n*n,c[0]+=l*bx,c[1]=l*Mx,l*=n,c[0]+=l*wx,c[1]+=l*Ex,c[2]=l*Tx,c}function Ix(n,l){var c=n+n;return n+l[0]*Math.sin(c)+l[1]*Math.sin(c+c)+l[2]*Math.sin(c+c+c)}var Ax=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const Cx={init:_x,forward:yx,inverse:vx,names:Ax,S_POLE:fx,N_POLE:px,EQUIT:mx,OBLIQ:gx};function js(n){return Math.abs(n)>1&&(n=n>1?1:-1),Math.asin(n)}function kx(){Math.abs(this.lat1+this.lat2)<dt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Xn(this.e3,this.sin_po,this.cos_po),this.qs1=qs(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Xn(this.e3,this.sin_po,this.cos_po),this.qs2=qs(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=qs(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>dt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function Px(n){var l=n.x,c=n.y;this.sin_phi=Math.sin(c),this.cos_phi=Math.cos(c);var m=qs(this.e3,this.sin_phi),g=this.a*Math.sqrt(this.c-this.ns0*m)/this.ns0,x=this.ns0*vt(l-this.long0),w=g*Math.sin(x)+this.x0,a=this.rh-g*Math.cos(x)+this.y0;return n.x=w,n.y=a,n}function zx(n){var l,c,m,g,x,w;return n.x-=this.x0,n.y=this.rh-n.y+this.y0,this.ns0>=0?(l=Math.sqrt(n.x*n.x+n.y*n.y),m=1):(l=-Math.sqrt(n.x*n.x+n.y*n.y),m=-1),g=0,l!==0&&(g=Math.atan2(m*n.x,m*n.y)),m=l*this.ns0/this.a,this.sphere?w=Math.asin((this.c-m*m)/(2*this.ns0)):(c=(this.c-m*m)/this.ns0,w=this.phi1z(this.e3,c)),x=vt(g/this.ns0+this.long0),n.x=x,n.y=w,n}function Lx(n,l){var c,m,g,x,w,a=js(.5*l);if(n<dt)return a;for(var S=n*n,P=1;P<=25;P++)if(c=Math.sin(a),m=Math.cos(a),g=n*c,x=1-g*g,w=.5*x*x/m*(l/(1-S)-c/x+.5/n*Math.log((1-g)/(1+g))),a=a+w,Math.abs(w)<=1e-7)return a;return null}var Dx=["Albers_Conic_Equal_Area","Albers","aea"];const Rx={init:kx,forward:Px,inverse:zx,names:Dx,phi1z:Lx};function Bx(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function Ox(n){var l,c,m,g,x,w,a,S,P=n.x,q=n.y;return m=vt(P-this.long0),l=Math.sin(q),c=Math.cos(q),g=Math.cos(m),w=this.sin_p14*l+this.cos_p14*c*g,x=1,w>0||Math.abs(w)<=dt?(a=this.x0+this.a*x*c*Math.sin(m)/w,S=this.y0+this.a*x*(this.cos_p14*l-this.sin_p14*c*g)/w):(a=this.x0+this.infinity_dist*c*Math.sin(m),S=this.y0+this.infinity_dist*(this.cos_p14*l-this.sin_p14*c*g)),n.x=a,n.y=S,n}function Fx(n){var l,c,m,g,x,w;return n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,(l=Math.sqrt(n.x*n.x+n.y*n.y))?(g=Math.atan2(l,this.rc),c=Math.sin(g),m=Math.cos(g),w=js(m*this.sin_p14+n.y*c*this.cos_p14/l),x=Math.atan2(n.x*c,l*this.cos_p14*m-n.y*this.sin_p14*c),x=vt(this.long0+x)):(w=this.phic0,x=0),n.x=x,n.y=w,n}var Nx=["gnom"];const Ux={init:Bx,forward:Ox,inverse:Fx,names:Nx};function Vx(n,l){var c=1-(1-n*n)/(2*n)*Math.log((1-n)/(1+n));if(Math.abs(Math.abs(l)-c)<1e-6)return l<0?-1*je:je;for(var m=Math.asin(.5*l),g,x,w,a,S=0;S<30;S++)if(x=Math.sin(m),w=Math.cos(m),a=n*x,g=Math.pow(1-a*a,2)/(2*w)*(l/(1-n*n)-x/(1-a*a)+.5/n*Math.log((1-a)/(1+a))),m+=g,Math.abs(g)<=1e-10)return m;return NaN}function $x(){this.sphere||(this.k0=Xn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function qx(n){var l=n.x,c=n.y,m,g,x=vt(l-this.long0);if(this.sphere)m=this.x0+this.a*x*Math.cos(this.lat_ts),g=this.y0+this.a*Math.sin(c)/Math.cos(this.lat_ts);else{var w=qs(this.e,Math.sin(c));m=this.x0+this.a*this.k0*x,g=this.y0+this.a*w*.5/this.k0}return n.x=m,n.y=g,n}function Gx(n){n.x-=this.x0,n.y-=this.y0;var l,c;return this.sphere?(l=vt(this.long0+n.x/this.a/Math.cos(this.lat_ts)),c=Math.asin(n.y/this.a*Math.cos(this.lat_ts))):(c=Vx(this.e,2*n.y*this.k0/this.a),l=vt(this.long0+n.x/(this.a*this.k0))),n.x=l,n.y=c,n}var jx=["cea"];const Zx={init:$x,forward:qx,inverse:Gx,names:jx};function Hx(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function Wx(n){var l=n.x,c=n.y,m=vt(l-this.long0),g=xo(c-this.lat0);return n.x=this.x0+this.a*m*this.rc,n.y=this.y0+this.a*g,n}function Xx(n){var l=n.x,c=n.y;return n.x=vt(this.long0+(l-this.x0)/(this.a*this.rc)),n.y=xo(this.lat0+(c-this.y0)/this.a),n}var Kx=["Equirectangular","Equidistant_Cylindrical","eqc"];const Jx={init:Hx,forward:Wx,inverse:Xx,names:Kx};var wp=20;function Yx(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Vl(this.es),this.e1=$l(this.es),this.e2=ql(this.es),this.e3=Gl(this.es),this.ml0=this.a*Ur(this.e0,this.e1,this.e2,this.e3,this.lat0)}function Qx(n){var l=n.x,c=n.y,m,g,x,w=vt(l-this.long0);if(x=w*Math.sin(c),this.sphere)Math.abs(c)<=dt?(m=this.a*w,g=-1*this.a*this.lat0):(m=this.a*Math.sin(x)/Math.tan(c),g=this.a*(xo(c-this.lat0)+(1-Math.cos(x))/Math.tan(c)));else if(Math.abs(c)<=dt)m=this.a*w,g=-1*this.ml0;else{var a=vo(this.a,this.e,Math.sin(c))/Math.tan(c);m=a*Math.sin(x),g=this.a*Ur(this.e0,this.e1,this.e2,this.e3,c)-this.ml0+a*(1-Math.cos(x))}return n.x=m+this.x0,n.y=g+this.y0,n}function eb(n){var l,c,m,g,x,w,a,S,P;if(m=n.x-this.x0,g=n.y-this.y0,this.sphere)if(Math.abs(g+this.a*this.lat0)<=dt)l=vt(m/this.a+this.long0),c=0;else{w=this.lat0+g/this.a,a=m*m/this.a/this.a+w*w,S=w;var q;for(x=wp;x;--x)if(q=Math.tan(S),P=-1*(w*(S*q+1)-S-.5*(S*S+a)*q)/((S-w)/q-1),S+=P,Math.abs(P)<=dt){c=S;break}l=vt(this.long0+Math.asin(m*Math.tan(S)/this.a)/Math.sin(c))}else if(Math.abs(g+this.ml0)<=dt)c=0,l=vt(this.long0+m/this.a);else{w=(this.ml0+g)/this.a,a=m*m/this.a/this.a+w*w,S=w;var R,F,Q,le,de;for(x=wp;x;--x)if(de=this.e*Math.sin(S),R=Math.sqrt(1-de*de)*Math.tan(S),F=this.a*Ur(this.e0,this.e1,this.e2,this.e3,S),Q=this.e0-2*this.e1*Math.cos(2*S)+4*this.e2*Math.cos(4*S)-6*this.e3*Math.cos(6*S),le=F/this.a,P=(w*(R*le+1)-le-.5*R*(le*le+a))/(this.es*Math.sin(2*S)*(le*le+a-2*w*le)/(4*R)+(w-le)*(R*Q-2/Math.sin(2*S))-Q),S-=P,Math.abs(P)<=dt){c=S;break}R=Math.sqrt(1-this.es*Math.pow(Math.sin(c),2))*Math.tan(c),l=vt(this.long0+Math.asin(m*R/this.a)/Math.sin(c))}return n.x=l,n.y=c,n}var tb=["Polyconic","poly"];const ib={init:Yx,forward:Qx,inverse:eb,names:tb};function rb(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function nb(n){var l,c=n.x,m=n.y,g=m-this.lat0,x=c-this.long0,w=g/Pl*1e-5,a=x,S=1,P=0;for(l=1;l<=10;l++)S=S*w,P=P+this.A[l]*S;var q=P,R=a,F=1,Q=0,le,de,fe=0,De=0;for(l=1;l<=6;l++)le=F*q-Q*R,de=Q*q+F*R,F=le,Q=de,fe=fe+this.B_re[l]*F-this.B_im[l]*Q,De=De+this.B_im[l]*F+this.B_re[l]*Q;return n.x=De*this.a+this.x0,n.y=fe*this.a+this.y0,n}function sb(n){var l,c=n.x,m=n.y,g=c-this.x0,x=m-this.y0,w=x/this.a,a=g/this.a,S=1,P=0,q,R,F=0,Q=0;for(l=1;l<=6;l++)q=S*w-P*a,R=P*w+S*a,S=q,P=R,F=F+this.C_re[l]*S-this.C_im[l]*P,Q=Q+this.C_im[l]*S+this.C_re[l]*P;for(var le=0;le<this.iterations;le++){var de=F,fe=Q,De,Ee,xe=w,Te=a;for(l=2;l<=6;l++)De=de*F-fe*Q,Ee=fe*F+de*Q,de=De,fe=Ee,xe=xe+(l-1)*(this.B_re[l]*de-this.B_im[l]*fe),Te=Te+(l-1)*(this.B_im[l]*de+this.B_re[l]*fe);de=1,fe=0;var qe=this.B_re[1],nt=this.B_im[1];for(l=2;l<=6;l++)De=de*F-fe*Q,Ee=fe*F+de*Q,de=De,fe=Ee,qe=qe+l*(this.B_re[l]*de-this.B_im[l]*fe),nt=nt+l*(this.B_im[l]*de+this.B_re[l]*fe);var Fe=qe*qe+nt*nt;F=(xe*qe+Te*nt)/Fe,Q=(Te*qe-xe*nt)/Fe}var Pe=F,Se=Q,He=1,Lt=0;for(l=1;l<=9;l++)He=He*Pe,Lt=Lt+this.D[l]*He;var It=this.lat0+Lt*Pl*1e5,Mt=this.long0+Se;return n.x=Mt,n.y=It,n}var ab=["New_Zealand_Map_Grid","nzmg"];const ob={init:rb,forward:nb,inverse:sb,names:ab};function lb(){}function hb(n){var l=n.x,c=n.y,m=vt(l-this.long0),g=this.x0+this.a*m,x=this.y0+this.a*Math.log(Math.tan(Math.PI/4+c/2.5))*1.25;return n.x=g,n.y=x,n}function cb(n){n.x-=this.x0,n.y-=this.y0;var l=vt(this.long0+n.x/this.a),c=2.5*(Math.atan(Math.exp(.8*n.y/this.a))-Math.PI/4);return n.x=l,n.y=c,n}var ub=["Miller_Cylindrical","mill"];const db={init:lb,forward:hb,inverse:cb,names:ub};var fb=20;function pb(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Sm(this.es)}function mb(n){var l,c,m=n.x,g=n.y;if(m=vt(m-this.long0),this.sphere){if(!this.m)g=this.n!==1?Math.asin(this.n*Math.sin(g)):g;else for(var x=this.n*Math.sin(g),w=fb;w;--w){var a=(this.m*g+Math.sin(g)-x)/(this.m+Math.cos(g));if(g-=a,Math.abs(a)<dt)break}l=this.a*this.C_x*m*(this.m+Math.cos(g)),c=this.a*this.C_y*g}else{var S=Math.sin(g),P=Math.cos(g);c=this.a*Sc(g,S,P,this.en),l=this.a*m*P/Math.sqrt(1-this.es*S*S)}return n.x=l,n.y=c,n}function gb(n){var l,c,m,g;return n.x-=this.x0,m=n.x/this.a,n.y-=this.y0,l=n.y/this.a,this.sphere?(l/=this.C_y,m=m/(this.C_x*(this.m+Math.cos(l))),this.m?l=js((this.m*l+Math.sin(l))/this.n):this.n!==1&&(l=js(Math.sin(l)/this.n)),m=vt(m+this.long0),l=xo(l)):(l=Im(n.y/this.a,this.es,this.en),g=Math.abs(l),g<je?(g=Math.sin(l),c=this.long0+n.x*Math.sqrt(1-this.es*g*g)/(this.a*Math.cos(l)),m=vt(c)):g-dt<je&&(m=this.long0)),n.x=m,n.y=l,n}var _b=["Sinusoidal","sinu"];const yb={init:pb,forward:mb,inverse:gb,names:_b};function vb(){}function xb(n){for(var l=n.x,c=n.y,m=vt(l-this.long0),g=c,x=Math.PI*Math.sin(c);;){var w=-(g+Math.sin(g)-x)/(1+Math.cos(g));if(g+=w,Math.abs(w)<dt)break}g/=2,Math.PI/2-Math.abs(c)<dt&&(m=0);var a=.900316316158*this.a*m*Math.cos(g)+this.x0,S=1.4142135623731*this.a*Math.sin(g)+this.y0;return n.x=a,n.y=S,n}function bb(n){var l,c;n.x-=this.x0,n.y-=this.y0,c=n.y/(1.4142135623731*this.a),Math.abs(c)>.999999999999&&(c=.999999999999),l=Math.asin(c);var m=vt(this.long0+n.x/(.900316316158*this.a*Math.cos(l)));m<-Math.PI&&(m=-Math.PI),m>Math.PI&&(m=Math.PI),c=(2*l+Math.sin(2*l))/Math.PI,Math.abs(c)>1&&(c=1);var g=Math.asin(c);return n.x=m,n.y=g,n}var wb=["Mollweide","moll"];const Mb={init:vb,forward:xb,inverse:bb,names:wb};function Eb(){Math.abs(this.lat1+this.lat2)<dt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Vl(this.es),this.e1=$l(this.es),this.e2=ql(this.es),this.e3=Gl(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Xn(this.e,this.sinphi,this.cosphi),this.ml1=Ur(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<dt?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Xn(this.e,this.sinphi,this.cosphi),this.ml2=Ur(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Ur(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function Tb(n){var l=n.x,c=n.y,m;if(this.sphere)m=this.a*(this.g-c);else{var g=Ur(this.e0,this.e1,this.e2,this.e3,c);m=this.a*(this.g-g)}var x=this.ns*vt(l-this.long0),w=this.x0+m*Math.sin(x),a=this.y0+this.rh-m*Math.cos(x);return n.x=w,n.y=a,n}function Sb(n){n.x-=this.x0,n.y=this.rh-n.y+this.y0;var l,c,m,g;this.ns>=0?(c=Math.sqrt(n.x*n.x+n.y*n.y),l=1):(c=-Math.sqrt(n.x*n.x+n.y*n.y),l=-1);var x=0;if(c!==0&&(x=Math.atan2(l*n.x,l*n.y)),this.sphere)return g=vt(this.long0+x/this.ns),m=xo(this.g-c/this.a),n.x=g,n.y=m,n;var w=this.g-c/this.a;return m=vc(w,this.e0,this.e1,this.e2,this.e3),g=vt(this.long0+x/this.ns),n.x=g,n.y=m,n}var Ib=["Equidistant_Conic","eqdc"];const Ab={init:Eb,forward:Tb,inverse:Sb,names:Ib};function Cb(){this.R=this.a}function kb(n){var l=n.x,c=n.y,m=vt(l-this.long0),g,x;Math.abs(c)<=dt&&(g=this.x0+this.R*m,x=this.y0);var w=js(2*Math.abs(c/Math.PI));(Math.abs(m)<=dt||Math.abs(Math.abs(c)-je)<=dt)&&(g=this.x0,c>=0?x=this.y0+Math.PI*this.R*Math.tan(.5*w):x=this.y0+Math.PI*this.R*-Math.tan(.5*w));var a=.5*Math.abs(Math.PI/m-m/Math.PI),S=a*a,P=Math.sin(w),q=Math.cos(w),R=q/(P+q-1),F=R*R,Q=R*(2/P-1),le=Q*Q,de=Math.PI*this.R*(a*(R-le)+Math.sqrt(S*(R-le)*(R-le)-(le+S)*(F-le)))/(le+S);m<0&&(de=-de),g=this.x0+de;var fe=S+R;return de=Math.PI*this.R*(Q*fe-a*Math.sqrt((le+S)*(S+1)-fe*fe))/(le+S),c>=0?x=this.y0+de:x=this.y0-de,n.x=g,n.y=x,n}function Pb(n){var l,c,m,g,x,w,a,S,P,q,R,F,Q;return n.x-=this.x0,n.y-=this.y0,R=Math.PI*this.R,m=n.x/R,g=n.y/R,x=m*m+g*g,w=-Math.abs(g)*(1+x),a=w-2*g*g+m*m,S=-2*w+1+2*g*g+x*x,Q=g*g/S+(2*a*a*a/S/S/S-9*w*a/S/S)/27,P=(w-a*a/3/S)/S,q=2*Math.sqrt(-P/3),R=3*Q/P/q,Math.abs(R)>1&&(R>=0?R=1:R=-1),F=Math.acos(R)/3,n.y>=0?c=(-q*Math.cos(F+Math.PI/3)-a/3/S)*Math.PI:c=-(-q*Math.cos(F+Math.PI/3)-a/3/S)*Math.PI,Math.abs(m)<dt?l=this.long0:l=vt(this.long0+Math.PI*(x-1+Math.sqrt(1+2*(m*m-g*g)+x*x))/2/m),n.x=l,n.y=c,n}var zb=["Van_der_Grinten_I","VanDerGrinten","vandg"];const Lb={init:Cb,forward:kb,inverse:Pb,names:zb};function Db(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function Rb(n){var l=n.x,c=n.y,m=Math.sin(n.y),g=Math.cos(n.y),x=vt(l-this.long0),w,a,S,P,q,R,F,Q,le,de,fe,De,Ee,xe,Te,qe,nt,Fe,Pe,Se,He,Lt,It;return this.sphere?Math.abs(this.sin_p12-1)<=dt?(n.x=this.x0+this.a*(je-c)*Math.sin(x),n.y=this.y0-this.a*(je-c)*Math.cos(x),n):Math.abs(this.sin_p12+1)<=dt?(n.x=this.x0+this.a*(je+c)*Math.sin(x),n.y=this.y0+this.a*(je+c)*Math.cos(x),n):(Fe=this.sin_p12*m+this.cos_p12*g*Math.cos(x),qe=Math.acos(Fe),nt=qe?qe/Math.sin(qe):1,n.x=this.x0+this.a*nt*g*Math.sin(x),n.y=this.y0+this.a*nt*(this.cos_p12*m-this.sin_p12*g*Math.cos(x)),n):(w=Vl(this.es),a=$l(this.es),S=ql(this.es),P=Gl(this.es),Math.abs(this.sin_p12-1)<=dt?(q=this.a*Ur(w,a,S,P,je),R=this.a*Ur(w,a,S,P,c),n.x=this.x0+(q-R)*Math.sin(x),n.y=this.y0-(q-R)*Math.cos(x),n):Math.abs(this.sin_p12+1)<=dt?(q=this.a*Ur(w,a,S,P,je),R=this.a*Ur(w,a,S,P,c),n.x=this.x0+(q+R)*Math.sin(x),n.y=this.y0+(q+R)*Math.cos(x),n):(F=m/g,Q=vo(this.a,this.e,this.sin_p12),le=vo(this.a,this.e,m),de=Math.atan((1-this.es)*F+this.es*Q*this.sin_p12/(le*g)),fe=Math.atan2(Math.sin(x),this.cos_p12*Math.tan(de)-this.sin_p12*Math.cos(x)),fe===0?Pe=Math.asin(this.cos_p12*Math.sin(de)-this.sin_p12*Math.cos(de)):Math.abs(Math.abs(fe)-Math.PI)<=dt?Pe=-Math.asin(this.cos_p12*Math.sin(de)-this.sin_p12*Math.cos(de)):Pe=Math.asin(Math.sin(x)*Math.cos(de)/Math.sin(fe)),De=this.e*this.sin_p12/Math.sqrt(1-this.es),Ee=this.e*this.cos_p12*Math.cos(fe)/Math.sqrt(1-this.es),xe=De*Ee,Te=Ee*Ee,Se=Pe*Pe,He=Se*Pe,Lt=He*Pe,It=Lt*Pe,qe=Q*Pe*(1-Se*Te*(1-Te)/6+He/8*xe*(1-2*Te)+Lt/120*(Te*(4-7*Te)-3*De*De*(1-7*Te))-It/48*xe),n.x=this.x0+qe*Math.sin(fe),n.y=this.y0+qe*Math.cos(fe),n))}function Bb(n){n.x-=this.x0,n.y-=this.y0;var l,c,m,g,x,w,a,S,P,q,R,F,Q,le,de,fe,De,Ee,xe,Te,qe,nt,Fe,Pe;return this.sphere?(l=Math.sqrt(n.x*n.x+n.y*n.y),l>2*je*this.a?void 0:(c=l/this.a,m=Math.sin(c),g=Math.cos(c),x=this.long0,Math.abs(l)<=dt?w=this.lat0:(w=js(g*this.sin_p12+n.y*m*this.cos_p12/l),a=Math.abs(this.lat0)-je,Math.abs(a)<=dt?this.lat0>=0?x=vt(this.long0+Math.atan2(n.x,-n.y)):x=vt(this.long0-Math.atan2(-n.x,n.y)):x=vt(this.long0+Math.atan2(n.x*m,l*this.cos_p12*g-n.y*this.sin_p12*m))),n.x=x,n.y=w,n)):(S=Vl(this.es),P=$l(this.es),q=ql(this.es),R=Gl(this.es),Math.abs(this.sin_p12-1)<=dt?(F=this.a*Ur(S,P,q,R,je),l=Math.sqrt(n.x*n.x+n.y*n.y),Q=F-l,w=vc(Q/this.a,S,P,q,R),x=vt(this.long0+Math.atan2(n.x,-1*n.y)),n.x=x,n.y=w,n):Math.abs(this.sin_p12+1)<=dt?(F=this.a*Ur(S,P,q,R,je),l=Math.sqrt(n.x*n.x+n.y*n.y),Q=l-F,w=vc(Q/this.a,S,P,q,R),x=vt(this.long0+Math.atan2(n.x,n.y)),n.x=x,n.y=w,n):(l=Math.sqrt(n.x*n.x+n.y*n.y),fe=Math.atan2(n.x,n.y),le=vo(this.a,this.e,this.sin_p12),De=Math.cos(fe),Ee=this.e*this.cos_p12*De,xe=-Ee*Ee/(1-this.es),Te=3*this.es*(1-xe)*this.sin_p12*this.cos_p12*De/(1-this.es),qe=l/le,nt=qe-xe*(1+xe)*Math.pow(qe,3)/6-Te*(1+3*xe)*Math.pow(qe,4)/24,Fe=1-xe*nt*nt/2-qe*nt*nt*nt/6,de=Math.asin(this.sin_p12*Math.cos(nt)+this.cos_p12*Math.sin(nt)*De),x=vt(this.long0+Math.asin(Math.sin(fe)*Math.sin(nt)/Math.cos(de))),Pe=Math.sin(de),w=Math.atan2((Pe-this.es*Fe*this.sin_p12)*Math.tan(de),Pe*(1-this.es)),n.x=x,n.y=w,n))}var Ob=["Azimuthal_Equidistant","aeqd"];const Fb={init:Db,forward:Rb,inverse:Bb,names:Ob};function Nb(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function Ub(n){var l,c,m,g,x,w,a,S,P=n.x,q=n.y;return m=vt(P-this.long0),l=Math.sin(q),c=Math.cos(q),g=Math.cos(m),w=this.sin_p14*l+this.cos_p14*c*g,x=1,(w>0||Math.abs(w)<=dt)&&(a=this.a*x*c*Math.sin(m),S=this.y0+this.a*x*(this.cos_p14*l-this.sin_p14*c*g)),n.x=a,n.y=S,n}function Vb(n){var l,c,m,g,x,w,a;return n.x-=this.x0,n.y-=this.y0,l=Math.sqrt(n.x*n.x+n.y*n.y),c=js(l/this.a),m=Math.sin(c),g=Math.cos(c),w=this.long0,Math.abs(l)<=dt?(a=this.lat0,n.x=w,n.y=a,n):(a=js(g*this.sin_p14+n.y*m*this.cos_p14/l),x=Math.abs(this.lat0)-je,Math.abs(x)<=dt?(this.lat0>=0?w=vt(this.long0+Math.atan2(n.x,-n.y)):w=vt(this.long0-Math.atan2(-n.x,n.y)),n.x=w,n.y=a,n):(w=vt(this.long0+Math.atan2(n.x*m,l*this.cos_p14*g-n.y*this.sin_p14*m)),n.x=w,n.y=a,n))}var $b=["ortho"];const qb={init:Nb,forward:Ub,inverse:Vb,names:$b};var Bi={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},vi={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Gb(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=je-yi/2?this.face=Bi.TOP:this.lat0<=-(je-yi/2)?this.face=Bi.BOTTOM:Math.abs(this.long0)<=yi?this.face=Bi.FRONT:Math.abs(this.long0)<=je+yi?this.face=this.long0>0?Bi.RIGHT:Bi.LEFT:this.face=Bi.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function jb(n){var l={x:0,y:0},c,m,g,x,w,a,S={value:0};if(n.x-=this.long0,this.es!==0?c=Math.atan(this.one_minus_f_squared*Math.tan(n.y)):c=n.y,m=n.x,this.face===Bi.TOP)x=je-c,m>=yi&&m<=je+yi?(S.value=vi.AREA_0,g=m-je):m>je+yi||m<=-(je+yi)?(S.value=vi.AREA_1,g=m>0?m-ji:m+ji):m>-(je+yi)&&m<=-yi?(S.value=vi.AREA_2,g=m+je):(S.value=vi.AREA_3,g=m);else if(this.face===Bi.BOTTOM)x=je+c,m>=yi&&m<=je+yi?(S.value=vi.AREA_0,g=-m+je):m<yi&&m>=-yi?(S.value=vi.AREA_1,g=-m):m<-yi&&m>=-(je+yi)?(S.value=vi.AREA_2,g=-m-je):(S.value=vi.AREA_3,g=m>0?-m+ji:-m-ji);else{var P,q,R,F,Q,le,de;this.face===Bi.RIGHT?m=po(m,+je):this.face===Bi.BACK?m=po(m,+ji):this.face===Bi.LEFT&&(m=po(m,-je)),F=Math.sin(c),Q=Math.cos(c),le=Math.sin(m),de=Math.cos(m),P=Q*de,q=Q*le,R=F,this.face===Bi.FRONT?(x=Math.acos(P),g=sc(x,R,q,S)):this.face===Bi.RIGHT?(x=Math.acos(q),g=sc(x,R,-P,S)):this.face===Bi.BACK?(x=Math.acos(-P),g=sc(x,R,-q,S)):this.face===Bi.LEFT?(x=Math.acos(-q),g=sc(x,R,P,S)):(x=g=0,S.value=vi.AREA_0)}return a=Math.atan(12/ji*(g+Math.acos(Math.sin(g)*Math.cos(yi))-je)),w=Math.sqrt((1-Math.cos(x))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(g))))),S.value===vi.AREA_1?a+=je:S.value===vi.AREA_2?a+=ji:S.value===vi.AREA_3&&(a+=1.5*ji),l.x=w*Math.cos(a),l.y=w*Math.sin(a),l.x=l.x*this.a+this.x0,l.y=l.y*this.a+this.y0,n.x=l.x,n.y=l.y,n}function Zb(n){var l={lam:0,phi:0},c,m,g,x,w,a,S,P,q,R={value:0};if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,m=Math.atan(Math.sqrt(n.x*n.x+n.y*n.y)),c=Math.atan2(n.y,n.x),n.x>=0&&n.x>=Math.abs(n.y)?R.value=vi.AREA_0:n.y>=0&&n.y>=Math.abs(n.x)?(R.value=vi.AREA_1,c-=je):n.x<0&&-n.x>=Math.abs(n.y)?(R.value=vi.AREA_2,c=c<0?c+ji:c-ji):(R.value=vi.AREA_3,c+=je),q=ji/12*Math.tan(c),w=Math.sin(q)/(Math.cos(q)-1/Math.sqrt(2)),a=Math.atan(w),g=Math.cos(c),x=Math.tan(m),S=1-g*g*x*x*(1-Math.cos(Math.atan(1/Math.cos(a)))),S<-1?S=-1:S>1&&(S=1),this.face===Bi.TOP)P=Math.acos(S),l.phi=je-P,R.value===vi.AREA_0?l.lam=a+je:R.value===vi.AREA_1?l.lam=a<0?a+ji:a-ji:R.value===vi.AREA_2?l.lam=a-je:l.lam=a;else if(this.face===Bi.BOTTOM)P=Math.acos(S),l.phi=P-je,R.value===vi.AREA_0?l.lam=-a+je:R.value===vi.AREA_1?l.lam=-a:R.value===vi.AREA_2?l.lam=-a-je:l.lam=a<0?-a-ji:-a+ji;else{var F,Q,le;F=S,q=F*F,q>=1?le=0:le=Math.sqrt(1-q)*Math.sin(a),q+=le*le,q>=1?Q=0:Q=Math.sqrt(1-q),R.value===vi.AREA_1?(q=Q,Q=-le,le=q):R.value===vi.AREA_2?(Q=-Q,le=-le):R.value===vi.AREA_3&&(q=Q,Q=le,le=-q),this.face===Bi.RIGHT?(q=F,F=-Q,Q=q):this.face===Bi.BACK?(F=-F,Q=-Q):this.face===Bi.LEFT&&(q=F,F=Q,Q=-q),l.phi=Math.acos(-le)-je,l.lam=Math.atan2(Q,F),this.face===Bi.RIGHT?l.lam=po(l.lam,-je):this.face===Bi.BACK?l.lam=po(l.lam,-ji):this.face===Bi.LEFT&&(l.lam=po(l.lam,+je))}if(this.es!==0){var de,fe,De;de=l.phi<0?1:0,fe=Math.tan(l.phi),De=this.b/Math.sqrt(fe*fe+this.one_minus_f_squared),l.phi=Math.atan(Math.sqrt(this.a*this.a-De*De)/(this.one_minus_f*De)),de&&(l.phi=-l.phi)}return l.lam+=this.long0,n.x=l.lam,n.y=l.phi,n}function sc(n,l,c,m){var g;return n<dt?(m.value=vi.AREA_0,g=0):(g=Math.atan2(l,c),Math.abs(g)<=yi?m.value=vi.AREA_0:g>yi&&g<=je+yi?(m.value=vi.AREA_1,g-=je):g>je+yi||g<=-(je+yi)?(m.value=vi.AREA_2,g=g>=0?g-ji:g+ji):(m.value=vi.AREA_3,g+=je)),g}function po(n,l){var c=n+l;return c<-ji?c+=Dl:c>+ji&&(c-=Dl),c}var Hb=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const Wb={init:Gb,forward:jb,inverse:Zb,names:Hb};var Xu=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Sl=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],km=.8487,Pm=1.3523,zm=Hn/5,Xb=1/zm,ho=18,xc=function(n,l){return n[0]+l*(n[1]+l*(n[2]+l*n[3]))},Kb=function(n,l){return n[1]+l*(2*n[2]+l*3*n[3])};function Jb(n,l,c,m){for(var g=l;m;--m){var x=n(g);if(g-=x,Math.abs(x)<c)break}return g}function Yb(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function Qb(n){var l=vt(n.x-this.long0),c=Math.abs(n.y),m=Math.floor(c*zm);m<0?m=0:m>=ho&&(m=ho-1),c=Hn*(c-Xb*m);var g={x:xc(Xu[m],c)*l,y:xc(Sl[m],c)};return n.y<0&&(g.y=-g.y),g.x=g.x*this.a*km+this.x0,g.y=g.y*this.a*Pm+this.y0,g}function ew(n){var l={x:(n.x-this.x0)/(this.a*km),y:Math.abs(n.y-this.y0)/(this.a*Pm)};if(l.y>=1)l.x/=Xu[ho][0],l.y=n.y<0?-je:je;else{var c=Math.floor(l.y*ho);for(c<0?c=0:c>=ho&&(c=ho-1);;)if(Sl[c][0]>l.y)--c;else if(Sl[c+1][0]<=l.y)++c;else break;var m=Sl[c],g=5*(l.y-m[0])/(Sl[c+1][0]-m[0]);g=Jb(function(x){return(xc(m,x)-l.y)/Kb(m,x)},g,dt,100),l.x/=xc(Xu[c],g),l.y=(5*c+g)*fr,n.y<0&&(l.y=-l.y)}return l.x=vt(l.x+this.long0),l}var tw=["Robinson","robin"];const iw={init:Yb,forward:Qb,inverse:ew,names:tw};function rw(){this.name="geocent"}function nw(n){var l=_m(n,this.es,this.a);return l}function sw(n){var l=ym(n,this.es,this.a,this.b);return l}var aw=["Geocentric","geocentric","geocent","Geocent"];const ow={init:rw,forward:nw,inverse:sw,names:aw};var Tr={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},wl={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function lw(){if(Object.keys(wl).forEach(function(c){if(typeof this[c]>"u")this[c]=wl[c].def;else{if(wl[c].num&&isNaN(this[c]))throw new Error("Invalid parameter value, must be numeric "+c+" = "+this[c]);wl[c].num&&(this[c]=parseFloat(this[c]))}wl[c].degrees&&(this[c]=this[c]*fr)}.bind(this)),Math.abs(Math.abs(this.lat0)-je)<dt?this.mode=this.lat0<0?Tr.S_POLE:Tr.N_POLE:Math.abs(this.lat0)<dt?this.mode=Tr.EQUIT:(this.mode=Tr.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var n=this.tilt,l=this.azi;this.cg=Math.cos(l),this.sg=Math.sin(l),this.cw=Math.cos(n),this.sw=Math.sin(n)}function hw(n){n.x-=this.long0;var l=Math.sin(n.y),c=Math.cos(n.y),m=Math.cos(n.x),g,x;switch(this.mode){case Tr.OBLIQ:x=this.sinph0*l+this.cosph0*c*m;break;case Tr.EQUIT:x=c*m;break;case Tr.S_POLE:x=-l;break;case Tr.N_POLE:x=l;break}switch(x=this.pn1/(this.p-x),g=x*c*Math.sin(n.x),this.mode){case Tr.OBLIQ:x*=this.cosph0*l-this.sinph0*c*m;break;case Tr.EQUIT:x*=l;break;case Tr.N_POLE:x*=-(c*m);break;case Tr.S_POLE:x*=c*m;break}var w,a;return w=x*this.cg+g*this.sg,a=1/(w*this.sw*this.h1+this.cw),g=(g*this.cg-x*this.sg)*this.cw*a,x=w*a,n.x=g*this.a,n.y=x*this.a,n}function cw(n){n.x/=this.a,n.y/=this.a;var l={x:n.x,y:n.y},c,m,g;g=1/(this.pn1-n.y*this.sw),c=this.pn1*n.x*g,m=this.pn1*n.y*this.cw*g,n.x=c*this.cg+m*this.sg,n.y=m*this.cg-c*this.sg;var x=Pn(n.x,n.y);if(Math.abs(x)<dt)l.x=0,l.y=n.y;else{var w,a;switch(a=1-x*x*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/x+x/this.pn1),w=Math.sqrt(1-a*a),this.mode){case Tr.OBLIQ:l.y=Math.asin(w*this.sinph0+n.y*a*this.cosph0/x),n.y=(w-this.sinph0*Math.sin(l.y))*x,n.x*=a*this.cosph0;break;case Tr.EQUIT:l.y=Math.asin(n.y*a/x),n.y=w*x,n.x*=a;break;case Tr.N_POLE:l.y=Math.asin(w),n.y=-n.y;break;case Tr.S_POLE:l.y=-Math.asin(w);break}l.x=Math.atan2(n.x,n.y)}return n.x=l.x+this.long0,n.y=l.y,n}var uw=["Tilted_Perspective","tpers"];const dw={init:lw,forward:hw,inverse:cw,names:uw};function fw(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var n=1-this.es,l=1/n;this.radius_p=Math.sqrt(n),this.radius_p2=n,this.radius_p_inv2=l,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function pw(n){var l=n.x,c=n.y,m,g,x,w;if(l=l-this.long0,this.shape==="ellipse"){c=Math.atan(this.radius_p2*Math.tan(c));var a=this.radius_p/Pn(this.radius_p*Math.cos(c),Math.sin(c));if(g=a*Math.cos(l)*Math.cos(c),x=a*Math.sin(l)*Math.cos(c),w=a*Math.sin(c),(this.radius_g-g)*g-x*x-w*w*this.radius_p_inv2<0)return n.x=Number.NaN,n.y=Number.NaN,n;m=this.radius_g-g,this.flip_axis?(n.x=this.radius_g_1*Math.atan(x/Pn(w,m)),n.y=this.radius_g_1*Math.atan(w/m)):(n.x=this.radius_g_1*Math.atan(x/m),n.y=this.radius_g_1*Math.atan(w/Pn(x,m)))}else this.shape==="sphere"&&(m=Math.cos(c),g=Math.cos(l)*m,x=Math.sin(l)*m,w=Math.sin(c),m=this.radius_g-g,this.flip_axis?(n.x=this.radius_g_1*Math.atan(x/Pn(w,m)),n.y=this.radius_g_1*Math.atan(w/m)):(n.x=this.radius_g_1*Math.atan(x/m),n.y=this.radius_g_1*Math.atan(w/Pn(x,m))));return n.x=n.x*this.a,n.y=n.y*this.a,n}function mw(n){var l=-1,c=0,m=0,g,x,w,a;if(n.x=n.x/this.a,n.y=n.y/this.a,this.shape==="ellipse"){this.flip_axis?(m=Math.tan(n.y/this.radius_g_1),c=Math.tan(n.x/this.radius_g_1)*Pn(1,m)):(c=Math.tan(n.x/this.radius_g_1),m=Math.tan(n.y/this.radius_g_1)*Pn(1,c));var S=m/this.radius_p;if(g=c*c+S*S+l*l,x=2*this.radius_g*l,w=x*x-4*g*this.C,w<0)return n.x=Number.NaN,n.y=Number.NaN,n;a=(-x-Math.sqrt(w))/(2*g),l=this.radius_g+a*l,c*=a,m*=a,n.x=Math.atan2(c,l),n.y=Math.atan(m*Math.cos(n.x)/l),n.y=Math.atan(this.radius_p_inv2*Math.tan(n.y))}else if(this.shape==="sphere"){if(this.flip_axis?(m=Math.tan(n.y/this.radius_g_1),c=Math.tan(n.x/this.radius_g_1)*Math.sqrt(1+m*m)):(c=Math.tan(n.x/this.radius_g_1),m=Math.tan(n.y/this.radius_g_1)*Math.sqrt(1+c*c)),g=c*c+m*m+l*l,x=2*this.radius_g*l,w=x*x-4*g*this.C,w<0)return n.x=Number.NaN,n.y=Number.NaN,n;a=(-x-Math.sqrt(w))/(2*g),l=this.radius_g+a*l,c*=a,m*=a,n.x=Math.atan2(c,l),n.y=Math.atan(m*Math.cos(n.x)/l)}return n.x=n.x+this.long0,n}var gw=["Geostationary Satellite View","Geostationary_Satellite","geos"];const _w={init:fw,forward:pw,inverse:mw,names:gw};function yw(n){n.Proj.projections.add(hc),n.Proj.projections.add(cc),n.Proj.projections.add(E1),n.Proj.projections.add(D1),n.Proj.projections.add(U1),n.Proj.projections.add(j1),n.Proj.projections.add(J1),n.Proj.projections.add(ix),n.Proj.projections.add(ox),n.Proj.projections.add(dx),n.Proj.projections.add(Cx),n.Proj.projections.add(Rx),n.Proj.projections.add(Ux),n.Proj.projections.add(Zx),n.Proj.projections.add(Jx),n.Proj.projections.add(ib),n.Proj.projections.add(ob),n.Proj.projections.add(db),n.Proj.projections.add(yb),n.Proj.projections.add(Mb),n.Proj.projections.add(Ab),n.Proj.projections.add(Lb),n.Proj.projections.add(Fb),n.Proj.projections.add(qb),n.Proj.projections.add(Wb),n.Proj.projections.add(iw),n.Proj.projections.add(ow),n.Proj.projections.add(dw),n.Proj.projections.add(_w)}sn.defaultDatum="WGS84";sn.Proj=Wn;sn.WGS84=new sn.Proj("WGS84");sn.Point=yo;sn.toPoint=vm;sn.defs=Fr;sn.nadgrid=Sv;sn.transform=yc;sn.mgrs=$v;sn.version="__VERSION__";yw(sn);function Mp(n,l,c){const m=n.slice();return m[13]=l[c],m[15]=c,m}function vw(n){let l,c,m=n[2].toFixed(2)+"",g,x,w;return{c(){l=gt("p"),c=Di("Zoom: "),g=Di(m),x=jt(),w=gt("p"),w.textContent="To explore scores, zoom must be above 12",We(l,"class","govuk-body"),We(w,"class","govuk-body")},m(a,S){ut(a,l,S),xt(l,c),xt(l,g),ut(a,x,S),ut(a,w,S)},p(a,S){S&4&&m!==(m=a[2].toFixed(2)+"")&&Vs(g,m)},d(a){a&&ht(l),a&&ht(x),a&&ht(w)}}}function xw(n){let l;function c(x,w){return x[1]in x[0]?ww:bw}let m=c(n),g=m(n);return{c(){g.c(),l=wc()},m(x,w){g.m(x,w),ut(x,l,w)},p(x,w){m===(m=c(x))&&g?g.p(x,w):(g.d(1),g=m(x),g&&(g.c(),g.m(l.parentNode,l)))},d(x){g.d(x),x&&ht(l)}}}function bw(n){let l;return{c(){l=gt("p"),l.textContent="Hover over area to see scores",We(l,"class","govuk-body")},m(c,m){ut(c,l,m)},p:ni,d(c){c&&ht(l)}}}function ww(n){let l,c,m,g,x,w,a,S,P=Array(n[3].length),q=[];for(let R=0;R<P.length;R+=1)q[R]=Ep(Mp(n,P,R));return{c(){l=gt("br"),c=jt(),m=gt("table"),g=gt("caption"),g.textContent="Score",x=jt(),w=gt("thead"),w.innerHTML=`<tr class="govuk-table__row"><th scope="col" class="govuk-table__header">Mode</th> 
            <th scope="col" class="govuk-table__header">Purpose</th> 
            <th scope="col" class="govuk-table__header">Score</th></tr>`,a=jt(),S=gt("tbody");for(let R=0;R<q.length;R+=1)q[R].c();We(g,"class","govuk-table__caption govuk-table__caption--s"),We(w,"class","govuk-table__head"),We(S,"class","govuk-table__body"),We(m,"class","govuk-table")},m(R,F){ut(R,l,F),ut(R,c,F),ut(R,m,F),xt(m,g),xt(m,x),xt(m,w),xt(m,a),xt(m,S);for(let Q=0;Q<q.length;Q+=1)q[Q].m(S,null)},p(R,F){if(F&11){P=Array(R[3].length);let Q;for(Q=0;Q<P.length;Q+=1){const le=Mp(R,P,Q);q[Q]?q[Q].p(le,F):(q[Q]=Ep(le),q[Q].c(),q[Q].m(S,null))}for(;Q<q.length;Q+=1)q[Q].d(1);q.length=P.length}},d(R){R&&ht(l),R&&ht(c),R&&ht(m),zl(q,R)}}}function Ep(n){let l,c,m,g,x=n[3][n[15]]+"",w,a,S,P=n[0][n[1]][n[15]]+"",q,R;return{c(){l=gt("tr"),c=gt("td"),c.textContent="PT",m=jt(),g=gt("td"),w=Di(x),a=jt(),S=gt("td"),q=Di(P),R=jt(),We(c,"class","govuk-table__cell"),We(g,"class","govuk-table__cell"),We(S,"class","govuk-table__cell"),We(l,"class","govuk-table__row")},m(F,Q){ut(F,l,Q),xt(l,c),xt(l,m),xt(l,g),xt(g,w),xt(l,a),xt(l,S),xt(S,q),xt(l,R)},p(F,Q){Q&3&&P!==(P=F[0][F[1]][F[15]]+"")&&Vs(q,P)},d(F){F&&ht(l)}}}function Mw(n){let l;function c(x,w){return x[2]>=12?xw:vw}let m=c(n),g=m(n);return{c(){l=gt("div"),g.c(),We(l,"class","whitebox svelte-zbzhxd")},m(x,w){ut(x,l,w),g.m(l,null)},p(x,[w]){m===(m=c(x))&&g?g.p(x,w):(g.d(1),g=m(x),g&&(g.c(),g.m(l,null)))},i:ni,o:ni,d(x){x&&ht(l),g.d()}}}var Ew="+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894 +units=m +no_defs",Tw="+proj=longlat +ellps=WGS84 +towgs84=0,0,0 +no_defs";function Sw(n,l,c){const{getMap:m}=mo("map"),g=m();let x={},w=["Business","Education","Entertainment","Shopping","Residential","Overall"],a=null,S=null,P=null,q=null,R=null,F=!0,Q=0,le=g.getZoom();return F&&g.on("mousemove",async function(de){F=!1;let fe=Date.now(),De=fe-Q;a=de.lngLat.lng,S=de.lngLat.lat;let Ee=sn(Tw,Ew,[a,S]);if(P=Math.floor(Ee[0]/100)*100+50,q=Math.floor(Ee[1]/100)*100+50,c(1,R=P.toString()+"_"+q.toString()),!(R in x)){if(De>=2e3&&le>=12){Q=fe;let xe=await d0(R);console.log(xe),xe=="not_in_square"||c(0,x={...x,...xe})}}F=!0}),g.on("zoom",()=>{c(2,le=g.getZoom())}),[x,R,le,w]}class Iw extends Ir{constructor(l){super(),Sr(this,l,Sw,Mw,gr,{})}}function Tp(n){let l,c,m,g;function x(S){n[8](S)}function w(S){n[9](S)}let a={};return n[2]!==void 0&&(a.login_username=n[2]),n[3]!==void 0&&(a.login_password=n[3]),l=new ly({props:a}),pn.push(()=>Cl(l,"login_username",x,n[2])),pn.push(()=>Cl(l,"login_password",w,n[3])),{c(){Er(l.$$.fragment)},m(S,P){pr(l,S,P),g=!0},p(S,P){const q={};!c&&P&4&&(c=!0,q.login_username=S[2],Al(()=>c=!1)),!m&&P&8&&(m=!0,q.login_password=S[3],Al(()=>m=!1)),l.$set(q)},i(S){g||(ti(l.$$.fragment,S),g=!0)},o(S){gi(l.$$.fragment,S),g=!1},d(S){mr(l,S)}}}function Sp(n){let l,c,m,g,x,w,a,S,P;return c=new Qy({}),x=new t0({}),S=new Jy({props:{innerHeight:n[1],$$slots:{default:[Aw]},$$scope:{ctx:n}}}),{c(){l=gt("div"),Er(c.$$.fragment),m=jt(),g=gt("div"),Er(x.$$.fragment),w=jt(),a=gt("div"),Er(S.$$.fragment)},m(q,R){ut(q,l,R),pr(c,l,null),ut(q,m,R),ut(q,g,R),pr(x,g,null),ut(q,w,R),ut(q,a,R),pr(S,a,null),P=!0},p(q,R){const F={};R&2&&(F.innerHeight=q[1]),R&8304&&(F.$$scope={dirty:R,ctx:q}),S.$set(F)},i(q){P||(ti(c.$$.fragment,q),ti(x.$$.fragment,q),ti(S.$$.fragment,q),P=!0)},o(q){gi(c.$$.fragment,q),gi(x.$$.fragment,q),gi(S.$$.fragment,q),P=!1},d(q){q&&ht(l),mr(c),q&&ht(m),q&&ht(g),mr(x),q&&ht(w),q&&ht(a),mr(S)}}}function Aw(n){let l,c,m,g,x,w,a,S,P,q,R,F,Q,le,de,fe,De,Ee,xe;function Te(Se){n[10](Se)}let qe={};n[5]!==void 0&&(qe.tileOpacity=n[5]),l=new z0({props:qe}),pn.push(()=>Cl(l,"tileOpacity",Te,n[5])),g=new n0({props:{tileOpacity:n[5]}});function nt(Se){n[11](Se)}function Fe(Se){n[12](Se)}let Pe={};return n[4]!==void 0&&(Pe.squareID=n[4]),n[6]!==void 0&&(Pe.hoverInfo=n[6]),w=new m0({props:Pe}),pn.push(()=>Cl(w,"squareID",nt,n[4])),pn.push(()=>Cl(w,"hoverInfo",Fe,n[6])),q=new b0({props:{squareID:n[4]}}),F=new y0({props:{tileOpacity:n[5]}}),le=new R0({}),fe=new U0({props:{hoverInfo:n[6]}}),Ee=new Iw({}),{c(){Er(l.$$.fragment),m=jt(),Er(g.$$.fragment),x=jt(),Er(w.$$.fragment),P=jt(),Er(q.$$.fragment),R=jt(),Er(F.$$.fragment),Q=jt(),Er(le.$$.fragment),de=jt(),Er(fe.$$.fragment),De=jt(),Er(Ee.$$.fragment)},m(Se,He){pr(l,Se,He),ut(Se,m,He),pr(g,Se,He),ut(Se,x,He),pr(w,Se,He),ut(Se,P,He),pr(q,Se,He),ut(Se,R,He),pr(F,Se,He),ut(Se,Q,He),pr(le,Se,He),ut(Se,de,He),pr(fe,Se,He),ut(Se,De,He),pr(Ee,Se,He),xe=!0},p(Se,He){const Lt={};!c&&He&32&&(c=!0,Lt.tileOpacity=Se[5],Al(()=>c=!1)),l.$set(Lt);const It={};He&32&&(It.tileOpacity=Se[5]),g.$set(It);const Mt={};!a&&He&16&&(a=!0,Mt.squareID=Se[4],Al(()=>a=!1)),!S&&He&64&&(S=!0,Mt.hoverInfo=Se[6],Al(()=>S=!1)),w.$set(Mt);const D={};He&16&&(D.squareID=Se[4]),q.$set(D);const K={};He&32&&(K.tileOpacity=Se[5]),F.$set(K);const H={};He&64&&(H.hoverInfo=Se[6]),fe.$set(H)},i(Se){xe||(ti(l.$$.fragment,Se),ti(g.$$.fragment,Se),ti(w.$$.fragment,Se),ti(q.$$.fragment,Se),ti(F.$$.fragment,Se),ti(le.$$.fragment,Se),ti(fe.$$.fragment,Se),ti(Ee.$$.fragment,Se),xe=!0)},o(Se){gi(l.$$.fragment,Se),gi(g.$$.fragment,Se),gi(w.$$.fragment,Se),gi(q.$$.fragment,Se),gi(F.$$.fragment,Se),gi(le.$$.fragment,Se),gi(fe.$$.fragment,Se),gi(Ee.$$.fragment,Se),xe=!1},d(Se){mr(l,Se),Se&&ht(m),mr(g,Se),Se&&ht(x),mr(w,Se),Se&&ht(P),mr(q,Se),Se&&ht(R),mr(F,Se),Se&&ht(Q),mr(le,Se),Se&&ht(de),mr(fe,Se),Se&&ht(De),mr(Ee,Se)}}}function Cw(n){let l,c,m,g,x;_s(n[7]);let w=n[3]!=="connect"&&Tp(n),a=n[3]=="connect"&&Sp(n);return{c(){w&&w.c(),l=jt(),a&&a.c(),c=wc()},m(S,P){w&&w.m(S,P),ut(S,l,P),a&&a.m(S,P),ut(S,c,P),m=!0,g||(x=ki(window,"resize",n[7]),g=!0)},p(S,[P]){S[3]!=="connect"?w?(w.p(S,P),P&8&&ti(w,1)):(w=Tp(S),w.c(),ti(w,1),w.m(l.parentNode,l)):w&&(go(),gi(w,1,1,()=>{w=null}),_o()),S[3]=="connect"?a?(a.p(S,P),P&8&&ti(a,1)):(a=Sp(S),a.c(),ti(a,1),a.m(c.parentNode,c)):a&&(go(),gi(a,1,1,()=>{a=null}),_o())},i(S){m||(ti(w),ti(a),m=!0)},o(S){gi(w),gi(a),m=!1},d(S){w&&w.d(S),S&&ht(l),a&&a.d(S),S&&ht(c),g=!1,x()}}}function kw(n,l,c){let{innerWidth:m=0}=l,{innerHeight:g=0}=l,{login_username:x="user"}=l,w="password",a,S,P;function q(){c(0,m=window.innerWidth),c(1,g=window.innerHeight)}function R(fe){x=fe,c(2,x)}function F(fe){w=fe,c(3,w)}function Q(fe){S=fe,c(5,S)}function le(fe){a=fe,c(4,a)}function de(fe){P=fe,c(6,P)}return n.$$set=fe=>{"innerWidth"in fe&&c(0,m=fe.innerWidth),"innerHeight"in fe&&c(1,g=fe.innerHeight),"login_username"in fe&&c(2,x=fe.login_username)},[m,g,x,w,a,S,P,q,R,F,Q,le,de]}class Pw extends Ir{constructor(l){super(),Sr(this,l,kw,Cw,gr,{innerWidth:0,innerHeight:1,login_username:2})}}var bc={},zw={get exports(){return bc},set exports(n){bc=n}};(function(n,l){(function(c,m){m(l)})(di,function(c){function m(D,K){if(window.NodeList.prototype.forEach)return D.forEach(K);for(var H=0;H<D.length;H++)K.call(window,D[H],H,D)}function g(){var D=new Date().getTime();return typeof window.performance<"u"&&typeof window.performance.now=="function"&&(D+=window.performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(K){var H=(D+Math.random()*16)%16|0;return D=Math.floor(D/16),(K==="x"?H:H&3|8).toString(16)})}function x(){for(var D=function(Ne){var Re={},Ce=function(Ge,Ve){for(var st in Ge)if(Object.prototype.hasOwnProperty.call(Ge,st)){var At=Ge[st],zt=Ve?Ve+"."+st:st;typeof At=="object"?Ce(At,zt):Re[zt]=At}};return Ce(Ne),Re},K={},H=0;H<arguments.length;H++){var Be=D(arguments[H]);for(var me in Be)Object.prototype.hasOwnProperty.call(Be,me)&&(K[me]=Be[me])}return K}function w(D,K){if(!D||typeof D!="object")throw new Error('Provide a `configObject` of type "object".');if(!K||typeof K!="string")throw new Error('Provide a `namespace` of type "string" to filter the `configObject` by.');var H={};for(var Be in D){var me=Be.split(".");if(Object.prototype.hasOwnProperty.call(D,Be)&&me[0]===K){me.length>1&&me.shift();var Ne=me.join(".");H[Ne]=D[Be]}}return H}(function(D){var K="defineProperty"in Object&&function(){try{var H={};return Object.defineProperty(H,"test",{value:42}),!0}catch{return!1}}();K||function(H){var Be=Object.prototype.hasOwnProperty("__defineGetter__"),me="Getters & setters cannot be defined on this javascript engine",Ne="A property cannot both have accessors and be writable or have a value";Object.defineProperty=function(Ce,Ge,Ve){if(H&&(Ce===window||Ce===document||Ce===Element.prototype||Ce instanceof Element))return H(Ce,Ge,Ve);if(Ce===null||!(Ce instanceof Object||typeof Ce=="object"))throw new TypeError("Object.defineProperty called on non-object");if(!(Ve instanceof Object))throw new TypeError("Property description must be an object");var st=String(Ge),At="value"in Ve||"writable"in Ve,zt="get"in Ve&&typeof Ve.get,St="set"in Ve&&typeof Ve.set;if(zt){if(zt!=="function")throw new TypeError("Getter must be a function");if(!Be)throw new TypeError(me);if(At)throw new TypeError(Ne);Object.__defineGetter__.call(Ce,st,Ve.get)}else Ce[st]=Ve.value;if(St){if(St!=="function")throw new TypeError("Setter must be a function");if(!Be)throw new TypeError(me);if(At)throw new TypeError(Ne);Object.__defineSetter__.call(Ce,st,Ve.set)}return"value"in Ve&&(Ce[st]=Ve.value),Ce}}(Object.defineProperty)}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{}),function(D){var K="Document"in this;K||typeof WorkerGlobalScope>"u"&&typeof importScripts!="function"&&(this.HTMLDocument?this.Document=this.HTMLDocument:(this.Document=this.HTMLDocument=document.constructor=new Function("return function Document() {}")(),this.Document.prototype=document))}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{}),function(D){var K="Element"in this&&"HTMLElement"in this;K||function(){if(window.Element&&!window.HTMLElement){window.HTMLElement=window.Element;return}window.Element=window.HTMLElement=new Function("return function Element() {}")();var H=document.appendChild(document.createElement("body")),Be=H.appendChild(document.createElement("iframe")),me=Be.contentWindow.document,Ne=Element.prototype=me.appendChild(me.createElement("*")),Re={},Ce=function(St,Ft){var ii=St.childNodes||[],ri=-1,Bt,Ht,Ot;if(St.nodeType===1&&St.constructor!==Element){St.constructor=Element;for(Bt in Re)Ht=Re[Bt],St[Bt]=Ht}for(;Ot=Ft&&ii[++ri];)Ce(Ot,Ft);return St},Ge=document.getElementsByTagName("*"),Ve=document.createElement,st,At=100;Ne.attachEvent("onpropertychange",function(St){for(var Ft=St.propertyName,ii=!Re.hasOwnProperty(Ft),ri=Ne[Ft],Bt=Re[Ft],Ht=-1,Ot;Ot=Ge[++Ht];)Ot.nodeType===1&&(ii||Ot[Ft]===Bt)&&(Ot[Ft]=ri);Re[Ft]=ri}),Ne.constructor=Element,Ne.hasAttribute||(Ne.hasAttribute=function(Ft){return this.getAttribute(Ft)!==null});function zt(){return At--||clearTimeout(st),document.body&&!document.body.prototype&&/(complete|interactive)/.test(document.readyState)?(Ce(document,!0),st&&document.body.prototype&&clearTimeout(st),!!document.body.prototype):!1}zt()||(document.onreadystatechange=zt,st=setInterval(zt,25)),document.createElement=function(Ft){var ii=Ve(String(Ft).toLowerCase());return Ce(ii)},document.removeChild(H)}()}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{}),function(D){var K=function(){if(!document.documentElement.dataset)return!1;var H=document.createElement("div");return H.setAttribute("data-a-b","c"),H.dataset&&H.dataset.aB=="c"}();K||Object.defineProperty(Element.prototype,"dataset",{get:function(){for(var H=this,Be=this.attributes,me={},Ne=0;Ne<Be.length;Ne++){var Re=Be[Ne];if(Re&&Re.name&&/^data-\w[.\w-]*$/.test(Re.name)){var Ce=Re.name,Ge=Re.value,Ve=Ce.substr(5).replace(/-./g,function(st){return st.charAt(1).toUpperCase()});"__defineGetter__"in Object.prototype&&"__defineSetter__"in Object.prototype?Object.defineProperty(me,Ve,{enumerable:!0,get:function(){return this.value}.bind({value:Ge||""}),set:function(At,zt){typeof zt<"u"?this.setAttribute(At,zt):this.removeAttribute(At)}.bind(H,Ce)}):me[Ve]=Ge}}return me}})}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{}),function(D){var K="trim"in String.prototype;K||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")})}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{});function a(D){if(typeof D!="string")return D;var K=D.trim();return K==="true"?!0:K==="false"?!1:K.length>0&&isFinite(K)?Number(K):D}function S(D){var K={};for(var H in D)K[H]=a(D[H]);return K}function P(D,K){this.translations=D||{},this.locale=K&&K.locale||document.documentElement.lang||"en"}P.prototype.t=function(D,K){if(!D)throw new Error("i18n: lookup key missing");if(K&&typeof K.count<"u"&&(D=D+"."+this.getPluralSuffix(D,K.count)),D in this.translations){var H=this.translations[D];if(H.match(/%{(.\S+)}/)){if(!K)throw new Error("i18n: cannot replace placeholders in string if no option data provided");return this.replacePlaceholders(H,K)}else return H}else return D},P.prototype.replacePlaceholders=function(D,K){var H;return this.hasIntlNumberFormatSupport()&&(H=new Intl.NumberFormat(this.locale)),D.replace(/%{(.\S+)}/g,function(Be,me){if(Object.prototype.hasOwnProperty.call(K,me)){var Ne=K[me];return Ne===!1?"":typeof Ne=="number"&&H?H.format(Ne):Ne}else throw new Error("i18n: no data found to replace "+Be+" placeholder in string")})},P.prototype.hasIntlPluralRulesSupport=function(){return Boolean(window.Intl&&"PluralRules"in window.Intl&&Intl.PluralRules.supportedLocalesOf(this.locale).length)},P.prototype.hasIntlNumberFormatSupport=function(){return Boolean(window.Intl&&"NumberFormat"in window.Intl&&Intl.NumberFormat.supportedLocalesOf(this.locale).length)},P.prototype.getPluralSuffix=function(D,K){if(K=Number(K),!isFinite(K))return"other";var H;if(this.hasIntlPluralRulesSupport()?H=new Intl.PluralRules(this.locale).select(K):H=this.selectPluralFormUsingFallbackRules(K),D+"."+H in this.translations)return H;if(D+".other"in this.translations)return console&&"warn"in console&&console.warn('i18n: Missing plural form ".'+H+'" for "'+this.locale+'" locale. Falling back to ".other".'),"other";throw new Error('i18n: Plural form ".other" is required for "'+this.locale+'" locale')},P.prototype.selectPluralFormUsingFallbackRules=function(D){D=Math.abs(Math.floor(D));var K=this.getPluralRulesForLocale();return K?P.pluralRules[K](D):"other"},P.prototype.getPluralRulesForLocale=function(){var D=this.locale,K=D.split("-")[0];for(var H in P.pluralRulesMap)if(Object.prototype.hasOwnProperty.call(P.pluralRulesMap,H)){for(var Be=P.pluralRulesMap[H],me=0;me<Be.length;me++)if(Be[me]===D||Be[me]===K)return H}},P.pluralRulesMap={arabic:["ar"],chinese:["my","zh","id","ja","jv","ko","ms","th","vi"],french:["hy","bn","fr","gu","hi","fa","pa","zu"],german:["af","sq","az","eu","bg","ca","da","nl","en","et","fi","ka","de","el","hu","lb","no","so","sw","sv","ta","te","tr","ur"],irish:["ga"],russian:["ru","uk"],scottish:["gd"],spanish:["pt-PT","it","es"],welsh:["cy"]},P.pluralRules={arabic:function(D){return D===0?"zero":D===1?"one":D===2?"two":D%100>=3&&D%100<=10?"few":D%100>=11&&D%100<=99?"many":"other"},chinese:function(){return"other"},french:function(D){return D===0||D===1?"one":"other"},german:function(D){return D===1?"one":"other"},irish:function(D){return D===1?"one":D===2?"two":D>=3&&D<=6?"few":D>=7&&D<=10?"many":"other"},russian:function(D){var K=D%100,H=K%10;return H===1&&K!==11?"one":H>=2&&H<=4&&!(K>=12&&K<=14)?"few":H===0||H>=5&&H<=9||K>=11&&K<=14?"many":"other"},scottish:function(D){return D===1||D===11?"one":D===2||D===12?"two":D>=3&&D<=10||D>=13&&D<=19?"few":"other"},spanish:function(D){return D===1?"one":D%1e6===0&&D!==0?"many":"other"},welsh:function(D){return D===0?"zero":D===1?"one":D===2?"two":D===3?"few":D===6?"many":"other"}},function(D){var K="DOMTokenList"in this&&function(H){return"classList"in H?!H.classList.toggle("x",!1)&&!H.className:!0}(document.createElement("x"));K||function(H){var Be="DOMTokenList"in H&&H.DOMTokenList;(!Be||document.createElementNS&&document.createElementNS("http://www.w3.org/2000/svg","svg")&&!(document.createElementNS("http://www.w3.org/2000/svg","svg").classList instanceof DOMTokenList))&&(H.DOMTokenList=function(){var me=!0,Ne=function(Ce,Ge,Ve,st){Object.defineProperty?Object.defineProperty(Ce,Ge,{configurable:me===!1?!0:!!st,get:Ve}):Ce.__defineGetter__(Ge,Ve)};try{Ne({},"support")}catch{me=!1}var Re=function(Ce,Ge){var Ve=this,st=[],At={},zt=0,St=0,Ft=function(Bt){Ne(Ve,Bt,function(){return ri(),st[Bt]},!1)},ii=function(){if(zt>=St)for(;St<zt;++St)Ft(St)},ri=function(){var Bt,Ht,Ot=arguments,Pi=/\s+/;if(Ot.length){for(Ht=0;Ht<Ot.length;++Ht)if(Pi.test(Ot[Ht]))throw Bt=new SyntaxError('String "'+Ot[Ht]+'" contains an invalid character'),Bt.code=5,Bt.name="InvalidCharacterError",Bt}for(typeof Ce[Ge]=="object"?st=(""+Ce[Ge].baseVal).replace(/^\s+|\s+$/g,"").split(Pi):st=(""+Ce[Ge]).replace(/^\s+|\s+$/g,"").split(Pi),st[0]===""&&(st=[]),At={},Ht=0;Ht<st.length;++Ht)At[st[Ht]]=!0;zt=st.length,ii()};return ri(),Ne(Ve,"length",function(){return ri(),zt}),Ve.toLocaleString=Ve.toString=function(){return ri(),st.join(" ")},Ve.item=function(Bt){return ri(),st[Bt]},Ve.contains=function(Bt){return ri(),!!At[Bt]},Ve.add=function(){ri.apply(Ve,Bt=arguments);for(var Bt,Ht,Ot=0,Pi=Bt.length;Ot<Pi;++Ot)Ht=Bt[Ot],At[Ht]||(st.push(Ht),At[Ht]=!0);zt!==st.length&&(zt=st.length>>>0,typeof Ce[Ge]=="object"?Ce[Ge].baseVal=st.join(" "):Ce[Ge]=st.join(" "),ii())},Ve.remove=function(){ri.apply(Ve,Bt=arguments);for(var Bt,Ht={},Ot=0,Pi=[];Ot<Bt.length;++Ot)Ht[Bt[Ot]]=!0,delete At[Bt[Ot]];for(Ot=0;Ot<st.length;++Ot)Ht[st[Ot]]||Pi.push(st[Ot]);st=Pi,zt=Pi.length>>>0,typeof Ce[Ge]=="object"?Ce[Ge].baseVal=st.join(" "):Ce[Ge]=st.join(" "),ii()},Ve.toggle=function(Bt,Ht){return ri.apply(Ve,[Bt]),D!==Ht?Ht?(Ve.add(Bt),!0):(Ve.remove(Bt),!1):At[Bt]?(Ve.remove(Bt),!1):(Ve.add(Bt),!0)},Ve};return Re}()),function(){var me=document.createElement("span");"classList"in me&&(me.classList.toggle("x",!1),me.classList.contains("x")&&(me.classList.constructor.prototype.toggle=function(Re){var Ce=arguments[1];if(Ce===D){var Ge=!this.contains(Re);return this[Ge?"add":"remove"](Re),Ge}return Ce=!!Ce,this[Ce?"add":"remove"](Re),Ce}))}(),function(){var me=document.createElement("span");if("classList"in me&&(me.classList.add("a","b"),!me.classList.contains("b"))){var Ne=me.classList.constructor.prototype.add;me.classList.constructor.prototype.add=function(){for(var Re=arguments,Ce=arguments.length,Ge=0;Ge<Ce;Ge++)Ne.call(this,Re[Ge])}}}(),function(){var me=document.createElement("span");if("classList"in me&&(me.classList.add("a"),me.classList.add("b"),me.classList.remove("a","b"),!!me.classList.contains("b"))){var Ne=me.classList.constructor.prototype.remove;me.classList.constructor.prototype.remove=function(){for(var Re=arguments,Ce=arguments.length,Ge=0;Ge<Ce;Ge++)Ne.call(this,Re[Ge])}}}()}(this)}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{}),function(D){var K="document"in this&&"classList"in document.documentElement&&"Element"in this&&"classList"in Element.prototype&&function(){var H=document.createElement("span");return H.classList.add("a","b"),H.classList.contains("b")}();K||function(H){var Be=!0,me=function(Re,Ce,Ge,Ve){Object.defineProperty?Object.defineProperty(Re,Ce,{configurable:Be===!1?!0:!!Ve,get:Ge}):Re.__defineGetter__(Ce,Ge)};try{me({},"support")}catch{Be=!1}var Ne=function(Re,Ce,Ge){me(Re.prototype,Ce,function(){var Ve,st=this,At="__defineGetter__DEFINE_PROPERTY"+Ce;if(st[At])return Ve;if(st[At]=!0,Be===!1){for(var zt,St=Ne.mirror||document.createElement("div"),Ft=St.childNodes,ii=Ft.length,ri=0;ri<ii;++ri)if(Ft[ri]._R===st){zt=Ft[ri];break}zt||(zt=St.appendChild(document.createElement("div"))),Ve=DOMTokenList.call(zt,st,Ge)}else Ve=new DOMTokenList(st,Ge);return me(st,Ce,function(){return Ve}),delete st[At],Ve},!0)};Ne(H.Element,"classList","className"),Ne(H.HTMLElement,"classList","className"),Ne(H.HTMLLinkElement,"relList","rel"),Ne(H.HTMLAnchorElement,"relList","rel"),Ne(H.HTMLAreaElement,"relList","rel")}(this)}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{}),function(D){var K="document"in this&&"matches"in document.documentElement;K||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.mozMatchesSelector||function(Be){for(var me=this,Ne=(me.document||me.ownerDocument).querySelectorAll(Be),Re=0;Ne[Re]&&Ne[Re]!==me;)++Re;return!!Ne[Re]})}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{}),function(D){var K="document"in this&&"closest"in document.documentElement;K||(Element.prototype.closest=function(Be){for(var me=this;me;){if(me.matches(Be))return me;me="SVGElement"in window&&me instanceof SVGElement?me.parentNode:me.parentElement}return null})}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{}),function(D){var K="Window"in this;K||typeof WorkerGlobalScope>"u"&&typeof importScripts!="function"&&function(H){H.constructor?H.Window=H.constructor:(H.Window=H.constructor=new Function("return function Window() {}")()).prototype=this}(this)}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{}),function(D){var K=function(H){if(!("Event"in H))return!1;if(typeof H.Event=="function")return!0;try{return new Event("click"),!0}catch{return!1}}(this);K||function(){var H={click:1,dblclick:1,keyup:1,keypress:1,keydown:1,mousedown:1,mouseup:1,mousemove:1,mouseover:1,mouseenter:1,mouseleave:1,mouseout:1,storage:1,storagecommit:1,textinput:1};if(typeof document>"u"||typeof window>"u")return;function Be(Ne,Re){for(var Ce=-1,Ge=Ne.length;++Ce<Ge;)if(Ce in Ne&&Ne[Ce]===Re)return Ce;return-1}var me=window.Event&&window.Event.prototype||null;window.Event=Window.prototype.Event=function(Re,Ce){if(!Re)throw new Error("Not enough arguments");var Ge;if("createEvent"in document){Ge=document.createEvent("Event");var Ve=Ce&&Ce.bubbles!==D?Ce.bubbles:!1,st=Ce&&Ce.cancelable!==D?Ce.cancelable:!1;return Ge.initEvent(Re,Ve,st),Ge}return Ge=document.createEventObject(),Ge.type=Re,Ge.bubbles=Ce&&Ce.bubbles!==D?Ce.bubbles:!1,Ge.cancelable=Ce&&Ce.cancelable!==D?Ce.cancelable:!1,Ge},me&&Object.defineProperty(window.Event,"prototype",{configurable:!1,enumerable:!1,writable:!0,value:me}),"createEvent"in document||(window.addEventListener=Window.prototype.addEventListener=Document.prototype.addEventListener=Element.prototype.addEventListener=function(){var Re=this,Ce=arguments[0],Ge=arguments[1];if(Re===window&&Ce in H)throw new Error("In IE8 the event: "+Ce+" is not available on the window object. Please see https://github.com/Financial-Times/polyfill-service/issues/317 for more information.");Re._events||(Re._events={}),Re._events[Ce]||(Re._events[Ce]=function(Ve){var st=Re._events[Ve.type].list,At=st.slice(),zt=-1,St=At.length,Ft;for(Ve.preventDefault=function(){Ve.cancelable!==!1&&(Ve.returnValue=!1)},Ve.stopPropagation=function(){Ve.cancelBubble=!0},Ve.stopImmediatePropagation=function(){Ve.cancelBubble=!0,Ve.cancelImmediate=!0},Ve.currentTarget=Re,Ve.relatedTarget=Ve.fromElement||null,Ve.target=Ve.target||Ve.srcElement||Re,Ve.timeStamp=new Date().getTime(),Ve.clientX&&(Ve.pageX=Ve.clientX+document.documentElement.scrollLeft,Ve.pageY=Ve.clientY+document.documentElement.scrollTop);++zt<St&&!Ve.cancelImmediate;)zt in At&&(Ft=At[zt],Be(st,Ft)!==-1&&typeof Ft=="function"&&Ft.call(Re,Ve))},Re._events[Ce].list=[],Re.attachEvent&&Re.attachEvent("on"+Ce,Re._events[Ce])),Re._events[Ce].list.push(Ge)},window.removeEventListener=Window.prototype.removeEventListener=Document.prototype.removeEventListener=Element.prototype.removeEventListener=function(){var Re=this,Ce=arguments[0],Ge=arguments[1],Ve;Re._events&&Re._events[Ce]&&Re._events[Ce].list&&(Ve=Be(Re._events[Ce].list,Ge),Ve!==-1&&(Re._events[Ce].list.splice(Ve,1),Re._events[Ce].list.length||(Re.detachEvent&&Re.detachEvent("on"+Ce,Re._events[Ce]),delete Re._events[Ce])))},window.dispatchEvent=Window.prototype.dispatchEvent=Document.prototype.dispatchEvent=Element.prototype.dispatchEvent=function(Re){if(!arguments.length)throw new Error("Not enough arguments");if(!Re||typeof Re.type!="string")throw new Error("DOM Events Exception 0");var Ce=this,Ge=Re.type;try{if(!Re.bubbles){Re.cancelBubble=!0;var Ve=function(st){st.cancelBubble=!0,(Ce||window).detachEvent("on"+Ge,Ve)};this.attachEvent("on"+Ge,Ve)}this.fireEvent("on"+Ge,Re)}catch{Re.target=Ce;do Re.currentTarget=Ce,"_events"in Ce&&typeof Ce._events[Ge]=="function"&&Ce._events[Ge].call(Ce,Re),typeof Ce["on"+Ge]=="function"&&Ce["on"+Ge].call(Ce,Re),Ce=Ce.nodeType===9?Ce.parentWindow:Ce.parentNode;while(Ce&&!Re.cancelBubble)}return!0},document.attachEvent("onreadystatechange",function(){document.readyState==="complete"&&document.dispatchEvent(new Event("DOMContentLoaded",{bubbles:!0}))}))}()}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{}),function(D){var K="bind"in Function.prototype;K||Object.defineProperty(Function.prototype,"bind",{value:function(Be){var me=Array,Ne=Object,Re=Ne.prototype,Ce=me.prototype,Ge=function(){},Ve=Re.toString,st=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",At,zt=Function.prototype.toString,St=function(yr){try{return zt.call(yr),!0}catch{return!1}},Ft="[object Function]",ii="[object GeneratorFunction]";At=function(yr){if(typeof yr!="function")return!1;if(st)return St(yr);var mn=Ve.call(yr);return mn===Ft||mn===ii};var ri=Ce.slice,Bt=Ce.concat,Ht=Ce.push,Ot=Math.max,Pi=this;if(!At(Pi))throw new TypeError("Function.prototype.bind called on incompatible "+Pi);for(var Vr=ri.call(arguments,1),Xr,Dn=function(){if(this instanceof Xr){var lr=Pi.apply(this,Bt.call(Vr,ri.call(arguments)));return Ne(lr)===lr?lr:this}else return Pi.apply(Be,Bt.call(Vr,ri.call(arguments)))},Kn=Ot(0,Pi.length-Vr.length),Wt=[],_r=0;_r<Kn;_r++)Ht.call(Wt,"$"+_r);return Xr=Function("binder","return function ("+Wt.join(",")+"){ return binder.apply(this, arguments); }")(Dn),Pi.prototype&&(Ge.prototype=Pi.prototype,Xr.prototype=new Ge,Ge.prototype=null),Xr}})}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{});var q={hideAllSections:"Hide all sections",hideSection:"Hide",hideSectionAriaLabel:"Hide this section",showAllSections:"Show all sections",showSection:"Show",showSectionAriaLabel:"Show this section"};function R(D,K){this.$module=D;var H={i18n:q};this.config=x(H,K||{},S(D.dataset)),this.i18n=new P(w(this.config,"i18n")),this.controlsClass="govuk-accordion__controls",this.showAllClass="govuk-accordion__show-all",this.showAllTextClass="govuk-accordion__show-all-text",this.sectionClass="govuk-accordion__section",this.sectionExpandedClass="govuk-accordion__section--expanded",this.sectionButtonClass="govuk-accordion__section-button",this.sectionHeaderClass="govuk-accordion__section-header",this.sectionHeadingClass="govuk-accordion__section-heading",this.sectionHeadingDividerClass="govuk-accordion__section-heading-divider",this.sectionHeadingTextClass="govuk-accordion__section-heading-text",this.sectionHeadingTextFocusClass="govuk-accordion__section-heading-text-focus",this.sectionShowHideToggleClass="govuk-accordion__section-toggle",this.sectionShowHideToggleFocusClass="govuk-accordion__section-toggle-focus",this.sectionShowHideTextClass="govuk-accordion__section-toggle-text",this.upChevronIconClass="govuk-accordion-nav__chevron",this.downChevronIconClass="govuk-accordion-nav__chevron--down",this.sectionSummaryClass="govuk-accordion__section-summary",this.sectionSummaryFocusClass="govuk-accordion__section-summary-focus",this.sectionContentClass="govuk-accordion__section-content",this.$sections=this.$module.querySelectorAll("."+this.sectionClass),this.browserSupportsSessionStorage=F.checkForSessionStorage()}R.prototype.init=function(){if(this.$module){this.initControls(),this.initSectionHeaders();var D=this.checkIfAllSectionsOpen();this.updateShowAllButton(D)}},R.prototype.initControls=function(){this.$showAllButton=document.createElement("button"),this.$showAllButton.setAttribute("type","button"),this.$showAllButton.setAttribute("class",this.showAllClass),this.$showAllButton.setAttribute("aria-expanded","false"),this.$showAllIcon=document.createElement("span"),this.$showAllIcon.classList.add(this.upChevronIconClass),this.$showAllButton.appendChild(this.$showAllIcon);var D=document.createElement("div");D.setAttribute("class",this.controlsClass),D.appendChild(this.$showAllButton),this.$module.insertBefore(D,this.$module.firstChild),this.$showAllText=document.createElement("span"),this.$showAllText.classList.add(this.showAllTextClass),this.$showAllButton.appendChild(this.$showAllText),this.$showAllButton.addEventListener("click",this.onShowOrHideAllToggle.bind(this)),"onbeforematch"in document&&document.addEventListener("beforematch",this.onBeforeMatch.bind(this))},R.prototype.initSectionHeaders=function(){m(this.$sections,function(D,K){var H=D.querySelector("."+this.sectionHeaderClass);this.constructHeaderMarkup(H,K),this.setExpanded(this.isExpanded(D),D),H.addEventListener("click",this.onSectionToggle.bind(this,D)),this.setInitialState(D)}.bind(this))},R.prototype.constructHeaderMarkup=function(D,K){var H=D.querySelector("."+this.sectionButtonClass),Be=D.querySelector("."+this.sectionHeadingClass),me=D.querySelector("."+this.sectionSummaryClass),Ne=document.createElement("button");Ne.setAttribute("type","button"),Ne.setAttribute("aria-controls",this.$module.id+"-content-"+(K+1));for(var Re=0;Re<H.attributes.length;Re++){var Ce=H.attributes.item(Re);Ce.nodeName!=="id"&&Ne.setAttribute(Ce.nodeName,Ce.nodeValue)}var Ge=document.createElement("span");Ge.classList.add(this.sectionHeadingTextClass),Ge.id=H.id;var Ve=document.createElement("span");Ve.classList.add(this.sectionHeadingTextFocusClass),Ge.appendChild(Ve),Ve.innerHTML=H.innerHTML;var st=document.createElement("span");st.classList.add(this.sectionShowHideToggleClass),st.setAttribute("data-nosnippet","");var At=document.createElement("span");At.classList.add(this.sectionShowHideToggleFocusClass),st.appendChild(At);var zt=document.createElement("span"),St=document.createElement("span");if(St.classList.add(this.upChevronIconClass),At.appendChild(St),zt.classList.add(this.sectionShowHideTextClass),At.appendChild(zt),Ne.appendChild(Ge),Ne.appendChild(this.getButtonPunctuationEl()),typeof me<"u"&&me!==null){var Ft=document.createElement("span"),ii=document.createElement("span");ii.classList.add(this.sectionSummaryFocusClass),Ft.appendChild(ii);for(var ri=0,Bt=me.attributes.length;ri<Bt;++ri){var Ht=me.attributes.item(ri).nodeName,Ot=me.attributes.item(ri).nodeValue;Ft.setAttribute(Ht,Ot)}ii.innerHTML=me.innerHTML,me.parentNode.replaceChild(Ft,me),Ne.appendChild(Ft),Ne.appendChild(this.getButtonPunctuationEl())}Ne.appendChild(st),Be.removeChild(H),Be.appendChild(Ne)},R.prototype.onBeforeMatch=function(D){var K=D.target.closest("."+this.sectionClass);K&&this.setExpanded(!0,K)},R.prototype.onSectionToggle=function(D){var K=this.isExpanded(D);this.setExpanded(!K,D),this.storeState(D)},R.prototype.onShowOrHideAllToggle=function(){var D=this,K=this.$sections,H=!this.checkIfAllSectionsOpen();m(K,function(Be){D.setExpanded(H,Be),D.storeState(Be)}),D.updateShowAllButton(H)},R.prototype.setExpanded=function(D,K){var H=K.querySelector("."+this.upChevronIconClass),Be=K.querySelector("."+this.sectionShowHideTextClass),me=K.querySelector("."+this.sectionButtonClass),Ne=K.querySelector("."+this.sectionContentClass),Re=D?this.i18n.t("hideSection"):this.i18n.t("showSection");Be.innerText=Re,me.setAttribute("aria-expanded",D);var Ce=[],Ge=K.querySelector("."+this.sectionHeadingTextClass);Ge&&Ce.push(Ge.innerText.trim());var Ve=K.querySelector("."+this.sectionSummaryClass);Ve&&Ce.push(Ve.innerText.trim());var st=D?this.i18n.t("hideSectionAriaLabel"):this.i18n.t("showSectionAriaLabel");Ce.push(st),me.setAttribute("aria-label",Ce.join(" , ")),D?(Ne.removeAttribute("hidden"),K.classList.add(this.sectionExpandedClass),H.classList.remove(this.downChevronIconClass)):(Ne.setAttribute("hidden","until-found"),K.classList.remove(this.sectionExpandedClass),H.classList.add(this.downChevronIconClass));var At=this.checkIfAllSectionsOpen();this.updateShowAllButton(At)},R.prototype.isExpanded=function(D){return D.classList.contains(this.sectionExpandedClass)},R.prototype.checkIfAllSectionsOpen=function(){var D=this.$sections.length,K=this.$module.querySelectorAll("."+this.sectionExpandedClass).length,H=D===K;return H},R.prototype.updateShowAllButton=function(D){var K=D?this.i18n.t("hideAllSections"):this.i18n.t("showAllSections");this.$showAllButton.setAttribute("aria-expanded",D),this.$showAllText.innerText=K,D?this.$showAllIcon.classList.remove(this.downChevronIconClass):this.$showAllIcon.classList.add(this.downChevronIconClass)};var F={checkForSessionStorage:function(){var D="this is the test string",K;try{return window.sessionStorage.setItem(D,D),K=window.sessionStorage.getItem(D)===D.toString(),window.sessionStorage.removeItem(D),K}catch{return!1}}};R.prototype.storeState=function(D){if(this.browserSupportsSessionStorage){var K=D.querySelector("."+this.sectionButtonClass);if(K){var H=K.getAttribute("aria-controls"),Be=K.getAttribute("aria-expanded");H&&Be&&window.sessionStorage.setItem(H,Be)}}},R.prototype.setInitialState=function(D){if(this.browserSupportsSessionStorage){var K=D.querySelector("."+this.sectionButtonClass);if(K){var H=K.getAttribute("aria-controls"),Be=H?window.sessionStorage.getItem(H):null;Be!==null&&this.setExpanded(Be==="true",D)}}},R.prototype.getButtonPunctuationEl=function(){var D=document.createElement("span");return D.classList.add("govuk-visually-hidden",this.sectionHeadingDividerClass),D.innerHTML=", ",D};var Q=32,le=1;function de(D,K){if(!D)return this;this.$module=D,this.debounceFormSubmitTimer=null;var H={preventDoubleClick:!1};this.config=x(H,K||{},S(D.dataset))}de.prototype.init=function(){this.$module&&(this.$module.addEventListener("keydown",this.handleKeyDown),this.$module.addEventListener("click",this.debounce.bind(this)))},de.prototype.handleKeyDown=function(D){var K=D.target;K.getAttribute("role")==="button"&&D.keyCode===Q&&(D.preventDefault(),K.click())},de.prototype.debounce=function(D){if(this.config.preventDoubleClick){if(this.debounceFormSubmitTimer)return D.preventDefault(),!1;this.debounceFormSubmitTimer=setTimeout(function(){this.debounceFormSubmitTimer=null}.bind(this),le*1e3)}};function fe(D,K){var H=D.closest("["+K+"]");if(H)return H.getAttribute(K)}(function(D){var K="Date"in self&&"now"in self.Date&&"getTime"in self.Date.prototype;K||(Date.now=function(){return new Date().getTime()})}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{});var De={charactersUnderLimit:{one:"You have %{count} character remaining",other:"You have %{count} characters remaining"},charactersAtLimit:"You have 0 characters remaining",charactersOverLimit:{one:"You have %{count} character too many",other:"You have %{count} characters too many"},wordsUnderLimit:{one:"You have %{count} word remaining",other:"You have %{count} words remaining"},wordsAtLimit:"You have 0 words remaining",wordsOverLimit:{one:"You have %{count} word too many",other:"You have %{count} words too many"},textareaDescription:{other:""}};function Ee(D,K){if(!D)return this;var H={threshold:0,i18n:De},Be=S(D.dataset),me={};if(("maxwords"in Be||"maxlength"in Be)&&(me={maxlength:!1,maxwords:!1}),this.config=x(H,K||{},me,Be),this.i18n=new P(w(this.config,"i18n"),{locale:fe(D,"lang")}),this.config.maxwords)this.maxLength=this.config.maxwords;else if(this.config.maxlength)this.maxLength=this.config.maxlength;else return;this.$module=D,this.$textarea=D.querySelector(".govuk-js-character-count"),this.$visibleCountMessage=null,this.$screenReaderCountMessage=null,this.lastInputTimestamp=null}Ee.prototype.init=function(){if(this.$textarea){var D=this.$textarea,K=document.getElementById(D.id+"-info");K.innerText.match(/^\s*$/)&&(K.innerText=this.i18n.t("textareaDescription",{count:this.maxLength})),D.insertAdjacentElement("afterend",K);var H=document.createElement("div");H.className="govuk-character-count__sr-status govuk-visually-hidden",H.setAttribute("aria-live","polite"),this.$screenReaderCountMessage=H,K.insertAdjacentElement("afterend",H);var Be=document.createElement("div");Be.className=K.className,Be.classList.add("govuk-character-count__status"),Be.setAttribute("aria-hidden","true"),this.$visibleCountMessage=Be,K.insertAdjacentElement("afterend",Be),K.classList.add("govuk-visually-hidden"),D.removeAttribute("maxlength"),this.bindChangeEvents(),"onpageshow"in window?window.addEventListener("pageshow",this.updateCountMessage.bind(this)):window.addEventListener("DOMContentLoaded",this.updateCountMessage.bind(this)),this.updateCountMessage()}},Ee.prototype.bindChangeEvents=function(){var D=this.$textarea;D.addEventListener("keyup",this.handleKeyUp.bind(this)),D.addEventListener("focus",this.handleFocus.bind(this)),D.addEventListener("blur",this.handleBlur.bind(this))},Ee.prototype.handleKeyUp=function(){this.updateVisibleCountMessage(),this.lastInputTimestamp=Date.now()},Ee.prototype.handleFocus=function(){this.valueChecker=setInterval(function(){(!this.lastInputTimestamp||Date.now()-500>=this.lastInputTimestamp)&&this.updateIfValueChanged()}.bind(this),1e3)},Ee.prototype.handleBlur=function(){clearInterval(this.valueChecker)},Ee.prototype.updateIfValueChanged=function(){this.$textarea.oldValue||(this.$textarea.oldValue=""),this.$textarea.value!==this.$textarea.oldValue&&(this.$textarea.oldValue=this.$textarea.value,this.updateCountMessage())},Ee.prototype.updateCountMessage=function(){this.updateVisibleCountMessage(),this.updateScreenReaderCountMessage()},Ee.prototype.updateVisibleCountMessage=function(){var D=this.$textarea,K=this.$visibleCountMessage,H=this.maxLength-this.count(D.value);this.isOverThreshold()?K.classList.remove("govuk-character-count__message--disabled"):K.classList.add("govuk-character-count__message--disabled"),H<0?(D.classList.add("govuk-textarea--error"),K.classList.remove("govuk-hint"),K.classList.add("govuk-error-message")):(D.classList.remove("govuk-textarea--error"),K.classList.remove("govuk-error-message"),K.classList.add("govuk-hint")),K.innerText=this.getCountMessage()},Ee.prototype.updateScreenReaderCountMessage=function(){var D=this.$screenReaderCountMessage;this.isOverThreshold()?D.removeAttribute("aria-hidden"):D.setAttribute("aria-hidden",!0),D.innerText=this.getCountMessage()},Ee.prototype.count=function(D){if(this.config.maxwords){var K=D.match(/\S+/g)||[];return K.length}else return D.length},Ee.prototype.getCountMessage=function(){var D=this.maxLength-this.count(this.$textarea.value),K=this.config.maxwords?"words":"characters";return this.formatCountMessage(D,K)},Ee.prototype.formatCountMessage=function(D,K){if(D===0)return this.i18n.t(K+"AtLimit");var H=D<0?"OverLimit":"UnderLimit";return this.i18n.t(K+H,{count:Math.abs(D)})},Ee.prototype.isOverThreshold=function(){if(!this.config.threshold)return!0;var D=this.$textarea,K=this.count(D.value),H=this.maxLength,Be=H*this.config.threshold/100;return Be<=K};function xe(D){this.$module=D,this.$inputs=D.querySelectorAll('input[type="checkbox"]')}xe.prototype.init=function(){var D=this.$module,K=this.$inputs;m(K,function(H){var Be=H.getAttribute("data-aria-controls");!Be||!document.getElementById(Be)||(H.setAttribute("aria-controls",Be),H.removeAttribute("data-aria-controls"))}),"onpageshow"in window?window.addEventListener("pageshow",this.syncAllConditionalReveals.bind(this)):window.addEventListener("DOMContentLoaded",this.syncAllConditionalReveals.bind(this)),this.syncAllConditionalReveals(),D.addEventListener("click",this.handleClick.bind(this))},xe.prototype.syncAllConditionalReveals=function(){m(this.$inputs,this.syncConditionalRevealWithInputState.bind(this))},xe.prototype.syncConditionalRevealWithInputState=function(D){var K=document.getElementById(D.getAttribute("aria-controls"));if(K&&K.classList.contains("govuk-checkboxes__conditional")){var H=D.checked;D.setAttribute("aria-expanded",H),K.classList.toggle("govuk-checkboxes__conditional--hidden",!H)}},xe.prototype.unCheckAllInputsExcept=function(D){var K=document.querySelectorAll('input[type="checkbox"][name="'+D.name+'"]');m(K,function(H){var Be=D.form===H.form;Be&&H!==D&&(H.checked=!1,this.syncConditionalRevealWithInputState(H))}.bind(this))},xe.prototype.unCheckExclusiveInputs=function(D){var K=document.querySelectorAll('input[data-behaviour="exclusive"][type="checkbox"][name="'+D.name+'"]');m(K,function(H){var Be=D.form===H.form;Be&&(H.checked=!1,this.syncConditionalRevealWithInputState(H))}.bind(this))},xe.prototype.handleClick=function(D){var K=D.target;if(K.type==="checkbox"){var H=K.getAttribute("aria-controls");if(H&&this.syncConditionalRevealWithInputState(K),!!K.checked){var Be=K.getAttribute("data-behaviour")==="exclusive";Be?this.unCheckAllInputsExcept(K):this.unCheckExclusiveInputs(K)}}};var Te=13,qe=32;function nt(D){this.$module=D}nt.prototype.init=function(){if(this.$module){var D=typeof this.$module.open=="boolean";D||this.polyfillDetails()}},nt.prototype.polyfillDetails=function(){var D=this.$module,K=this.$summary=D.getElementsByTagName("summary").item(0),H=this.$content=D.getElementsByTagName("div").item(0);!K||!H||(H.id||(H.id="details-content-"+g()),D.setAttribute("role","group"),K.setAttribute("role","button"),K.setAttribute("aria-controls",H.id),K.tabIndex=0,this.$module.hasAttribute("open")?K.setAttribute("aria-expanded","true"):(K.setAttribute("aria-expanded","false"),H.style.display="none"),this.polyfillHandleInputs(this.polyfillSetAttributes.bind(this)))},nt.prototype.polyfillSetAttributes=function(){return this.$module.hasAttribute("open")?(this.$module.removeAttribute("open"),this.$summary.setAttribute("aria-expanded","false"),this.$content.style.display="none"):(this.$module.setAttribute("open","open"),this.$summary.setAttribute("aria-expanded","true"),this.$content.style.display=""),!0},nt.prototype.polyfillHandleInputs=function(D){this.$summary.addEventListener("keypress",function(K){var H=K.target;(K.keyCode===Te||K.keyCode===qe)&&H.nodeName.toLowerCase()==="summary"&&(K.preventDefault(),H.click?H.click():D(K))}),this.$summary.addEventListener("keyup",function(K){var H=K.target;K.keyCode===qe&&H.nodeName.toLowerCase()==="summary"&&K.preventDefault()}),this.$summary.addEventListener("click",D)};function Fe(D,K){if(!D)return this;this.$module=D;var H={disableAutoFocus:!1};this.config=x(H,K||{},S(D.dataset))}Fe.prototype.init=function(){var D=this.$module;D&&(this.setFocus(),D.addEventListener("click",this.handleClick.bind(this)))},Fe.prototype.setFocus=function(){var D=this.$module;this.config.disableAutoFocus||(D.setAttribute("tabindex","-1"),D.addEventListener("blur",function(){D.removeAttribute("tabindex")}),D.focus())},Fe.prototype.handleClick=function(D){var K=D.target;this.focusTarget(K)&&D.preventDefault()},Fe.prototype.focusTarget=function(D){if(D.tagName!=="A"||D.href===!1)return!1;var K=this.getFragmentFromUrl(D.href),H=document.getElementById(K);if(!H)return!1;var Be=this.getAssociatedLegendOrLabel(H);return Be?(Be.scrollIntoView(),H.focus({preventScroll:!0}),!0):!1},Fe.prototype.getFragmentFromUrl=function(D){return D.indexOf("#")===-1?!1:D.split("#").pop()},Fe.prototype.getAssociatedLegendOrLabel=function(D){var K=D.closest("fieldset");if(K){var H=K.getElementsByTagName("legend");if(H.length){var Be=H[0];if(D.type==="checkbox"||D.type==="radio")return Be;var me=Be.getBoundingClientRect().top,Ne=D.getBoundingClientRect();if(Ne.height&&window.innerHeight){var Re=Ne.top+Ne.height;if(Re-me<window.innerHeight/2)return Be}}}return document.querySelector("label[for='"+D.getAttribute("id")+"']")||D.closest("label")};function Pe(D){this.$module=D,this.$menuButton=D&&D.querySelector(".govuk-js-header-toggle"),this.$menu=this.$menuButton&&D.querySelector("#"+this.$menuButton.getAttribute("aria-controls")),this.menuIsOpen=!1,this.mql=null}Pe.prototype.init=function(){!this.$module||!this.$menuButton||!this.$menu||("matchMedia"in window?(this.mql=window.matchMedia("(min-width: 48.0625em)"),"addEventListener"in this.mql?this.mql.addEventListener("change",this.syncState.bind(this)):this.mql.addListener(this.syncState.bind(this)),this.syncState(),this.$menuButton.addEventListener("click",this.handleMenuButtonClick.bind(this))):this.$menuButton.setAttribute("hidden",""))},Pe.prototype.syncState=function(){this.mql.matches?(this.$menu.removeAttribute("hidden"),this.$menuButton.setAttribute("hidden","")):(this.$menuButton.removeAttribute("hidden"),this.$menuButton.setAttribute("aria-expanded",this.menuIsOpen),this.menuIsOpen?this.$menu.removeAttribute("hidden"):this.$menu.setAttribute("hidden",""))},Pe.prototype.handleMenuButtonClick=function(){this.menuIsOpen=!this.menuIsOpen,this.syncState()};function Se(D,K){this.$module=D;var H={disableAutoFocus:!1};this.config=x(H,K||{},S(D.dataset))}Se.prototype.init=function(){var D=this.$module;D&&this.setFocus()},Se.prototype.setFocus=function(){var D=this.$module;this.config.disableAutoFocus||D.getAttribute("role")==="alert"&&(D.getAttribute("tabindex")||(D.setAttribute("tabindex","-1"),D.addEventListener("blur",function(){D.removeAttribute("tabindex")})),D.focus())};function He(D){this.$module=D,this.$inputs=D.querySelectorAll('input[type="radio"]')}He.prototype.init=function(){var D=this.$module,K=this.$inputs;m(K,function(H){var Be=H.getAttribute("data-aria-controls");!Be||!document.getElementById(Be)||(H.setAttribute("aria-controls",Be),H.removeAttribute("data-aria-controls"))}),"onpageshow"in window?window.addEventListener("pageshow",this.syncAllConditionalReveals.bind(this)):window.addEventListener("DOMContentLoaded",this.syncAllConditionalReveals.bind(this)),this.syncAllConditionalReveals(),D.addEventListener("click",this.handleClick.bind(this))},He.prototype.syncAllConditionalReveals=function(){m(this.$inputs,this.syncConditionalRevealWithInputState.bind(this))},He.prototype.syncConditionalRevealWithInputState=function(D){var K=document.getElementById(D.getAttribute("aria-controls"));if(K&&K.classList.contains("govuk-radios__conditional")){var H=D.checked;D.setAttribute("aria-expanded",H),K.classList.toggle("govuk-radios__conditional--hidden",!H)}},He.prototype.handleClick=function(D){var K=D.target;if(K.type==="radio"){var H=document.querySelectorAll('input[type="radio"][aria-controls]');m(H,function(Be){var me=Be.form===K.form,Ne=Be.name===K.name;Ne&&me&&this.syncConditionalRevealWithInputState(Be)}.bind(this))}};function Lt(D){this.$module=D,this.$linkedElement=null,this.linkedElementListener=!1}Lt.prototype.init=function(){this.$module&&(this.$linkedElement=this.getLinkedElement(),this.$linkedElement&&this.$module.addEventListener("click",this.focusLinkedElement.bind(this)))},Lt.prototype.getLinkedElement=function(){var D=this.getFragmentFromUrl();return D?document.getElementById(D):!1},Lt.prototype.focusLinkedElement=function(){var D=this.$linkedElement;D.getAttribute("tabindex")||(D.setAttribute("tabindex","-1"),D.classList.add("govuk-skip-link-focused-element"),this.linkedElementListener||(this.$linkedElement.addEventListener("blur",this.removeFocusProperties.bind(this)),this.linkedElementListener=!0)),D.focus()},Lt.prototype.removeFocusProperties=function(){this.$linkedElement.removeAttribute("tabindex"),this.$linkedElement.classList.remove("govuk-skip-link-focused-element")},Lt.prototype.getFragmentFromUrl=function(){return this.$module.hash?this.$module.hash.split("#").pop():!1},function(D){var K="document"in this&&"nextElementSibling"in document.documentElement;K||Object.defineProperty(Element.prototype,"nextElementSibling",{get:function(){for(var H=this.nextSibling;H&&H.nodeType!==1;)H=H.nextSibling;return H}})}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{}),function(D){var K="document"in this&&"previousElementSibling"in document.documentElement;K||Object.defineProperty(Element.prototype,"previousElementSibling",{get:function(){for(var H=this.previousSibling;H&&H.nodeType!==1;)H=H.previousSibling;return H}})}.call(typeof window=="object"&&window||typeof self=="object"&&self||typeof di=="object"&&di||{});function It(D){this.$module=D,this.$tabs=D.querySelectorAll(".govuk-tabs__tab"),this.keys={left:37,right:39,up:38,down:40},this.jsHiddenClass="govuk-tabs__panel--hidden"}It.prototype.init=function(){typeof window.matchMedia=="function"?this.setupResponsiveChecks():this.setup()},It.prototype.setupResponsiveChecks=function(){this.mql=window.matchMedia("(min-width: 40.0625em)"),this.mql.addListener(this.checkMode.bind(this)),this.checkMode()},It.prototype.checkMode=function(){this.mql.matches?this.setup():this.teardown()},It.prototype.setup=function(){var D=this.$module,K=this.$tabs,H=D.querySelector(".govuk-tabs__list"),Be=D.querySelectorAll(".govuk-tabs__list-item");if(!(!K||!H||!Be)){H.setAttribute("role","tablist"),m(Be,function(Ne){Ne.setAttribute("role","presentation")}),m(K,function(Ne){this.setAttributes(Ne),Ne.boundTabClick=this.onTabClick.bind(this),Ne.boundTabKeydown=this.onTabKeydown.bind(this),Ne.addEventListener("click",Ne.boundTabClick,!0),Ne.addEventListener("keydown",Ne.boundTabKeydown,!0),this.hideTab(Ne)}.bind(this));var me=this.getTab(window.location.hash)||this.$tabs[0];this.showTab(me),D.boundOnHashChange=this.onHashChange.bind(this),window.addEventListener("hashchange",D.boundOnHashChange,!0)}},It.prototype.teardown=function(){var D=this.$module,K=this.$tabs,H=D.querySelector(".govuk-tabs__list"),Be=D.querySelectorAll(".govuk-tabs__list-item");!K||!H||!Be||(H.removeAttribute("role"),m(Be,function(me){me.removeAttribute("role","presentation")}),m(K,function(me){me.removeEventListener("click",me.boundTabClick,!0),me.removeEventListener("keydown",me.boundTabKeydown,!0),this.unsetAttributes(me)}.bind(this)),window.removeEventListener("hashchange",D.boundOnHashChange,!0))},It.prototype.onHashChange=function(D){var K=window.location.hash,H=this.getTab(K);if(H){if(this.changingHash){this.changingHash=!1;return}var Be=this.getCurrentTab();this.hideTab(Be),this.showTab(H),H.focus()}},It.prototype.hideTab=function(D){this.unhighlightTab(D),this.hidePanel(D)},It.prototype.showTab=function(D){this.highlightTab(D),this.showPanel(D)},It.prototype.getTab=function(D){return this.$module.querySelector('.govuk-tabs__tab[href="'+D+'"]')},It.prototype.setAttributes=function(D){var K=this.getHref(D).slice(1);D.setAttribute("id","tab_"+K),D.setAttribute("role","tab"),D.setAttribute("aria-controls",K),D.setAttribute("aria-selected","false"),D.setAttribute("tabindex","-1");var H=this.getPanel(D);H.setAttribute("role","tabpanel"),H.setAttribute("aria-labelledby",D.id),H.classList.add(this.jsHiddenClass)},It.prototype.unsetAttributes=function(D){D.removeAttribute("id"),D.removeAttribute("role"),D.removeAttribute("aria-controls"),D.removeAttribute("aria-selected"),D.removeAttribute("tabindex");var K=this.getPanel(D);K.removeAttribute("role"),K.removeAttribute("aria-labelledby"),K.classList.remove(this.jsHiddenClass)},It.prototype.onTabClick=function(D){if(!D.target.classList.contains("govuk-tabs__tab"))return!1;D.preventDefault();var K=D.target,H=this.getCurrentTab();this.hideTab(H),this.showTab(K),this.createHistoryEntry(K)},It.prototype.createHistoryEntry=function(D){var K=this.getPanel(D),H=K.id;K.id="",this.changingHash=!0,window.location.hash=this.getHref(D).slice(1),K.id=H},It.prototype.onTabKeydown=function(D){switch(D.keyCode){case this.keys.left:case this.keys.up:this.activatePreviousTab(),D.preventDefault();break;case this.keys.right:case this.keys.down:this.activateNextTab(),D.preventDefault();break}},It.prototype.activateNextTab=function(){var D=this.getCurrentTab();if(D){var K=D.parentElement.nextElementSibling;if(K){var H=K.querySelector(".govuk-tabs__tab");H&&(this.hideTab(D),this.showTab(H),H.focus(),this.createHistoryEntry(H))}}},It.prototype.activatePreviousTab=function(){var D=this.getCurrentTab();if(D){var K=D.parentElement.previousElementSibling;if(K){var H=K.querySelector(".govuk-tabs__tab");H&&(this.hideTab(D),this.showTab(H),H.focus(),this.createHistoryEntry(H))}}},It.prototype.getPanel=function(D){var K=this.$module.querySelector(this.getHref(D));return K},It.prototype.showPanel=function(D){var K=this.getPanel(D);K.classList.remove(this.jsHiddenClass)},It.prototype.hidePanel=function(D){var K=this.getPanel(D);K.classList.add(this.jsHiddenClass)},It.prototype.unhighlightTab=function(D){D.setAttribute("aria-selected","false"),D.parentNode.classList.remove("govuk-tabs__list-item--selected"),D.setAttribute("tabindex","-1")},It.prototype.highlightTab=function(D){D.setAttribute("aria-selected","true"),D.parentNode.classList.add("govuk-tabs__list-item--selected"),D.setAttribute("tabindex","0")},It.prototype.getCurrentTab=function(){return this.$module.querySelector(".govuk-tabs__list-item--selected .govuk-tabs__tab")},It.prototype.getHref=function(D){var K=D.getAttribute("href"),H=K.slice(K.indexOf("#"),K.length);return H};function Mt(D){D=typeof D<"u"?D:{};var K=typeof D.scope<"u"?D.scope:document,H=K.querySelectorAll('[data-module="govuk-accordion"]');m(H,function(St){new R(St,D.accordion).init()});var Be=K.querySelectorAll('[data-module="govuk-button"]');m(Be,function(St){new de(St,D.button).init()});var me=K.querySelectorAll('[data-module="govuk-character-count"]');m(me,function(St){new Ee(St,D.characterCount).init()});var Ne=K.querySelectorAll('[data-module="govuk-checkboxes"]');m(Ne,function(St){new xe(St).init()});var Re=K.querySelectorAll('[data-module="govuk-details"]');m(Re,function(St){new nt(St).init()});var Ce=K.querySelector('[data-module="govuk-error-summary"]');Ce&&new Fe(Ce,D.errorSummary).init();var Ge=K.querySelector('[data-module="govuk-header"]');Ge&&new Pe(Ge).init();var Ve=K.querySelectorAll('[data-module="govuk-notification-banner"]');m(Ve,function(St){new Se(St,D.notificationBanner).init()});var st=K.querySelectorAll('[data-module="govuk-radios"]');m(st,function(St){new He(St).init()});var At=K.querySelector('[data-module="govuk-skip-link"]');new Lt(At).init();var zt=K.querySelectorAll('[data-module="govuk-tabs"]');m(zt,function(St){new It(St).init()})}c.initAll=Mt,c.Accordion=R,c.Button=de,c.Details=nt,c.CharacterCount=Ee,c.Checkboxes=xe,c.ErrorSummary=Fe,c.Header=Pe,c.NotificationBanner=Se,c.Radios=He,c.SkipLink=Lt,c.Tabs=It})})(zw,bc);const Lw=bc;document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";Lw.initAll();new Pw({target:document.getElementById("app")})});export default Dw();
